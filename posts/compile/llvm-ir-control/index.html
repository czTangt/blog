<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>04 LLVM IR Control - czTang</title><meta name=author content="czTang">
<meta name=description content="这里记录 llvm、ir 相关知识。
"><meta name=keywords content='compile'><meta itemprop=name content="04 LLVM IR Control"><meta itemprop=description content="这里记录 llvm、ir 相关知识。"><meta itemprop=datePublished content="2024-11-28T09:48:41+08:00"><meta itemprop=dateModified content="2024-12-10T15:40:15+08:00"><meta itemprop=wordCount content="2863"><meta itemprop=keywords content="Compile"><meta property="og:url" content="https://czTangt.github.io/blog/posts/compile/llvm-ir-control/"><meta property="og:site_name" content="czTang"><meta property="og:title" content="04 LLVM IR Control"><meta property="og:description" content="这里记录 llvm、ir 相关知识。"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-28T09:48:41+08:00"><meta property="article:modified_time" content="2024-12-10T15:40:15+08:00"><meta property="article:tag" content="Compile"><meta name=twitter:card content="summary"><meta name=twitter:title content="04 LLVM IR Control"><meta name=twitter:description content="这里记录 llvm、ir 相关知识。"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202410312135963.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical type=text/html href=https://czTangt.github.io/blog/posts/compile/llvm-ir-control/ title="04 LLVM IR Control - czTang"><link rel=prev type=text/html href=https://czTangt.github.io/blog/posts/reverse/algorithm/ title=逆向中的算法><link rel=next type=text/html href=https://czTangt.github.io/blog/posts/android/unidbg/ title="Unidbg 记录"><link rel=stylesheet href=/blog/css/style.min.css><link rel=preload href=/blog/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/blog/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/blog/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/blog/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"04 LLVM IR Control","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/czTangt.github.io\/blog\/posts\/compile\/llvm-ir-control\/"},"genre":"posts","keywords":"compile","wordcount":2863,"url":"https:\/\/czTangt.github.io\/blog\/posts\/compile\/llvm-ir-control\/","datePublished":"2024-11-28T09:48:41+08:00","dateModified":"2024-12-10T15:40:15+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"czTang"},"description":""}</script><script src=/blog/js/head/color-scheme.min.js></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=left><div class=header-title><a href=/blog/ title=czTang><span class=header-title-pre><i class='fa fa-coffee'>&nbsp</i></span><span class=header-title-text>czTang</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/blog/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Archives</a></li><li class=menu-item><a class=menu-link href=/blog/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/blog/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=/blog/about/><i class="fa-solid fa-user fa-fw fa-sm" aria-hidden=true></i> About</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/blog/ title=czTang><span class=header-title-pre><i class='fa fa-coffee'>&nbsp</i></span><span class=header-title-text>czTang</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/blog/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Archives</a></li><li class=menu-item><a class=menu-link href=/blog/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/blog/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=/blog/about/><i class="fa-solid fa-user fa-fw fa-sm" aria-hidden=true></i> About</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=合集><div class="details collection-details open"><div class="details-summary collection-summary"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i>
<span class=collection-name data-collections=合集>Compile</span>
<span class=collection-count>6</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content collection-content"><nav><ul class=collection-list><li class=collection-item><a href=/blog/posts/compile/lexer-re-automata/ title="01 Lexer Re Automata">01 Lexer Re Automata</a></li><li class=collection-item><a href=/blog/posts/compile/compilers-lab/ title="Compilers Lab">Compilers Lab</a></li><li class=collection-item><a href=/blog/posts/compile/parser-cfg-ll-lr/ title="02 Parser Cfg LL LR">02 Parser Cfg LL LR</a></li><li class=collection-item><a href=/blog/posts/compile/semantics-symboltable-ag/ title="03 Semantics SymbolTable Ag">03 Semantics SymbolTable Ag</a></li><li class=collection-item><span class=active title="04 LLVM IR Control">04 LLVM IR Control</span></li><li class=collection-item><a href=/blog/posts/compile/codegen-riscv-isel-ra/ title="05 Codegen Riscv Isel Ra">05 Codegen Riscv Isel Ra</a></li></ul><div class=collection-nav-simple><a href=/blog/posts/compile/semantics-symboltable-ag/ class=collection-nav-item rel=prev title="03 Semantics SymbolTable Ag"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i></a><span class=text-secondary>5/6</span><a href=/blog/posts/compile/codegen-riscv-isel-ra/ class=collection-nav-item rel=next title="05 Codegen Riscv Isel Ra"><i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></nav></div></div></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>04 LLVM IR Control</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/czTangt title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img loading=lazy src=/blog/images/avatar.jpg alt=czTang data-title=czTang width=20 height=20 class=avatar style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'>&nbsp;czTang</a></span><span class=post-included-in>&nbsp;收录于 <a href=/blog/categories/compile/ class=post-category title="分类 - Compile"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Compile</a> 和 <a href=/blog/collections/compile/ class=post-collection title="合集 - Compile"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> Compile</a></span></div><div class=post-meta-line><span title="发布于 2024-11-28 09:48:41"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2024.11.28>2024.11.28</time></span>&nbsp;<span title="更新于 2024-12-10 15:40:15"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden=true></i><time datetime=2024.12.10>2024.12.10</time></span>&nbsp;<span title="2863 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 2900 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 6 分钟</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#llvm>LLVM</a><ul><li><a href=#介绍>介绍</a></li><li><a href=#ir>IR</a><ul><li><a href=#ir-生成>IR 生成</a></li><li><a href=#不同优化等级的控制流>不同优化等级的控制流</a></li></ul></li></ul></li><li><a href=#中间代码生成>中间代码生成</a><ul><li><a href=#表达式翻译>表达式翻译</a><ul><li><a href=#非布尔表达式翻译>非布尔表达式翻译</a></li><li><a href=#数组引用翻译>数组引用翻译</a></li></ul></li><li><a href=#控制流翻译easy>控制流翻译（easy）</a><ul><li><a href=#if-条件语句>if 条件语句</a></li><li><a href=#if-else-语句>if else 语句</a></li><li><a href=#while-循环语句>while 循环语句</a></li><li><a href=#break-语句>break 语句</a></li><li><a href=#短路求值>短路求值</a></li></ul></li><li><a href=#控制流翻译hard>控制流翻译（hard）</a><ul><li><a href=#if-语句>if 语句</a></li><li><a href=#if-else-语句-1>if else 语句</a></li><li><a href=#while-循环语句-1>while 循环语句</a></li><li><a href=#布尔表达式>布尔表达式</a></li></ul></li><li><a href=#backpatch>backpatch</a><ul><li><a href=#m-属性>M 属性</a></li><li><a href=#n-属性>N 属性</a></li></ul></li></ul></li><li><a href=#目标代码生成>目标代码生成</a></li></ul></nav></div></div><div class=content id=content><p>这里记录 llvm、ir 相关知识。</p><h2 id=llvm class=heading-element><span>LLVM</span>
<a href=#llvm class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 id=介绍 class=heading-element><span>介绍</span>
<a href=#%e4%bb%8b%e7%bb%8d class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class="alert alert-note"><p class=alert-title><svg class="icon" viewBox="0 0 16 16" width="16" height="16"><path d="M0 8a8 8 0 1116 0A8 8 0 010 8zm8-6.5a6.5 6.5.0 100 13 6.5 6.5.0 000-13zM6.5 7.75A.75.75.0 017.25 7h1a.75.75.0 01.75.75v2.75h.25a.75.75.0 010 1.5h-2a.75.75.0 010-1.5h.25v-2h-.25a.75.75.0 01-.75-.75zM8 6a1 1 0 110-2 1 1 0 010 2z"/></svg>注意</p><p>The LLVM Project is a collection of modular and reusable compiler and tool-chain technologies. Despite its name, LLVM has little to do with traditional virtual machines. The name “LLVM” itself is not an acronym; it is the full name of the project.</p></div><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128101801.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128101801.png?size=small" data-sub-html="<h2>20241128101801</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128101801.png alt="LLVM IR" srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128101801.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128101801.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128101801.png?size=large 2x" data-title=20241128101801 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>LLVM IR</figcaption></figure></p><h3 id=ir class=heading-element><span>IR</span>
<a href=#ir class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128101824.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128101824.png?size=small" data-sub-html="<h2>20241128101824</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128101824.png alt=IR srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128101824.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128101824.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128101824.png?size=large 2x" data-title=20241128101824 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>IR</figcaption></figure></p><h4 id=ir-生成 class=heading-element><span>IR 生成</span>
<a href=#ir-%e7%94%9f%e6%88%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>使用 <code>clang -S -emit-llvm -fno-discard-value-names xxx.c -o xxx.ll -O1 -g0</code> 将 c 代码转化为 IR 的形式。</p><ul><li><code>-S</code>：生成汇编代码（IR）作为输出，而不是直接生成二进制文件或可执行文件</li><li><code>-emit-llvm</code>：生成 LLVM 中间表示（IR），而不是目标平台的汇编代码。<code>-S</code> 都是和它一起进行使用</li><li><code>-fno-discard-value-names</code>：在生成的 IR 中不丢弃值的名称（如变量名和函数名），保留符号信息，便于调式或分析</li><li><code>-o xxx.ll</code>：指定生成人类可读的 <code>.ll</code> 形式文件，而不是 bitcode 形式的 <code>.bc</code> 形式文件</li><li><code>-O1</code>：优化级别设置，<code>-O1</code> 表示中等优化级别</li><li><code>-g0</code>：控制调试信息的级别，它表示不包含调试信息</li></ul><p>之后会形成下面形式的代码。它是<strong>强类型</strong>，同时为<strong>三地址码</strong>和<strong>静态单赋值</strong>形式。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128103522.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128103522.png?size=small" data-sub-html="<h2>20241128103522</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128103522.png alt=.ll文件 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128103522.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128103522.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128103522.png?size=large 2x" data-title=20241128103522 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>.ll文件</figcaption></figure></p><p>这里静态单赋值就是每个寄存器只被定义一次，也就是它只在左侧出现一遍，右侧没有限制。这样在软件上就可以实现无限制个数的寄存器了，同时对于变量定义的寻找也更为简便。下面就是 SSA 的转换，要使控制流满足 SSA，那么需要使用 $\phi$ 函数来根据控制流决定选择 y1 还是 y2。</p><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128103929.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128103929.png?size=small" data-sub-html="<h2>20241128103929</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128103929.png alt=SSA转换 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128103929.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128103929.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128103929.png?size=large 2x" data-title=20241128103929 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>SSA转换</figcaption></figure></p><h4 id=不同优化等级的控制流 class=heading-element><span>不同优化等级的控制流</span>
<a href=#%e4%b8%8d%e5%90%8c%e4%bc%98%e5%8c%96%e7%ad%89%e7%ba%a7%e7%9a%84%e6%8e%a7%e5%88%b6%e6%b5%81 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>都是对于下面的代码通过上述命令生成不同优化等级的 IR 代码。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>factorial</span><span class=p>(</span><span class=kt>int</span> <span class=n>val</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>val</span> <span class=o>==</span> <span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>val</span> <span class=o>*</span> <span class=nf>factorial</span><span class=p>(</span><span class=n>val</span> <span class=o>-</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>下面就是没有优化的 CFG 图，可以看出它有一个开辟空间的操作，同时左右分支都把结果传到了 <code>%2</code> 这个寄存器之中，然后返回基本块姐可以直接使用这个进行返回。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128104340.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128104340.png?size=small" data-sub-html="<h2>20241128104340</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128104340.png alt="无优化 CFG" srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128104340.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128104340.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128104340.png?size=large 2x" data-title=20241128104340 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>无优化 CFG</figcaption></figure></p><p>而下面就是 o1 优化的 CFG 图，它使用了 $\phi$ 函数来对分支进行处理，若是从 <code>%3</code> 基本块跳转来的，那么返回值使用 <code>%6</code>；若是从 <code>%1</code> 基本块跳转来的，返回值使用 <code>1</code>。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128110222.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128110222.png?size=small" data-sub-html="<h2>20241128110222</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128110222.png alt="o1 优化 CFG" srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128110222.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128110222.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128110222.png?size=large 2x" data-title=20241128110222 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>o1 优化 CFG</figcaption></figure></p><p>然后对于下面的代码，不同优化等级的 IR 代码列举如下。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>factorial</span><span class=p>(</span><span class=kt>int</span> <span class=n>val</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>temp</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>val</span><span class=p>;</span> <span class=n>i</span> <span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=n>temp</span> <span class=o>*=</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>temp</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>这里没有优化的话，就会出现开辟空间的操作（下面的 <code>alloca</code>），然后因此涉及 <code>load</code> 和 <code>store</code> 操作。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128111138.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128111138.png?size=small" data-sub-html="<h2>20241128111138</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128111138.png alt=无优化版本 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128111138.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128111138.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128111138.png?size=large 2x" data-title=20241128111138 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>无优化版本</figcaption></figure></p><p>而若是采用了 o1 优化，那么上述开辟空间和加载等就没有了，整个代码都很简洁，多出了 $\phi$ 函数的操作。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128111155.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128111155.png?size=small" data-sub-html="<h2>20241128111155</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128111155.png alt="o1 优化版本" srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128111155.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128111155.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241128111155.png?size=large 2x" data-title=20241128111155 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>o1 优化版本</figcaption></figure></p><h2 id=中间代码生成 class=heading-element><span>中间代码生成</span>
<a href=#%e4%b8%ad%e9%97%b4%e4%bb%a3%e7%a0%81%e7%94%9f%e6%88%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 id=表达式翻译 class=heading-element><span>表达式翻译</span>
<a href=#%e8%a1%a8%e8%be%be%e5%bc%8f%e7%bf%bb%e8%af%91 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h4 id=非布尔表达式翻译 class=heading-element><span>非布尔表达式翻译</span>
<a href=#%e9%9d%9e%e5%b8%83%e5%b0%94%e8%a1%a8%e8%be%be%e5%bc%8f%e7%bf%bb%e8%af%91 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>这里如图所示，<code>E.code</code> 表示翻译后的中间代码，<code>E.addr</code> 表示原本的变量和生成的中间变量。下面的流程就是通过构建语法树，然后自底向上匹配规则，逐一生成中间变量，同时也就生成了中间代码。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203110615.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203110615.png?size=small" data-sub-html="<h2>20241203110615</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203110615.png alt=表达式翻译 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203110615.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203110615.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203110615.png?size=large 2x" data-title=20241203110615 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>表达式翻译</figcaption></figure></p><h4 id=数组引用翻译 class=heading-element><span>数组引用翻译</span>
<a href=#%e6%95%b0%e7%bb%84%e5%bc%95%e7%94%a8%e7%bf%bb%e8%af%91 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>下面就是数组引用的中间代码翻译流程，我们首先就是需要对声明进行解析，这样我们才能得到数组的宽度。之后才会对于 i，j 进行解析，运用公式得到最后的地址。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203111953.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203111953.png?size=small" data-sub-html="<h2>20241203111953</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203111953.png alt=数组引用翻译 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203111953.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203111953.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203111953.png?size=large 2x" data-title=20241203111953 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>数组引用翻译</figcaption></figure></p><p>对于数组声明就采用之前的翻译制导方案，通过继承属性和综合属性来传递相关信息，最后形成数组类型。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203112109.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203112109.png?size=small" data-sub-html="<h2>20241203112109</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203112109.png alt=语法制导翻译 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203112109.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203112109.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203112109.png?size=large 2x" data-title=20241203112109 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>语法制导翻译</figcaption></figure></p><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203112252.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203112252.png?size=small" data-sub-html="<h2>20241203112252</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203112252.png alt=翻译规则 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203112252.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203112252.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203112252.png?size=large 2x" data-title=20241203112252 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>翻译规则</figcaption></figure></p><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203112310.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203112310.png?size=small" data-sub-html="<h2>20241203112310</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203112310.png alt=翻译语法树 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203112310.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203112310.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203112310.png?size=large 2x" data-title=20241203112310 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>翻译语法树</figcaption></figure></p><p>这里主要关注 <code>getelementptr</code>，它对于数组元素进行解包获取内部信息。对于这里的参数 <code>[2 x [3 x i32]]</code> 是 <code>base type</code>，<code>[2 x [3 x i32]]* %2</code> 是数组的首地址，同时返回一个指向元素的指针，所以后面需要进行 load 操作。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203113752.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203113752.png?size=small" data-sub-html="<h2>20241203113752</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203113752.png alt=翻译后中间代码 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203113752.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203113752.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203113752.png?size=large 2x" data-title=20241203113752 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>翻译后中间代码</figcaption></figure></p><h3 id=控制流翻译easy class=heading-element><span>控制流翻译（easy）</span>
<a href=#%e6%8e%a7%e5%88%b6%e6%b5%81%e7%bf%bb%e8%af%91easy class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>这里就是对于下面的产生式进行翻译，转化为中间代码的形式。同时使用的是 Visitor 方式，因为我们这里需要及时输出生成的中间代码，避免频繁的字符串拼接操作，而使用 Listener 模式会有上面的问题，直接进行 Attributed Grammar 方式则会很麻烦。</p><p>同时这里为简单模式的翻译，它只需要使用综合属性，各个非终结符的分工、合作明确。所以产生的代码也相对冗杂。</p><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203172019.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203172019.png?size=small" data-sub-html="<h2>20241203172019</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203172019.png alt=产生式翻译 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203172019.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203172019.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203172019.png?size=large 2x" data-title=20241203172019 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>产生式翻译</figcaption></figure></p><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203185911.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203185911.png?size=small" data-sub-html="<h2>20241203185911</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203185911.png alt=翻译规则 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203185911.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203185911.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203185911.png?size=large 2x" data-title=20241203185911 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>翻译规则</figcaption></figure></p><h4 id=if-条件语句 class=heading-element><span>if 条件语句</span>
<a href=#if-%e6%9d%a1%e4%bb%b6%e8%af%ad%e5%8f%a5 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>下面就是对于 if 条件语句的翻译规则。总结起来就是我们首先需要标记两个标签 true 和 false，然后看 if 中的 cond 来分配这两个标签到 if 中的语句块和 if 结尾，这样我们就实现了对于 if 语句的翻译。</p><p>最终生成的 IR 也是如下面的类型：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 源代码
</span></span><span class=line><span class=cl>if (true) {
</span></span><span class=line><span class=cl>    a = b;
</span></span><span class=line><span class=cl>    b = c;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 翻译代码
</span></span><span class=line><span class=cl>br true b.true1 b.false2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b.true1:
</span></span><span class=line><span class=cl>a = b
</span></span><span class=line><span class=cl>c = c
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b.false2:</span></span></code></pre></td></tr></table></div></div><h4 id=if-else-语句 class=heading-element><span>if else 语句</span>
<a href=#if-else-%e8%af%ad%e5%8f%a5 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>而对于 if else 形式的，需要在上面的基础上添加一个 end 的标签，这样比如在 true 的语句执行完之后，直接到 if 之后的语句，而不是 else 语句。</p><p>最终生成的 IR 也是如下面的类型：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 源代码
</span></span><span class=line><span class=cl>if (true) {
</span></span><span class=line><span class=cl>    a = b;
</span></span><span class=line><span class=cl>    if (true) {
</span></span><span class=line><span class=cl>        c = d;
</span></span><span class=line><span class=cl>    } else {
</span></span><span class=line><span class=cl>        e = g;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>} else {
</span></span><span class=line><span class=cl>    d = f;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 翻译代码
</span></span><span class=line><span class=cl>br true b.true1 b.false2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b.true1:
</span></span><span class=line><span class=cl>a = b
</span></span><span class=line><span class=cl>br true b.true4 b.false5
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b.true4:
</span></span><span class=line><span class=cl>c = d
</span></span><span class=line><span class=cl>br end.6
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b.false5:
</span></span><span class=line><span class=cl>e = g
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b.end6:
</span></span><span class=line><span class=cl>br b.end3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b.false2:
</span></span><span class=line><span class=cl>d = f
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b.end3:</span></span></code></pre></td></tr></table></div></div><h4 id=while-循环语句 class=heading-element><span>while 循环语句</span>
<a href=#while-%e5%be%aa%e7%8e%af%e8%af%ad%e5%8f%a5 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>对于 while 循环，我们需要设置一个 begin 的标签，这样我们才可以在满足循环条件的前提下从头开始执行代码。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 源代码
</span></span><span class=line><span class=cl>while (true) {
</span></span><span class=line><span class=cl>    a = b;
</span></span><span class=line><span class=cl>    if (true) {
</span></span><span class=line><span class=cl>        c = d;
</span></span><span class=line><span class=cl>    } else {
</span></span><span class=line><span class=cl>        e = f;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>a = c;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 翻译代码
</span></span><span class=line><span class=cl>begin1:
</span></span><span class=line><span class=cl>br true b.true2 b.false3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b.true2:
</span></span><span class=line><span class=cl>a = b
</span></span><span class=line><span class=cl>br true b.true4 b.false5
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b.true4:
</span></span><span class=line><span class=cl>c = d
</span></span><span class=line><span class=cl>br b.end6
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b.false5:
</span></span><span class=line><span class=cl>e = f
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b.end6:
</span></span><span class=line><span class=cl>br begin1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b.false3:
</span></span><span class=line><span class=cl>a = c</span></span></code></pre></td></tr></table></div></div><h4 id=break-语句 class=heading-element><span>break 语句</span>
<a href=#break-%e8%af%ad%e5%8f%a5 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>这里 break 语句的翻译难点就在于它只会跳出离他最近的一层循环，所以我们需要追踪它会跳到哪一个标签处。面对这种情况，我们采用栈结构来存储相关标签。如下图所示，我们在内外层 while 处分别压入相关标签，面对 break 时就跳到栈顶的标签处，这样就实现了只跳出离它最近一层的功能。</p><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203191735.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203191735.png?size=small" data-sub-html="<h2>20241203191735</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203191735.png alt="break 栈展示" srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203191735.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203191735.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203191735.png?size=large 2x" data-title=20241203191735 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>break 栈展示</figcaption></figure></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 源代码
</span></span><span class=line><span class=cl>while (true) {
</span></span><span class=line><span class=cl>    while (false) {
</span></span><span class=line><span class=cl>        if (true) {
</span></span><span class=line><span class=cl>            break; # 这里的 break 只会跳出 while
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>        a = b;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    a = c;
</span></span><span class=line><span class=cl>    break;
</span></span><span class=line><span class=cl>    a = d;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>a = e;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 翻译代码
</span></span><span class=line><span class=cl>begin1:
</span></span><span class=line><span class=cl>br true b.true2 b.false3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b.true2:
</span></span><span class=line><span class=cl>begin4:
</span></span><span class=line><span class=cl>br false b.true5 b.false6
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b.true5:
</span></span><span class=line><span class=cl>br true b.true7 b.false8
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b.true7:
</span></span><span class=line><span class=cl>br b.false6
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b.false8:
</span></span><span class=line><span class=cl>a = b
</span></span><span class=line><span class=cl>br begin4
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b.false6:
</span></span><span class=line><span class=cl>a = c
</span></span><span class=line><span class=cl>br b.flase3
</span></span><span class=line><span class=cl>a = d
</span></span><span class=line><span class=cl>br begin1
</span></span><span class=line><span class=cl>b.false3:
</span></span><span class=line><span class=cl>a = e</span></span></code></pre></td></tr></table></div></div><h4 id=短路求值 class=heading-element><span>短路求值</span>
<a href=#%e7%9f%ad%e8%b7%af%e6%b1%82%e5%80%bc class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>短路求值和 if else 语句很像，例如 <code>||</code>，前面的正确后，要标记正确并跳转到最后，前面失败，那么就看后面的正误来跳转。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 源代码
</span></span><span class=line><span class=cl>while (true || false) {
</span></span><span class=line><span class=cl>    a = b;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>a = c;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 翻译代码
</span></span><span class=line><span class=cl>begin1:
</span></span><span class=line><span class=cl>br true or.true2 or.false3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>or.false3:
</span></span><span class=line><span class=cl>t1 = false
</span></span><span class=line><span class=cl>br or.end4
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>or.true2:
</span></span><span class=line><span class=cl>t1 = true
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>or.end4:
</span></span><span class=line><span class=cl>br t1 b.true5 b.false6
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b.true5:
</span></span><span class=line><span class=cl>a = b
</span></span><span class=line><span class=cl>br begin1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b.false6:
</span></span><span class=line><span class=cl>a = c</span></span></code></pre></td></tr></table></div></div><h3 id=控制流翻译hard class=heading-element><span>控制流翻译（hard）</span>
<a href=#%e6%8e%a7%e5%88%b6%e6%b5%81%e7%bf%bb%e8%af%91hard class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>这里为困难模式，和简单模式相比，它直接用布尔表达式改变控制流，无需计算最终逻辑值，即将不同非终结符的作用混杂在一起。因此它需要从父节点获取更具体的跳转目标，缩短跳转路径。为此父节点要为子节点准备跳转指令的目标标签，子节点就通过继承属性确定跳转目标。</p><h4 id=if-语句 class=heading-element><span>if 语句</span>
<a href=#if-%e8%af%ad%e5%8f%a5 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>如下图所示，在困难模式下 $B.false = S_{1}.next = S.next$，这样通过将不同非终结符设置的标签根据位置组合成一个的做法简化了生成的代码。</p><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190101.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190101.png?size=small" data-sub-html="<h2>20241203190101</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190101.png alt=相关操作 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190101.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190101.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190101.png?size=large 2x" data-title=20241203190101 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>相关操作</figcaption></figure></p><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190022.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190022.png?size=small" data-sub-html="<h2>20241203190022</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190022.png alt="if 语句" srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190022.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190022.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190022.png?size=large 2x" data-title=20241203190022 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>if 语句</figcaption></figure></p><h4 id=if-else-语句-1 class=heading-element><span>if else 语句</span>
<a href=#if-else-%e8%af%ad%e5%8f%a5-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190642.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190642.png?size=small" data-sub-html="<h2>20241203190642</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190642.png alt=相关操作 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190642.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190642.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190642.png?size=large 2x" data-title=20241203190642 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>相关操作</figcaption></figure></p><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190659.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190659.png?size=small" data-sub-html="<h2>20241203190659</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190659.png alt="if else 语句" srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190659.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190659.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203190659.png?size=large 2x" data-title=20241203190659 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>if else 语句</figcaption></figure></p><h4 id=while-循环语句-1 class=heading-element><span>while 循环语句</span>
<a href=#while-%e5%be%aa%e7%8e%af%e8%af%ad%e5%8f%a5-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203191130.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203191130.png?size=small" data-sub-html="<h2>20241203191130</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203191130.png alt=相关操作 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203191130.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203191130.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203191130.png?size=large 2x" data-title=20241203191130 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>相关操作</figcaption></figure></p><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203191139.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203191139.png?size=small" data-sub-html="<h2>20241203191139</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203191139.png alt="while 循环语句" srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203191139.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203191139.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203191139.png?size=large 2x" data-title=20241203191139 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>while 循环语句</figcaption></figure></p><h4 id=布尔表达式 class=heading-element><span>布尔表达式</span>
<a href=#%e5%b8%83%e5%b0%94%e8%a1%a8%e8%be%be%e5%bc%8f class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203192731.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203192731.png?size=small" data-sub-html="<h2>20241203192731</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203192731.png alt=布尔表达式 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203192731.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203192731.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241203192731.png?size=large 2x" data-title=20241203192731 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>布尔表达式</figcaption></figure></p><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205091529.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205091529.png?size=small" data-sub-html="<h2>20241205091529</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205091529.png alt=具体例子 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205091529.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205091529.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205091529.png?size=large 2x" data-title=20241205091529 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>具体例子</figcaption></figure></p><h3 id=backpatch class=heading-element><span>backpatch</span>
<a href=#backpatch class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205104349.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205104349.png?size=small" data-sub-html="<h2>20241205104349</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205104349.png alt=技术介绍 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205104349.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205104349.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205104349.png?size=large 2x" data-title=20241205104349 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>技术介绍</figcaption></figure></p><p>根据以下的规则，综合属性 $B.truelist$ 保存需要跳转到 $B.true$ 标签的指令，综合属性 $B.falselist$ 保存需要跳转到 $B.false$ 标签的指令，综合属性 $S/L.nextlist$ 保存需要跳转到 $S/L.next$ 标签的指令。</p><p>之后就是为左部非终结符 $B$ 计算综合属性 $B.truelist$ 与 $B.falselist$，为左部非终结符 $S/L$ 计算综合属性 $S/L.nextlist$，并考虑每个综合属性，为已能确定目标地址的跳转指令进行<strong>回填</strong>。下面只有 (3) 与 (7) 的 gen 生成了新的代码，控制流语句主要目的就是 <strong>控制</strong> 流。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205104559.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205104559.png?size=small" data-sub-html="<h2>20241205104559</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205104559.png alt=相关规则 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205104559.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205104559.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205104559.png?size=large 2x" data-title=20241205104559 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>相关规则</figcaption></figure></p><p>由上面的做法，需要为回填操作添加多的属性来获取信息，由此就有了 M 属性和 N 属性。</p><h4 id=m-属性 class=heading-element><span>M 属性</span>
<a href=#m-%e5%b1%9e%e6%80%a7 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>M 属性就是获取下一个 code 的第一条语句的位置，这样我们就可以得到相关的位置信息了，之后我们就可以根据这个信息来进行回填。</p><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205105504.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205105504.png?size=small" data-sub-html="<h2>20241205105504</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205105504.png alt="M 属性示例" srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205105504.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205105504.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205105504.png?size=large 2x" data-title=20241205105504 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>M 属性示例</figcaption></figure></p><h4 id=n-属性 class=heading-element><span>N 属性</span>
<a href=#n-%e5%b1%9e%e6%80%a7 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>N 属性就是添加一条 goto 语句，一开始就是为了解决 if else 的跳转到最后的情况。</p><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205110021.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205110021.png?size=small" data-sub-html="<h2>20241205110021</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205110021.png alt="N 相关规则" srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205110021.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205110021.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20241205110021.png?size=large 2x" data-title=20241205110021 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>N 相关规则</figcaption></figure></p><h2 id=目标代码生成 class=heading-element><span>目标代码生成</span>
<a href=#%e7%9b%ae%e6%a0%87%e4%bb%a3%e7%a0%81%e7%94%9f%e6%88%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2024-12-10 15:40:15">更新于 2024.12.10&nbsp;
<a class=git-hash href=https://github.com/czTangt/blog.git/commit/2089144735f4f06ef4eef8d4158ce65835a8d9b8 rel="external nofollow noopener noreferrer" target=_blank title="commit by czTangt(cz.tangt@gmail.com) 2089144735f4f06ef4eef8d4158ce65835a8d9b8: add content to compile lab6"><i class="fa-solid fa-hashtag fa-fw" aria-hidden=true></i>2089144</a></span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href="https://github.com/czTangt/blog.git/blob/main/content/posts%5ccompile%5cllvm-ir-control.md?plain=1" title=查看源码 target=_blank rel="external nofollow noopener noreferrer" class=link-to-source>查看源码</a></span><span><a href=https://github.com/czTangt/blog.git/edit/main/content/posts%5ccompile%5cllvm-ir-control.md title=编辑此页 target=_blank rel="external nofollow noopener noreferrer" class=link-to-edit>编辑此页</a></span><span><a href="https://github.com/czTangt/blog.git/issues/new?title=[BUG]%2004+LLVM+IR+Control&amp;body=%7cField%7cValue%7c%0A%7c-%7c-%7c%0A%7cTitle%7c04+LLVM+IR+Control%7c%0A%7cURL%7chttps://czTangt.github.io/blog/posts/compile/llvm-ir-control/%7c%0A%7cFilename%7chttps://github.com/czTangt/blog.git/blob/main/content/posts%5ccompile%5cllvm-ir-control.md?plain=1%7c" title=报告问题 target=_blank rel="external nofollow noopener noreferrer" class=link-to-report>报告问题</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 X" data-sharer=twitter data-url=https://czTangt.github.io/blog/posts/compile/llvm-ir-control/ data-title="04 LLVM IR Control" data-hashtags=compile><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://czTangt.github.io/blog/posts/compile/llvm-ir-control/ data-hashtag=compile><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://czTangt.github.io/blog/posts/compile/llvm-ir-control/ data-title="04 LLVM IR Control"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/blog/tags/compile/ class=post-tag title="标签 - Compile">Compile</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/blog/>主页</a></span></section></div><div class=post-nav><a href=/blog/posts/reverse/algorithm/ class=post-nav-item rel=prev title=逆向中的算法><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>逆向中的算法</a><a href=/blog/posts/android/unidbg/ class=post-nav-item rel=next title="Unidbg 记录">Unidbg 记录<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article><aside class=toc id=toc-auto aria-label=目录><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered order-1">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.136.5"><img class=hugo-icon src=/blog/images/hugo.min.svg alt="Hugo logo"> Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.3.14"><img class=fixit-icon src=/blog/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright order-2" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2024</span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div></div><a href=https://github.com/czTangt/blog title="View source on GitHub" target=_blank rel="external nofollow" class="github-corner left d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true" width="56" height="56"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><noscript><div class=noscript-warning>该网站在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/blog/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=preload href=/blog/lib/katex/katex.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/blog/lib/katex/katex.min.css></noscript><link rel=stylesheet href=/blog/lib/cookieconsent/cookieconsent.min.css><script src=/blog/lib/autocomplete/autocomplete.min.js defer></script><script src=/blog/lib/fuse/fuse.min.js defer></script><script src=/blog/lib/lightgallery/lightgallery.min.js defer></script><script src=/blog/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/blog/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/blog/lib/sharer/sharer.min.js async defer></script><script src=/blog/lib/katex/katex.min.js defer></script><script src=/blog/lib/katex/auto-render.min.js defer></script><script src=/blog/lib/katex/mhchem.min.js defer></script><script src=/blog/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/blog/js/codeblock.js defer></script><script src=https://libs.baidu.com/jquery/2.1.4/jquery.min.js defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:10},comment:{enable:!1},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/blog/search.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!1},version:"v0.3.14"}</script><script src=/blog/js/theme.min.js defer></script></body></html>