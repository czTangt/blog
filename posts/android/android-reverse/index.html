<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Android Reverse - czTang</title><meta name=author content="czTang">
<meta name=description content="记录安卓逆向的相关操作。
"><meta name=keywords content='reverse,android'><meta itemprop=name content="Android Reverse"><meta itemprop=description content="记录安卓逆向的相关操作。"><meta itemprop=datePublished content="2025-01-31T18:14:02+08:00"><meta itemprop=dateModified content="2025-01-31T21:32:54+08:00"><meta itemprop=wordCount content="8658"><meta itemprop=keywords content="Reverse,Android"><meta property="og:url" content="https://czTangt.github.io/blog/posts/android/android-reverse/"><meta property="og:site_name" content="czTang"><meta property="og:title" content="Android Reverse"><meta property="og:description" content="记录安卓逆向的相关操作。"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-01-31T18:14:02+08:00"><meta property="article:modified_time" content="2025-01-31T21:32:54+08:00"><meta property="article:tag" content="Reverse"><meta property="article:tag" content="Android"><meta name=twitter:card content="summary"><meta name=twitter:title content="Android Reverse"><meta name=twitter:description content="记录安卓逆向的相关操作。"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202410312135963.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical type=text/html href=https://czTangt.github.io/blog/posts/android/android-reverse/ title="Android Reverse - czTang"><link rel=prev type=text/html href=https://czTangt.github.io/blog/posts/config/docker/ title=Docker><link rel=next type=text/html href=https://czTangt.github.io/blog/posts/reverse/windows/ title=Windows><link rel=stylesheet href=/blog/css/style.min.css><link rel=preload href=/blog/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/blog/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/blog/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/blog/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Android Reverse","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/czTangt.github.io\/blog\/posts\/android\/android-reverse\/"},"genre":"posts","keywords":"reverse, android","wordcount":8658,"url":"https:\/\/czTangt.github.io\/blog\/posts\/android\/android-reverse\/","datePublished":"2025-01-31T18:14:02+08:00","dateModified":"2025-01-31T21:32:54+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"czTang"},"description":""}</script><script src=/blog/js/head/color-scheme.min.js></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=left><div class=header-title><a href=/blog/ title=czTang><span class=header-title-pre><i class='fa fa-coffee'>&nbsp</i></span><span class=header-title-text>czTang</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/blog/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Archives</a></li><li class=menu-item><a class=menu-link href=/blog/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/blog/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=/blog/about/><i class="fa-solid fa-user fa-fw fa-sm" aria-hidden=true></i> About</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/blog/ title=czTang><span class=header-title-pre><i class='fa fa-coffee'>&nbsp</i></span><span class=header-title-text>czTang</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/blog/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Archives</a></li><li class=menu-item><a class=menu-link href=/blog/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/blog/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=/blog/about/><i class="fa-solid fa-user fa-fw fa-sm" aria-hidden=true></i> About</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=合集><div class="details collection-details open"><div class="details-summary collection-summary"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i>
<span class=collection-name title=合集>Reverse</span>
<span class=collection-count>5</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content collection-content"><nav><ul class=collection-list><li class=collection-item><a href=/blog/posts/android/elf/ title="ELF 解析">ELF 解析</a></li><li class=collection-item><a href=/blog/posts/reverse/algorithm/ title=逆向中的算法>逆向中的算法</a></li><li class=collection-item><a href=/blog/posts/android/unidbg/ title="Unidbg 记录">Unidbg 记录</a></li><li class=collection-item><span class=active title="Android Reverse">Android Reverse</span></li><li class=collection-item><a href=/blog/posts/reverse/windows/ title=Windows>Windows</a></li></ul><div class=collection-nav-simple><a href=/blog/posts/android/unidbg/ class=collection-nav-item rel=prev title="Unidbg 记录"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i></a><span class=text-secondary>4/5</span><a href=/blog/posts/reverse/windows/ class=collection-nav-item rel=next title=Windows><i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></nav></div></div></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Android Reverse</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/czTangt title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img loading=lazy src=/blog/images/avatar.jpg alt=czTang data-title=czTang width=20 height=20 class=avatar style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'>&nbsp;czTang</a></span><span class=post-included-in>&nbsp;收录于 <a href=/blog/categories/android/ class=post-category title="分类 - Android"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Android</a> 和 <a href=/blog/collections/reverse/ class=post-collection title="合集 - Reverse"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> Reverse</a></span></div><div class=post-meta-line><span title="发布于 2025-01-31 18:14:02"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2025.1.31>2025.1.31</time></span>&nbsp;<span title="更新于 2025-01-31 21:32:54"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden=true></i><time datetime=2025.1.31>2025.1.31</time></span>&nbsp;<span title="8658 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 8700 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 18 分钟</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#android-命令>Android 命令</a><ul><li><a href=#基础命令>基础命令</a></li><li><a href=#手机信息查看>手机信息查看</a></li><li><a href=#包信息查看>包信息查看</a></li><li><a href=#其他>其他</a></li></ul></li><li><a href=#adb-相关>Adb 相关</a><ul><li><a href=#adb-原理>Adb 原理</a></li><li><a href=#工作原理>工作原理</a></li><li><a href=#使用归纳>使用归纳</a><ul><li><a href=#安卓模拟器>安卓模拟器</a></li><li><a href=#多设备下的-adb>多设备下的 Adb</a></li><li><a href=#无线wifi连接>无线（WIFI）连接</a></li><li><a href=#总结>总结</a><ul><li><a href=#adb>adb</a></li><li><a href=#frida>frida</a></li><li><a href=#objection>objection</a></li></ul></li></ul></li><li><a href=#adb-命令>Adb 命令</a></li></ul></li><li><a href=#动态调式>动态调式</a><ul><li><a href=#文件修改>文件修改</a><ul><li><a href=#修改-debug-权限>修改 debug 权限</a></li><li><a href=#修改应用文件>修改应用文件</a></li></ul></li><li><a href=#jeb-动调>jeb 动调</a></li><li><a href=#ida-动调>IDA 动调</a><ul><li><a href=#attach-模式>attach 模式</a></li><li><a href=#debug-模式>debug 模式</a></li><li><a href=#调试问题>调试问题</a></li></ul></li></ul></li><li><a href=#frida-使用>frida 使用</a><ul><li><a href=#frida-1>frida</a><ul><li><a href=#参数讲解>参数讲解</a></li><li><a href=#启动>启动</a></li></ul></li><li><a href=#frida-server>frida-server</a></li><li><a href=#frida-ps>frida-ps</a><ul><li><a href=#参数讲解-1>参数讲解</a></li><li><a href=#常用命令>常用命令</a></li></ul></li><li><a href=#相关分析>相关分析</a><ul><li><a href=#获取包名>获取包名</a></li><li><a href=#定位-native-函数位置>定位 native 函数位置</a><ul><li><a href=#静态注册>静态注册</a></li><li><a href=#动态注册>动态注册</a></li></ul></li></ul></li></ul></li><li><a href=#错误汇总>错误汇总</a><ul><li><a href=#程序安装>程序安装</a><ul><li><a href=#删除问题>删除问题</a></li><li><a href=#签名问题>签名问题</a></li></ul></li><li><a href=#adb-错误>Adb 错误</a><ul><li><a href=#连不上设备>连不上设备</a></li></ul></li><li><a href=#frida-错误>frida 错误</a><ul><li><a href=#apply-错误>apply 错误</a></li><li><a href=#加载错误>加载错误</a></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><p>记录安卓逆向的相关操作。</p><h2 id=android-命令 class=heading-element><span>Android 命令</span>
<a href=#android-%e5%91%bd%e4%bb%a4 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>这里对于基于 Linux 的 Android 系统命令进行简单罗列。</p><h3 id=基础命令 class=heading-element><span>基础命令</span>
<a href=#%e5%9f%ba%e7%a1%80%e5%91%bd%e4%bb%a4 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p><code>ps</code> 命令可输出当前设备正在运行的进程。在 Android 8 之后，ps 命令只能打印出当前进程，需要加上 <code>-e</code> 参数才能打印出全部的进程。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ps -ef <span class=p>|</span> grep &lt;package-infomation&gt;</span></span></code></pre></td></tr></table></div></div><p><code>netstat</code> 该命令输出 App 连接的 IP、端口、协议等网络相关信息，通常使用的参数组合为 <code>-alpe</code>。<code>netstat -alpe</code> 用于查看所有 sockets 连接的IP和端口以及相应的进程名和 pid。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>netstat -alpe <span class=p>|</span> grep &lt;package-infomation&gt;</span></span></code></pre></td></tr></table></div></div><p><code>lsof</code> 该命令可以用于查看对应进程打开的文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>lsof -p &lt;pid&gt; -l <span class=p>|</span> grep &lt;file_name&gt;</span></span></code></pre></td></tr></table></div></div><h3 id=手机信息查看 class=heading-element><span>手机信息查看</span>
<a href=#%e6%89%8b%e6%9c%ba%e4%bf%a1%e6%81%af%e6%9f%a5%e7%9c%8b class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>通过查看手机信息来决定使用什么版本的工具和程序。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cat /proc/cpuinfo                   <span class=c1># 查看手机架构</span>
</span></span><span class=line><span class=cl>getprop ro.product.cpu.abi          <span class=c1># 查看cpu处理器位数</span></span></span></code></pre></td></tr></table></div></div><h3 id=包信息查看 class=heading-element><span>包信息查看</span>
<a href=#%e5%8c%85%e4%bf%a1%e6%81%af%e6%9f%a5%e7%9c%8b class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 获取当前活动（处于前台）的系统服务信息然后过滤出正在活动的任务</span>
</span></span><span class=line><span class=cl>dumpsys activity top <span class=p>|</span> grep TASK
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看包的信息</span>
</span></span><span class=line><span class=cl>dumpsys package &lt;package-name&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看包含 /data 的虚拟内存区域的详细信息，即查看包含 /data 名称的进程的相关信息。这里就是找到对应虚拟内存区域中的所有文件，它可以寻找包名所在文件的目录</span>
</span></span><span class=line><span class=cl>cat /proc/&lt;pid&gt;/maps <span class=p>|</span> grep /data</span></span></code></pre></td></tr></table></div></div><h3 id=其他 class=heading-element><span>其他</span>
<a href=#%e5%85%b6%e4%bb%96 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p><code>am</code> 命令主要用于启动或停止服务、发送广播、启动 Activity 等。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 以 Debug 模式启动 App</span>
</span></span><span class=line><span class=cl>am start-activity -D -N &lt;package-name&gt;/.&lt;class-name&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 启动指定的 Activity</span>
</span></span><span class=line><span class=cl><span class=c1># 按 AndroidManifest 的路径（com.kbtx.redpack_simple.FlagActivity），打开指定控件，这里就是类的路径前面为包的路径，所以直接用 &#34;.&#34;替代，不一致的情况下需要写全。</span>
</span></span><span class=line><span class=cl>am start -n com.kbtx.redpack_simple/.FlagActivity   
</span></span><span class=line><span class=cl>am start -n owasp.mstg.uncrackable2/sg.vantagepoint.uncrackable2.MainActivity
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 监视设备上的 Activity Manager 输出</span>
</span></span><span class=line><span class=cl>am monitor
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 结束进程，这里也可以通过 kill -9 &lt;pid&gt; 使用信号杀死，但是可能会出现进程重启杀不掉的情况</span>
</span></span><span class=line><span class=cl>am force-stop &lt;package-name&gt;</span></span></code></pre></td></tr></table></div></div><p><code>pm</code> 它是 Android 中 packageManager 的命令行，是用于管理 package 的命令。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 列出所有的包名</span>
</span></span><span class=line><span class=cl>pm list package
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 寻找包名所在文件的目录</span>
</span></span><span class=line><span class=cl>pm path &lt;package-name&gt;</span></span></code></pre></td></tr></table></div></div><p><code>logcat</code> 可以查看日志的输出</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 查看日志输出</span>
</span></span><span class=line><span class=cl>logcat <span class=p>|</span> grep</span></span></code></pre></td></tr></table></div></div><h2 id=adb-相关 class=heading-element><span>Adb 相关</span>
<a href=#adb-%e7%9b%b8%e5%85%b3 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 id=adb-原理 class=heading-element><span>Adb 原理</span>
<a href=#adb-%e5%8e%9f%e7%90%86 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>Adb（Android Debug Bridge）是 Android 开发工具链中的一个重要组件，属于 Android Open Source Project（AOSP）的一部分。它主要用于在开发环境中实现 PC 端与 Android 设备（包括物理设备和模拟器）之间的通信，支持多种设备操作，是连接 PC 端开发环境与移动终端的桥梁。
Adb 采用 C/S（客户端/服务器）架构，主要由以下三个组件构成：</p><ul><li><strong>Client</strong>：运行在 PC 端，主要用于发送命令。用户可以通过命令行工具（如 adb）调用客户端，执行如文件推送（push）、应用安装（install）等操作。客户端会解析这些命令，进行预处理，并将处理后的指令或数据通过网络发送给服务器端。</li><li><strong>Server</strong>：作为后台进程运行在 PC 端。负责检测 USB 端口，感知设备的连接和拔除，以及模拟器实例的启动或停止。它会维护一张设备状态表，为每个设备标记状态，如 offline（离线）、bootloader（引导程序模式）、recovery（恢复模式）或 online（在线）。同时将客户端的请求通过 USB 或 TCP/IP 方式发送到对应的设备上的 adbd（守护进程）。</li><li><strong>Daemon</strong>：存在于 Android 设备上，由设备的 init 进程启动，系统开机时自动运行。处理来自服务器端的命令请求，执行相关命令，并将结果返回给服务器端。</li></ul><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403041955759.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403041955759.png?size=small" data-sub-html="<h2>20240304195530684</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403041955759.png alt="Adb 组件" srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403041955759.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403041955759.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403041955759.png?size=large 2x" data-title=20240304195530684 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>Adb 组件</figcaption></figure></p><h3 id=工作原理 class=heading-element><span>工作原理</span>
<a href=#%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ol><li><strong>客户端启动</strong>：当用户在 PC 终端中输入 Adb 命令时，客户端会启动。</li><li><strong>服务端检测与启动</strong>：<ul><li>客户端会检查 PC 后台是否已运行 Adb 服务器。如果未运行，客户端会自动启动服务器进程。</li><li>服务器启动后，会绑定到本地 TCP 端口 <strong>5037</strong>，并监听来自客户端的命令。</li></ul></li><li><strong>设备连接建立</strong>：<ul><li>服务器会尝试与所有连接的设备建立连接。对于通过 USB 连接的设备，服务器会通过 USB 接口与设备上的 <code>adbd</code> 守护进程通信。</li><li>对于模拟器，服务器会扫描本地 TCP 端口范围 <strong>5555-5585</strong>（前 16 个模拟器使用奇数号端口进行 Adb 通信，偶数号端口用于控制台连接）。例如：<ul><li><strong>模拟器 1</strong>：控制台端口 5554，Adb 端口 5555。</li><li><strong>模拟器 2</strong>：控制台端口 5556，Adb 端口 5557。</li></ul></li></ul></li><li><strong>通信过程</strong>：<ul><li>客户端将命令发送到服务器（端口 5037）。</li><li>服务器根据设备状态表，将命令转发到对应的设备上的 <code>adbd</code>。</li><li><code>adbd</code> 执行命令并将结果返回给服务器，服务器再将结果返回给客户端。</li></ul></li></ol><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403042042159.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403042042159.png?size=small" data-sub-html="<h2>202403042042159</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403042042159.png alt=工作原理 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403042042159.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403042042159.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403042042159.png?size=large 2x" data-title=202403042042159 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>工作原理</figcaption></figure></p><h3 id=使用归纳 class=heading-element><span>使用归纳</span>
<a href=#%e4%bd%bf%e7%94%a8%e5%bd%92%e7%ba%b3 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h4 id=安卓模拟器 class=heading-element><span>安卓模拟器</span>
<a href=#%e5%ae%89%e5%8d%93%e6%a8%a1%e6%8b%9f%e5%99%a8 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>通常认为，开启模拟器的 USB 调试后，使用 <code>adb connect 127.0.0.1:port</code> 命令进行连接，然后通过 <code>adb devices</code> 查看设备列表，会看到以 <code>&lt;ip:port></code> 格式显示的设备。然而，结合真机调试和模拟器测试，可以发现：</p><ul><li><strong>真机</strong>：使用 USB 连接时，插入 USB 线并开启 USB 调试后，设备会被 Adb 服务器识别，<code>adb devices</code> 显示的设备名称为设备的 <strong>序列号</strong>。</li><li><strong>模拟器</strong>：通常不使用 USB 调试，而是通过 TCP/IP 连接。直接使用 <code>adb connect</code> 命令连接特定端口即可发现设备。在 NAT 模式下，模拟器必须有 WIFI 连接。模拟器通过 WIFI 连接到主机网卡时，会绑定本地端口，但 Adb 服务器可能无法自动发现模拟器（尤其是模拟器未使用默认端口范围 5555-5585），因此需要手动使用 <code>adb connect</code> 命令进行绑定。</li></ul><h4 id=多设备下的-adb class=heading-element><span>多设备下的 Adb</span>
<a href=#%e5%a4%9a%e8%ae%be%e5%a4%87%e4%b8%8b%e7%9a%84-adb class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>在多设备环境中（例如多个模拟器或真机），直接使用 <code>adb shell</code> 等命令可能会因无法确定目标设备而报错。此时需要通过 <code>-s &lt;名称></code> 参数指定设备进行调试。例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>adb -s 127.0.0.1:21503 shell</span></span></code></pre></td></tr></table></div></div><p>在使用 adb 和 frida-ps 进行设备检测时，可能会发现识别出的信息不同。这里连接真机喝逍遥模拟器，前者通过 USB 连接，后者使用 nat 连接 WIFI。以下是相关工具的参数说明：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>adb --help
</span></span><span class=line><span class=cl>global options:
</span></span><span class=line><span class=cl>-a         listen on all network interfaces, not just localhost
</span></span><span class=line><span class=cl>-d         use USB device <span class=o>(</span>error <span class=k>if</span> multiple devices connected<span class=o>)</span>
</span></span><span class=line><span class=cl>-e         use TCP/IP device <span class=o>(</span>error <span class=k>if</span> multiple TCP/IP devices available<span class=o>)</span>
</span></span><span class=line><span class=cl>-s SERIAL  use device with given serial <span class=o>(</span>overrides <span class=nv>$ANDROID_SERIAL</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>frida-ps --help
</span></span><span class=line><span class=cl>Options:
</span></span><span class=line><span class=cl>-U, --usb             connect to USB device
</span></span><span class=line><span class=cl>-D ID, --device<span class=o>=</span>ID    connect to device with the given ID
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>objection --help
</span></span><span class=line><span class=cl>Options:
</span></span><span class=line><span class=cl>-N, --network            Connect using a network connection instead of USB.
</span></span><span class=line><span class=cl>-h, --host TEXT          <span class=o>[</span>default: 127.0.0.1<span class=o>]</span>
</span></span><span class=line><span class=cl>-p, --port INTEGER       <span class=o>[</span>default: 27042<span class=o>]</span>
</span></span><span class=line><span class=cl>-ah, --api-host TEXT     <span class=o>[</span>default: 127.0.0.1<span class=o>]</span>
</span></span><span class=line><span class=cl>-ap, --api-port INTEGER  <span class=o>[</span>default: 8888<span class=o>]</span>
</span></span><span class=line><span class=cl>-g, --gadget TEXT        Name of the Frida Gadget/Process to connect to.
</span></span><span class=line><span class=cl><span class=o>[</span>default: Gadget<span class=o>]</span>
</span></span><span class=line><span class=cl>-S, --serial TEXT        A device serial to connect to.</span></span></code></pre></td></tr></table></div></div><p>尝试之后可以得到下面的结论：</p><ul><li>使用 <code>Adb</code> 的 <code>-d</code> 选项可以匹配 USB 连接的真机，而 <code>-e</code> 选项可以连接模拟器。</li><li>使用 <code>frida-ps</code> 的 <code>-U</code> 选项连接的却是模拟器，这表明二者的检测机制不同。</li><li>对于 <code>frida</code> 和 <code>frida-ps</code>，可以使用 <code>-D ID</code> 参数，通过 adb devices 中显示的设备 ID（名称）来匹配不同的设备。</li><li>对于 <code>objection</code>，则使用 <code>-S serial</code> 参数来识别设备，这里的 serial 就是设备的 ID。</li></ul><h4 id=无线wifi连接 class=heading-element><span>无线（WIFI）连接</span>
<a href=#%e6%97%a0%e7%ba%bfwifi%e8%bf%9e%e6%8e%a5 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>在测试 <code>objection</code> 的 <code>-p</code> 选项时，发现在模拟器中运行 <code>frida-server</code> 监听 7878 端口时，<code>objection</code> 无法连接，即使设置了 <code>adb forward tcp:27042 tcp:7878</code> 也无法成功连接。因此，尝试使用无线连接的真机来测试 <code>-p</code> 选项是否能够成功。</p><p>为了使手机支持无线调试，需要确保手机上存在 <code>adbd</code> 进程。有两种方法可以实现：</p><ul><li><strong>通过 USB 连接启动无线调试</strong>：使用 Adb 启动 USB 连接手机的无线调试功能。虽然这种方法有些多余（既然已经通过 USB 连接了，再使用无线连接似乎没有必要），但可以作为一种测试手段。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>adb tcpip <span class=m>5555</span>
</span></span><span class=line><span class=cl>adb connect &lt;PHONE_IP_ADDRESS&gt;:5555 <span class=c1># `&lt;PHONE_IP_ADDRESS&gt;` 是手机在局域网中的 IP 地址。</span></span></span></code></pre></td></tr></table></div></div><ul><li><strong>使用 Android 命令行指令启动无线调试</strong>：可以通过 <code>adb shell</code> 或下载 Termux 应用来执行命令行操作，详细步骤可以参考 <a href=https://blog.csdn.net/lerous/article/details/108297330 target=_blank rel="external nofollow noopener noreferrer">adb wifi调试问题</a>。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>adb shell setprop service.adb.tcp.port <span class=m>5555</span>
</span></span><span class=line><span class=cl>adb shell stop adbd
</span></span><span class=line><span class=cl>adb shell start adbd
</span></span><span class=line><span class=cl>adb connect &lt;PHONE_IP_ADDRESS&gt;:5555</span></span></code></pre></td></tr></table></div></div><p>配置完成后在 <code>adb devices</code> 中可以看到一个无线连接的设备。但要确保手机和 PC 在同一个局域网内，因此可以通过 <code>ping</code> 命令测试网络连通性，如果可以 ping 通，说明无线连接可行。然后在手机上启动 <code>frida-server</code>，监听端口（例如 7878）。并在在 PC 上使用 <code>objection</code> 连接无线设备 <code>objection -N -h 192.168.123.213 -p 7878 -g com.example.app explore</code>，如果连接成功，说明无线连接可行。</p><p>然后断开连接，使用 USB 连接真机，并在手机上启动 <code>frida-server</code> 的 7878 端口。之后使用 <code>objection</code> 连接 <code>objection -S SERIAL -g com.example.app explore</code>。最后可以发现无论是否使用端口转发，<code>-p 7878</code> 选项都无法成功连接目标真机。</p><p>最后发现 <code>frida</code> 将模拟器视为 USB 连接设备，而 Adb 将其识别为 TCP/IP 连接设备。模拟器的 WIFI 功能在这种情况下更像是一个摆设。同时<code>objection</code> 对于 USB 连接设备不提供 <code>frida-server</code> 的端口切换功能，仅对无线连接的设备提供此功能。因此，USB 设备（无论是真机还是模拟器）在使用 <code>objection</code> 时，建议使用 <code>frida-server</code> 的默认端口（27042）。</p><div class="details admonition note open disabled"><div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden=true></i>叠甲</div><div class=details-content><div class=admonition-content><p>这个只是我拿真机与模拟器测试的结果，可能存在别的方案使得上述结论无效。</p></div></div></div><h4 id=总结 class=heading-element><span>总结</span>
<a href=#%e6%80%bb%e7%bb%93 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><div class="details admonition tip open disabled"><div class="details-summary admonition-title"><i class="icon fa-fw fa-regular fa-lightbulb" aria-hidden=true></i>总结</div><div class=details-content><div class=admonition-content><p>这里总结 adb，frida，frida-ps，objection 连接真机和模拟器设备等多设备情况时的处理方法。</p></div></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>List of devices attached
</span></span><span class=line><span class=cl>8C5X1J8JR       		device
</span></span><span class=line><span class=cl>127.0.0.1:21503 		device
</span></span><span class=line><span class=cl>192.168.123.213:5555    device	<span class=c1>## WIFI 连接是后来加的，和 8C5X1J8JR 是同一台真机设备</span></span></span></code></pre></td></tr></table></div></div><h5 id=adb class=heading-element><span>adb</span>
<a href=#adb class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>## 模拟器设备</span>
</span></span><span class=line><span class=cl>adb -e shell	
</span></span><span class=line><span class=cl><span class=c1>## USB连接设备</span>
</span></span><span class=line><span class=cl>adb -d shell	<span class=c1>## 这两个命令面对同类设备只存在一个的情况时可以使用</span>
</span></span><span class=line><span class=cl><span class=c1>## WIFI连接设备</span>
</span></span><span class=line><span class=cl>adb -a shell	<span class=c1>## 这个只有单个设备时才能使用，条件比上面两个更苛刻</span>
</span></span><span class=line><span class=cl><span class=c1>## 通用连接</span>
</span></span><span class=line><span class=cl>adb -s 192.168.123.213:5555 shell	<span class=c1>## -s SERIAL根据序列号来连接，是通用连接方式，多设备都可以连接</span></span></span></code></pre></td></tr></table></div></div><p><code>Adb</code> 将模拟器识别为 TCP/IP 连接设备，它通过本地回环地址的端口（模拟器 adbd 使用的端口）进行连接。这里提及的模拟器都是使用 NAT 网络连接，其中的 WIFI 是一个摆设，但是如果改为桥接模式，那么可以将模拟器视为一个 WIFI 连接的设备。</p><h5 id=frida class=heading-element><span>frida</span>
<a href=#frida class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>## 通用连接</span>
</span></span><span class=line><span class=cl>frida-ps -D ID	<span class=c1>## 直接根据上面的 SERIAL充当ID 进行连接</span>
</span></span><span class=line><span class=cl><span class=c1>## 模拟器连接</span>
</span></span><span class=line><span class=cl>frida-ps -U		<span class=c1>## 还存在一个USB设备的情况下，这个命令只匹配模拟器，若是只有一个模拟器没有真机，也匹配模拟器</span>
</span></span><span class=line><span class=cl><span class=c1>## 端口修改连接</span>
</span></span><span class=line><span class=cl>./frida-server-16.0.8-android-arm64 -l 0.0.0.0:19233
</span></span><span class=line><span class=cl>adb forward tcp:19233 tcp:19233
</span></span><span class=line><span class=cl>frida -H 127.0.0.1:19233 -f 包名 -l .<span class=se>\j</span>s_example.js</span></span></code></pre></td></tr></table></div></div><p><code>frida</code> 将模拟器视为优先级更高的 USB 连接设备，所以对于模拟器的连接直接使用 <code>-U</code> 就可以连接</p><h5 id=objection class=heading-element><span>objection</span>
<a href=#objection class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>## USB设备-&gt;USB连接的手机和模拟器，这个情况下，frida-server不能更改监听的端口</span>
</span></span><span class=line><span class=cl>objection -S SERIAL -g &lt;package-name&gt; explore
</span></span><span class=line><span class=cl><span class=c1>## WIFI设备，这个情况下可以随意更改frida-server监听端口</span>
</span></span><span class=line><span class=cl>objection -N -h 192.168.123.213 -p <span class=m>7878</span> -g &lt;package-name&gt; explore</span></span></code></pre></td></tr></table></div></div><p><code>objection</code> 的 <code>-p</code> 设置只能适用于无线连接设备，USB 连接设备（真机和模拟器）都不可以进行设置。这里 <code>frida-server</code> 的原理就是运行进程来监听安卓设备的一个端口，然后 frida 去连接安卓设备对应的端口并发送信息，<code>frida-server</code> 通过端口接收数据并执行操作。所以可能 objection 的 <code>-S</code> 选择设备只会采用默认的 <code>frida-server</code> 端口去连接。</p><h3 id=adb-命令 class=heading-element><span>Adb 命令</span>
<a href=#adb-%e5%91%bd%e4%bb%a4 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>上文介绍了 Adb 的原理，我们通常需要它来处理相关命令。这里通过 <code>adb shell</code> 进入 adb 环境，它相当于 Android 系统中的 shell 环境，可以执行上文罗列的 Linux 命令。同时可以直接使用 <code>adb shell + linux command</code> 来直接执行 linux 命令，然后结果就会反馈到当前终端。简单连接设备的命令如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 查看当前连接的设备</span>
</span></span><span class=line><span class=cl>adb devices
</span></span><span class=line><span class=cl><span class=c1># 连接模拟器设备，这里是蓝叠的</span>
</span></span><span class=line><span class=cl>adb connect 127.0.0.1:5555
</span></span><span class=line><span class=cl><span class=c1># 多个设备下，使用 -s 连接单独设备，或者根据模拟器与真机分别使用-e与-d选项</span>
</span></span><span class=line><span class=cl>adb -s 127.0.0.1:5555 shell</span></span></code></pre></td></tr></table></div></div><h2 id=动态调式 class=heading-element><span>动态调式</span>
<a href=#%e5%8a%a8%e6%80%81%e8%b0%83%e5%bc%8f class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>Android 应用分为 java 和 native 两层，所以进行动调时就需要分别对待。这个 <a href=https://www.cnblogs.com/revercc/p/16175186.html target=_blank rel="external nofollow noopener noreferrer">博客</a> 就是描述 adb 参与 android 调式的流程，可以结合下面的内容进行理解。</p><h3 id=文件修改 class=heading-element><span>文件修改</span>
<a href=#%e6%96%87%e4%bb%b6%e4%bf%ae%e6%94%b9 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>在进行动态调式之前，Android 应用可能采取不同措施防止动态调式，所以就需要修改 apk 的一些设置来达到可以进行动态调式的目的。</p><h4 id=修改-debug-权限 class=heading-element><span>修改 debug 权限</span>
<a href=#%e4%bf%ae%e6%94%b9-debug-%e6%9d%83%e9%99%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>首先在 AndroidManifest.xml 里添加可调试权限 <code>android:debuggable="true"</code>，然后重新签名打包。这里的添加是在 <code>&lt;activity></code> 标签中添加，例如：<code>&lt;activity android:name="example" android:debuggable="true"></code>。</p><p>或者可以使用 Magisk 命令，但是重启失效。具体可以看这篇 <a href=https://www.52pojie.cn/thread-1714727-1-1.html target=_blank rel="external nofollow noopener noreferrer">博客</a> 来进行操作。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>adb shell                                     <span class=c1># adb进入命令行模式</span>
</span></span><span class=line><span class=cl>su                                            <span class=c1># 切换至超级用户</span>
</span></span><span class=line><span class=cl>magisk resetprop ro.debuggable <span class=m>1</span>              <span class=c1># 修改权限</span>
</span></span><span class=line><span class=cl>stop<span class=p>;</span>start<span class=p>;</span>                                   <span class=c1># 一定要通过该方式重启</span></span></span></code></pre></td></tr></table></div></div><h4 id=修改应用文件 class=heading-element><span>修改应用文件</span>
<a href=#%e4%bf%ae%e6%94%b9%e5%ba%94%e7%94%a8%e6%96%87%e4%bb%b6 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>上述添加权限之后需要保存修改的文件，这时就需要用到 <a href=https://apktool.org/docs/install/ target=_blank rel="external nofollow noopener noreferrer">apktool</a> 来进行重打包和签名了。参考 <a href=https://aquilao.github.io/Blog/Decompile_apk/ target=_blank rel="external nofollow noopener noreferrer">这篇博客</a> 的具体修改流程如下：</p><ul><li><strong>apktool 反编译</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>apktool</span> <span class=n>d</span> <span class=o>-f</span> <span class=p>&lt;</span><span class=n>apk_path</span><span class=p>&gt;</span> <span class=n>-o</span> <span class=p>&lt;</span><span class=n>folder_path</span><span class=p>&gt;</span></span></span></code></pre></td></tr></table></div></div><p>这里 apktool 解包到指定目录下，<code>&lt;apk_path></code> 指待反编译 apk 的路径，<code>&lt;folder_path></code> 指把反编译的文件输出的文件夹。这样反编译可以查看 smail 代码，同时反编译出的 AndroidManifest.xml 文件也可以被读取。</p><ul><li><strong>apktool 重打包</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>apktool</span> <span class=n>b</span> <span class=p>&lt;</span><span class=n>folder_path</span><span class=p>&gt;</span> <span class=n>-p</span> <span class=p>&lt;</span><span class=n>apk_path</span><span class=p>&gt;</span></span></span></code></pre></td></tr></table></div></div><p>这里重新打包的 apk 会在 <code>&lt;apk_path>/dist/</code> 目录中生成。如此一来，就得到了新的修改过的 apk 文件。</p><ul><li><strong>生成签名</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>jarsigner</span> <span class=n>-verbose</span> <span class=n>-keystore</span> <span class=p>&lt;</span><span class=n>keystore_path</span><span class=p>&gt;</span> <span class=n>-signedjar</span> <span class=p>&lt;</span><span class=n>signed_apk_path</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=n>unsigned_apk_path</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=n>keystore_alias</span><span class=p>&gt;</span></span></span></code></pre></td></tr></table></div></div><p>这里 <code>&lt;keystore_path></code> 是指 keystore 文件存放的路径，<code>&lt;signed_apk_path></code> 是指签名后的 apk，<code>&lt;unsigned_apk_path></code> 是指未签名的 apk，<code>&lt;keystore_alias></code> 是指之前生成 keystore 文件时所使用的别名。</p><h3 id=jeb-动调 class=heading-element><span>jeb 动调</span>
<a href=#jeb-%e5%8a%a8%e8%b0%83 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>经过上述修改，就可以在 jeb 中启动动态调试了，首先在 jeb 中相应语句下断点 ctrl + b，之后 debug 模式启动 app。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>adb shell am start -D -n com.zj.wuaipojie/.ui.MainActivity
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 分析</span>
</span></span><span class=line><span class=cl>adb shell am start -D -n &lt;package-name&gt;/.&lt;class-name&gt;
</span></span><span class=line><span class=cl><span class=c1># 这里类名前面的文字和包名相同，所以使用&#34;.&#34;来替代，如果不同就需要写完整路径了</span>
</span></span><span class=line><span class=cl><span class=c1># am start -n 表示启动一个activity，也可以用这种方式直接启动MainActivity之外的Activity</span>
</span></span><span class=line><span class=cl><span class=c1># am start -D 表示将应用设置为可调试模式</span>
</span></span><span class=line><span class=cl>adb forward tcp:port jdwp:PID
</span></span><span class=line><span class=cl>jdb -connect com.sun.jdi.SocketAttach:hostname<span class=o>=</span>localhost,port<span class=o>=</span>xxx</span></span></code></pre></td></tr></table></div></div><p>然后jeb直接附加程序进行动调即可，具体步骤看这个 <a href=https://www.52pojie.cn/thread-1598242-1-1.html target=_blank rel="external nofollow noopener noreferrer">博客</a>。</p><h3 id=ida-动调 class=heading-element><span>IDA 动调</span>
<a href=#ida-%e5%8a%a8%e8%b0%83 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>IDA 动调分为两种模式，一种是以 attach 模式启动，第二种则以 debug 模式启动，二者的区别在于使用场景，有时候要动态调试的参数在 app 一启动的时候就产生了，时机较早，所以需要以 debug 模式去挂起 app。</p><h4 id=attach-模式 class=heading-element><span>attach 模式</span>
<a href=#attach-%e6%a8%a1%e5%bc%8f class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>这里首先需要在 IDA <code>Debugger -> Debugger options</code> 中进行设置，防止因为别的进程等事宜暂停。（这个可有可无，但是对于高版本而言，例如我的 Android 12，最好还是加上，详细原因看下面），然后直接在分析的 so 中打断点，之后进行调式。</p><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/image.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/image.png?size=small" data-sub-html="<h2>image</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/image.png alt=Debugger srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/image.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/image.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/image.png?size=large 2x" data-title=image style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>Debugger</figcaption></figure></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 首先在 adb 中运行 android-server</span>
</span></span><span class=line><span class=cl>adb shell ./data/loval/tmp/android-server
</span></span><span class=line><span class=cl><span class=c1># 之后进行端口转发，使用 adb forward 命令之后，adb.exe(server) 会监听 23946 端口等待 IDA 连接，同时连接移动端 android-server 的 23946 端口</span>
</span></span><span class=line><span class=cl>adb forward tcp:23946 tcp:23946 <span class=c1># 这里修改端口可以使用 ./android-server -p 19233，然后转发对应的端口，最后在IDA中填写相应端口即可</span>
</span></span><span class=line><span class=cl><span class=c1># 然后直接运行apk即可，下面语句也是运行apk的语句</span>
</span></span><span class=line><span class=cl>adb shell am start -n com.zj.wuaipojie/.ui.ChallengeEight</span></span></code></pre></td></tr></table></div></div><p>最后在 IDA 中选择 <code>Remote ARM Linux/Android debugger</code>，然后设置 IP 为 127.0.0.1 端口匹配即可调试 so文件。这里注意尽量保持一个设备在场，开启 as 的话，IDA 会识别到别的虚拟机中去。attach 之后，等待左下角的加载条加载完，呈现 <code>AU：idle</code>，这样就可以在 IDA 中直接 F9 或者点击 Start 了，然后 IDA 会处于不可操作状态。操作权转移到了 app 上，在 app 中输入 flag，然后点击 check 等逻辑之后，若是它会调用 so 文件，那么就会因为之前的断点断在我们需要分析的内容处，这样我们就可以进行调试了。</p><p>这里主要说一下我在 Android12 中遇到的问题，一开始没有设置上述 <code>Debugger options</code>，然后直接启动的 apk。之后遇到了 <code>got unknown signal #33</code> 、<code>got unknown signal #35</code> 等 signal 错误，然后多跳几个就会崩溃。之后我设置了 <code>Debugger options</code>，然后采用 <code>adb shell am start -n com.zj.wuaipojie/.ui.ChallengeEight</code> 形式打开 app，最后竟然正常调试了！然后我又取消了设置和启动方式，改为一开始的形式启动，发现也正常了！。。。现在感觉这个系统真是玄学，之后若是再次调试，先设置 <code>Debugger options</code>，感觉它应该有点用处。（补充一下，在这个期间还设置了在 <code>Debugger setup</code> 中设置了 <code>exceptions</code>，但是没有任何作用）</p><h4 id=debug-模式 class=heading-element><span>debug 模式</span>
<a href=#debug-%e6%a8%a1%e5%bc%8f class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>按照这篇 <a href=https://www.52pojie.cn/thread-1315444-1-7.html target=_blank rel="external nofollow noopener noreferrer">文章</a> 进行配置操作。不过因为 so 文件的加载前会先执行 <strong>JNI_Onload</strong>，如果要反反调试，那么可能就需要在 <strong>JNI_Onload</strong> 中打断点了。具体可以参考这篇 <a href=https://www.cnblogs.com/revercc/p/16175186.html target=_blank rel="external nofollow noopener noreferrer">文章</a>。</p><h4 id=调试问题 class=heading-element><span>调试问题</span>
<a href=#%e8%b0%83%e8%af%95%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><ul><li>IDA 找不到 so 的情况<ul><li>因为APK设置了该属性 <code>android:extractNativeLibs="false"</code>，所以在 apk 的安装目录中不显示 so 文件，这个时候可以直接将 <strong>base.apk</strong> 作为so文件进行处理；</li><li>或者可以尝试手动复制一份对应的 so 文件放到<code>data/app/&lt;package-name>/lib</code>目录下；</li></ul></li><li>安卓高版本(android10及以上)与低版本的差异<ul><li>高版本因为 <strong>libc.so</strong> 的路径改变了，所以显示不出所有的线程。之后使用命令 <code>IDA_LIBC_PATH=/apex/com.android.runtime/lib64/bionic/libc.so ./android_server64</code> 启动服务可以完整显示</li></ul></li></ul><h2 id=frida-使用 class=heading-element><span>frida 使用</span>
<a href=#frida-%e4%bd%bf%e7%94%a8 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p><code>Frida-tools</code> 共有六个小工具，分别是 frida CLI、frida-ps、frida-trace、frida-discover、frida-ls-devices、frida-kill。下面就介绍对于工具的使用。</p><h3 id=frida-1 class=heading-element><span>frida</span>
<a href=#frida-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h4 id=参数讲解 class=heading-element><span>参数讲解</span>
<a href=#%e5%8f%82%e6%95%b0%e8%ae%b2%e8%a7%a3 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>单独使用 frida 就可以完成绝大多数功能，下面罗列其相关参数。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>--version                       <span class=c1># 显示程序的版本号并退出</span>
</span></span><span class=line><span class=cl>-h, --help                      <span class=c1># 显示此帮助信息并退出</span>
</span></span><span class=line><span class=cl>-D ID, --device<span class=o>=</span>ID              <span class=c1># 连接到指定ID的设备上</span>
</span></span><span class=line><span class=cl>-U, --usb                       <span class=c1># 连接到USB设备</span>
</span></span><span class=line><span class=cl>-R, --remote                    <span class=c1># 连接到远程frida服务器</span>
</span></span><span class=line><span class=cl>-f FILE, --file<span class=o>=</span>FILE            <span class=c1># spawn这个应用</span>
</span></span><span class=line><span class=cl>-F, --attach-frontmost          <span class=c1># 附加到最前端的应用程序</span>
</span></span><span class=line><span class=cl>-p PID, --attach-pid<span class=o>=</span>PID        <span class=c1># 附加到PID</span>
</span></span><span class=line><span class=cl>--debug                         <span class=c1># 启用兼容Node.js的脚本调试器</span>
</span></span><span class=line><span class=cl>-l SCRIPT, --load<span class=o>=</span>SCRIPT        <span class=c1># 加载脚本。</span>
</span></span><span class=line><span class=cl>-q                              <span class=c1># 安静模式（无提示），并在-l和-e之后退出。</span>
</span></span><span class=line><span class=cl>--no-pause                      <span class=c1># 启动后自动启动主线程</span>
</span></span><span class=line><span class=cl>-o LOGFILE, --output<span class=o>=</span>LOGFILE    <span class=c1># 输出到日志文件</span></span></span></code></pre></td></tr></table></div></div><h4 id=启动 class=heading-element><span>启动</span>
<a href=#%e5%90%af%e5%8a%a8 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><ul><li>attach 模式</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>frida -UF                               <span class=c1># 测试是否连接成功</span>
</span></span><span class=line><span class=cl>frida -U pid<span class=o>(</span>通常为&lt;package-name&gt;<span class=o>)</span> -l hook.js</span></span></code></pre></td></tr></table></div></div><ul><li>spawn 模式</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>frida -U -f com.android.settings -l hook.js --no-pause<span class=o>(</span>后面--no……高版本不写<span class=o>)</span></span></span></code></pre></td></tr></table></div></div><h3 id=frida-server class=heading-element><span>frida-server</span>
<a href=#frida-server class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> /data/adb/tools      <span class=c1># frida-server放在了这个目录下</span>
</span></span><span class=line><span class=cl>chmod <span class=m>777</span> *
</span></span><span class=line><span class=cl>./frida-server-16.0.8-android-arm64
</span></span><span class=line><span class=cl><span class=c1># 防止反调试，切换端口监听（默认端口为27042），这里监听任何对手机 1314 端口的网络连接，需要注意端口转发问题</span>
</span></span><span class=line><span class=cl>./frida-server-16.0.8-android-arm64 -l 0.0.0.0:1314
</span></span><span class=line><span class=cl>adb forward tcp:1314 tcp:1314
</span></span><span class=line><span class=cl><span class=c1># 由此可以查看 frida 监听的端口</span>
</span></span><span class=line><span class=cl>netstat -tulp <span class=p>|</span> grep frida</span></span></code></pre></td></tr></table></div></div><h3 id=frida-ps class=heading-element><span>frida-ps</span>
<a href=#frida-ps class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>frida-ps 用于列出进程的一个命令行工具。</p><h4 id=参数讲解-1 class=heading-element><span>参数讲解</span>
<a href=#%e5%8f%82%e6%95%b0%e8%ae%b2%e8%a7%a3-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>--version                       <span class=c1># 显示程序的版本号并退出</span>
</span></span><span class=line><span class=cl>-h, --help                      <span class=c1># 显示此帮助信息并退出</span>
</span></span><span class=line><span class=cl>-D ID, --device<span class=o>=</span>ID              <span class=c1># 连接到指定ID的设备上</span>
</span></span><span class=line><span class=cl>-U, --usb                       <span class=c1># 连接到USB设备</span>
</span></span><span class=line><span class=cl>-R, --remote                    <span class=c1># 连接到远程frida服务器</span>
</span></span><span class=line><span class=cl>-H HOST, --host<span class=o>=</span>HOST            <span class=c1># 连接到HOST上的远程frida-server。</span>
</span></span><span class=line><span class=cl>-O FILE, --options-file<span class=o>=</span>FILE    <span class=c1># 包含额外命令行选项的文本文件</span>
</span></span><span class=line><span class=cl>-a, --applications              <span class=c1># 仅列出应用程序</span>
</span></span><span class=line><span class=cl>-i, --installed                 <span class=c1># 包括所有已安装的应用程序</span>
</span></span><span class=line><span class=cl>-j, --json                      <span class=c1># 以JSON格式输出结果</span></span></span></code></pre></td></tr></table></div></div><h4 id=常用命令 class=heading-element><span>常用命令</span>
<a href=#%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 查看当前手机运行的进程</span>
</span></span><span class=line><span class=cl>frida-ps -U
</span></span><span class=line><span class=cl><span class=c1># 查看设备所有应用程序</span>
</span></span><span class=line><span class=cl>frida-ps -Ua
</span></span><span class=line><span class=cl><span class=c1># 查看设备上的所有已安装应用程序和对应的名字</span>
</span></span><span class=line><span class=cl>frida-ps -Uai
</span></span><span class=line><span class=cl><span class=c1># 获得设备的进程名和包名</span>
</span></span><span class=line><span class=cl>frida-ps -U -a</span></span></code></pre></td></tr></table></div></div><h3 id=相关分析 class=heading-element><span>相关分析</span>
<a href=#%e7%9b%b8%e5%85%b3%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h4 id=获取包名 class=heading-element><span>获取包名</span>
<a href=#%e8%8e%b7%e5%8f%96%e5%8c%85%e5%90%8d class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>首先确保 android 中运行了 frida-server，然后直接使用 <code>frida-ps -Uai</code>。它可以列出设备上运行的进程及其包名，然后选择自己需要的程序包名即可。</p><h4 id=定位-native-函数位置 class=heading-element><span>定位 native 函数位置</span>
<a href=#%e5%ae%9a%e4%bd%8d-native-%e5%87%bd%e6%95%b0%e4%bd%8d%e7%bd%ae class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>我们要确定某一个方法，比如 <code>com.bilibili.nativelibrary.LibBili.s</code> 这个方法在 so 中什么位置，叫什么名字。先做如下约定，防止名称混淆。</p><ul><li>JNI 函数：Java 函数所对应的 native 函数</li><li>JNI 方法：JNI 提供的两百多个 API，比如 GetStringUTFChars 等等。</li></ul><p>将一个 <strong>JAVA方法</strong> 和 <strong>JNI函数</strong> 连结在一起，有 <code>静态绑定和动态绑定</code> 两种方式，也叫静态注册和动态注册。我们并不能一眼确定某个函数是静态绑定还是动态绑定，过去我们会静态分析反编译的 Java 代码，找到代码中加载的 so，然后在 so 里做 JNI函数的分析和定位（如果是 java_开头为静态注册，为 <strong>JNI_OnLoad</strong> 中调用 <strong>RegisterNative 函数</strong> 则是动态注册）。这里通过 frida 和开源工具可以直接进行识别。</p><h5 id=静态注册 class=heading-element><span>静态注册</span>
<a href=#%e9%9d%99%e6%80%81%e6%b3%a8%e5%86%8c class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>如果一个函数采用静态绑定，那么对应 native 函数 的命名遵照以下规则：</p><ol><li>前缀 <code>Java_</code>；</li><li>紧跟着类的全名（间隔符从由 <code>.</code> 替换成 <code>_</code>）；</li><li>最后是方法名；</li></ol><p>比如对于 <code>com.bilibili.nativelibrary.LibBili.s</code> 这个类，它如果采用静态注册，那么 <strong>JNI函数</strong> 就会是 <code>Java_com_bilibili_nativelibrary_LibBili_s</code>。我们可以使用 frida 自带的分析工具 <strong>frida trace</strong> 进行批量 <code>native hook</code>。下面命令中 <code>-UF</code> 指附加到手机最前台的应用，即当前运行的应用，因此这里需要先打开 App。<code>-i "Java_com*"</code> 指 Hook 该 app 当前加载的所有以 <code>"Java_com"</code> 开头的 native 函数，<code>-i</code> 后面双引号里是函数名，支持正则表达式的语法。这个时候就可以对 app 进行相关操作，然后会有相应 hook 输出，然后看看输出的类名是否为自己的目标，若是，则确定为静态注册。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>frida-trace -UF -i <span class=s2>&#34;Java_com*&#34;</span></span></span></code></pre></td></tr></table></div></div><h5 id=动态注册 class=heading-element><span>动态注册</span>
<a href=#%e5%8a%a8%e6%80%81%e6%b3%a8%e5%86%8c class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>直接 hook RegisterNatives 函数，然后查看输出的内容是否为自己的目标。同时这里可以使用 unidbg 进行模拟执行，会直接输出动态注册的函数和地址（应对 hook 后不主动调用的情况）。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>frida -U -f &lt;package_name&gt; -l path/hook_RegisterNatives.js</span></span></code></pre></td></tr></table></div></div><p>下面是脚本 <code>hook_RegisterNatives.js</code> 的代码。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>hook_RegisterNatives</span><span class=p>(</span><span class=nx>taget_class</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>symbols</span> <span class=o>=</span> <span class=nx>Module</span><span class=p>.</span><span class=nx>enumerateSymbolsSync</span><span class=p>(</span><span class=s2>&#34;libart.so&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>addrRegisterNatives</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>symbols</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>symbol</span> <span class=o>=</span> <span class=nx>symbols</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>//_ZN3art3JNI15RegisterNativesEP7_JNIEnvP7_jclassPK15JNINativeMethodi
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=nx>symbol</span><span class=p>.</span><span class=nx>name</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=s2>&#34;art&#34;</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>            <span class=nx>symbol</span><span class=p>.</span><span class=nx>name</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=s2>&#34;JNI&#34;</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>            <span class=nx>symbol</span><span class=p>.</span><span class=nx>name</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=s2>&#34;RegisterNatives&#34;</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>            <span class=nx>symbol</span><span class=p>.</span><span class=nx>name</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=s2>&#34;CheckJNI&#34;</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>addrRegisterNatives</span> <span class=o>=</span> <span class=nx>symbol</span><span class=p>.</span><span class=nx>address</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;RegisterNatives is at &#34;</span><span class=p>,</span> <span class=nx>symbol</span><span class=p>.</span><span class=nx>address</span><span class=p>,</span> <span class=nx>symbol</span><span class=p>.</span><span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>addrRegisterNatives</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Interceptor</span><span class=p>.</span><span class=nx>attach</span><span class=p>(</span><span class=nx>addrRegisterNatives</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>onEnter</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kd>var</span> <span class=nx>env</span> <span class=o>=</span> <span class=nx>args</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=kd>var</span> <span class=nx>java_class</span> <span class=o>=</span> <span class=nx>args</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=kd>var</span> <span class=nx>class_name</span> <span class=o>=</span> <span class=nx>Java</span><span class=p>.</span><span class=nx>vm</span><span class=p>.</span><span class=nx>tryGetEnv</span><span class=p>().</span><span class=nx>getClassName</span><span class=p>(</span><span class=nx>java_class</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=c1>//console.log(class_name);
</span></span></span><span class=line><span class=cl><span class=c1></span>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>class_name</span> <span class=o>===</span> <span class=nx>taget_class</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;\n[RegisterNatives] method_count:&#34;</span><span class=p>,</span> <span class=nx>args</span><span class=p>[</span><span class=mi>3</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>                    <span class=kd>var</span> <span class=nx>methods_ptr</span> <span class=o>=</span> <span class=nx>ptr</span><span class=p>(</span><span class=nx>args</span><span class=p>[</span><span class=mi>2</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=kd>var</span> <span class=nx>method_count</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>args</span><span class=p>[</span><span class=mi>3</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>                    <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>method_count</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=kd>var</span> <span class=nx>name_ptr</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>readPointer</span><span class=p>(</span><span class=nx>methods_ptr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>i</span> <span class=o>*</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>pointerSize</span> <span class=o>*</span> <span class=mi>3</span><span class=p>));</span>
</span></span><span class=line><span class=cl>                        <span class=kd>var</span> <span class=nx>sig_ptr</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>readPointer</span><span class=p>(</span><span class=nx>methods_ptr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>i</span> <span class=o>*</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>pointerSize</span> <span class=o>*</span> <span class=mi>3</span> <span class=o>+</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>pointerSize</span><span class=p>));</span>
</span></span><span class=line><span class=cl>                        <span class=kd>var</span> <span class=nx>fnPtr_ptr</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>readPointer</span><span class=p>(</span><span class=nx>methods_ptr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>i</span> <span class=o>*</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>pointerSize</span> <span class=o>*</span> <span class=mi>3</span> <span class=o>+</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>pointerSize</span> <span class=o>*</span> <span class=mi>2</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=kd>var</span> <span class=nx>name</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>readCString</span><span class=p>(</span><span class=nx>name_ptr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=kd>var</span> <span class=nx>sig</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>readCString</span><span class=p>(</span><span class=nx>sig_ptr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=kd>var</span> <span class=nx>find_module</span> <span class=o>=</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>findModuleByAddress</span><span class=p>(</span><span class=nx>fnPtr_ptr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;[RegisterNatives] java_class:&#34;</span><span class=p>,</span> <span class=nx>class_name</span><span class=p>,</span> <span class=s2>&#34;name:&#34;</span><span class=p>,</span> <span class=nx>name</span><span class=p>,</span> <span class=s2>&#34;sig:&#34;</span><span class=p>,</span> <span class=nx>sig</span><span class=p>,</span> <span class=s2>&#34;fnPtr:&#34;</span><span class=p>,</span> <span class=nx>fnPtr_ptr</span><span class=p>,</span> <span class=s2>&#34;module_name:&#34;</span><span class=p>,</span> <span class=nx>find_module</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=s2>&#34;module_base:&#34;</span><span class=p>,</span> <span class=nx>find_module</span><span class=p>.</span><span class=nx>base</span><span class=p>,</span> <span class=s2>&#34;offset:&#34;</span><span class=p>,</span> <span class=nx>ptr</span><span class=p>(</span><span class=nx>fnPtr_ptr</span><span class=p>).</span><span class=nx>sub</span><span class=p>(</span><span class=nx>find_module</span><span class=p>.</span><span class=nx>base</span><span class=p>));</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 只有类名为com.bilibili.nativelibrary.LibBili，才打印输出
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>hook_RegisterNatives</span><span class=p>(</span><span class=s2>&#34;com.bilibili.nativelibrary.LibBili&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>setImmediate</span><span class=p>(</span><span class=nx>main</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div><h2 id=错误汇总 class=heading-element><span>错误汇总</span>
<a href=#%e9%94%99%e8%af%af%e6%b1%87%e6%80%bb class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 id=程序安装 class=heading-element><span>程序安装</span>
<a href=#%e7%a8%8b%e5%ba%8f%e5%ae%89%e8%a3%85 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h4 id=删除问题 class=heading-element><span>删除问题</span>
<a href=#%e5%88%a0%e9%99%a4%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>使用 <code>adb install -t xxxx.apk</code> 报错（-t 是覆盖安装）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>adb: failed to install .\xxxx.apk: Failure [INSTALL_FAILED_UPDATE_INCOMPATIBLE: Package xxxx signatures do not match previously installed version; ignoring!]
</span></span><span class=line><span class=cl>adb: failed to install .\xxxx.apk: Failure [INSTALL_FAILED_TEST_ONLY: installPackageLI]</span></span></code></pre></td></tr></table></div></div><p>这里是因为原先的文件还存在，覆盖之前的文件会导致签名不对。如果用手机自带的卸载不能卸载干净，所以需要使用 adb 卸载干净。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>adb uninstall &lt;package-name&gt;</span></span></code></pre></td></tr></table></div></div><h4 id=签名问题 class=heading-element><span>签名问题</span>
<a href=#%e7%ad%be%e5%90%8d%e9%97%ae%e9%a2%98 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>使用 <code>adb install xxxx.apk</code> 安装报错</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>adb: failed to install .\xxxx.apk: Failure [INSTALL_PARSE_FAILED_NO_CERTIFICATES: Failed to collect certificates from /data/app/vmdl2062104312.tmp/base.apk: Attempt to get length of null array]</span></span></code></pre></td></tr></table></div></div><p>这里是因为没有签名，签名后再安装即可。</p><h3 id=adb-错误 class=heading-element><span>Adb 错误</span>
<a href=#adb-%e9%94%99%e8%af%af class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h4 id=连不上设备 class=heading-element><span>连不上设备</span>
<a href=#%e8%bf%9e%e4%b8%8d%e4%b8%8a%e8%ae%be%e5%a4%87 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>报错 <code>daemon not running； starting now at tcp:5037</code>，这里就是服务启动问题，按照下面流程操作即可。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>adb kill-server                     # 如果使用 devices 没有显示设备，尝试先杀死服务，然后连接报错就进行下面的流程
</span></span><span class=line><span class=cl>netstat -ano | findstr 5037         # 找出占用 5037 端口的应用的 pid
</span></span><span class=line><span class=cl>taskkill -f -pid &lt;pid&gt;              # 关闭掉该应用</span></span></code></pre></td></tr></table></div></div><h3 id=frida-错误 class=heading-element><span>frida 错误</span>
<a href=#frida-%e9%94%99%e8%af%af class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h4 id=apply-错误 class=heading-element><span>apply 错误</span>
<a href=#apply-%e9%94%99%e8%af%af class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>下面是很常见的错误，但是对于程序运行没有太大的影响。查阅资料只知道是对象创建的问题，但是不知道自己错在了什么地方。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>TypeError</span><span class=o>:</span> <span class=nx>cannot</span> <span class=nx>read</span> <span class=nx>property</span> <span class=s1>&#39;apply&#39;</span> <span class=k>of</span> <span class=kc>undefined</span>
</span></span><span class=line><span class=cl>    <span class=nx>at</span> <span class=o>&lt;</span><span class=nx>anonymous</span><span class=o>&gt;</span> <span class=p>(</span><span class=nx>frida</span><span class=o>/</span><span class=nx>runtime</span><span class=o>/</span><span class=nx>core</span><span class=p>.</span><span class=nx>js</span><span class=o>:</span><span class=mi>51</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>目前根据经验与尝试，估计为 <code>setImmediate</code> 的错误，现象如下。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=nx>otherfunc</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>setImmediate</span><span class=p>(</span><span class=nx>main</span><span class=p>)</span>   <span class=c1>// 正确
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>setImmediate</span><span class=p>(</span><span class=nx>main</span><span class=p>())</span> <span class=c1>// 错误，直接报错 undefined
</span></span></span></code></pre></td></tr></table></div></div><p>由此可以判断，当 <code>setImmediate</code> 的参数为函数调用形式（如 <code>main()</code>）时，实际上会先执行 <code>main()</code>，并将 <code>main()</code> 的返回值传递给 <code>setImmediate</code>。如果<code>main()</code> 没有返回值（默认返回 <code>undefined</code>），则会导致上面的错误。因此正确方法就是将函数名（引用，如 <code>main</code>）传递给 <code>setImmediate</code>，而不是函数调用结果。</p><h4 id=加载错误 class=heading-element><span>加载错误</span>
<a href=#%e5%8a%a0%e8%bd%bd%e9%94%99%e8%af%af class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>下面的错误都是因为加载问题导致的，它在 so 没有加载之前就先进行 hook 了，自然会出现错误。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nb>Error</span><span class=o>:</span> <span class=nx>unable</span> <span class=nx>to</span> <span class=nx>find</span> <span class=nx>module</span> <span class=s1>&#39;libil2cpp.so&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>Base</span> <span class=nx>errot</span></span></span></code></pre></td></tr></table></div></div><p>因此可以使用下面 <code>my_hook_dlopen</code> 函数来调用目标函数，这样确保了 so 打开之后再进行 hook，但是可能存在调用两次的情况。另外可以把 <code>setImmediate</code> 调换为<code>setTimeout</code>，后面加一个延时时间，使得函数延后一段时间之后再调用，这样就有可能实现在函数加载之后再 hook 了。或者可以先注入，然后在 frida 界面调用目标函数，一般也可以实现在函数加载之后再调用的逻辑。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>my_hook_dlopen</span><span class=p>(</span><span class=nx>soName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Interceptor</span><span class=p>.</span><span class=nx>attach</span><span class=p>(</span><span class=nx>Module</span><span class=p>.</span><span class=nx>findExportByName</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=s2>&#34;dlopen&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>onEnter</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kd>var</span> <span class=nx>pathptr</span> <span class=o>=</span> <span class=nx>args</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>pathptr</span> <span class=o>!==</span> <span class=kc>undefined</span> <span class=o>&amp;&amp;</span> <span class=nx>pathptr</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=kd>var</span> <span class=nx>path</span> <span class=o>=</span> <span class=nx>ptr</span><span class=p>(</span><span class=nx>pathptr</span><span class=p>).</span><span class=nx>readCString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                    <span class=c1>// console.log(path);
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=k>if</span> <span class=p>(</span><span class=nx>path</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=nx>soName</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;[+] Successfully call the target libso&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=k>this</span><span class=p>.</span><span class=nx>is_can_hook</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=nx>onLeave</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>retval</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>is_can_hook</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>target_func</span><span class=p>(</span><span class=nx>soName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2025-01-31 21:32:54">更新于 2025.1.31&nbsp;
<a class=git-hash href=https://github.com/czTangt/blog.git/commit/fed0c446599a704e502744162bdbad9c3dc50777 rel="external nofollow noopener noreferrer" target=_blank title="commit by czTangt(cz.tangt@gmail.com) fed0c446599a704e502744162bdbad9c3dc50777: add frida and dynamic debug"><i class="fa-solid fa-hashtag fa-fw" aria-hidden=true></i>fed0c44</a></span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href="https://github.com/czTangt/blog.git/blob/main/content/posts%5candroid%5cReverse.md?plain=1" title=查看源码 target=_blank rel="external nofollow noopener noreferrer" class=link-to-source>查看源码</a></span><span><a href=https://github.com/czTangt/blog.git/edit/main/content/posts%5candroid%5cReverse.md title=编辑此页 target=_blank rel="external nofollow noopener noreferrer" class=link-to-edit>编辑此页</a></span><span><a href="https://github.com/czTangt/blog.git/issues/new?title=[BUG]%20Android+Reverse&amp;body=%7cField%7cValue%7c%0A%7c-%7c-%7c%0A%7cTitle%7cAndroid+Reverse%7c%0A%7cURL%7chttps://czTangt.github.io/blog/posts/android/android-reverse/%7c%0A%7cFilename%7chttps://github.com/czTangt/blog.git/blob/main/content/posts%5candroid%5cReverse.md?plain=1%7c" title=报告问题 target=_blank rel="external nofollow noopener noreferrer" class=link-to-report>报告问题</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 X" data-sharer=twitter data-url=https://czTangt.github.io/blog/posts/android/android-reverse/ data-title="Android Reverse" data-hashtags=reverse,android><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://czTangt.github.io/blog/posts/android/android-reverse/ data-hashtag=reverse><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://czTangt.github.io/blog/posts/android/android-reverse/ data-title="Android Reverse"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/blog/tags/reverse/ class=post-tag title="标签 - Reverse">Reverse</a><a href=/blog/tags/android/ class=post-tag title="标签 - Android">Android</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/blog/>主页</a></span></section></div><div class=post-nav><a href=/blog/posts/config/docker/ class=post-nav-item rel=prev title=Docker><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Docker</a><a href=/blog/posts/reverse/windows/ class=post-nav-item rel=next title=Windows>Windows<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article><aside class=toc id=toc-auto aria-label=目录><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered order-1">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.136.5"><img class=hugo-icon src=/blog/images/hugo.min.svg alt="Hugo logo"> Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.3.17-30a67c4b"><img class=fixit-icon src=/blog/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright order-2" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2024 - 2025</span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div></div><a href=https://github.com/czTangt/blog title="View source on GitHub" target=_blank rel="external nofollow" class="github-corner left d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true" width="56" height="56"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><noscript><div class=noscript-warning>该网站在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/blog/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=preload href=/blog/lib/katex/katex.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/blog/lib/katex/katex.min.css></noscript><link rel=stylesheet href=/blog/lib/cookieconsent/cookieconsent.min.css><script src=/blog/lib/autocomplete/autocomplete.min.js defer></script><script src=/blog/lib/fuse/fuse.min.js defer></script><script src=/blog/lib/lightgallery/lightgallery.min.js defer></script><script src=/blog/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/blog/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/blog/lib/sharer/sharer.min.js async defer></script><script src=/blog/lib/katex/katex.min.js defer></script><script src=/blog/lib/katex/auto-render.min.js defer></script><script src=/blog/lib/katex/mhchem.min.js defer></script><script src=/blog/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/blog/js/codeblock.js defer></script><script src=https://libs.baidu.com/jquery/2.1.4/jquery.min.js defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:10},comment:{enable:!1},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/blog/search.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!1},version:"v0.3.17-30a67c4b"}</script><script src=/blog/js/theme.min.js defer></script></body></html>