<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Android Reverse - czTang</title><meta name=author content="czTang">
<meta name=description content="记录安卓逆向的相关操作。
"><meta name=keywords content='reverse,android'><meta itemprop=name content="Android Reverse"><meta itemprop=description content="记录安卓逆向的相关操作。"><meta itemprop=datePublished content="2025-01-31T18:14:02+08:00"><meta itemprop=dateModified content="2025-01-31T20:17:51+08:00"><meta itemprop=wordCount content="3959"><meta itemprop=keywords content="Reverse,Android"><meta property="og:url" content="https://czTangt.github.io/blog/posts/android/android-reverse/"><meta property="og:site_name" content="czTang"><meta property="og:title" content="Android Reverse"><meta property="og:description" content="记录安卓逆向的相关操作。"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-01-31T18:14:02+08:00"><meta property="article:modified_time" content="2025-01-31T20:17:51+08:00"><meta property="article:tag" content="Reverse"><meta property="article:tag" content="Android"><meta name=twitter:card content="summary"><meta name=twitter:title content="Android Reverse"><meta name=twitter:description content="记录安卓逆向的相关操作。"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202410312135963.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical type=text/html href=https://czTangt.github.io/blog/posts/android/android-reverse/ title="Android Reverse - czTang"><link rel=prev type=text/html href=https://czTangt.github.io/blog/posts/config/docker/ title=Docker><link rel=stylesheet href=/blog/css/style.min.css><link rel=preload href=/blog/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/blog/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/blog/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/blog/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Android Reverse","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/czTangt.github.io\/blog\/posts\/android\/android-reverse\/"},"genre":"posts","keywords":"reverse, android","wordcount":3959,"url":"https:\/\/czTangt.github.io\/blog\/posts\/android\/android-reverse\/","datePublished":"2025-01-31T18:14:02+08:00","dateModified":"2025-01-31T20:17:51+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"czTang"},"description":""}</script><script src=/blog/js/head/color-scheme.min.js></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=left><div class=header-title><a href=/blog/ title=czTang><span class=header-title-pre><i class='fa fa-coffee'>&nbsp</i></span><span class=header-title-text>czTang</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/blog/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Archives</a></li><li class=menu-item><a class=menu-link href=/blog/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/blog/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=/blog/about/><i class="fa-solid fa-user fa-fw fa-sm" aria-hidden=true></i> About</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/blog/ title=czTang><span class=header-title-pre><i class='fa fa-coffee'>&nbsp</i></span><span class=header-title-text>czTang</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/blog/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Archives</a></li><li class=menu-item><a class=menu-link href=/blog/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/blog/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=/blog/about/><i class="fa-solid fa-user fa-fw fa-sm" aria-hidden=true></i> About</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=合集><div class="details collection-details open"><div class="details-summary collection-summary"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i>
<span class=collection-name title=合集>Reverse</span>
<span class=collection-count>4</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content collection-content"><nav><ul class=collection-list><li class=collection-item><a href=/blog/posts/android/elf/ title="ELF 解析">ELF 解析</a></li><li class=collection-item><a href=/blog/posts/reverse/algorithm/ title=逆向中的算法>逆向中的算法</a></li><li class=collection-item><a href=/blog/posts/android/unidbg/ title="Unidbg 记录">Unidbg 记录</a></li><li class=collection-item><span class=active title="Android Reverse">Android Reverse</span></li></ul><div class=collection-nav-simple><a href=/blog/posts/android/unidbg/ class=collection-nav-item rel=prev title="Unidbg 记录"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i></a><span class=text-secondary>4/4</span><i class="fa-solid fa-angle-right fa-fw collection-nav-item text-secondary" aria-hidden=true></i></div></nav></div></div></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Android Reverse</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/czTangt title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img loading=lazy src=/blog/images/avatar.jpg alt=czTang data-title=czTang width=20 height=20 class=avatar style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'>&nbsp;czTang</a></span><span class=post-included-in>&nbsp;收录于 <a href=/blog/categories/android/ class=post-category title="分类 - Android"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Android</a> 和 <a href=/blog/collections/reverse/ class=post-collection title="合集 - Reverse"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> Reverse</a></span></div><div class=post-meta-line><span title="发布于 2025-01-31 18:14:02"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2025.1.31>2025.1.31</time></span>&nbsp;<span title="更新于 2025-01-31 20:17:51"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden=true></i><time datetime=2025.1.31>2025.1.31</time></span>&nbsp;<span title="3959 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 4000 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 8 分钟</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#android-命令>Android 命令</a><ul><li><a href=#基础命令>基础命令</a></li><li><a href=#手机信息查看>手机信息查看</a></li><li><a href=#包信息查看>包信息查看</a></li><li><a href=#其他>其他</a></li></ul></li><li><a href=#adb-相关>Adb 相关</a><ul><li><a href=#adb-原理>Adb 原理</a></li><li><a href=#工作原理>工作原理</a></li><li><a href=#使用归纳>使用归纳</a><ul><li><a href=#安卓模拟器>安卓模拟器</a></li><li><a href=#多设备下的-adb>多设备下的 Adb</a></li><li><a href=#无线wifi连接>无线（WIFI）连接</a></li><li><a href=#总结>总结</a><ul><li><a href=#adb>adb</a></li><li><a href=#frida>frida</a></li><li><a href=#objection>objection</a></li></ul></li></ul></li><li><a href=#adb-命令>Adb 命令</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>记录安卓逆向的相关操作。</p><h2 id=android-命令 class=heading-element><span>Android 命令</span>
<a href=#android-%e5%91%bd%e4%bb%a4 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>这里对于基于 Linux 的 Android 系统命令进行简单罗列。</p><h3 id=基础命令 class=heading-element><span>基础命令</span>
<a href=#%e5%9f%ba%e7%a1%80%e5%91%bd%e4%bb%a4 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p><code>ps</code> 命令可输出当前设备正在运行的进程。在 Android 8 之后，ps 命令只能打印出当前进程，需要加上 <code>-e</code> 参数才能打印出全部的进程。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ps -ef <span class=p>|</span> grep &lt;package-infomation&gt;</span></span></code></pre></td></tr></table></div></div><p><code>netstat</code> 该命令输出 App 连接的 IP、端口、协议等网络相关信息，通常使用的参数组合为 <code>-alpe</code>。<code>netstat -alpe</code> 用于查看所有 sockets 连接的IP和端口以及相应的进程名和 pid。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>netstat -alpe <span class=p>|</span> grep &lt;package-infomation&gt;</span></span></code></pre></td></tr></table></div></div><p><code>lsof</code> 该命令可以用于查看对应进程打开的文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>lsof -p &lt;pid&gt; -l <span class=p>|</span> grep &lt;file_name&gt;</span></span></code></pre></td></tr></table></div></div><h3 id=手机信息查看 class=heading-element><span>手机信息查看</span>
<a href=#%e6%89%8b%e6%9c%ba%e4%bf%a1%e6%81%af%e6%9f%a5%e7%9c%8b class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>通过查看手机信息来决定使用什么版本的工具和程序。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cat /proc/cpuinfo                   <span class=c1># 查看手机架构</span>
</span></span><span class=line><span class=cl>getprop ro.product.cpu.abi          <span class=c1># 查看cpu处理器位数</span></span></span></code></pre></td></tr></table></div></div><h3 id=包信息查看 class=heading-element><span>包信息查看</span>
<a href=#%e5%8c%85%e4%bf%a1%e6%81%af%e6%9f%a5%e7%9c%8b class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 获取当前活动（处于前台）的系统服务信息然后过滤出正在活动的任务</span>
</span></span><span class=line><span class=cl>dumpsys activity top <span class=p>|</span> grep TASK
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看包的信息</span>
</span></span><span class=line><span class=cl>dumpsys package &lt;package-name&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看包含 /data 的虚拟内存区域的详细信息，即查看包含 /data 名称的进程的相关信息。这里就是找到对应虚拟内存区域中的所有文件，它可以寻找包名所在文件的目录</span>
</span></span><span class=line><span class=cl>cat /proc/&lt;pid&gt;/maps <span class=p>|</span> grep /data</span></span></code></pre></td></tr></table></div></div><h3 id=其他 class=heading-element><span>其他</span>
<a href=#%e5%85%b6%e4%bb%96 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p><code>am</code> 命令主要用于启动或停止服务、发送广播、启动 Activity 等。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 以 Debug 模式启动 App</span>
</span></span><span class=line><span class=cl>am start-activity -D -N &lt;package-name&gt;/.&lt;class-name&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 启动指定的 Activity</span>
</span></span><span class=line><span class=cl><span class=c1># 按 AndroidManifest 的路径（com.kbtx.redpack_simple.FlagActivity），打开指定控件，这里就是类的路径前面为包的路径，所以直接用 &#34;.&#34;替代，不一致的情况下需要写全。</span>
</span></span><span class=line><span class=cl>am start -n com.kbtx.redpack_simple/.FlagActivity   
</span></span><span class=line><span class=cl>am start -n owasp.mstg.uncrackable2/sg.vantagepoint.uncrackable2.MainActivity
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 监视设备上的 Activity Manager 输出</span>
</span></span><span class=line><span class=cl>am monitor
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 结束进程，这里也可以通过 kill -9 &lt;pid&gt; 使用信号杀死，但是可能会出现进程重启杀不掉的情况</span>
</span></span><span class=line><span class=cl>am force-stop &lt;package-name&gt;</span></span></code></pre></td></tr></table></div></div><p><code>pm</code> 它是 Android 中 packageManager 的命令行，是用于管理 package 的命令。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 列出所有的包名</span>
</span></span><span class=line><span class=cl>pm list package
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 寻找包名所在文件的目录</span>
</span></span><span class=line><span class=cl>pm path &lt;package-name&gt;</span></span></code></pre></td></tr></table></div></div><p><code>logcat</code> 可以查看日志的输出</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 查看日志输出</span>
</span></span><span class=line><span class=cl>logcat <span class=p>|</span> grep</span></span></code></pre></td></tr></table></div></div><h2 id=adb-相关 class=heading-element><span>Adb 相关</span>
<a href=#adb-%e7%9b%b8%e5%85%b3 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 id=adb-原理 class=heading-element><span>Adb 原理</span>
<a href=#adb-%e5%8e%9f%e7%90%86 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>Adb（Android Debug Bridge）是 Android 开发工具链中的一个重要组件，属于 Android Open Source Project（AOSP）的一部分。它主要用于在开发环境中实现 PC 端与 Android 设备（包括物理设备和模拟器）之间的通信，支持多种设备操作，是连接 PC 端开发环境与移动终端的桥梁。
Adb 采用 C/S（客户端/服务器）架构，主要由以下三个组件构成：</p><ul><li><strong>Client</strong>：运行在 PC 端，主要用于发送命令。用户可以通过命令行工具（如 adb）调用客户端，执行如文件推送（push）、应用安装（install）等操作。客户端会解析这些命令，进行预处理，并将处理后的指令或数据通过网络发送给服务器端。</li><li><strong>Server</strong>：作为后台进程运行在 PC 端。负责检测 USB 端口，感知设备的连接和拔除，以及模拟器实例的启动或停止。它会维护一张设备状态表，为每个设备标记状态，如 offline（离线）、bootloader（引导程序模式）、recovery（恢复模式）或 online（在线）。同时将客户端的请求通过 USB 或 TCP/IP 方式发送到对应的设备上的 adbd（守护进程）。</li><li><strong>Daemon</strong>：存在于 Android 设备上，由设备的 init 进程启动，系统开机时自动运行。处理来自服务器端的命令请求，执行相关命令，并将结果返回给服务器端。</li></ul><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403041955759.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403041955759.png?size=small" data-sub-html="<h2>20240304195530684</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403041955759.png alt="Adb 组件" srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403041955759.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403041955759.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403041955759.png?size=large 2x" data-title=20240304195530684 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>Adb 组件</figcaption></figure></p><h3 id=工作原理 class=heading-element><span>工作原理</span>
<a href=#%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ol><li><strong>客户端启动</strong>：当用户在 PC 终端中输入 Adb 命令时，客户端会启动。</li><li><strong>服务端检测与启动</strong>：<ul><li>客户端会检查 PC 后台是否已运行 Adb 服务器。如果未运行，客户端会自动启动服务器进程。</li><li>服务器启动后，会绑定到本地 TCP 端口 <strong>5037</strong>，并监听来自客户端的命令。</li></ul></li><li><strong>设备连接建立</strong>：<ul><li>服务器会尝试与所有连接的设备建立连接。对于通过 USB 连接的设备，服务器会通过 USB 接口与设备上的 <code>adbd</code> 守护进程通信。</li><li>对于模拟器，服务器会扫描本地 TCP 端口范围 <strong>5555-5585</strong>（前 16 个模拟器使用奇数号端口进行 Adb 通信，偶数号端口用于控制台连接）。例如：<ul><li><strong>模拟器 1</strong>：控制台端口 5554，Adb 端口 5555。</li><li><strong>模拟器 2</strong>：控制台端口 5556，Adb 端口 5557。</li></ul></li></ul></li><li><strong>通信过程</strong>：<ul><li>客户端将命令发送到服务器（端口 5037）。</li><li>服务器根据设备状态表，将命令转发到对应的设备上的 <code>adbd</code>。</li><li><code>adbd</code> 执行命令并将结果返回给服务器，服务器再将结果返回给客户端。</li></ul></li></ol><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403042042159.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403042042159.png?size=small" data-sub-html="<h2>202403042042159</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403042042159.png alt=工作原理 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403042042159.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403042042159.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202403042042159.png?size=large 2x" data-title=202403042042159 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>工作原理</figcaption></figure></p><h3 id=使用归纳 class=heading-element><span>使用归纳</span>
<a href=#%e4%bd%bf%e7%94%a8%e5%bd%92%e7%ba%b3 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h4 id=安卓模拟器 class=heading-element><span>安卓模拟器</span>
<a href=#%e5%ae%89%e5%8d%93%e6%a8%a1%e6%8b%9f%e5%99%a8 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>通常认为，开启模拟器的 USB 调试后，使用 <code>adb connect 127.0.0.1:port</code> 命令进行连接，然后通过 <code>adb devices</code> 查看设备列表，会看到以 <code>&lt;ip:port></code> 格式显示的设备。然而，结合真机调试和模拟器测试，可以发现：</p><ul><li><strong>真机</strong>：使用 USB 连接时，插入 USB 线并开启 USB 调试后，设备会被 Adb 服务器识别，<code>adb devices</code> 显示的设备名称为设备的 <strong>序列号</strong>。</li><li><strong>模拟器</strong>：通常不使用 USB 调试，而是通过 TCP/IP 连接。直接使用 <code>adb connect</code> 命令连接特定端口即可发现设备。在 NAT 模式下，模拟器必须有 WIFI 连接。模拟器通过 WIFI 连接到主机网卡时，会绑定本地端口，但 Adb 服务器可能无法自动发现模拟器（尤其是模拟器未使用默认端口范围 5555-5585），因此需要手动使用 <code>adb connect</code> 命令进行绑定。</li></ul><h4 id=多设备下的-adb class=heading-element><span>多设备下的 Adb</span>
<a href=#%e5%a4%9a%e8%ae%be%e5%a4%87%e4%b8%8b%e7%9a%84-adb class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>在多设备环境中（例如多个模拟器或真机），直接使用 <code>adb shell</code> 等命令可能会因无法确定目标设备而报错。此时需要通过 <code>-s &lt;名称></code> 参数指定设备进行调试。例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>adb -s 127.0.0.1:21503 shell</span></span></code></pre></td></tr></table></div></div><p>在使用 adb 和 frida-ps 进行设备检测时，可能会发现识别出的信息不同。这里连接真机喝逍遥模拟器，前者通过 USB 连接，后者使用 nat 连接 WIFI。以下是相关工具的参数说明：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>adb --help
</span></span><span class=line><span class=cl>global options:
</span></span><span class=line><span class=cl>-a         listen on all network interfaces, not just localhost
</span></span><span class=line><span class=cl>-d         use USB device <span class=o>(</span>error <span class=k>if</span> multiple devices connected<span class=o>)</span>
</span></span><span class=line><span class=cl>-e         use TCP/IP device <span class=o>(</span>error <span class=k>if</span> multiple TCP/IP devices available<span class=o>)</span>
</span></span><span class=line><span class=cl>-s SERIAL  use device with given serial <span class=o>(</span>overrides <span class=nv>$ANDROID_SERIAL</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>frida-ps --help
</span></span><span class=line><span class=cl>Options:
</span></span><span class=line><span class=cl>-U, --usb             connect to USB device
</span></span><span class=line><span class=cl>-D ID, --device<span class=o>=</span>ID    connect to device with the given ID
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>objection --help
</span></span><span class=line><span class=cl>Options:
</span></span><span class=line><span class=cl>-N, --network            Connect using a network connection instead of USB.
</span></span><span class=line><span class=cl>-h, --host TEXT          <span class=o>[</span>default: 127.0.0.1<span class=o>]</span>
</span></span><span class=line><span class=cl>-p, --port INTEGER       <span class=o>[</span>default: 27042<span class=o>]</span>
</span></span><span class=line><span class=cl>-ah, --api-host TEXT     <span class=o>[</span>default: 127.0.0.1<span class=o>]</span>
</span></span><span class=line><span class=cl>-ap, --api-port INTEGER  <span class=o>[</span>default: 8888<span class=o>]</span>
</span></span><span class=line><span class=cl>-g, --gadget TEXT        Name of the Frida Gadget/Process to connect to.
</span></span><span class=line><span class=cl><span class=o>[</span>default: Gadget<span class=o>]</span>
</span></span><span class=line><span class=cl>-S, --serial TEXT        A device serial to connect to.</span></span></code></pre></td></tr></table></div></div><p>尝试之后可以得到下面的结论：</p><ul><li>使用 <code>Adb</code> 的 <code>-d</code> 选项可以匹配 USB 连接的真机，而 <code>-e</code> 选项可以连接模拟器。</li><li>使用 <code>frida-ps</code> 的 <code>-U</code> 选项连接的却是模拟器，这表明二者的检测机制不同。</li><li>对于 <code>frida</code> 和 <code>frida-ps</code>，可以使用 <code>-D ID</code> 参数，通过 adb devices 中显示的设备 ID（名称）来匹配不同的设备。</li><li>对于 <code>objection</code>，则使用 <code>-S serial</code> 参数来识别设备，这里的 serial 就是设备的 ID。</li></ul><h4 id=无线wifi连接 class=heading-element><span>无线（WIFI）连接</span>
<a href=#%e6%97%a0%e7%ba%bfwifi%e8%bf%9e%e6%8e%a5 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>在测试 <code>objection</code> 的 <code>-p</code> 选项时，发现在模拟器中运行 <code>frida-server</code> 监听 7878 端口时，<code>objection</code> 无法连接，即使设置了 <code>adb forward tcp:27042 tcp:7878</code> 也无法成功连接。因此，尝试使用无线连接的真机来测试 <code>-p</code> 选项是否能够成功。</p><p>为了使手机支持无线调试，需要确保手机上存在 <code>adbd</code> 进程。有两种方法可以实现：</p><ul><li><strong>通过 USB 连接启动无线调试</strong>：使用 Adb 启动 USB 连接手机的无线调试功能。虽然这种方法有些多余（既然已经通过 USB 连接了，再使用无线连接似乎没有必要），但可以作为一种测试手段。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>adb tcpip <span class=m>5555</span>
</span></span><span class=line><span class=cl>adb connect &lt;PHONE_IP_ADDRESS&gt;:5555 <span class=c1># `&lt;PHONE_IP_ADDRESS&gt;` 是手机在局域网中的 IP 地址。</span></span></span></code></pre></td></tr></table></div></div><ul><li><strong>使用 Android 命令行指令启动无线调试</strong>：可以通过 <code>adb shell</code> 或下载 Termux 应用来执行命令行操作，详细步骤可以参考 <a href=https://blog.csdn.net/lerous/article/details/108297330 target=_blank rel="external nofollow noopener noreferrer">adb wifi调试问题</a>。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>adb shell setprop service.adb.tcp.port <span class=m>5555</span>
</span></span><span class=line><span class=cl>adb shell stop adbd
</span></span><span class=line><span class=cl>adb shell start adbd
</span></span><span class=line><span class=cl>adb connect &lt;PHONE_IP_ADDRESS&gt;:5555</span></span></code></pre></td></tr></table></div></div><p>配置完成后在 <code>adb devices</code> 中可以看到一个无线连接的设备。但要确保手机和 PC 在同一个局域网内，因此可以通过 <code>ping</code> 命令测试网络连通性，如果可以 ping 通，说明无线连接可行。然后在手机上启动 <code>frida-server</code>，监听端口（例如 7878）。并在在 PC 上使用 <code>objection</code> 连接无线设备 <code>objection -N -h 192.168.123.213 -p 7878 -g com.example.app explore</code>，如果连接成功，说明无线连接可行。</p><p>然后断开连接，使用 USB 连接真机，并在手机上启动 <code>frida-server</code> 的 7878 端口。之后使用 <code>objection</code> 连接 <code>objection -S SERIAL -g com.example.app explore</code>。最后可以发现无论是否使用端口转发，<code>-p 7878</code> 选项都无法成功连接目标真机。</p><p>最后发现 <code>frida</code> 将模拟器视为 USB 连接设备，而 Adb 将其识别为 TCP/IP 连接设备。模拟器的 WIFI 功能在这种情况下更像是一个摆设。同时<code>objection</code> 对于 USB 连接设备不提供 <code>frida-server</code> 的端口切换功能，仅对无线连接的设备提供此功能。因此，USB 设备（无论是真机还是模拟器）在使用 <code>objection</code> 时，建议使用 <code>frida-server</code> 的默认端口（27042）。</p><div class="details admonition note open disabled"><div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden=true></i>叠甲</div><div class=details-content><div class=admonition-content><p>这个只是我拿真机与模拟器测试的结果，可能存在别的方案使得上述结论无效。</p></div></div></div><h4 id=总结 class=heading-element><span>总结</span>
<a href=#%e6%80%bb%e7%bb%93 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><div class="details admonition tip open disabled"><div class="details-summary admonition-title"><i class="icon fa-fw fa-regular fa-lightbulb" aria-hidden=true></i>总结</div><div class=details-content><div class=admonition-content><p>这里总结 adb，frida，frida-ps，objection 连接真机和模拟器设备等多设备情况时的处理方法。</p></div></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>List of devices attached
</span></span><span class=line><span class=cl>8C5X1J8JR       		device
</span></span><span class=line><span class=cl>127.0.0.1:21503 		device
</span></span><span class=line><span class=cl>192.168.123.213:5555    device	<span class=c1>## WIFI 连接是后来加的，和 8C5X1J8JR 是同一台真机设备</span></span></span></code></pre></td></tr></table></div></div><h5 id=adb class=heading-element><span>adb</span>
<a href=#adb class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>## 模拟器设备</span>
</span></span><span class=line><span class=cl>adb -e shell	
</span></span><span class=line><span class=cl><span class=c1>## USB连接设备</span>
</span></span><span class=line><span class=cl>adb -d shell	<span class=c1>## 这两个命令面对同类设备只存在一个的情况时可以使用</span>
</span></span><span class=line><span class=cl><span class=c1>## WIFI连接设备</span>
</span></span><span class=line><span class=cl>adb -a shell	<span class=c1>## 这个只有单个设备时才能使用，条件比上面两个更苛刻</span>
</span></span><span class=line><span class=cl><span class=c1>## 通用连接</span>
</span></span><span class=line><span class=cl>adb -s 192.168.123.213:5555 shell	<span class=c1>## -s SERIAL根据序列号来连接，是通用连接方式，多设备都可以连接</span></span></span></code></pre></td></tr></table></div></div><p><code>Adb</code> 将模拟器识别为 TCP/IP 连接设备，它通过本地回环地址的端口（模拟器 adbd 使用的端口）进行连接。这里提及的模拟器都是使用 NAT 网络连接，其中的 WIFI 是一个摆设，但是如果改为桥接模式，那么可以将模拟器视为一个 WIFI 连接的设备。</p><h5 id=frida class=heading-element><span>frida</span>
<a href=#frida class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>## 通用连接</span>
</span></span><span class=line><span class=cl>frida-ps -D ID	<span class=c1>## 直接根据上面的 SERIAL充当ID 进行连接</span>
</span></span><span class=line><span class=cl><span class=c1>## 模拟器连接</span>
</span></span><span class=line><span class=cl>frida-ps -U		<span class=c1>## 还存在一个USB设备的情况下，这个命令只匹配模拟器，若是只有一个模拟器没有真机，也匹配模拟器</span>
</span></span><span class=line><span class=cl><span class=c1>## 端口修改连接</span>
</span></span><span class=line><span class=cl>./frida-server-16.0.8-android-arm64 -l 0.0.0.0:19233
</span></span><span class=line><span class=cl>adb forward tcp:19233 tcp:19233
</span></span><span class=line><span class=cl>frida -H 127.0.0.1:19233 -f 包名 -l .<span class=se>\j</span>s_example.js</span></span></code></pre></td></tr></table></div></div><p><code>frida</code> 将模拟器视为优先级更高的 USB 连接设备，所以对于模拟器的连接直接使用 <code>-U</code> 就可以连接</p><h5 id=objection class=heading-element><span>objection</span>
<a href=#objection class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>## USB设备-&gt;USB连接的手机和模拟器，这个情况下，frida-server不能更改监听的端口</span>
</span></span><span class=line><span class=cl>objection -S SERIAL -g &lt;package-name&gt; explore
</span></span><span class=line><span class=cl><span class=c1>## WIFI设备，这个情况下可以随意更改frida-server监听端口</span>
</span></span><span class=line><span class=cl>objection -N -h 192.168.123.213 -p <span class=m>7878</span> -g &lt;package-name&gt; explore</span></span></code></pre></td></tr></table></div></div><p><code>objection</code> 的 <code>-p</code> 设置只能适用于无线连接设备，USB 连接设备（真机和模拟器）都不可以进行设置。这里 <code>frida-server</code> 的原理就是运行进程来监听安卓设备的一个端口，然后 frida 去连接安卓设备对应的端口并发送信息，<code>frida-server</code> 通过端口接收数据并执行操作。所以可能 objection 的 <code>-S</code> 选择设备只会采用默认的 <code>frida-server</code> 端口去连接。</p><h3 id=adb-命令 class=heading-element><span>Adb 命令</span>
<a href=#adb-%e5%91%bd%e4%bb%a4 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>上文介绍了 Adb 的原理，我们通常需要它来处理相关命令。这里通过 <code>adb shell</code> 进入 adb 环境，它相当于 Android 系统中的 shell 环境，可以执行上文罗列的 Linux 命令。同时可以直接使用 <code>adb shell + linux command</code> 来直接执行 linux 命令，然后结果就会反馈到当前终端。简单连接设备的命令如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 查看当前连接的设备</span>
</span></span><span class=line><span class=cl>adb devices
</span></span><span class=line><span class=cl><span class=c1># 连接模拟器设备，这里是蓝叠的</span>
</span></span><span class=line><span class=cl>adb connect 127.0.0.1:5555
</span></span><span class=line><span class=cl><span class=c1># 多个设备下，使用 -s 连接单独设备，或者根据模拟器与真机分别使用-e与-d选项</span>
</span></span><span class=line><span class=cl>adb -s 127.0.0.1:5555 shell</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2025-01-31 20:17:51">更新于 2025.1.31&nbsp;
<a class=git-hash href=https://github.com/czTangt/blog.git/commit/f0c83d42fb6bbd272123c9c5cbae3f6e3125c70f rel="external nofollow noopener noreferrer" target=_blank title="commit by czTangt(cz.tangt@gmail.com) f0c83d42fb6bbd272123c9c5cbae3f6e3125c70f: add post of android-reverse"><i class="fa-solid fa-hashtag fa-fw" aria-hidden=true></i>f0c83d4</a></span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href="https://github.com/czTangt/blog.git/blob/main/content/posts%5candroid%5cReverse.md?plain=1" title=查看源码 target=_blank rel="external nofollow noopener noreferrer" class=link-to-source>查看源码</a></span><span><a href=https://github.com/czTangt/blog.git/edit/main/content/posts%5candroid%5cReverse.md title=编辑此页 target=_blank rel="external nofollow noopener noreferrer" class=link-to-edit>编辑此页</a></span><span><a href="https://github.com/czTangt/blog.git/issues/new?title=[BUG]%20Android+Reverse&amp;body=%7cField%7cValue%7c%0A%7c-%7c-%7c%0A%7cTitle%7cAndroid+Reverse%7c%0A%7cURL%7chttps://czTangt.github.io/blog/posts/android/android-reverse/%7c%0A%7cFilename%7chttps://github.com/czTangt/blog.git/blob/main/content/posts%5candroid%5cReverse.md?plain=1%7c" title=报告问题 target=_blank rel="external nofollow noopener noreferrer" class=link-to-report>报告问题</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 X" data-sharer=twitter data-url=https://czTangt.github.io/blog/posts/android/android-reverse/ data-title="Android Reverse" data-hashtags=reverse,android><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://czTangt.github.io/blog/posts/android/android-reverse/ data-hashtag=reverse><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://czTangt.github.io/blog/posts/android/android-reverse/ data-title="Android Reverse"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/blog/tags/reverse/ class=post-tag title="标签 - Reverse">Reverse</a><a href=/blog/tags/android/ class=post-tag title="标签 - Android">Android</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/blog/>主页</a></span></section></div><div class=post-nav><a href=/blog/posts/config/docker/ class=post-nav-item rel=prev title=Docker><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Docker</a></div></div></article><aside class=toc id=toc-auto aria-label=目录><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered order-1">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.136.5"><img class=hugo-icon src=/blog/images/hugo.min.svg alt="Hugo logo"> Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.3.17-30a67c4b"><img class=fixit-icon src=/blog/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright order-2" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2024 - 2025</span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div></div><a href=https://github.com/czTangt/blog title="View source on GitHub" target=_blank rel="external nofollow" class="github-corner left d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true" width="56" height="56"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><noscript><div class=noscript-warning>该网站在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/blog/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=preload href=/blog/lib/katex/katex.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/blog/lib/katex/katex.min.css></noscript><link rel=stylesheet href=/blog/lib/cookieconsent/cookieconsent.min.css><script src=/blog/lib/autocomplete/autocomplete.min.js defer></script><script src=/blog/lib/fuse/fuse.min.js defer></script><script src=/blog/lib/lightgallery/lightgallery.min.js defer></script><script src=/blog/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/blog/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/blog/lib/sharer/sharer.min.js async defer></script><script src=/blog/lib/katex/katex.min.js defer></script><script src=/blog/lib/katex/auto-render.min.js defer></script><script src=/blog/lib/katex/mhchem.min.js defer></script><script src=/blog/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/blog/js/codeblock.js defer></script><script src=https://libs.baidu.com/jquery/2.1.4/jquery.min.js defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:10},comment:{enable:!1},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/blog/search.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!1},version:"v0.3.17-30a67c4b"}</script><script src=/blog/js/theme.min.js defer></script></body></html>