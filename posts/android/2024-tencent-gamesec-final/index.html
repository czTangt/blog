<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>2024腾讯游戏安全竞赛决赛 - czTang</title><meta name=author content="czTang">
<meta name=description content="记录一下对于2024腾讯游戏安全竞赛安卓赛道的复现。
"><meta name=keywords content='android,game'><meta itemprop=name content="2024腾讯游戏安全竞赛决赛"><meta itemprop=description content="记录一下对于2024腾讯游戏安全竞赛安卓赛道的复现。"><meta itemprop=datePublished content="2025-03-27T10:19:48+08:00"><meta itemprop=dateModified content="2025-04-05T16:27:33+08:00"><meta itemprop=wordCount content="11126"><meta itemprop=keywords content="Android,Game"><meta property="og:url" content="https://czTangt.github.io/blog/posts/android/2024-tencent-gamesec-final/"><meta property="og:site_name" content="czTang"><meta property="og:title" content="2024腾讯游戏安全竞赛决赛"><meta property="og:description" content="记录一下对于2024腾讯游戏安全竞赛安卓赛道的复现。"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-27T10:19:48+08:00"><meta property="article:modified_time" content="2025-04-05T16:27:33+08:00"><meta property="article:tag" content="Android"><meta property="article:tag" content="Game"><meta name=twitter:card content="summary"><meta name=twitter:title content="2024腾讯游戏安全竞赛决赛"><meta name=twitter:description content="记录一下对于2024腾讯游戏安全竞赛安卓赛道的复现。"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202410312135963.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical type=text/html href=https://czTangt.github.io/blog/posts/android/2024-tencent-gamesec-final/ title="2024腾讯游戏安全竞赛决赛 - czTang"><link rel=prev type=text/html href=https://czTangt.github.io/blog/posts/android/2024-tencent-gamesec-prelim/ title=2024腾讯游戏安全竞赛初赛><link rel=stylesheet href=/blog/css/style.min.css><link rel=preload href=/blog/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/blog/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/blog/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/blog/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"2024腾讯游戏安全竞赛决赛","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/czTangt.github.io\/blog\/posts\/android\/2024-tencent-gamesec-final\/"},"genre":"posts","keywords":"android, game","wordcount":11126,"url":"https:\/\/czTangt.github.io\/blog\/posts\/android\/2024-tencent-gamesec-final\/","datePublished":"2025-03-27T10:19:48+08:00","dateModified":"2025-04-05T16:27:33+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"czTang"},"description":""}</script><script src=/blog/js/head/color-scheme.min.js></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=left><div class=header-title><a href=/blog/ title=czTang><span class=header-title-pre><i class='fa fa-coffee'>&nbsp</i></span><span class=header-title-text>czTang</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/blog/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Archives</a></li><li class=menu-item><a class=menu-link href=/blog/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/blog/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=/blog/about/><i class="fa-solid fa-user fa-fw fa-sm" aria-hidden=true></i> About</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/blog/ title=czTang><span class=header-title-pre><i class='fa fa-coffee'>&nbsp</i></span><span class=header-title-text>czTang</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/blog/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Archives</a></li><li class=menu-item><a class=menu-link href=/blog/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/blog/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=/blog/about/><i class="fa-solid fa-user fa-fw fa-sm" aria-hidden=true></i> About</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=合集><div class="details collection-details open"><div class="details-summary collection-summary"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i>
<span class=collection-name title=合集>Game</span>
<span class=collection-count>2</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content collection-content"><nav><ul class=collection-list><li class=collection-item><a href=/blog/posts/android/2024-tencent-gamesec-prelim/ title=2024腾讯游戏安全竞赛初赛>2024腾讯游戏安全竞赛初赛</a></li><li class=collection-item><span class=active title=2024腾讯游戏安全竞赛决赛>2024腾讯游戏安全竞赛决赛</span></li></ul><div class=collection-nav-simple><a href=/blog/posts/android/2024-tencent-gamesec-prelim/ class=collection-nav-item rel=prev title=2024腾讯游戏安全竞赛初赛><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i></a><span class=text-secondary>2/2</span><i class="fa-solid fa-angle-right fa-fw collection-nav-item text-secondary" aria-hidden=true></i></div></nav></div></div></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>2024腾讯游戏安全竞赛决赛</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/czTangt title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img loading=lazy src=/blog/images/avatar.jpg alt=czTang data-title=czTang width=20 height=20 class=avatar style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'>&nbsp;czTang</a></span><span class=post-included-in>&nbsp;收录于 <a href=/blog/categories/android/ class=post-category title="分类 - Android"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Android</a> 和 <a href=/blog/collections/game/ class=post-collection title="合集 - Game"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> Game</a></span></div><div class=post-meta-line><span title="发布于 2025-03-27 10:19:48"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2025.3.27>2025.3.27</time></span>&nbsp;<span title="更新于 2025-04-05 16:27:33"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden=true></i><time datetime=2025.4.5>2025.4.5</time></span>&nbsp;<span title="11126 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 11200 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 23 分钟</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#前期准备>前期准备</a><ul><li><a href=#版本与结构>版本与结构</a></li><li><a href=#gname-验证>GName 验证</a><ul><li><a href=#gadget-注入>gadget 注入</a></li><li><a href=#算法验证>算法验证</a></li></ul></li></ul></li><li><a href=#dumpsdk>dumpSDK</a><ul><li><a href=#sdk-获取>SDK 获取</a><ul><li><a href=#获取类对象>获取类对象</a><ul><li><a href=#fuobjectarray>FUObjectArray</a></li><li><a href=#getobjectptr>GetObjectPtr</a></li></ul></li><li><a href=#获取变量和方法>获取变量和方法</a><ul><li><a href=#前置知识>前置知识</a><ul><li><a href=#ufield>UField</a></li><li><a href=#ffield>FField</a></li><li><a href=#fproperty>FProperty</a></li><li><a href=#ustruct>UStruct</a></li><li><a href=#uclass>UClass</a></li><li><a href=#总结>总结</a></li></ul></li><li><a href=#childproperties>ChildProperties</a></li><li><a href=#property-解析>Property 解析</a><ul><li><a href=#fbyteproperty>FByteProperty</a></li><li><a href=#fmapproperty>FMapProperty</a></li></ul></li><li><a href=#children>Children</a></li><li><a href=#ufunction-解析>UFunction 解析</a></li></ul></li></ul></li></ul></li><li><a href=#参考资料>参考资料</a></li></ul></nav></div></div><div class=content id=content><p>记录一下对于2024腾讯游戏安全竞赛安卓赛道的复现。</p><h2 id=前期准备 class=heading-element><span>前期准备</span>
<a href=#%e5%89%8d%e6%9c%9f%e5%87%86%e5%a4%87 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 id=版本与结构 class=heading-element><span>版本与结构</span>
<a href=#%e7%89%88%e6%9c%ac%e4%b8%8e%e7%bb%93%e6%9e%84 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>按照初赛的逻辑，首先查看这个游戏的 ue 版本，然后发现和初赛一样，在 libUE4.so 中发现了 <code>++UE4+Release-4.27</code>，确定是 4.27 版本。然后就是按照常规流程来寻找 GWorld，GUObjectArray，GName 三件套。对于前面两个而言，就是通过 <code>SeamlessTravel FlushLevelStreaming</code> 和 <code>CloseDisregardForGC</code> 进行字符串交叉引用即可找到。然后由下图得到了 <code>GWorld</code> 为 <code>0x4F5C0D0</code>，<code>GUObjectArray</code> 为 <code>0x4E533AC</code>。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327214918.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327214918.png?size=small" data-sub-html="<h2>20250327214918</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327214918.png alt=GWorld srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327214918.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327214918.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327214918.png?size=large 2x" data-title=20250327214918 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>GWorld</figcaption></figure><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327220856.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327220856.png?size=small" data-sub-html="<h2>20250327220856</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327220856.png alt=GUObjectArray srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327220856.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327220856.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327220856.png?size=large 2x" data-title=20250327220856 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>GUObjectArray</figcaption></figure>不过这里按照常规流程却不好解析 GName 这个关键结构。这里首先搜索字符串 <code>ByteProperty</code>，然后排除上面的宽字符串（因为没有交叉引用），找到最后一个字符串找到其交叉引用。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327221140.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327221140.png?size=small" data-sub-html="<h2>20250327221140</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327221140.png alt=ByteProperty搜索 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327221140.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327221140.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327221140.png?size=large 2x" data-title=20250327221140 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>ByteProperty搜索</figcaption></figure>然后这里就是不同之处了，这里往下翻可以看见是 <code>None</code>，<code>IntProperty</code> 等字符串，但是未识别成函数，按 <code>p</code> 也没有效果。因此查看这个 <code>loc_1C2E26C</code> 发现存在两个交叉引用，其中一个还是自己引用自己，所以跳转到第一个引用的地方。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327221728.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327221728.png?size=small" data-sub-html="<h2>20250327221728</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327221728.png alt=代码段交叉引用 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327221728.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327221728.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327221728.png?size=large 2x" data-title=20250327221728 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>代码段交叉引用</figcaption></figure>之后发现 <code>loc_1C2E0B0</code> 还是没有识别为函数，同时是最后跳转到上面的 <code>loc_1C2E26C</code>。查看这个小的代码片段没发现什么关键的地方，同时查看其交叉引用发现有很多函数调用这个地方，因此继续往上查看这个地方的调用点。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327222041.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327222041.png?size=small" data-sub-html="<h2>20250327222041</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327222041.png alt=代码段交叉引用 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327222041.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327222041.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327222041.png?size=large 2x" data-title=20250327222041 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>代码段交叉引用</figcaption></figure>随便选了交叉引用中的一个函数，发现这里就和之前找到 GName 的汇编代码很相近了。这里 R0 就是传入的 this 指针，也就是 GName，因此 <code>GName</code> 为 <code>0x4E2EC00</code>。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327222352.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327222352.png?size=small" data-sub-html="<h2>20250327222352</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327222352.png alt=交叉引用函数 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327222352.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327222352.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327222352.png?size=large 2x" data-title=20250327222352 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>交叉引用函数</figcaption></figure></p><h3 id=gname-验证 class=heading-element><span>GName 验证</span>
<a href=#gname-%e9%aa%8c%e8%af%81 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h4 id=gadget-注入 class=heading-element><span>gadget 注入</span>
<a href=#gadget-%e6%b3%a8%e5%85%a5 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>上述找到 GName 的流程和平时不同，所以尝试利用 frida 来验证通过这里的 GName 获取字符串算法是否有效。但是发现 frida 注入迟缓，响应很慢，同时游戏正常运行一段时间之后就会自己闪退。因此尝试使用 frida-gadget 注入来使用 frida。这里首先再消耗一下 frida-server，先采用 spawn 模式启动下面的代码，查看 apk 打开的 so 文件。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// frida -U -F com.tencent.ace.gamematch2024final  -l .\hook.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>hook_dlopen</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Interceptor</span><span class=p>.</span><span class=nx>attach</span><span class=p>(</span><span class=nx>Module</span><span class=p>.</span><span class=nx>findExportByName</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=s2>&#34;android_dlopen_ext&#34;</span><span class=p>),</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>onEnter</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kd>var</span> <span class=nx>soName</span> <span class=o>=</span> <span class=nx>args</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>readCString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`dlopen onEnter: </span><span class=si>${</span><span class=nx>soName</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> 
</span></span><span class=line><span class=cl>        <span class=nx>onLeave</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>retval</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`dlopen onLeave: </span><span class=si>${</span><span class=nx>retval</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>      
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>setImmediate</span><span class=p>(</span><span class=nx>hook_dlopen</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div><p>之后得到了下面的结果，可以看出首先打开了 libstats_jni.so，libUE4.so，libvrapi.so 等 so 文件，所以准备对于这些 so 文件进行 frida-gadget 的注入。不过这里只对 apk 本身的 so 进行注入，同时一开始对 libUE4.so 注入会闪退，所以就对 libvrapi.so 进行注入。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327223356.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327223356.png?size=small" data-sub-html="<h2>20250327223356</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327223356.png alt=frida结果 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327223356.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327223356.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250327223356.png?size=large 2x" data-title=20250327223356 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>frida结果</figcaption></figure>这里的注入就是利用 lief 来给 libvrapi.so 文件添加依赖。通过下面的代码，libvrapi.so 就依赖 libfrida-gadget.so 了，这样在加载前者时，需要先将后者进行加载，这样就达到了注入 frida-gadget 的目的（注意这里只有 arm32，所以需要选择适当的 frida-gadget 文件）。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>lief</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>str_so_apk</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>str_so_gadget</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># python .\liefpatch.py libvrapi.so libfrida-gadget.so</span>
</span></span><span class=line><span class=cl><span class=n>libnative</span> <span class=o>=</span> <span class=n>lief</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=n>str_so_apk</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libnative</span><span class=o>.</span><span class=n>add_library</span><span class=p>(</span><span class=n>str_so_gadget</span><span class=p>)</span> <span class=c1># Injection!</span>
</span></span><span class=line><span class=cl><span class=n>libnative</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>str_so_apk</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>之后就是把新的 libvrapi.so 和准备好的 libfrida-gadget.so 和 libfrida-gadget.config.so 都放入由上文 frida hook 得到的 apk 路径中去即可，具体可以参照 <a href="https://www.bilibili.com/video/BV13B2oYTELv/?spm_id_from=333.337.search-card.all.click&amp;vd_source=17ac9da9453dbd6d64b9616668574c5f" target=_blank rel="external nofollow noopener noreferrer">视频</a> 中的流程。或者使用 apktool 重打包 apk，把上述修改和需要添加的文件放入到 <code>lib/armeabi-v7a</code> 目录中，再使用 MT 管理器签名安装。其中 libfrida-gadget.config.so 是配置文件，内容如下。它规定了 frida-gadget 的交互规则，可以从 <a href=https://frida.re/docs/gadget/ target=_blank rel="external nofollow noopener noreferrer">官网</a> 找到相应解释。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;interaction&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;listen&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;address&#34;</span><span class=p>:</span> <span class=s2>&#34;127.0.0.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=mi>27042</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;on_port_conflict&#34;</span><span class=p>:</span> <span class=s2>&#34;fail&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;on_load&#34;</span><span class=p>:</span> <span class=s2>&#34;wait&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>这样都准备好了之后，再启动 apk，会发现它卡在了加载页面。这个时候就需要使用 <code>frida -U -F -l hook.js</code> 来加载 frida 脚本，这样 apk 才会继续运行到输入密码的界面。同时此时写的 frida 脚本也可以正常进行交互和响应了，不会再出现使用 frida-server 时的卡死情况了，但还是会间隔一段时间就闪退。</p><h4 id=算法验证 class=heading-element><span>算法验证</span>
<a href=#%e7%ae%97%e6%b3%95%e9%aa%8c%e8%af%81 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>这里的代码可以直接拿初赛的 <code>getNameFromId()</code> 函数来验证，不过这里因为是 arm32 的 apk，所以偏移需要进行适当调整。查看源码就只是 <code>offset_FRWLock</code> 和 <code>size_Block</code> 发生了变化，然后得到了下面的代码。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>GWorld_Offset</span> <span class=o>=</span> <span class=mh>0x4F5C0D0</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>GName_Offset</span> <span class=o>=</span> <span class=mh>0x4E2EC00</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>GUObjectArray_Offset</span> <span class=o>=</span> <span class=mh>0x4E533AC</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>GWorld</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>GName</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>moduleBase</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>init</span><span class=p>(</span><span class=nx>soName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>module</span> <span class=o>=</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>findModuleByName</span><span class=p>(</span><span class=nx>soName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>module</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>moduleBase</span> <span class=o>=</span> <span class=nx>module</span><span class=p>.</span><span class=nx>base</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>GWorld</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>GWorld_Offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>GName</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>GName_Offset</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`init success`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getNameFromId32</span><span class=p>(</span><span class=nx>ComparisonIndex</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/*-----------------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=cm>        相关数据结构偏移与大小
</span></span></span><span class=line><span class=cl><span class=cm>    -----------------------------------------------------------------------------*/</span>
</span></span><span class=line><span class=cl>    <span class=c1>// FNameEntryAllocator 相关数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>offset_FRWLock</span> <span class=o>=</span> <span class=mh>0x28</span><span class=p>;</span>                                  <span class=c1>// FRWLock 偏移量，32位系统下为 0x28
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>offset_Blocks</span> <span class=o>=</span> <span class=nx>offset_FRWLock</span> <span class=o>+</span> <span class=mh>0x8</span><span class=p>;</span>                   <span class=c1>// Blocks 偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>size_Stride</span> <span class=o>=</span> <span class=mh>0x2</span><span class=p>;</span>                                      <span class=c1>// FNameEntry 的大小
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>size_Block</span> <span class=o>=</span> <span class=mh>0x4</span><span class=p>;</span>                                       <span class=c1>// Blocks 中存储的 uint8* 指针的大小，32位系统下为 4 字节
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// FNameEntryHanlder 相关数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>FNameBlockOffsetBits</span> <span class=o>=</span> <span class=mi>16</span><span class=p>;</span>                              <span class=c1>// 块偏移量位数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>FNameBlockOffsets</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=nx>FNameBlockOffsetBits</span><span class=p>;</span>          <span class=c1>// 块偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>Block</span> <span class=o>=</span> <span class=nx>ComparisonIndex</span> <span class=o>&gt;&gt;</span> <span class=nx>FNameBlockOffsetBits</span><span class=p>;</span>        <span class=c1>// 块索引
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>Offset</span> <span class=o>=</span> <span class=nx>ComparisonIndex</span> <span class=o>&amp;</span> <span class=p>(</span><span class=nx>FNameBlockOffsets</span> <span class=o>-</span> <span class=mi>1</span><span class=p>);</span>     <span class=c1>// 块内偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// FNameEntryHeader 相关数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>bIsWideBit</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>                                         <span class=c1>// 判断是否为宽字符的位数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>offset_LenBit</span> <span class=o>=</span> <span class=mi>6</span><span class=p>;</span>                                      <span class=c1>// 字符串长度位数的偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// FNameEntry 相关数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>offset_Union</span> <span class=o>=</span> <span class=mh>0x2</span><span class=p>;</span>                                     <span class=c1>// FNameEntry 中字符串 Union 的偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/*-----------------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=cm>        相关数据结构计算
</span></span></span><span class=line><span class=cl><span class=cm>    -----------------------------------------------------------------------------*/</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 计算 FNameEntryAllocator 的地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>FNameEntryAllocator</span> <span class=o>=</span> <span class=nx>GName</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 计算 Blocks 数组的地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>Blocks</span> <span class=o>=</span> <span class=nx>FNameEntryAllocator</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>offset_Blocks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取 Blocks 数组中块实例的地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>BlockInstance</span> <span class=o>=</span> <span class=nx>Blocks</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Block</span> <span class=o>*</span> <span class=nx>size_Block</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 计算 Resolve 返回的 FNameEntry 类型地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>FNameEntry</span> <span class=o>=</span> <span class=nx>BlockInstance</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>size_Stride</span> <span class=o>*</span> <span class=nx>Offset</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取 FNameEntryHeader，它只有两个字节
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>FNameEntryHeader</span> <span class=o>=</span> <span class=nx>FNameEntry</span><span class=p>.</span><span class=nx>readU16</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取字符串地址，长度，是否为宽字符标识
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>str_addr</span> <span class=o>=</span> <span class=nx>FNameEntry</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>offset_Union</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>str_length</span> <span class=o>=</span> <span class=nx>FNameEntryHeader</span> <span class=o>&gt;&gt;</span> <span class=nx>offset_LenBit</span><span class=p>;</span>             <span class=c1>// 计算字符串长度
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>wide</span> <span class=o>=</span> <span class=nx>FNameEntryHeader</span> <span class=o>&amp;</span> <span class=nx>bIsWideBit</span><span class=p>;</span>                       <span class=c1>// 判断字符串是否为宽字符
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// 如果是宽字符，返回 &#34;widestr&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>wide</span><span class=p>)</span> <span class=k>return</span> <span class=s2>&#34;widestr&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 如果字符串长度合理，读取并返回UTF-8字符串
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>str_length</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=nx>str_length</span> <span class=o>&lt;</span> <span class=mi>250</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>str_addr</span><span class=p>.</span><span class=nx>readCString</span><span class=p>(</span><span class=nx>str_length</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;Invalid length&#34;</span><span class=p>;</span> <span class=c1>// 长度不合理，返回 &#34;Invalid length&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>init</span><span class=p>(</span><span class=s2>&#34;libUE4.so&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=mi>50</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>name</span> <span class=o>=</span> <span class=nx>getNameFromId32</span><span class=p>(</span><span class=nx>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] name: </span><span class=si>${</span><span class=nx>name</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>运行的结果如下所示，可以看出来这个 GName 是没有问题的，<code>FNmae::ToString()</code> 函数的功能可以实现。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250330195153.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250330195153.png?size=small" data-sub-html="<h2>20250330195153</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250330195153.png alt="frida 结果" srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250330195153.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250330195153.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250330195153.png?size=large 2x" data-title=20250330195153 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>frida 结果</figcaption></figure></p><h2 id=dumpsdk class=heading-element><span>dumpSDK</span>
<a href=#dumpsdk class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>这里直接 dumpSDK 会发现报错，不能 dump，同时采用初始使用的 <code>getActorsMap</code> 也解析不到结果，由此怀疑更改了 UE 相关结构。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250330200342.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250330200342.png?size=small" data-sub-html="<h2>20250330200342</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250330200342.png alt=dump报错 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250330200342.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250330200342.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250330200342.png?size=large 2x" data-title=20250330200342 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>dump报错</figcaption></figure>因此这里就需要根据动态调试获取魔改的偏移，不过在此之前，需要知道 SDK 是怎么得到的，这样才知道需要寻找哪些偏移。</p><h3 id=sdk-获取 class=heading-element><span>SDK 获取</span>
<a href=#sdk-%e8%8e%b7%e5%8f%96 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>SDK 的获取需要三个关键的全局变量：<code>GWorld</code>，<code>GName</code> 和 <code>GUObjectArray</code>。前面两个在 Actor 获取和 getName 解析中被使用，而最后的 <code>GUObjectArray</code> 就是在获取 SDK 中的类成员和函数时被使用。下文就是对于这个全局变量的解析，同时结合 <a href=https://github.com/hackcatml/frida-ue4dump target=_blank rel="external nofollow noopener noreferrer">frida-ue4dump</a> 代码进行讲解。</p><div class="details admonition tip open disabled"><div class="details-summary admonition-title"><i class="icon fa-fw fa-regular fa-lightbulb" aria-hidden=true></i>补充</div><div class=details-content><div class=admonition-content><p>这里分析的只是 arm64 架构的情况，然后提取 frida-ue4dump 中关于这部分的代码并改进。而 arm32 架构则因为指针大小及其他原因会更改偏移，所以需要另外分析。</p></div></div></div><h4 id=获取类对象 class=heading-element><span>获取类对象</span>
<a href=#%e8%8e%b7%e5%8f%96%e7%b1%bb%e5%af%b9%e8%b1%a1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><h5 id=fuobjectarray class=heading-element><span>FUObjectArray</span>
<a href=#fuobjectarray class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>上述提到的名字获取是最为基本的，复杂的是类成员字段，函数签名等信息的获取。这里的全局变量 <code>GUObjectArray</code> 存储了当前所有的对象，同时根据初赛获取这个结构的信息可知，它的类型为 FUObjectArray。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401230022.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401230022.png?size=small" data-sub-html="<h2>20250401230022</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401230022.png alt=GUObjectArray srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401230022.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401230022.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401230022.png?size=large 2x" data-title=20250401230022 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>GUObjectArray</figcaption></figure>然后找到 FUObjectArray 类型文件，由此可以提取其部分成员变量如下：<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401230142.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401230142.png?size=small" data-sub-html="<h2>20250401230142</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401230142.png alt=FUObjectArray srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401230142.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401230142.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401230142.png?size=large 2x" data-title=20250401230142 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>FUObjectArray</figcaption></figure></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>COREUOBJECT_API</span> <span class=n>FUObjectArray</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=c1>//typedef TStaticIndirectArrayThreadSafeRead&lt;UObjectBase, 8 * 1024 * 1024 /* Max 8M UObjects */, 16384 /* allocated in 64K/128K chunks */ &gt; TUObjectArray;
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>typedef</span> <span class=n>FChunkedFixedUObjectArray</span> <span class=n>TUObjectArray</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// note these variables are left with the Obj prefix so they can be related to the historical GObj versions
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=cm>/** First index into objects array taken into account for GC.							*/</span>
</span></span><span class=line><span class=cl>	<span class=n>int32</span> <span class=n>ObjFirstGCIndex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Index pointing to last object created in range disregarded for GC.					*/</span>
</span></span><span class=line><span class=cl>	<span class=n>int32</span> <span class=n>ObjLastNonGCIndex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Maximum number of objects in the disregard for GC Pool */</span>
</span></span><span class=line><span class=cl>	<span class=n>int32</span> <span class=n>MaxObjectsNotConsideredByGC</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/** If true this is the intial load and we should load objects int the disregarded for GC range.	*/</span>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>OpenForDisregardForGC</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Array of all live objects.											*/</span>
</span></span><span class=line><span class=cl>	<span class=n>TUObjectArray</span> <span class=n>ObjObjects</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>......</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>这里根据注释可知，重要的是 <code>TUObjectArray ObjObjects;</code>，它是存储所有存活对象的数组。同时因为这里需要进行 8 字节内存对齐，要求每个成员的偏移量是自身大小和 8 字节中的较小者的倍数，而下面 <code>TUObjectArray</code> 的结构表明它大于 8 字节，所以为了其从 8 字节倍数偏移开始，这里 bool 类型的 <code>OpenForDisregardForGC</code> 被填补为 4 字节，由此可知 <code>ObjObjects</code> 的偏移为 0x10。同时它的类型 <code>TUObjectArray</code> 也通过 <code>typedef</code> 指明是 <code>FChunkedFixedUObjectArray</code> 类型。</p><p>这个类型的定义如下，根据注释可知它包含最大元素容量，当前元素数量等信息。同时这里 <code>FUObjectItem** Objects;</code> 是最重要的成员变量，它是 FUObjectItem 类型的二级指针（arm64 中指针为 8字节），指向一个指针数组，其中每个元素都指向一个chunk（内存块）。而由下面的算法，这里 enum 定义的 NumElementsPerChunk 直接决定了 Objects 指向的每个内存块（Chunk）的大小为 64 * 1024 个元素。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401231036.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401231036.png?size=small" data-sub-html="<h2>20250401231036</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401231036.png alt=FChunkedFixedUObjectArray srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401231036.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401231036.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401231036.png?size=large 2x" data-title=20250401231036 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>FChunkedFixedUObjectArray</figcaption></figure></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>FChunkedFixedUObjectArray</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>enum</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=n>NumElementsPerChunk</span> <span class=o>=</span> <span class=mi>64</span> <span class=o>*</span> <span class=mi>1024</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/** Master table to chunks of pointers **/</span>
</span></span><span class=line><span class=cl>	<span class=n>FUObjectItem</span><span class=o>**</span> <span class=n>Objects</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** If requested, a contiguous memory where all objects are allocated **/</span>
</span></span><span class=line><span class=cl>	<span class=n>FUObjectItem</span><span class=o>*</span> <span class=n>PreAllocatedObjects</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Maximum number of elements **/</span>
</span></span><span class=line><span class=cl>	<span class=n>int32</span> <span class=n>MaxElements</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Number of elements we currently have **/</span>
</span></span><span class=line><span class=cl>	<span class=n>int32</span> <span class=n>NumElements</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Maximum number of chunks **/</span>
</span></span><span class=line><span class=cl>	<span class=n>int32</span> <span class=n>MaxChunks</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Number of chunks we currently have **/</span>
</span></span><span class=line><span class=cl>	<span class=n>int32</span> <span class=n>NumChunks</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>由此可以知道 Objects 的内存结构如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Objects
</span></span><span class=line><span class=cl>|
</span></span><span class=line><span class=cl>|——&gt; Chunk0 -&gt; [FUObjectItem_0, FUObjectItem_1, ..., FUObjectItem_65535]  // 第 0 个块，共 64K 元素
</span></span><span class=line><span class=cl>|——&gt; Chunk1 -&gt; [FUObjectItem_65536, ..., FUObjectItem_131071]             // 第 1 个块
</span></span><span class=line><span class=cl>|——&gt; ChunkN -&gt; [...]                                                      // 第 N 个块</span></span></code></pre></td></tr></table></div></div><p>之后在看 Objects 的类型 FUObjectItem，它定义简单，就是一个具体的 Object。由此可知上文 Objects 最终指向的每一个 FUObjectItem 都代表一个对象。同时这里的 FUObjectItem 需要进行内存对齐，其大小对齐到 0x18。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401233000.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401233000.png?size=small" data-sub-html="<h2>20250401233000</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401233000.png alt=FUObjectItem srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401233000.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401233000.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250401233000.png?size=large 2x" data-title=20250401233000 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>FUObjectItem</figcaption></figure></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>FUObjectItem</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Pointer to the allocated object
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>class</span> <span class=nc>UObjectBase</span><span class=o>*</span> <span class=n>Object</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Internal flags
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>int32</span> <span class=n>Flags</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=c1>// UObject Owner Cluster Index
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>int32</span> <span class=n>ClusterRootIndex</span><span class=p>;</span>	
</span></span><span class=line><span class=cl>	<span class=c1>// Weak Object Pointer Serial number associated with the object
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>int32</span> <span class=n>SerialNumber</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h5 id=getobjectptr class=heading-element><span>GetObjectPtr</span>
<a href=#getobjectptr class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>这里获取 <code>UObject *</code> 和 getName 的过程一样，都需要通过一个函数来进行获取，这里的就是 <code>GetObjectPtr()</code> 函数。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402095504.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402095504.png?size=small" data-sub-html="<h2>20250402095504</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402095504.png alt=GetObjectPtr() srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402095504.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402095504.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402095504.png?size=large 2x" data-title=20250402095504 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>GetObjectPtr()</figcaption></figure>这里两个函数逻辑一样，区别在于 const 版本防止意外修改数据，适用于只读操作，另一个允许修改数据，适用于需要变更的场景。消去 checkf 操作，简化如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl>	<span class=n>FORCEINLINE_DEBUGGABLE</span> <span class=n>FUObjectItem</span> <span class=k>const</span><span class=o>*</span> <span class=nf>GetObjectPtr</span><span class=p>(</span><span class=n>int32</span> <span class=n>Index</span><span class=p>)</span> <span class=k>const</span> <span class=n>TSAN_SAFE</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>const</span> <span class=n>int32</span> <span class=n>ChunkIndex</span> <span class=o>=</span> <span class=n>Index</span> <span class=o>/</span> <span class=n>NumElementsPerChunk</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>const</span> <span class=n>int32</span> <span class=n>WithinChunkIndex</span> <span class=o>=</span> <span class=n>Index</span> <span class=o>%</span> <span class=n>NumElementsPerChunk</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>FUObjectItem</span><span class=o>*</span> <span class=n>Chunk</span> <span class=o>=</span> <span class=n>Objects</span><span class=p>[</span><span class=n>ChunkIndex</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>Chunk</span> <span class=o>+</span> <span class=n>WithinChunkIndex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>由上面算法可知，UObject 的储存并不是平坦的，而是分块的。同时这里也使用了上文定义的 <code>NumElementsPerChunk</code>，体现上文表示的 Objects 内存结构。这里 <code>GetObjectPtr()</code> 函数首先根据索引 Index 计算块索引 ChunkIndex 和 块内偏移 WithinChunkIndex，然后访问块数组 Objects 找到对应块指针，再通过块指针和块内偏移得到目标 FUObjectItem 的地址。</p><p>然后从 frida-ue4dump 提取相关代码，并进行改进，然后得到了下面获取所有对象指针的代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>GWorld</span><span class=p>,</span> <span class=nx>GName</span><span class=p>,</span> <span class=nx>GUObjectArray</span><span class=p>,</span> <span class=nx>moduleBase</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Offsets</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Global</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>GWorld</span><span class=o>:</span> <span class=mh>0x0B32D8A8</span><span class=p>,</span>          <span class=c1>// GWorld 的全局偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>GName</span><span class=o>:</span> <span class=mh>0x0B171CC0</span><span class=p>,</span>           <span class=c1>// GNames 的全局偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>GUObjectArray</span><span class=o>:</span> <span class=mh>0xB1B5F98</span><span class=p>,</span>    <span class=c1>// GUObjectArray 的全局偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>FUObjectArray</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>TUObjectArray</span><span class=o>:</span> <span class=mh>0x10</span><span class=p>,</span>  <span class=c1>// TUObjectArray ObjObjects;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>TUObjectArray</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>NumElements</span><span class=o>:</span> <span class=mh>0x14</span><span class=p>,</span>    <span class=c1>// int32 NumElements;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>FUObjectItem</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Size</span><span class=o>:</span> <span class=mh>0x18</span><span class=p>,</span>           <span class=c1>// FUObjectItem 的总大小
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>Chunk</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>NumElementsPerChunk</span><span class=o>:</span> <span class=mi>64</span> <span class=o>*</span> <span class=mi>1024</span><span class=p>,</span> <span class=c1>// 每个 Chunk 容纳 0x10000 个 Element
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>init</span><span class=p>(</span><span class=nx>soName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>module</span> <span class=o>=</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>findModuleByName</span><span class=p>(</span><span class=nx>soName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>module</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>moduleBase</span> <span class=o>=</span> <span class=nx>module</span><span class=p>.</span><span class=nx>base</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>GWorld</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>Global</span><span class=p>.</span><span class=nx>GWorld</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>GName</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>Global</span><span class=p>.</span><span class=nx>GName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>GUObjectArray</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>Global</span><span class=p>.</span><span class=nx>GUObjectArray</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] init success`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 获取 UObjectBase* 的函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>getUObjectBaseObjectFromId</span><span class=p>(</span><span class=nx>index</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 计算块索引和块内偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>chunkIndex</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>index</span> <span class=o>/</span> <span class=nx>Offsets</span><span class=p>.</span><span class=nx>Chunk</span><span class=p>.</span><span class=nx>NumElementsPerChunk</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>withinChunkIndex</span> <span class=o>=</span> <span class=nx>index</span> <span class=o>%</span> <span class=nx>Offsets</span><span class=p>.</span><span class=nx>Chunk</span><span class=p>.</span><span class=nx>NumElementsPerChunk</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取 TUObjectArray
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>TUObjectArray</span> <span class=o>=</span> <span class=nx>GUObjectArray</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FUObjectArray</span><span class=p>.</span><span class=nx>TUObjectArray</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取对应的 Chunk 指针 -&gt; Objects[ChunkIndex]
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>chunkPtr</span> <span class=o>=</span> <span class=nx>TUObjectArray</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>chunkIndex</span> <span class=o>*</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>pointerSize</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 计算目标 FUObjectItem 的地址 -&gt; Chunk + WithinChunkIndex
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>objectItemPtr</span> <span class=o>=</span> <span class=nx>chunkPtr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>withinChunkIndex</span> <span class=o>*</span> <span class=nx>Offsets</span><span class=p>.</span><span class=nx>FUObjectItem</span><span class=p>.</span><span class=nx>Size</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 返回 UObjectBase*（对应 FUObjectItem -&gt; Object）
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=nx>objectItemPtr</span><span class=p>.</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 遍历所有对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>dumpObjects</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>numElements</span> <span class=o>=</span> <span class=nx>GUObjectArray</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FUObjectArray</span><span class=p>.</span><span class=nx>TUObjectArray</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>TUObjectArray</span><span class=p>.</span><span class=nx>NumElements</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] Total Objects: </span><span class=si>${</span><span class=nx>numElements</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>numElements</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>objectPtr</span> <span class=o>=</span> <span class=nx>getUObjectBaseObjectFromId</span><span class=p>(</span><span class=nx>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=nx>i</span><span class=si>}</span><span class=sb>] UObjectBase: </span><span class=si>${</span><span class=nx>objectPtr</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>init</span><span class=p>(</span><span class=s2>&#34;libUE4.so&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>dumpObjects</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>之后根据初赛时知道的获取 Class 和 Actor 名称的方法，可以直接进行 dumpObjects 的操作，代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>GWorld</span><span class=p>,</span> <span class=nx>GName</span><span class=p>,</span> <span class=nx>GUObjectArray</span><span class=p>,</span> <span class=nx>moduleBase</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Offsets</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 全局符号偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>Global</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>GWorld</span><span class=o>:</span> <span class=mh>0x0B32D8A8</span><span class=p>,</span>                 <span class=c1>// GWorld 的全局偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>GName</span><span class=o>:</span> <span class=mh>0x0B171CC0</span><span class=p>,</span>                  <span class=c1>// GNames 的全局偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>GUObjectArray</span><span class=o>:</span> <span class=mh>0xB1B5F98</span><span class=p>,</span>           <span class=c1>// GUObjectArray 的全局偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// FUObjectArray 结构体成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>FUObjectArray</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>TUObjectArray</span><span class=o>:</span> <span class=mh>0x10</span><span class=p>,</span>                <span class=c1>// TUObjectArray ObjObjects 的偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// FChunkedFixedUObjectArray (TUObjectArray) 结构体成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>TUObjectArray</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>NumElements</span><span class=o>:</span> <span class=mh>0x14</span><span class=p>,</span>                  <span class=c1>// int32 NumElements 的偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// FUObjectItem 结构体成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>FUObjectItem</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Size</span><span class=o>:</span> <span class=mh>0x18</span><span class=p>,</span>                         <span class=c1>// FUObjectItem 的总大小（64位默认对齐）
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 分块存储相关常量
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>Chunk</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>NumElementsPerChunk</span><span class=o>:</span> <span class=mi>64</span> <span class=o>*</span> <span class=mi>1024</span><span class=p>,</span>     <span class=c1>// 每块 64K 元素
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// UObject 结构体成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>UObject</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>ClassPrivate</span><span class=o>:</span> <span class=mh>0x10</span><span class=p>,</span>                 <span class=c1>// UClass* ClassPrivate 的偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>NamePrivate</span><span class=o>:</span> <span class=mh>0x18</span><span class=p>,</span>                  <span class=c1>// FName NamePrivate 的偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// FNameEntryAllocator 结构体成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>FNameEntryAllocator</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Lock</span><span class=o>:</span> <span class=mh>0x38</span><span class=p>,</span>                         <span class=c1>// FNameEntryAllocator 中的 FRWLock 偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>Blocks</span><span class=o>:</span> <span class=mh>0x40</span><span class=p>,</span>                       <span class=c1>// FNameEntryAllocator 中的 Blocks 数组偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// FNameEntryHandle 结构体成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>FNameEntryHandle</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>FNameBlockOffsetBits</span><span class=o>:</span> <span class=mi>16</span><span class=p>,</span>           <span class=c1>// FNameEntryHandle 中的 Block 偏移位数
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>FNameBlockOffsets</span><span class=o>:</span> <span class=mh>0x10000</span><span class=p>,</span>         <span class=c1>// FNameEntryHandle 中的 Block 偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// FNameEntry 结构体成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>FNameEntry</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Stride</span><span class=o>:</span> <span class=mh>0x2</span><span class=p>,</span>                        <span class=c1>// FNameEntry 的步长（每个 Entry 占 2 字节）
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>Header</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>bIsWideBit</span><span class=o>:</span> <span class=mh>0x1</span><span class=p>,</span>                <span class=c1>// FNameEntry 中的宽字符标志位偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>LenBit</span><span class=o>:</span> <span class=mi>6</span><span class=p>,</span>                      <span class=c1>// 字符串长度在 Header 中的位偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nb>String</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>Union</span><span class=o>:</span> <span class=mh>0x2</span><span class=p>,</span>                     <span class=c1>// 字符串 Union 相对 FNameEntry 的偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>init</span><span class=p>(</span><span class=nx>soName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>module</span> <span class=o>=</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>findModuleByName</span><span class=p>(</span><span class=nx>soName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>module</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>moduleBase</span> <span class=o>=</span> <span class=nx>module</span><span class=p>.</span><span class=nx>base</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 从 Offsets.Global 读取全局符号偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>GWorld</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>Global</span><span class=p>.</span><span class=nx>GWorld</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>GName</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>Global</span><span class=p>.</span><span class=nx>GName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>GUObjectArray</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>Global</span><span class=p>.</span><span class=nx>GUObjectArray</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] init success`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// UObject 工具函数 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>UObject</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>getClass</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>object</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>ptr</span><span class=p>(</span><span class=nx>object</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>UObject</span><span class=p>.</span><span class=nx>ClassPrivate</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>getNameId</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>object</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>ptr</span><span class=p>(</span><span class=nx>object</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>UObject</span><span class=p>.</span><span class=nx>NamePrivate</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>getName</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>object</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>isValid</span><span class=p>(</span><span class=nx>object</span><span class=p>)</span> <span class=o>?</span> <span class=nx>getNameFromId</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>getNameId</span><span class=p>(</span><span class=nx>object</span><span class=p>))</span> <span class=o>:</span> <span class=s2>&#34;None&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>getClassName</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>object</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>isValid</span><span class=p>(</span><span class=nx>object</span><span class=p>)</span> <span class=o>?</span> <span class=k>this</span><span class=p>.</span><span class=nx>getName</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>getClass</span><span class=p>(</span><span class=nx>object</span><span class=p>))</span> <span class=o>:</span> <span class=s2>&#34;None&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>isValid</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>object</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>!</span><span class=nx>ptr</span><span class=p>(</span><span class=nx>object</span><span class=p>).</span><span class=nx>isNull</span><span class=p>()</span> <span class=o>&amp;&amp;</span> <span class=k>this</span><span class=p>.</span><span class=nx>getNameId</span><span class=p>(</span><span class=nx>object</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>getClass</span><span class=p>(</span><span class=nx>object</span><span class=p>).</span><span class=nx>isNull</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// FName 解析函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>getNameFromId</span><span class=p>(</span><span class=nx>ComparisonIndex</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 计算 Block 和 Offset
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>Block</span> <span class=o>=</span> <span class=nx>ComparisonIndex</span> <span class=o>&gt;&gt;</span> <span class=nx>Offsets</span><span class=p>.</span><span class=nx>FNameEntryHandle</span><span class=p>.</span><span class=nx>FNameBlockOffsetBits</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Offset</span> <span class=o>=</span> <span class=nx>ComparisonIndex</span> <span class=o>&amp;</span> <span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FNameEntryHandle</span><span class=p>.</span><span class=nx>FNameBlockOffsets</span> <span class=o>-</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 定位 FNameEntryAllocator 和 Blocks 数组
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>FNameEntryAllocator</span> <span class=o>=</span> <span class=nx>GName</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Blocks</span> <span class=o>=</span> <span class=nx>FNameEntryAllocator</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FNameEntryAllocator</span><span class=p>.</span><span class=nx>Blocks</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取当前 Block 的指针
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>BlockPtr</span> <span class=o>=</span> <span class=nx>Blocks</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Block</span> <span class=o>*</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>pointerSize</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 计算 FNameEntry 地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>FNameEntry</span> <span class=o>=</span> <span class=nx>BlockPtr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offset</span> <span class=o>*</span> <span class=nx>Offsets</span><span class=p>.</span><span class=nx>FNameEntry</span><span class=p>.</span><span class=nx>Stride</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 读取 FNameEntryHeader
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>FNameEntryHeader</span> <span class=o>=</span> <span class=nx>FNameEntry</span><span class=p>.</span><span class=nx>readU16</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 解析字符串长度和宽字符标志
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>strLength</span> <span class=o>=</span> <span class=nx>FNameEntryHeader</span> <span class=o>&gt;&gt;</span> <span class=nx>Offsets</span><span class=p>.</span><span class=nx>FNameEntry</span><span class=p>.</span><span class=nx>Header</span><span class=p>.</span><span class=nx>LenBit</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>bIsWide</span> <span class=o>=</span> <span class=p>(</span><span class=nx>FNameEntryHeader</span> <span class=o>&amp;</span> <span class=nx>Offsets</span><span class=p>.</span><span class=nx>FNameEntry</span><span class=p>.</span><span class=nx>Header</span><span class=p>.</span><span class=nx>bIsWideBit</span><span class=p>)</span> <span class=o>!==</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 处理宽字符
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>bIsWide</span><span class=p>)</span> <span class=k>return</span> <span class=s2>&#34;widestr&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 读取字符串
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>strAddr</span> <span class=o>=</span> <span class=nx>FNameEntry</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FNameEntry</span><span class=p>.</span><span class=nb>String</span><span class=p>.</span><span class=nx>Union</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=nx>strLength</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=nx>strLength</span> <span class=o>&lt;</span> <span class=mi>250</span><span class=p>)</span> <span class=o>?</span>
</span></span><span class=line><span class=cl>        <span class=nx>strAddr</span><span class=p>.</span><span class=nx>readUtf8String</span><span class=p>(</span><span class=nx>strLength</span><span class=p>)</span> <span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;None&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 获取 UObjectBase* 的函数 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>getUObjectBaseObjectFromId</span><span class=p>(</span><span class=nx>index</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 计算块索引和块内偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>chunkIndex</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>index</span> <span class=o>/</span> <span class=nx>Offsets</span><span class=p>.</span><span class=nx>Chunk</span><span class=p>.</span><span class=nx>NumElementsPerChunk</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>withinChunkIndex</span> <span class=o>=</span> <span class=nx>index</span> <span class=o>%</span> <span class=nx>Offsets</span><span class=p>.</span><span class=nx>Chunk</span><span class=p>.</span><span class=nx>NumElementsPerChunk</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取 TUObjectArray
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>TUObjectArray</span> <span class=o>=</span> <span class=nx>GUObjectArray</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FUObjectArray</span><span class=p>.</span><span class=nx>TUObjectArray</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取对应的 Chunk 指针 -&gt; Objects[ChunkIndex]
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>chunkPtr</span> <span class=o>=</span> <span class=nx>TUObjectArray</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>chunkIndex</span> <span class=o>*</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>pointerSize</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 计算目标 FUObjectItem 的地址 -&gt; Chunk + WithinChunkIndex
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>objectItemPtr</span> <span class=o>=</span> <span class=nx>chunkPtr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>withinChunkIndex</span> <span class=o>*</span> <span class=nx>Offsets</span><span class=p>.</span><span class=nx>FUObjectItem</span><span class=p>.</span><span class=nx>Size</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 返回 UObjectBase（对应 FUObjectItem -&gt; Object）
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=nx>objectItemPtr</span><span class=p>.</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>dumpObjects</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>numElements</span> <span class=o>=</span> <span class=nx>GUObjectArray</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FUObjectArray</span><span class=p>.</span><span class=nx>TUObjectArray</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>TUObjectArray</span><span class=p>.</span><span class=nx>NumElements</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] Total Objects: </span><span class=si>${</span><span class=nx>numElements</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>numElements</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>object</span> <span class=o>=</span> <span class=nx>getUObjectBaseObjectFromId</span><span class=p>(</span><span class=nx>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>UObject</span><span class=p>.</span><span class=nx>isValid</span><span class=p>(</span><span class=nx>object</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=nx>i</span><span class=si>}</span><span class=sb>] ClassName: </span><span class=si>${</span><span class=nx>UObject</span><span class=p>.</span><span class=nx>getClassName</span><span class=p>(</span><span class=nx>object</span><span class=p>)</span><span class=si>}</span><span class=sb>, ObjName: </span><span class=si>${</span><span class=nx>UObject</span><span class=p>.</span><span class=nx>getName</span><span class=p>(</span><span class=nx>object</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>init</span><span class=p>(</span><span class=s2>&#34;libUE4.so&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>dumpObjects</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h4 id=获取变量和方法 class=heading-element><span>获取变量和方法</span>
<a href=#%e8%8e%b7%e5%8f%96%e5%8f%98%e9%87%8f%e5%92%8c%e6%96%b9%e6%b3%95 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>之后为了获取 SDK 中结构体的变量和方法，需要了解更多 UE 的类。</p><h5 id=前置知识 class=heading-element><span>前置知识</span>
<a href=#%e5%89%8d%e7%bd%ae%e7%9f%a5%e8%af%86 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><div class="details admonition abstract open disabled"><div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-clipboard-list" aria-hidden=true></i>注意事项</div><div class=details-content><div class=admonition-content><p>下面的内容来自于 <a href=https://bbs.kanxue.com/thread-282857.htm#msg_header_h2_4 target=_blank rel="external nofollow noopener noreferrer">UE4.27SDK-Dump</a>，这里根据 UE4.27 源码进行查看理解。</p></div></div></div><h6 id=ufield class=heading-element><span>UField</span>
<a href=#ufield class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h6><p>UField 继承自 UObject，但是它仅仅只多了一个 <code>UField* Next;</code> 的迭代指针，这个类主要就是用于 <code>UClass</code> 等迭代方法。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402151225.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402151225.png?size=small" data-sub-html="<h2>20250402151225</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402151225.png alt=UField srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402151225.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402151225.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402151225.png?size=large 2x" data-title=20250402151225 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>UField</figcaption></figure>这里可以使用 Visual Studio 的内存布局功能查看迭代指针的偏移。不过因为源码中的 FName 类存在条件编译的成员变量，Visual Studio 分析时会添加这个变量，所以会使得 FName 变成 12 字节。但是由初赛的知识，<strong>FName 在安卓 arm 64 平台只有两个成员变量，所以它是 8 个字节</strong>，因此将下列条件编译变量注释，得到了符合 arm64 架构的内存布局。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404172556.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404172556.png?size=small" data-sub-html="<h2>20250404172556</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404172556.png alt=修正偏移 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404172556.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404172556.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404172556.png?size=large 2x" data-title=20250404172556 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>修正偏移</figcaption></figure>然后再查看内存布局，就符合 arm64 架构了。这个类的大小为 48 字节，对齐方式是 8 字节。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404172702.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404172702.png?size=small" data-sub-html="<h2>20250404172702</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404172702.png alt=内存布局 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404172702.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404172702.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404172702.png?size=large 2x" data-title=20250404172702 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>内存布局</figcaption></figure></p><h6 id=ffield class=heading-element><span>FField</span>
<a href=#ffield class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h6><p>在 UE4.25 之后，引入了 <code>FField</code>，可以把它视为上述 <code>UField</code> 的子集，后续就是通过它来获取属性系统。它直接描述属性信息（也就是成员变量的信息），剥离了与 UObject 相关的功能。且其没有继承任何一个类，这样大幅度减少了属性对象的占用。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402154439.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402154439.png?size=small" data-sub-html="<h2>20250402154439</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402154439.png alt=FField srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402154439.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402154439.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402154439.png?size=large 2x" data-title=20250402154439 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>FField</figcaption></figure>提取的成员变量和内存布局如下。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>COREUOBJECT_API</span> <span class=n>FField</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint64_t</span> <span class=n>VTable</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/** Pointer to the class object representing the type of this FField */</span>
</span></span><span class=line><span class=cl>	<span class=n>FFieldClass</span><span class=o>*</span> <span class=n>ClassPrivate</span><span class=p>;</span>                  <span class=c1>// 类名，用于区分 FProperty 类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=cm>/** Owner of this field */</span>
</span></span><span class=line><span class=cl>	<span class=n>FFieldVariant</span> <span class=n>Owner</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/** Next Field in the linked list */</span>
</span></span><span class=line><span class=cl>	<span class=n>FField</span><span class=o>*</span> <span class=n>Next</span><span class=p>;</span>                               <span class=c1>// 指向下一个 FField
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Name of this field */</span>
</span></span><span class=line><span class=cl>	<span class=n>FName</span> <span class=n>NamePrivate</span><span class=p>;</span>                          <span class=c1>// 成员变量名称
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Object flags */</span>
</span></span><span class=line><span class=cl>	<span class=n>EObjectFlags</span> <span class=n>FlagsPrivate</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// #if WITH_EDITORONLY_DATA
</span></span></span><span class=line><span class=cl><span class=c1>// private:
</span></span></span><span class=line><span class=cl><span class=c1>// 	   /** Editor-only meta data map */
</span></span></span><span class=line><span class=cl><span class=c1>// 	   TMap&lt;FName, FString&gt;* MetaDataMap;
</span></span></span><span class=line><span class=cl><span class=c1>// #endif // WITH_EDITORONLY_DATA
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>这个类最后一个成员变量被条件编译 <code>#if WITH_EDITORONLY_DATA</code> 包裹，实际游戏中不会包含。由此同样将这个变量给注释掉。然后得到了下面的内存布局，大小为 56 字节，对齐方式是 8 字节。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404173129.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404173129.png?size=small" data-sub-html="<h2>20250404173129</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404173129.png alt=内存布局 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404173129.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404173129.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404173129.png?size=large 2x" data-title=20250404173129 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>内存布局</figcaption></figure>然后下面展示 <code>FFieldClass</code> 和 <code>FFieldVariant</code> 的成员变量。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402160849.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402160849.png?size=small" data-sub-html="<h2>20250402160849</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402160849.png alt=FFieldClass srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402160849.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402160849.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402160849.png?size=large 2x" data-title=20250402160849 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>FFieldClass</figcaption></figure><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402160929.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402160929.png?size=small" data-sub-html="<h2>20250402160929</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402160929.png alt=FFieldVariant srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402160929.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402160929.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402160929.png?size=large 2x" data-title=20250402160929 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>FFieldVariant</figcaption></figure></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>COREUOBJECT_API</span> <span class=n>FFieldClass</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Name of this field class */</span>
</span></span><span class=line><span class=cl>	<span class=n>FName</span> <span class=n>Name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Unique Id of this field class (for casting) */</span>
</span></span><span class=line><span class=cl>	<span class=n>uint64</span> <span class=n>Id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Cast flags used for casting to other classes */</span>
</span></span><span class=line><span class=cl>	<span class=n>uint64</span> <span class=n>CastFlags</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Class flags */</span>
</span></span><span class=line><span class=cl>	<span class=n>EClassFlags</span> <span class=n>ClassFlags</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Super of this class */</span>
</span></span><span class=line><span class=cl>	<span class=n>FFieldClass</span><span class=o>*</span> <span class=n>SuperClass</span><span class=p>;</span>	
</span></span><span class=line><span class=cl>	<span class=cm>/** Default instance of this class */</span>
</span></span><span class=line><span class=cl>	<span class=n>FField</span><span class=o>*</span> <span class=n>DefaultObject</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Counter for generating runtime unique names */</span>
</span></span><span class=line><span class=cl>	<span class=n>FThreadSafeCounter</span> <span class=n>UnqiueNameIndexCounter</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>COREUOBJECT_API</span> <span class=n>FFieldVariant</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>union</span> <span class=nc>FFieldObjectUnion</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=n>FField</span><span class=o>*</span> <span class=n>Field</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=n>UObject</span><span class=o>*</span> <span class=n>Object</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span> <span class=n>Container</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>bIsUObject</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>前者大小为 64 字节，对齐大小为 8 字节；后者大小为 16 字节，对齐方式为 8 字节。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404173308.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404173308.png?size=small" data-sub-html="<h2>20250404173308</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404173308.png alt=内存布局 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404173308.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404173308.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404173308.png?size=large 2x" data-title=20250404173308 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>内存布局</figcaption></figure></p><h6 id=fproperty class=heading-element><span>FProperty</span>
<a href=#fproperty class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h6><p>这个类继承 <code>FField</code>，它保存更详细的信息描述。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402161655.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402161655.png?size=small" data-sub-html="<h2>20250402161655</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402161655.png alt=FProperty srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402161655.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402161655.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402161655.png?size=large 2x" data-title=20250402161655 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>FProperty</figcaption></figure></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>COREUOBJECT_API</span> <span class=nl>FProperty</span> <span class=p>:</span> <span class=k>public</span> <span class=n>FField</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Persistent variables.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>int32</span>			<span class=n>ArrayDim</span><span class=p>;</span>                   <span class=c1>// 变量的维数
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>int32</span>			<span class=n>ElementSize</span><span class=p>;</span>                <span class=c1>// 变量元素大小（变量整体大小为 ElementSize * ArrayDim）
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>EPropertyFlags</span>	<span class=n>PropertyFlags</span><span class=p>;</span>              <span class=c1>// 变量 Flag
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>uint16</span>			<span class=n>RepIndex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>TEnumAsByte</span><span class=o>&lt;</span><span class=n>ELifetimeCondition</span><span class=o>&gt;</span> <span class=n>BlueprintReplicationCondition</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// In memory variables (generated during Link()).
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>int32</span>		<span class=n>Offset_Internal</span><span class=p>;</span>                <span class=c1>// 变量在结构体中的偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=n>FName</span>		<span class=n>RepNotifyFunc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/** In memory only: Linked list of properties from most-derived to base **/</span>
</span></span><span class=line><span class=cl>	<span class=n>FProperty</span><span class=o>*</span>	<span class=n>PropertyLinkNext</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** In memory only: Linked list of object reference properties from most-derived to base **/</span>
</span></span><span class=line><span class=cl>	<span class=n>FProperty</span><span class=o>*</span>  <span class=n>NextRef</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** In memory only: Linked list of properties requiring destruction. Note this does not include things that will be destroyed byt he native destructor **/</span>
</span></span><span class=line><span class=cl>	<span class=n>FProperty</span><span class=o>*</span>	<span class=n>DestructorLinkNext</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** In memory only: Linked list of properties requiring post constructor initialization.**/</span>
</span></span><span class=line><span class=cl>	<span class=n>FProperty</span><span class=o>*</span>	<span class=n>PostConstructLinkNext</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TEnumAsByte</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>uint8</span> <span class=n>Value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p><code>FProperty</code> 和 <code>TEnumAsByte</code> 的内存布局如下。前者大小为 120 字节，对齐方式是 8 字节；后者大小为 1 字节，对齐方式为 1 字节。这里为了 <code>FProperty</code> 的对齐，所以把 <code>TEnumAsByte</code> 填充为 2 字节。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404183916.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404183916.png?size=small" data-sub-html="<h2>20250404183916</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404183916.png alt=内存布局 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404183916.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404183916.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404183916.png?size=large 2x" data-title=20250404183916 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>内存布局</figcaption></figure></p><h6 id=ustruct class=heading-element><span>UStruct</span>
<a href=#ustruct class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h6><p>这个类比较重要，它继承于 <code>UField</code>，记录了成员、函数信息的指针。这里主要关注 <code>SuperStruct</code>，<code>ChildProperties</code> 和 <code>Children</code>。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402162727.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402162727.png?size=small" data-sub-html="<h2>20250402162727</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402162727.png alt=UStruct srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402162727.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402162727.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402162727.png?size=large 2x" data-title=20250402162727 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>UStruct</figcaption></figure></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>COREUOBJECT_API</span> <span class=nl>UStruct</span> <span class=p>:</span> <span class=k>public</span> <span class=n>UField</span>
</span></span><span class=line><span class=cl><span class=cp>#if USTRUCT_FAST_ISCHILDOF_IMPL == USTRUCT_ISCHILDOF_STRUCTARRAY
</span></span></span><span class=line><span class=cl><span class=cp></span>	<span class=p>,</span> <span class=k>private</span> <span class=n>FStructBaseChain</span>
</span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Struct this inherits from, may be null */</span>
</span></span><span class=line><span class=cl>	<span class=n>UStruct</span><span class=o>*</span> <span class=n>SuperStruct</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Pointer to start of linked list of child fields */</span>
</span></span><span class=line><span class=cl>	<span class=n>UField</span><span class=o>*</span> <span class=n>Children</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=cm>/** Pointer to start of linked list of child fields */</span>
</span></span><span class=line><span class=cl>	<span class=n>FField</span><span class=o>*</span> <span class=n>ChildProperties</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/** Total size of all UProperties, the allocated structure may be larger due to alignment */</span>
</span></span><span class=line><span class=cl>	<span class=n>int32</span> <span class=n>PropertiesSize</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Alignment of structure in memory, structure will be at least this large */</span>
</span></span><span class=line><span class=cl>	<span class=n>int32</span> <span class=n>MinAlignment</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=cm>/** Script bytecode associated with this object */</span>
</span></span><span class=line><span class=cl>	<span class=n>TArray</span><span class=o>&lt;</span><span class=n>uint8</span><span class=o>&gt;</span> <span class=n>Script</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/** In memory only: Linked list of properties from most-derived to base */</span>
</span></span><span class=line><span class=cl>	<span class=n>FProperty</span><span class=o>*</span> <span class=n>PropertyLink</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** In memory only: Linked list of object reference properties from most-derived to base */</span>
</span></span><span class=line><span class=cl>	<span class=n>FProperty</span><span class=o>*</span> <span class=n>RefLink</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** In memory only: Linked list of properties requiring destruction. Note this does not include things that will be destroyed byt he native destructor */</span>
</span></span><span class=line><span class=cl>	<span class=n>FProperty</span><span class=o>*</span> <span class=n>DestructorLink</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** In memory only: Linked list of properties requiring post constructor initialization */</span>
</span></span><span class=line><span class=cl>	<span class=n>FProperty</span><span class=o>*</span> <span class=n>PostConstructLink</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/** Array of object references embedded in script code and referenced by FProperties. Mirrored for easy access by realtime garbage collection code */</span>
</span></span><span class=line><span class=cl>	<span class=n>TArray</span><span class=o>&lt;</span><span class=n>UObject</span><span class=o>*&gt;</span> <span class=n>ScriptAndPropertyObjectReferences</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>typedef</span> <span class=n>TArray</span><span class=o>&lt;</span><span class=n>TPair</span><span class=o>&lt;</span><span class=n>TFieldPath</span><span class=o>&lt;</span><span class=n>FField</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>int32</span><span class=o>&gt;&gt;</span> <span class=n>FUnresolvedScriptPropertiesArray</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Contains a list of script properties that couldn&#39;t be resolved at load time */</span>
</span></span><span class=line><span class=cl>	<span class=n>FUnresolvedScriptPropertiesArray</span><span class=o>*</span> <span class=n>UnresolvedScriptProperties</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>由上可以看出 <code>UStruct</code> 继承了 <code>UField</code> 和 <code>FStructBaseChain</code>，不过后者被条件编译宏包围着。这个条件编译指令的目的是在类型继承关系查询功能上实现不同的性能优化方案，同时安卓平台上一般启动这个条件编译，所以 <code>UStruct</code> 真实继承两个类。因此它的内存布局如下，大小为 200 字节，对齐方式是 8 字节。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404184837.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404184837.png?size=small" data-sub-html="<h2>20250404184837</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404184837.png alt=内存布局 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404184837.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404184837.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404184837.png?size=large 2x" data-title=20250404184837 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>内存布局</figcaption></figure></p><h6 id=uclass class=heading-element><span>UClass</span>
<a href=#uclass class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h6><p>这个类就是 UObject 中的成员，它继承 UStruct，新增很多成员，不过实际使用的还是 UStruct 中已经定义的成员。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402163449.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402163449.png?size=small" data-sub-html="<h2>20250402163449</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402163449.png alt=UClass srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402163449.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402163449.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402163449.png?size=large 2x" data-title=20250402163449 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>UClass</figcaption></figure>下面是 <code>UClass</code> 的内存布局，其大小为 632 字节，对齐方式为 8 字节。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404185036.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404185036.png?size=small" data-sub-html="<h2>20250404185036</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404185036.png alt=内存布局 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404185036.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404185036.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404185036.png?size=large 2x" data-title=20250404185036 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>内存布局</figcaption></figure></p><h6 id=总结 class=heading-element><span>总结</span>
<a href=#%e6%80%bb%e7%bb%93 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h6><p>回顾一下上面的过程，这里首先从 <code>GUObjectArray</code> 获取了每个对象 <code>UObject</code>，然后 <code>UObject</code> 类中包含 <code>UClass* ClassPrivate;</code> 成员变量。同时 <code>UClass</code> 继承自 <code>UStruct</code>，所以可以通过 ClassPrivate 获取到 <code>UStruct</code>。由此就可以获得 <code>UStruct</code> 类中的 <code>FField* ChildProperties;</code> 和 <code>UField* Children;</code>。前者是类中的属性，后者则是类中的方法。</p><p>这里首先可以根据上面的内存布局获取 <code>Children</code> 和 <code>ChildProperties</code> 的偏移分别为 0x48，0x50。然后可以填补上面的代码，获取 UStruct 的相关信息。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Offsets</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>......</span>
</span></span><span class=line><span class=cl>    <span class=nx>UStruct</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>SuperStruct</span><span class=o>:</span> <span class=mh>0x40</span><span class=p>,</span>                  <span class=c1>// UStruct 中的 SuperStruct 成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>Children</span><span class=o>:</span> <span class=mh>0x48</span><span class=p>,</span>                     <span class=c1>// UStruct 中的 Children 成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>ChildProperties</span><span class=o>:</span> <span class=mh>0x50</span><span class=p>,</span>              <span class=c1>// UStruct 中的 ChildProperties 成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// UStruct 工具函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>UStruct</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>getSuperClass</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>structz</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// UStruct* -&gt; 该结构体的父类
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>ptr</span><span class=p>(</span><span class=nx>structz</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>UStruct</span><span class=p>.</span><span class=nx>SuperStruct</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>getChildren</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>structz</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// UField* -&gt; 该结构体的方法
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>ptr</span><span class=p>(</span><span class=nx>structz</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>UStruct</span><span class=p>.</span><span class=nx>Children</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>getChildProperties</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>structz</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// FField* -&gt; 该结构体的属性
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>ptr</span><span class=p>(</span><span class=nx>structz</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>UStruct</span><span class=p>.</span><span class=nx>ChildProperties</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>getClassName</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>clazz</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>UObject</span><span class=p>.</span><span class=nx>getName</span><span class=p>(</span><span class=nx>clazz</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>getClassPath</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>object</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// 获取当前对象的完全类限定符
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>clazz</span> <span class=o>=</span> <span class=nx>UObject</span><span class=p>.</span><span class=nx>getClass</span><span class=p>(</span><span class=nx>object</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>classname</span> <span class=o>=</span> <span class=nx>UObject</span><span class=p>.</span><span class=nx>getName</span><span class=p>(</span><span class=nx>clazz</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>superclass</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>getSuperClass</span><span class=p>(</span><span class=nx>clazz</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=nx>UObject</span><span class=p>.</span><span class=nx>isValid</span><span class=p>(</span><span class=nx>superclass</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>classname</span> <span class=o>+=</span> <span class=s2>&#34;.&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>classname</span> <span class=o>+=</span> <span class=nx>UObject</span><span class=p>.</span><span class=nx>getName</span><span class=p>(</span><span class=nx>superclass</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=nx>superclass</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>getSuperClass</span><span class=p>(</span><span class=nx>superclass</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>classname</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>getStructClassPath</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>clazz</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// 获取当前类的完全类限定符
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>var</span> <span class=nx>classname</span> <span class=o>=</span> <span class=nx>UObject</span><span class=p>.</span><span class=nx>getName</span><span class=p>(</span><span class=nx>clazz</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>superclass</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>getSuperClass</span><span class=p>(</span><span class=nx>clazz</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=nx>UObject</span><span class=p>.</span><span class=nx>isValid</span><span class=p>(</span><span class=nx>superclass</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>classname</span> <span class=o>+=</span> <span class=s2>&#34;.&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>classname</span> <span class=o>+=</span> <span class=nx>UObject</span><span class=p>.</span><span class=nx>getName</span><span class=p>(</span><span class=nx>superclass</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nx>superclass</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>getSuperClass</span><span class=p>(</span><span class=nx>superclass</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>classname</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h5 id=childproperties class=heading-element><span>ChildProperties</span>
<a href=#childproperties class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>这里获取了 <code>FField* ChildProperties</code>，就可以根据具体的类型进行解析，在 UE4 中定义了许多具体的类型，例如：<code>FInterfaceProperty</code>，<code>FStructProperty</code>，<code>FEnumProperty</code> 等。他们均继承自 <code>FProperty</code> 类，进而继承自 <code>FField</code> 类，在下图 <strong>UObjectHierarchyFwd.h</strong> 文件中清楚地展示了相关类型的继承关系。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402202204.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402202204.png?size=small" data-sub-html="<h2>20250402202204</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402202204.png alt=UObjectHierarchyFwd.h srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402202204.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402202204.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402202204.png?size=large 2x" data-title=20250402202204 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>UObjectHierarchyFwd.h</figcaption></figure>由此可以继续找到这些类型的相关定义。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402202552.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402202552.png?size=small" data-sub-html="<h2>20250402202552</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402202552.png alt=FInterfaceProperty srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402202552.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402202552.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402202552.png?size=large 2x" data-title=20250402202552 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>FInterfaceProperty</figcaption></figure><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402202638.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402202638.png?size=small" data-sub-html="<h2>20250402202638</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402202638.png alt=FStructProperty srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402202638.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402202638.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402202638.png?size=large 2x" data-title=20250402202638 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>FStructProperty</figcaption></figure><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402203013.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402203013.png?size=small" data-sub-html="<h2>20250402203013</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402203013.png alt=20250402203013 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402203013.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402203013.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402203013.png?size=large 2x" data-title=20250402203013 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>20250402203013</figcaption></figure>这些 Property 自身可能还会有字段如 <code>UStriptStruct* Struct</code> 来进一步描述信息，也可能仅依赖于 FProperty 而不需要新字段去描述信息。而实际上，通过上述过程得到的 <code>FField* ChildProperties</code> 就已经是具体的一个 <code>Property</code> 了。即通过上面代码中的 <code>getChildProperties()</code> 获取的 <code>FField</code>，要么已经是 <code>FInterfaceProperty</code>，要么就是 <code>FStructProperty</code>，它总会代表一种具体的类型。因此这里可以在得到此指针后添加 <code>FProperty</code> 的大小，这样就可以得到真正的 Property 标识。这里比如对于 <code>FInterfaceProperty</code>，它和 <code>FProperty</code> 的内存布局如下所示，可见它去除 <code>FProperty</code> 的大小之后就是它的标识 <code>class UClass* InterfaceClass</code> 了。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404200137.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404200137.png?size=small" data-sub-html="<h2>20250404200137</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404200137.png alt=内存布局对比 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404200137.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404200137.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404200137.png?size=large 2x" data-title=20250404200137 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>内存布局对比</figcaption></figure>由此得到的 <code>FProperty</code> 大小为 0x78，那么实际偏移也就是 0x78。这里通过添加 <code>FProperty</code> 的大小得到真正类型标识的方法并不是通用的，一些特殊的 Property 还会存在数个指针，比如类型 <code>FMapProperty</code> 有不同指针存储了不同信息，而 <code>FEnumProperty</code> 则多存储了一个 <code>UnderlyingProp</code> 指针，它们都需要加上多出的大小才能指向真正类型。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402224657.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402224657.png?size=small" data-sub-html="<h2>20250402224657</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402224657.png alt="特殊 Property 内存布局" srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402224657.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402224657.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250402224657.png?size=large 2x" data-title=20250402224657 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>特殊 Property 内存布局</figcaption></figure>而要区分出这些 Property，那么就需要依赖于它继承自 FField 中的字段 <code>FFieldClass* ClassPrivate</code>，它的类如下所示。由此可见，获取该字段指针之后，第一个成员变量就是 FName 类型，它存储了当前 Property 的类名称，由此可以区别出不同的 Property。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404201151.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404201151.png?size=small" data-sub-html="<h2>20250404201151</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404201151.png alt=FFieldClass srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404201151.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404201151.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404201151.png?size=large 2x" data-title=20250404201151 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>FFieldClass</figcaption></figure>同时这里还可以通过获取 <code>FName NamePrivate</code> 得到这个 Property 的名称，也就是结构体中成员变量的名称。由此可以写出下面代码获取相关信息：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Offsets</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>......</span>
</span></span><span class=line><span class=cl>    <span class=c1>// FField 结构体成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>FField</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>ClassPrivate</span><span class=o>:</span> <span class=mh>0x8</span><span class=p>,</span>                 <span class=c1>// FField 中的 ClassPrivate 成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>Next</span><span class=o>:</span> <span class=mh>0x20</span><span class=p>,</span>                        <span class=c1>// FField 中的 Next 成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>NamePrivate</span><span class=o>:</span> <span class=mh>0x28</span><span class=p>,</span>                 <span class=c1>// FField 中的 NamePrivate 成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// FField 工具函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>FField</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>getClassName</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>fField</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// FFieldClass* -&gt; 该字段的类名称
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>getNameFromId</span><span class=p>(</span><span class=nx>ptr</span><span class=p>(</span><span class=nx>fField</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FField</span><span class=p>.</span><span class=nx>ClassPrivate</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>().</span><span class=nx>readU32</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>getNext</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>fField</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// FField* -&gt; 下一个 FField* 对象
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>ptr</span><span class=p>(</span><span class=nx>fField</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FField</span><span class=p>.</span><span class=nx>Next</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>getName</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>fField</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// FName -&gt; 该字段的名称
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>getNameFromId</span><span class=p>(</span><span class=nx>ptr</span><span class=p>(</span><span class=nx>fField</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FField</span><span class=p>.</span><span class=nx>NamePrivate</span><span class=p>).</span><span class=nx>readU32</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getProperty</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>numElements</span> <span class=o>=</span> <span class=nx>GUObjectArray</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FUObjectArray</span><span class=p>.</span><span class=nx>TUObjectArray</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>TUObjectArray</span><span class=p>.</span><span class=nx>NumElements</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] Total Objects: </span><span class=si>${</span><span class=nx>numElements</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>numElements</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>object</span> <span class=o>=</span> <span class=nx>getUObjectBaseObjectFromId</span><span class=p>(</span><span class=nx>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>UObject</span><span class=p>.</span><span class=nx>isValid</span><span class=p>(</span><span class=nx>object</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>uStruct</span> <span class=o>=</span> <span class=nx>UObject</span><span class=p>.</span><span class=nx>getClass</span><span class=p>(</span><span class=nx>object</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>childProperties</span> <span class=o>=</span> <span class=nx>UStruct</span><span class=p>.</span><span class=nx>getChildProperties</span><span class=p>(</span><span class=nx>uStruct</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=kd>var</span> <span class=nx>currProp</span> <span class=o>=</span> <span class=nx>childProperties</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=p>(</span><span class=nx>UObject</span><span class=p>.</span><span class=nx>isValid</span><span class=p>(</span><span class=nx>currProp</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>oname</span> <span class=o>=</span> <span class=nx>FField</span><span class=p>.</span><span class=nx>getName</span><span class=p>(</span><span class=nx>currProp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>cname</span> <span class=o>=</span> <span class=nx>FField</span><span class=p>.</span><span class=nx>getClassName</span><span class=p>(</span><span class=nx>currProp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=nx>i</span><span class=si>}</span><span class=sb>] oname: </span><span class=si>${</span><span class=nx>oname</span><span class=si>}</span><span class=sb>, cname: </span><span class=si>${</span><span class=nx>cname</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nx>currProp</span> <span class=o>=</span> <span class=nx>FField</span><span class=p>.</span><span class=nx>getNext</span><span class=p>(</span><span class=nx>currProp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>init</span><span class=p>(</span><span class=s2>&#34;libUE4.so&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>getProperty</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>类的属性以链表的形式存储在 ChildProperties 中，每个 FField 对象可以通过 Next 指针指向下一个属性。由此上文的循环可以获取一个类的所有属性如下所示。这里 oname 就是表示类的成员变量名称，而 cname 表示成员变量的类型名称。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405003300.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405003300.png?size=small" data-sub-html="<h2>20250405003300</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405003300.png alt=获取结果 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405003300.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405003300.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405003300.png?size=large 2x" data-title=20250405003300 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>获取结果</figcaption></figure></p><p>同时看到上文的 <code>FProperty</code> 类型，它存在几个关键的成员变量：<code>ArrayDim</code>，<code>ElementSize</code>，<code>PropertyFlags</code> 和 <code>Offset_Internal</code>。其中 <code>ArrayDim</code> 和 <code>ElementSize</code> 分别表示当前成员变量（FProperty 对象）的维数和元素大小，而 <code>PropertyFlags</code> 是一个属性标志位集合，用于定义属性的元数据和行为特性，<code>Offset_Internal</code> 则是该成员变量距离类地址的偏移。由此可以写出下面的代码。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Offsets</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// FProperty 结构体成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>FProperty</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>ArrayDim</span><span class=o>:</span> <span class=mh>0x34</span><span class=p>,</span>                    <span class=c1>// FProperty 中的 ArrayDim 成员偏移  
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>ElementSize</span><span class=o>:</span> <span class=mh>0x38</span><span class=p>,</span>                 <span class=c1>// FProperty 中的 ElementSize 成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>PropertyFlags</span><span class=o>:</span> <span class=mh>0x40</span><span class=p>,</span>               <span class=c1>// FProperty 中的 PropertyFlags 成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>OffsetInternal</span><span class=o>:</span> <span class=mh>0x4c</span><span class=p>,</span>              <span class=c1>// FProperty 中的 OffsetInternal 成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>Size</span><span class=o>:</span> <span class=mh>0x78</span><span class=p>,</span>                        <span class=c1>// FProperty 的大小
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=c1>// FProperty 工具函数，继承自 UObject，因此命名为 UProperty
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>UProperty</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>getElementSize</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>prop</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>ptr</span><span class=p>(</span><span class=nx>prop</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FProperty</span><span class=p>.</span><span class=nx>ElementSize</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>getPropertyFlags</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>prop</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>ptr</span><span class=p>(</span><span class=nx>prop</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FProperty</span><span class=p>.</span><span class=nx>PropertyFlags</span><span class=p>).</span><span class=nx>readU64</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>getOffset</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>prop</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>ptr</span><span class=p>(</span><span class=nx>prop</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FProperty</span><span class=p>.</span><span class=nx>OffsetInternal</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>这里的偏移和 Visual Studio 中的不同，ArrayDim 和 ElementSize 会占据前面空闲的 4 个字节，也就是往前移动 4 个字节，没有进行字节对齐。这个结果是根据下面的代码查看 <code>FProperty</code> 的真实内存布局得到的。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>analysisProp</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>object</span> <span class=o>=</span> <span class=nx>getUObjectBaseObjectFromId</span><span class=p>(</span><span class=mi>15654</span><span class=p>);</span> <span class=c1>// 对于特定对象进行分析
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>UObject</span><span class=p>.</span><span class=nx>isValid</span><span class=p>(</span><span class=nx>object</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>uStruct</span> <span class=o>=</span> <span class=nx>UObject</span><span class=p>.</span><span class=nx>getClass</span><span class=p>(</span><span class=nx>object</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>childProperties</span> <span class=o>=</span> <span class=nx>UStruct</span><span class=p>.</span><span class=nx>getChildProperties</span><span class=p>(</span><span class=nx>uStruct</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>currProp</span> <span class=o>=</span> <span class=nx>childProperties</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=nx>UObject</span><span class=p>.</span><span class=nx>isValid</span><span class=p>(</span><span class=nx>currProp</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>oname</span> <span class=o>=</span> <span class=nx>FField</span><span class=p>.</span><span class=nx>getName</span><span class=p>(</span><span class=nx>currProp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>cname</span> <span class=o>=</span> <span class=nx>FField</span><span class=p>.</span><span class=nx>getClassName</span><span class=p>(</span><span class=nx>currProp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`oname: </span><span class=si>${</span><span class=nx>oname</span><span class=si>}</span><span class=sb>, cname: </span><span class=si>${</span><span class=nx>cname</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>currProp</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FProperty</span><span class=p>.</span><span class=nx>ElementSize</span><span class=p>).</span><span class=nx>readU32</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>currProp</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FProperty</span><span class=p>.</span><span class=nx>ElementSize</span><span class=p>).</span><span class=nx>readU32</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>hexdump</span><span class=p>(</span><span class=nx>currProp</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=nx>currProp</span> <span class=o>=</span> <span class=nx>FField</span><span class=p>.</span><span class=nx>getNext</span><span class=p>(</span><span class=nx>currProp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>然后就得到下面的结果，这里可以看出来，<code>ArrayDim</code> 为 1，而 <code>ElementSize</code> 为 4，它们都是往前移了 4 个字节，将 Visual Studio 内存布局中 FlagsPrivate 后面空闲的 4 个字节移动到了 ElementSize 后面。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405125522.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405125522.png?size=small" data-sub-html="<h2>20250405125522</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405125522.png alt=真实情况分析 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405125522.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405125522.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405125522.png?size=large 2x" data-title=20250405125522 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>真实情况分析</figcaption></figure></p><h5 id=property-解析 class=heading-element><span>Property 解析</span>
<a href=#property-%e8%a7%a3%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>得到了成员变量类型名称，后面就需要找到其到底是什么类型。上面通过 <code>FFieldClass* ClassPrivate</code> 得到具体的 Property 类型，而因为具体的 Property 类型继承自 <code>FProperty</code>，而 <code>FProperty</code> 又继承自 <code>FField</code>，所以可以将 <code>FField* ChildProperties</code> 指针，转化为具体类型的指针，也就是把父类指针强制转化为子类指针。</p><p>对于具体类型的分析首先需要知道 <code>UEnum</code> 类，它继承自 <code>UField</code>，然后 <code>UField</code> 继承自 <code>UObject</code>。其中最为重要的就是 <code>TArray&lt;TPair&lt;FName, int64>> Names;</code> 这个成员变量，它是一个键值对，用于记录名字和对应的值。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404212007.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404212007.png?size=small" data-sub-html="<h2>20250404212007</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404212007.png alt=UEnum srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404212007.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404212007.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404212007.png?size=large 2x" data-title=20250404212007 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>UEnum</figcaption></figure></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// Reflection data for an enumeration.
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>COREUOBJECT_API</span> <span class=nl>UEnum</span> <span class=p>:</span> <span class=k>public</span> <span class=n>UField</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** This will be the true type of the enum as a string, e.g. &#34;ENamespacedEnum::InnerType&#34; or &#34;ERegularEnum&#34; or &#34;EEnumClass&#34; */</span>
</span></span><span class=line><span class=cl>	<span class=n>FString</span> <span class=n>CppType</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>protected</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** List of pairs of all enum names and values. */</span>
</span></span><span class=line><span class=cl>	<span class=n>TArray</span><span class=o>&lt;</span><span class=n>TPair</span><span class=o>&lt;</span><span class=n>FName</span><span class=p>,</span> <span class=n>int64</span><span class=o>&gt;&gt;</span> <span class=n>Names</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/** How the enum was originally defined. */</span>
</span></span><span class=line><span class=cl>	<span class=n>ECppForm</span> <span class=n>CppForm</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/** Enum flags. */</span>
</span></span><span class=line><span class=cl>	<span class=n>EEnumFlags</span> <span class=n>EnumFlags</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/** pointer to function used to look up the enum&#39;s display name. Currently only assigned for UEnums generated for nativized blueprints */</span>
</span></span><span class=line><span class=cl>	<span class=n>FEnumDisplayNameFn</span> <span class=n>EnumDisplayNameFn</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p><code>UEnum</code> 内存布局如下，大小为 96 字节，对齐方式是 8 字节。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404212235.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404212235.png?size=small" data-sub-html="<h2>20250404212235</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404212235.png alt=内存布局 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404212235.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404212235.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404212235.png?size=large 2x" data-title=20250404212235 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>内存布局</figcaption></figure>这里 <code>TArray</code> 是模板类，第一个成员是模板指针，而第二个成员描述当前有几个这样的模板指针，第三个成员描述最大有多个这样的模板指针，其结构如下所示。而这里的模板则是一个键值对 <code>TPair</code>，它的结构也如下所示。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>SizeType</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TArray</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>typedef</span> <span class=k>typename</span> <span class=n>TChooseClass</span><span class=o>&lt;</span>
</span></span><span class=line><span class=cl>		<span class=n>Allocator</span><span class=o>::</span><span class=n>NeedsElementType</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=k>typename</span> <span class=n>Allocator</span><span class=o>::</span><span class=k>template</span> <span class=n>ForElementType</span><span class=o>&lt;</span><span class=n>ElementType</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=k>typename</span> <span class=n>Allocator</span><span class=o>::</span><span class=n>ForAnyElementType</span>
</span></span><span class=line><span class=cl>	<span class=o>&gt;::</span><span class=n>Result</span> <span class=n>ElementAllocatorType</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>protected</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=n>ElementAllocatorType</span> <span class=n>AllocatorInstance</span><span class=p>;</span> <span class=c1>// 模板指针
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>SizeType</span>             <span class=n>ArrayNum</span><span class=p>;</span>          <span class=c1>// 记录当前数组内元素的实际个数
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>SizeType</span>             <span class=n>ArrayMax</span><span class=p>;</span>          <span class=c1>// 记录当前数组最大可容纳元素的数量
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>KeyType</span><span class=p>,</span> <span class=k>typename</span> <span class=n>ValueType</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>TPair</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>KeyType</span> <span class=n>Key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>ValueType</span> <span class=n>Value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div><p>然后由此可以得到下面的代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Offsets</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>......</span>
</span></span><span class=line><span class=cl>    <span class=c1>// UEnum 结构体成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>UEnum</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Names</span><span class=o>:</span> <span class=mh>0x40</span><span class=p>,</span>                                <span class=c1>// UEnum 中的 Names 成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>enumItemSize</span><span class=o>:</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>pointerSize</span> <span class=o>+</span> <span class=mh>0x10</span><span class=p>,</span>   <span class=c1>// UEnum -&gt; TArray 的大小，其中 TPair 大小为 0x10 字节
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>ArrayNum</span><span class=o>:</span> <span class=mh>0x40</span> <span class=o>+</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>pointerSize</span><span class=p>,</span>       <span class=c1>// UEnum -&gt; TArray 中 ArrayNum 成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>UEnum</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>getNamesArray</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>en</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// 获取 UEnum 的 Names 数组
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>ptr</span><span class=p>(</span><span class=nx>en</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>UEnum</span><span class=p>.</span><span class=nx>Names</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>getCount</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>en</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// 获取 UEnum 的 Names 数组长度
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>ptr</span><span class=p>(</span><span class=nx>en</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>UEnum</span><span class=p>.</span><span class=nx>ArrayNum</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h6 id=fbyteproperty class=heading-element><span>FByteProperty</span>
<a href=#fbyteproperty class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h6><p>从下面内存视图可以看出来 <code>FByteProperty</code> 只比 <code>FProperty</code> 多出一个 <code>UEnum</code> 的指针，那么这里的关键就是解析这个指针。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404213443.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404213443.png?size=small" data-sub-html="<h2>20250404213443</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404213443.png alt=内存视图 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404213443.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404213443.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250404213443.png?size=large 2x" data-title=20250404213443 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>内存视图</figcaption></figure>由此首先就需要获取这个指针，利用下面代码，可以从 <code>FFieldClass* ClassPrivate</code> 获取到指针。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// FByteProperty 工具函数，继承自 UObject，因此命名为 UByteProperty
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>UByteProperty</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>getName</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>prop</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// FName -&gt; 该字段的名称
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>UObject</span><span class=p>.</span><span class=nx>getName</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>getEnum</span><span class=p>(</span><span class=nx>prop</span><span class=p>));</span> 
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>getEnum</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>prop</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// UEnum* -&gt; 该字段的枚举类型
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>ptr</span><span class=p>(</span><span class=nx>prop</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FProperty</span><span class=p>.</span><span class=nx>Size</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>得到了 <code>UEnum*</code> 指针之后，就可以对其进行解析。这里其实就是解析这个 <code>TArray</code> 模板类，主要的步骤就是先得到 <code>TArray&lt;TPair&lt;FName, int64>> Names;</code> 的指针，读取其指向数组的起始位置，也就是一个一个 <code>TPair</code> 组成的数组。之后通过数组元素的大小，也就是 <code>TPair&lt;FName, int64></code> 的大小进行遍历。而 TPair 的类型如上所示，因此这里 <code>TPair&lt;FName, int64></code> 就是 <code>8 + 8 = 16</code> 字节。同时这里元素的数量就是由 <code>TArray</code> 中的成员变量 <code>ArrayNum</code> 确定的。然后可以得到下面对于 <code>FByteProperty</code> 的解析代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>analysisFByteProp</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>numElements</span> <span class=o>=</span> <span class=nx>GUObjectArray</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FUObjectArray</span><span class=p>.</span><span class=nx>TUObjectArray</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>TUObjectArray</span><span class=p>.</span><span class=nx>NumElements</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] Total Objects: </span><span class=si>${</span><span class=nx>numElements</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>numElements</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>object</span> <span class=o>=</span> <span class=nx>getUObjectBaseObjectFromId</span><span class=p>(</span><span class=nx>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>UObject</span><span class=p>.</span><span class=nx>isValid</span><span class=p>(</span><span class=nx>object</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>uStruct</span> <span class=o>=</span> <span class=nx>UObject</span><span class=p>.</span><span class=nx>getClass</span><span class=p>(</span><span class=nx>object</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>childProperties</span> <span class=o>=</span> <span class=nx>UStruct</span><span class=p>.</span><span class=nx>getChildProperties</span><span class=p>(</span><span class=nx>uStruct</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=kd>var</span> <span class=nx>currProp</span> <span class=o>=</span> <span class=nx>childProperties</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=p>(</span><span class=nx>UObject</span><span class=p>.</span><span class=nx>isValid</span><span class=p>(</span><span class=nx>currProp</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>oname</span> <span class=o>=</span> <span class=nx>FField</span><span class=p>.</span><span class=nx>getName</span><span class=p>(</span><span class=nx>currProp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>cname</span> <span class=o>=</span> <span class=nx>FField</span><span class=p>.</span><span class=nx>getClassName</span><span class=p>(</span><span class=nx>currProp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>cname</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=s2>&#34;ByteProperty&#34;</span><span class=p>)</span> <span class=o>!==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=nx>i</span><span class=si>}</span><span class=sb>] oname: </span><span class=si>${</span><span class=nx>oname</span><span class=si>}</span><span class=sb>, cname: </span><span class=si>${</span><span class=nx>cname</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=kr>const</span> <span class=nx>enumObj</span> <span class=o>=</span> <span class=nx>UByteProperty</span><span class=p>.</span><span class=nx>getEnum</span><span class=p>(</span><span class=nx>currProp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=nx>UObject</span><span class=p>.</span><span class=nx>isValid</span><span class=p>(</span><span class=nx>enumObj</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`\tbyte </span><span class=si>${</span><span class=nx>oname</span><span class=si>}</span><span class=sb>; //[Offset: </span><span class=si>${</span><span class=nx>ptr</span><span class=p>(</span><span class=nx>UProperty</span><span class=p>.</span><span class=nx>getOffset</span><span class=p>(</span><span class=nx>currProp</span><span class=p>))</span><span class=si>}</span><span class=sb>, Size: </span><span class=si>${</span><span class=nx>UProperty</span><span class=p>.</span><span class=nx>getElementSize</span><span class=p>(</span><span class=nx>currProp</span><span class=p>)</span><span class=si>}</span><span class=sb>]`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=c1>// const enumNamesArray = UEnum.getNamesArray(enumObj);
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=c1>// for (var count = 0; count &lt; UEnum.getCount(enumObj); count++) {
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=c1>//     var index = enumNamesArray.add(count * Offsets.UEnum.enumItemSize).readU32();
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=c1>//     try{
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=c1>//         console.log(`\t\t${getNameFromId(index).replace(enumNamesArray + &#34;::&#34;, &#34;&#34;)}`);
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=c1>//     }
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=c1>//     catch(e) {
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=c1>//         console.log(`\t\t${index}`);
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=c1>//     }
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=c1>// }
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=c1>// console.log(&#34;\t};&#34;);
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=nx>currProp</span> <span class=o>=</span> <span class=nx>FField</span><span class=p>.</span><span class=nx>getNext</span><span class=p>(</span><span class=nx>currProp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>这里获得的 <code>FByteProperty</code> 存在两种含义，一种就是直接存储 <code>uint8</code> 数值（原始 <code>byte</code>），一种就是作为枚举值的索引（此时需要 <code>UEnum</code> 提供映射关系）。因此上述代码其实只是如同 SDK 处理那样，没有解析 <code>UEnum</code>，直接使用 <code>byte</code> 作为其成员变量的数据类型，而代码中注释的代码就是解析 <code>UEnum</code> 结构的过程。</p><h6 id=fmapproperty class=heading-element><span>FMapProperty</span>
<a href=#fmapproperty class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h6><p>但是对于一些复合类型则需要进行递归处理，这里以 <code>FMapProperty</code> 为例。它存在两个 <code>FProperty</code> 类型来描述 key 和 value 类型，因此要知道 key 和 value 的类型，那么就必须再一次进行 <code>FProperty</code> 解析。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>COREUOBJECT_API</span> <span class=nl>FMapProperty</span> <span class=p>:</span> <span class=k>public</span> <span class=n>FMapProperty_Super</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>FProperty</span><span class=o>*</span>       <span class=n>KeyProp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>FProperty</span><span class=o>*</span>       <span class=n>ValueProp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>......</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p><figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405133542.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405133542.png?size=small" data-sub-html="<h2>20250405133542</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405133542.png alt=内存布局比对 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405133542.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405133542.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405133542.png?size=large 2x" data-title=20250405133542 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>内存布局比对</figcaption></figure>由此需要添加下面的代码，然后通过 <code>resolveProp()</code> 函数进行递归解析。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Offsets</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// FMapProperty 结构体成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>FMapProperty</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>KeyProp</span><span class=o>:</span> <span class=mh>0x78</span><span class=p>,</span>                              <span class=c1>// FMapProperty 中的 KeyProp 成员偏移，等于 FProperty 的大小
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>ValueProp</span><span class=o>:</span> <span class=mh>0x78</span> <span class=o>+</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>pointerSize</span><span class=p>,</span>      <span class=c1>// FMapProperty 中的 ValueProp 成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// FProperty 工具函数，继承自 UObject，因此命名为 UProperty
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>UProperty</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>getKeyProp</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>prop</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// FProperty* -&gt; 该字段的 KeyProp
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>ptr</span><span class=p>(</span><span class=nx>prop</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FMapProperty</span><span class=p>.</span><span class=nx>KeyProp</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>getValueProp</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>prop</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// FProperty* -&gt; 该字段的 ValueProp
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>ptr</span><span class=p>(</span><span class=nx>prop</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FMapProperty</span><span class=p>.</span><span class=nx>ValueProp</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>resolveProp</span><span class=p>(</span><span class=nx>prop</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>prop</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>cname</span> <span class=o>=</span> <span class=nx>FField</span><span class=p>.</span><span class=nx>getClassName</span><span class=p>(</span><span class=nx>prop</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>cname</span> <span class=o>===</span> <span class=s2>&#34;ObjectProperty&#34;</span> <span class=o>||</span> <span class=nx>cname</span> <span class=o>===</span> <span class=s2>&#34;WeakObjectProperty&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>||</span> <span class=nx>cname</span> <span class=o>===</span> <span class=s2>&#34;LazyObjectProperty&#34;</span> <span class=o>||</span> <span class=nx>cname</span> <span class=o>===</span> <span class=s2>&#34;AssetObjectProperty&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>||</span> <span class=nx>cname</span> <span class=o>===</span> <span class=s2>&#34;SoftObjectProperty&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=p>...</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>cname</span> <span class=o>===</span> <span class=s2>&#34;ClassProperty&#34;</span> <span class=o>||</span> <span class=nx>cname</span> <span class=o>===</span> <span class=s2>&#34;AssetClassProperty&#34;</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>            <span class=nx>cname</span> <span class=o>===</span> <span class=s2>&#34;SoftClassProperty&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=p>...</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>......</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s2>&#34;NULL&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>之后其余 <code>Property</code> 也是类似方法进行解析。</p><h5 id=children class=heading-element><span>Children</span>
<a href=#children class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>除了类属性之外，还有类成员函数需要解析，这里就需要依靠 <code>UField* Children</code> 来进行解析了。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405152822.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405152822.png?size=small" data-sub-html="<h2>20250405152822</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405152822.png alt=类继承关系 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405152822.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405152822.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405152822.png?size=large 2x" data-title=20250405152822 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>类继承关系</figcaption></figure>这里的 <code>UField* Children</code> 和上文 <code>FField* ChildProperties</code> 的形式类似，最终也是通过将父类指针转化为子类指针 <code>UFunction</code> 来获取更为具体的信息。同时这里类的成员函数也是以链表的形式存储在 Children 中，每个 UField 对象可以通过 Next 指针指向下一个类成员函数。</p><h5 id=ufunction-解析 class=heading-element><span>UFunction 解析</span>
<a href=#ufunction-%e8%a7%a3%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>查看 <code>UFunction</code>，它继承自 <code>UStruct</code>，而 <code>UStruct</code> 又继承自 <code>UField</code>，即 <code>UFunction</code> 继承自 <code>UField</code>，这个情况和 <code>FProperty</code> 继承自 <code>FField</code> 的形式相似。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405153315.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405153315.png?size=small" data-sub-html="<h2>20250405153315</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405153315.png alt=20250405153315 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405153315.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405153315.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405153315.png?size=large 2x" data-title=20250405153315 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>20250405153315</figcaption></figure></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>COREUOBJECT_API</span> <span class=nl>UFunction</span> <span class=p>:</span> <span class=k>public</span> <span class=n>UStruct</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Persistent variables.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=cm>/** EFunctionFlags set defined for this function */</span>
</span></span><span class=line><span class=cl>	<span class=n>EFunctionFlags</span> <span class=n>FunctionFlags</span><span class=p>;</span>                       <span class=c1>// 函数属性
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=c1>// Variables in memory only.
</span></span></span><span class=line><span class=cl><span class=c1></span>	
</span></span><span class=line><span class=cl>	<span class=cm>/** Number of parameters total */</span>
</span></span><span class=line><span class=cl>	<span class=n>uint8</span> <span class=n>NumParms</span><span class=p>;</span>                                     <span class=c1>// 参数数量
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Total size of parameters in memory */</span>
</span></span><span class=line><span class=cl>	<span class=n>uint16</span> <span class=n>ParmsSize</span><span class=p>;</span>                                   <span class=c1>// 参数大小
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Memory offset of return value property */</span>
</span></span><span class=line><span class=cl>	<span class=n>uint16</span> <span class=n>ReturnValueOffset</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Id of this RPC function call (must be FUNC_Net &amp; (FUNC_NetService|FUNC_NetResponse)) */</span>
</span></span><span class=line><span class=cl>	<span class=n>uint16</span> <span class=n>RPCId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Id of the corresponding response call (must be FUNC_Net &amp; FUNC_NetService) */</span>
</span></span><span class=line><span class=cl>	<span class=n>uint16</span> <span class=n>RPCResponseId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/** pointer to first local struct property in this UFunction that contains defaults */</span>
</span></span><span class=line><span class=cl>	<span class=n>FProperty</span><span class=o>*</span> <span class=n>FirstPropertyToInit</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#if UE_BLUEPRINT_EVENTGRAPH_FASTCALLS
</span></span></span><span class=line><span class=cl><span class=cp></span>	<span class=cm>/** The event graph this function calls in to (persistent) */</span>
</span></span><span class=line><span class=cl>	<span class=n>UFunction</span><span class=o>*</span> <span class=n>EventGraphFunction</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=cm>/** The state offset inside of the event graph (persistent) */</span>
</span></span><span class=line><span class=cl>	<span class=n>int32</span> <span class=n>EventGraphCallOffset</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** C++ function this is bound to */</span>
</span></span><span class=line><span class=cl>	<span class=n>FNativeFuncPtr</span> <span class=n>Func</span><span class=p>;</span>                                 <span class=c1>// 函数指针
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>这里也是通过 <code>UField</code> 强制转化得到 <code>UFunction</code> 指针，不过这里 <code>UFunction</code> 最终继承 <code>UObject</code>，所以可以通过 <code>UObject</code> 得到函数名字。因此可以得到下面代码。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Offsets</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// UField 结构体成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>UField</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Next</span><span class=o>:</span> <span class=mh>0x28</span><span class=p>,</span>                                 <span class=c1>// UField 中的 Next 成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// UFunction 结构体成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>UFunction</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>FirstPropertyToInit</span><span class=o>:</span> <span class=mh>0xd8</span><span class=p>,</span>                  <span class=c1>// UFunction 中的 FirstPropertyToInit 成员偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// UField 工具函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>UField</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>getNext</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>uField</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// UField* -&gt; 下一个 UField* 对象
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>ptr</span><span class=p>(</span><span class=nx>uField</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>UField</span><span class=p>.</span><span class=nx>Next</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// UFunction 工具函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>UFunction</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>getFunc</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>ufunction</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// FProperty* -&gt; 该函数的 Func 成员
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>ptr</span><span class=p>(</span><span class=nx>ufunction</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>UFunction</span><span class=p>.</span><span class=nx>FirstPropertyToInit</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>analysisFunction</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>numElements</span> <span class=o>=</span> <span class=nx>GUObjectArray</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>FUObjectArray</span><span class=p>.</span><span class=nx>TUObjectArray</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Offsets</span><span class=p>.</span><span class=nx>TUObjectArray</span><span class=p>.</span><span class=nx>NumElements</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] Total Objects: </span><span class=si>${</span><span class=nx>numElements</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>numElements</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>object</span> <span class=o>=</span> <span class=nx>getUObjectBaseObjectFromId</span><span class=p>(</span><span class=nx>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>UObject</span><span class=p>.</span><span class=nx>isValid</span><span class=p>(</span><span class=nx>object</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>uStruct</span> <span class=o>=</span> <span class=nx>UObject</span><span class=p>.</span><span class=nx>getClass</span><span class=p>(</span><span class=nx>object</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>child</span> <span class=o>=</span> <span class=nx>UStruct</span><span class=p>.</span><span class=nx>getChildren</span><span class=p>(</span><span class=nx>uStruct</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=kd>var</span> <span class=nx>currFunc</span> <span class=o>=</span> <span class=nx>child</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=p>(</span><span class=nx>UObject</span><span class=p>.</span><span class=nx>isValid</span><span class=p>(</span><span class=nx>currFunc</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>oname</span> <span class=o>=</span> <span class=nx>UObject</span><span class=p>.</span><span class=nx>getName</span><span class=p>(</span><span class=nx>currFunc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=kr>const</span> <span class=nx>cname</span> <span class=o>=</span> <span class=nx>UObject</span><span class=p>.</span><span class=nx>getClassName</span><span class=p>(</span><span class=nx>currFunc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>cname</span><span class=p>.</span><span class=nx>startsWith</span><span class=p>(</span><span class=s2>&#34;Function&#34;</span><span class=p>)</span> <span class=o>||</span> <span class=nx>cname</span> <span class=o>===</span> <span class=s2>&#34;DelegateFunction&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=kr>const</span> <span class=nx>funcAddr</span> <span class=o>=</span> <span class=nx>UFunction</span><span class=p>.</span><span class=nx>getFunc</span><span class=p>(</span><span class=nx>currFunc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[</span><span class=si>${</span><span class=nx>i</span><span class=si>}</span><span class=sb>] oname: </span><span class=si>${</span><span class=nx>oname</span><span class=si>}</span><span class=sb>, cname: </span><span class=si>${</span><span class=nx>cname</span><span class=si>}</span><span class=sb>, funcAddr: </span><span class=si>${</span><span class=nx>ptr</span><span class=p>(</span><span class=nx>funcAddr</span> <span class=o>-</span> <span class=nx>moduleBase</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=kd>var</span> <span class=nx>funcParam</span> <span class=o>=</span> <span class=nx>UStruct</span><span class=p>.</span><span class=nx>getChildProperties</span><span class=p>(</span><span class=nx>child</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=nx>currFunc</span> <span class=o>=</span> <span class=nx>UField</span><span class=p>.</span><span class=nx>getNext</span><span class=p>(</span><span class=nx>currFunc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>通过上面的代码可以得到下面的结果。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405162312.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405162312.png?size=small" data-sub-html="<h2>20250405162312</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405162312.png alt=获取结果 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405162312.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405162312.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250405162312.png?size=large 2x" data-title=20250405162312 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>获取结果</figcaption></figure>这里只有类成员函数的名称和偏移，但是因为 <code>UFunction</code> 继承自 <code>UStruct</code>，而 <code>UStruct</code> 有成员变量 <code>FField* ChildProperties</code>，所以后续依旧是解析这个 Property 来获取函数的参数信息。同时 UE4 还定义了一下属性 Flag，用于表示函数类型或者参数类型，比如 native 函数，out 型参数等，这里可以看具体的 dump 工具来了解。</p><h2 id=参考资料 class=heading-element><span>参考资料</span>
<a href=#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><div class="details admonition quote open disabled"><div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-quote-right" aria-hidden=true></i>参考</div><div class=details-content><div class=admonition-content><p><ul><li><a href=https://bbs.kanxue.com/thread-281463.htm target=_blank rel="external nofollow noopener noreferrer">腾讯游戏安全技术竞赛2024决赛 安卓方向解题报告</a></li><li><a href=https://bbs.kanxue.com/thread-281464.htm target=_blank rel="external nofollow noopener noreferrer">2024腾讯游戏安全大赛-安卓赛道决赛VM分析与还原</a></li><li><a href=http://www.yxfzedu.com/article/12302 target=_blank rel="external nofollow noopener noreferrer">Android安全-2024騰訊遊戲安全大賽安卓決賽(復現)</a></li><li><a href=https://blog.lleavesg.top/article/Android-Seccomp target=_blank rel="external nofollow noopener noreferrer">Android环境下Seccomp对系统调用的监控</a></li><li><a href=https://bbs.kanxue.com/thread-282857.htm#msg_header_h2_4 target=_blank rel="external nofollow noopener noreferrer">UE4.27SDK-Dump</a></li></ul></div></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2025-04-05 16:27:33">更新于 2025.4.5&nbsp;
<a class=git-hash href=https://github.com/czTangt/blog.git/commit/af68794fceaff02f009e84b5dc6e97ef0f2a1d7a rel="external nofollow noopener noreferrer" target=_blank title="commit by czTangt(cz.tangt@gmail.com) af68794fceaff02f009e84b5dc6e97ef0f2a1d7a: finish learn sdk to 2025TententGameSecFinal"><i class="fa-solid fa-hashtag fa-fw" aria-hidden=true></i>af68794</a></span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href="https://github.com/czTangt/blog.git/blob/main/content/posts%5candroid%5c2024_Tencent_GameSec_Final.md?plain=1" title=查看源码 target=_blank rel="external nofollow noopener noreferrer" class=link-to-source>查看源码</a></span><span><a href=https://github.com/czTangt/blog.git/edit/main/content/posts%5candroid%5c2024_Tencent_GameSec_Final.md title=编辑此页 target=_blank rel="external nofollow noopener noreferrer" class=link-to-edit>编辑此页</a></span><span><a href="https://github.com/czTangt/blog.git/issues/new?title=[BUG]%202024%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%86%B3%E8%B5%9B&amp;body=%7cField%7cValue%7c%0A%7c-%7c-%7c%0A%7cTitle%7c2024%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%86%B3%E8%B5%9B%7c%0A%7cURL%7chttps://czTangt.github.io/blog/posts/android/2024-tencent-gamesec-final/%7c%0A%7cFilename%7chttps://github.com/czTangt/blog.git/blob/main/content/posts%5candroid%5c2024_Tencent_GameSec_Final.md?plain=1%7c" title=报告问题 target=_blank rel="external nofollow noopener noreferrer" class=link-to-report>报告问题</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 X" data-sharer=twitter data-url=https://czTangt.github.io/blog/posts/android/2024-tencent-gamesec-final/ data-title=2024腾讯游戏安全竞赛决赛 data-hashtags=android,game><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://czTangt.github.io/blog/posts/android/2024-tencent-gamesec-final/ data-hashtag=android><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://czTangt.github.io/blog/posts/android/2024-tencent-gamesec-final/ data-title=2024腾讯游戏安全竞赛决赛><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/blog/tags/android/ class=post-tag title="标签 - Android">Android</a><a href=/blog/tags/game/ class=post-tag title="标签 - Game">Game</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/blog/>主页</a></span></section></div><div class=post-nav><a href=/blog/posts/android/2024-tencent-gamesec-prelim/ class=post-nav-item rel=prev title=2024腾讯游戏安全竞赛初赛><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>2024腾讯游戏安全竞赛初赛</a></div></div></article><aside class=toc id=toc-auto aria-label=目录><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered order-1">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.136.5"><img class=hugo-icon src=/blog/images/hugo.min.svg alt="Hugo logo"> Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.3.17-30a67c4b"><img class=fixit-icon src=/blog/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright order-2" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2024 - 2025</span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div></div><a href=https://github.com/czTangt/blog title="View source on GitHub" target=_blank rel="external nofollow" class="github-corner left d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true" width="56" height="56"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><noscript><div class=noscript-warning>该网站在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/blog/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=preload href=/blog/lib/katex/katex.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/blog/lib/katex/katex.min.css></noscript><link rel=stylesheet href=/blog/lib/cookieconsent/cookieconsent.min.css><script src=/blog/lib/autocomplete/autocomplete.min.js defer></script><script src=/blog/lib/fuse/fuse.min.js defer></script><script src=/blog/lib/lightgallery/lightgallery.min.js defer></script><script src=/blog/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/blog/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/blog/lib/sharer/sharer.min.js async defer></script><script src=/blog/lib/katex/katex.min.js defer></script><script src=/blog/lib/katex/auto-render.min.js defer></script><script src=/blog/lib/katex/mhchem.min.js defer></script><script src=/blog/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/blog/js/codeblock.js defer></script><script src=https://libs.baidu.com/jquery/2.1.4/jquery.min.js defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:10},comment:{enable:!1},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/blog/search.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!1},version:"v0.3.17-30a67c4b"}</script><script src=/blog/js/theme.min.js defer></script></body></html>