<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>2024腾讯游戏安全竞赛初赛 - czTang</title><meta name=author content="czTang">
<meta name=description content="记录一下对于2024腾讯游戏安全竞赛安卓赛道的复现。
"><meta name=keywords content='android,game'><meta itemprop=name content="2024腾讯游戏安全竞赛初赛"><meta itemprop=description content="记录一下对于2024腾讯游戏安全竞赛安卓赛道的复现。"><meta itemprop=datePublished content="2025-03-03T18:55:55+08:00"><meta itemprop=dateModified content="2025-03-05T19:41:35+08:00"><meta itemprop=wordCount content="11008"><meta itemprop=keywords content="Android,Game"><meta property="og:url" content="https://czTangt.github.io/blog/posts/android/2024-tencent-gamesec-prelim/"><meta property="og:site_name" content="czTang"><meta property="og:title" content="2024腾讯游戏安全竞赛初赛"><meta property="og:description" content="记录一下对于2024腾讯游戏安全竞赛安卓赛道的复现。"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-03T18:55:55+08:00"><meta property="article:modified_time" content="2025-03-05T19:41:35+08:00"><meta property="article:tag" content="Android"><meta property="article:tag" content="Game"><meta name=twitter:card content="summary"><meta name=twitter:title content="2024腾讯游戏安全竞赛初赛"><meta name=twitter:description content="记录一下对于2024腾讯游戏安全竞赛安卓赛道的复现。"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202410312135963.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical type=text/html href=https://czTangt.github.io/blog/posts/android/2024-tencent-gamesec-prelim/ title="2024腾讯游戏安全竞赛初赛 - czTang"><link rel=prev type=text/html href=https://czTangt.github.io/blog/posts/android/shell/ title=Shell><link rel=stylesheet href=/blog/css/style.min.css><link rel=preload href=/blog/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/blog/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/blog/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/blog/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"2024腾讯游戏安全竞赛初赛","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/czTangt.github.io\/blog\/posts\/android\/2024-tencent-gamesec-prelim\/"},"genre":"posts","keywords":"android, game","wordcount":11008,"url":"https:\/\/czTangt.github.io\/blog\/posts\/android\/2024-tencent-gamesec-prelim\/","datePublished":"2025-03-03T18:55:55+08:00","dateModified":"2025-03-05T19:41:35+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"czTang"},"description":""}</script><script src=/blog/js/head/color-scheme.min.js></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=left><div class=header-title><a href=/blog/ title=czTang><span class=header-title-pre><i class='fa fa-coffee'>&nbsp</i></span><span class=header-title-text>czTang</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/blog/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Archives</a></li><li class=menu-item><a class=menu-link href=/blog/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/blog/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=/blog/about/><i class="fa-solid fa-user fa-fw fa-sm" aria-hidden=true></i> About</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/blog/ title=czTang><span class=header-title-pre><i class='fa fa-coffee'>&nbsp</i></span><span class=header-title-text>czTang</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/blog/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Archives</a></li><li class=menu-item><a class=menu-link href=/blog/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/blog/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=/blog/about/><i class="fa-solid fa-user fa-fw fa-sm" aria-hidden=true></i> About</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=合集><div class="details collection-details open"><div class="details-summary collection-summary"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i>
<span class=collection-name title=合集>Game</span>
<span class=collection-count>1</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content collection-content"><nav><ul class=collection-list><li class=collection-item><span class=active title=2024腾讯游戏安全竞赛初赛>2024腾讯游戏安全竞赛初赛</span></li></ul><div class=collection-nav-simple><i class="fa-solid fa-angle-left fa-fw collection-nav-item text-secondary" aria-hidden=true></i><span class=text-secondary>1/1</span><i class="fa-solid fa-angle-right fa-fw collection-nav-item text-secondary" aria-hidden=true></i></div></nav></div></div></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>2024腾讯游戏安全竞赛初赛</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/czTangt title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img loading=lazy src=/blog/images/avatar.jpg alt=czTang data-title=czTang width=20 height=20 class=avatar style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'>&nbsp;czTang</a></span><span class=post-included-in>&nbsp;收录于 <a href=/blog/categories/android/ class=post-category title="分类 - Android"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Android</a> 和 <a href=/blog/collections/game/ class=post-collection title="合集 - Game"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> Game</a></span></div><div class=post-meta-line><span title="发布于 2025-03-03 18:55:55"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2025.3.3>2025.3.3</time></span>&nbsp;<span title="更新于 2025-03-05 19:41:35"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden=true></i><time datetime=2025.3.5>2025.3.5</time></span>&nbsp;<span title="11008 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 11100 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 22 分钟</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#ue-基础知识>UE 基础知识</a><ul><li><a href=#相关概念>相关概念</a><ul><li><a href=#蓝图>蓝图</a></li><li><a href=#常见基类>常见基类</a><ul><li><a href=#uobject>Uobject</a></li><li><a href=#actor>Actor</a></li><li><a href=#pawn>Pawn</a></li><li><a href=#character>Character</a></li><li><a href=#controller>Controller</a></li><li><a href=#game-mode>Game Mode</a></li></ul></li></ul></li><li><a href=#相关结构>相关结构</a><ul><li><a href=#uengine>UEngine</a></li><li><a href=#ugameinstance>UGameInstance</a></li><li><a href=#fworldcontent>FWorldContent</a></li><li><a href=#uworld>UWorld</a></li><li><a href=#ulevel>ULevel</a></li></ul></li><li><a href=#逆向关键结构>逆向关键结构</a></li></ul></li><li><a href=#dumpsdk>dumpSDK</a><ul><li><a href=#确定-ue-版本>确定 UE 版本</a></li><li><a href=#查找关键结构>查找关键结构</a><ul><li><a href=#gworld>GWorld</a></li><li><a href=#gname>GName</a></li><li><a href=#guobjectarray>GUObjectArray</a></li></ul></li><li><a href=#dumpsdk-1>dumpSDK</a></li></ul></li><li><a href=#寻找-actor>寻找 Actor</a><ul><li><a href=#获取地址>获取地址</a><ul><li><a href=#ulevel_offset>ULevel_offset</a><ul><li><a href=#uworld-1>UWorld</a></li><li><a href=#fnetworknotify>FNetworkNotify</a></li><li><a href=#uobject-1>UObject</a></li><li><a href=#获取偏移>获取偏移</a></li></ul></li><li><a href=#actor_offset>Actor_offset</a><ul><li><a href=#ulevel-1>ULevel</a></li><li><a href=#furl>FURL</a></li><li><a href=#fstring>FString</a></li><li><a href=#tarray>TArray</a></li><li><a href=#获取偏移-1>获取偏移</a></li></ul></li><li><a href=#获取内存地址>获取内存地址</a></li></ul></li></ul></li><li><a href=#参考资料>参考资料</a></li></ul></nav></div></div><div class=content id=content><p>记录一下对于2024腾讯游戏安全竞赛安卓赛道的复现。</p><h2 id=ue-基础知识 class=heading-element><span>UE 基础知识</span>
<a href=#ue-%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>在进行逆向前，首先需要知道一些 UE 的基本知识，不然后面会越来越混乱。这里可以从 <a href=https://blog.csdn.net/qq_23091255/article/details/144704710 target=_blank rel="external nofollow noopener noreferrer">虚幻引擎是什么</a> 这篇文章了解到什么是虚幻引擎。同时这篇文章也罗列了 UE 结构图，可以从这些继承关系图中查看 UE 相关的重要结构，下面就是对于其中的重要结构和一些概念进行讲解。</p><h3 id=相关概念 class=heading-element><span>相关概念</span>
<a href=#%e7%9b%b8%e5%85%b3%e6%a6%82%e5%bf%b5 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h4 id=蓝图 class=heading-element><span>蓝图</span>
<a href=#%e8%93%9d%e5%9b%be class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>虚幻引擎中的 <strong>蓝图可视化脚本</strong> 系统是一类完整的游戏性脚本系统，此系统的基础概念是使用基于节点的界面在虚幻编辑器中创建游戏性元素。它基于节点的可视化编程工具，通过逻辑节点图实现游戏逻辑，无需传统代码编写。</p><h4 id=常见基类 class=heading-element><span>常见基类</span>
<a href=#%e5%b8%b8%e8%a7%81%e5%9f%ba%e7%b1%bb class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><h5 id=uobject class=heading-element><span>Uobject</span>
<a href=#uobject class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p><strong>UObject</strong> 是虚幻引擎中的核心基础类，大部分其他游戏对象和资源类都直接或间接地继承自它。它作为虚幻引擎的基石，提供了多项关键功能，包括内存管理、序列化、反射、垃圾回收以及元数据支持。在虚幻引擎中，UObject 类的实例通常被称为 <strong>对象</strong>，它们构成了游戏世界及其相关资源的基本单元。它的作用如下：</p><ul><li><strong>内存管理</strong>：UObject 提供了强大的内存管理机制，确保在创建和销毁对象时正确分配和释放内存。它引入了一套自动化的内存清理系统，使得对象可以在不再被引用时自动释放所占用的资源，自动进行垃圾回收，从而有效防止内存泄漏。这种机制不仅简化了开发者的任务，还提高了应用的稳定性和性能。</li><li><strong>序列化与反序列化</strong>：UObject 支持将对象的状态保存到磁盘文件（如关卡、材质、模型等资源），并在需要时从这些文件中恢复。这一特性使得虚幻引擎能够高效地加载和保存游戏内容，确保游戏状态可以持久化，并且可以在不同的会话之间保持一致。此外，序列化能力也使得跨平台的数据交换变得更加简单。</li><li><strong>反射</strong>：UObject 实现了反射机制，允许程序在运行时动态地检查和操作对象的结构和行为。尽管 C++ 本身并不具备内置的反射功能，但虚幻引擎通过 UObject 提供了这一强大特性。开发者可以通过反射访问对象的属性和方法，这对于编辑器功能（如属性面板、蓝图编辑）和运行时调试非常有用。反射机制还为自动化工具和脚本提供了便利，增强了开发效率。</li></ul><h5 id=actor class=heading-element><span>Actor</span>
<a href=#actor class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>Actor 指 <strong>AActor</strong> 基类，它是一个核心类，作为游戏世界内所有可交互对象的基础。任何可以在关卡中放置或动态生成的对象，几乎都是从 AActor 类派生而来。这包括但不限于角色、道具、特效、静态和动态物体等。它作为基类，为所有继承自它的类提供了一套通用的功能和接口。它不仅代表了游戏中可见的实体，还包含了控制这些实体行为的逻辑。每个 AActor 都可以拥有多个组件（如渲染组件、碰撞组件、音频组件等），这些组件赋予 AActor 特定的行为和特性。通过组合不同的组件，开发者可以构建出复杂且功能丰富的游戏元素。Actor 最主要的能力就是 <strong>能被挂载组件</strong>，只有需要挂载组件时，才应该继承自 Actor 类。</p><p>在虚幻引擎中，所有的 AActor 实例都由 <strong>ULevel</strong> 类管理，存储在一个名为 <strong>Actors</strong> 的成员变量中，该成员是一个 TArray 容器（<code>TArray&lt;AActor*> Actors;</code>），包含着当前关卡中所有的 AActor 对象。那么就可以通过遍历这个数组来访问和操作关卡内的所有 AActor。此外，虚幻引擎还提供了多种工具和函数，使得查找特定类型的 AActor 或根据条件筛选 AActor 变得更加容易。例如，可以使用 <code>GetAllActorsOfClass</code> 函数来获取指定类的所有实例，或者使用 <code>TActorIterator</code> 来遍历符合特定条件的 AActor。</p><h5 id=pawn class=heading-element><span>Pawn</span>
<a href=#pawn class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p><strong>APawn</strong> 派生自 AActor，它作为玩家或AI控制的代理实体（如角色、载具）。它代表国际象棋中的棋子，提供了被 <strong>操作</strong> 的特性。它能被后面要提到的 <strong>Controller</strong> 所操纵。</p><h5 id=character class=heading-element><span>Character</span>
<a href=#character class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p><strong>ACharacter</strong> 派生自 APawn，它提供了一个特殊组件：<strong>Character Movement</strong>。这个组件提供了一个基础的，基于胶囊体的角色移动功能。包括移动和跳跃，还能扩展出蹲伏和爬行等。所以如果游戏角色是人类的话，特别适合使用 Character 类。简单而言，对于需要移动的角色，都适用于 Character 类的逻辑。</p><h5 id=controller class=heading-element><span>Controller</span>
<a href=#controller class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p><strong>AController</strong> 是基类，Controller 是用来操控 Pawn/Character 的人。可以把它看作是下棋的棋手，或者提线木偶的操作者。它既可以是玩家，比如 <strong>Player Controller</strong>，通过键盘或者手柄输入来操作游戏角色，也可以是电脑 AI，比如 <strong>AI Controller</strong> 来操作游戏中的 NPC 和怪物等角色。它通过 Possess 来接管并控制一个角色，然后通过 UnPossess 来结束接管一个角色。</p><h5 id=game-mode class=heading-element><span>Game Mode</span>
<a href=#game-mode class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>这里指 <strong>AGameModeBase</strong> 基类，它是游戏规则与流程管理者，定义了游戏是如何被执行的，游戏规则，游戏流程以及其他方面的内容。它仅在服务端存在，客户端无法直接访问。核心职责就是定义玩家加入流程（如重生规则、队伍分配）；设置默认 Pawn 类、PlayerController 类、HUD 类；实现胜利/失败条件判定逻辑。</p><h3 id=相关结构 class=heading-element><span>相关结构</span>
<a href=#%e7%9b%b8%e5%85%b3%e7%bb%93%e6%9e%84 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h4 id=uengine class=heading-element><span>UEngine</span>
<a href=#uengine class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p><strong>UEngine</strong> 作为虚幻引擎的基石，以抽象基类的形式通过 <code>UCLASS(abstract)</code> 宏定义，承载着引擎运行时全局状态管理的核心职责。其派生类体系严格遵循环境隔离原则，针对游戏运行时与编辑器环境分别派生出 <strong>UGameEngine</strong> 与 <strong>UEditorEngine</strong> 两个子类。这两个子类在内存管理、对象生命周期和系统交互层面存在显著差异，共同构建起引擎的多环境适应能力。</p><ul><li>UGameEngine：当引擎以独立游戏模式运行时，<strong>UGameEngine</strong> 将成为主导实例。此子类的核心使命是维护一个完整且封闭的游戏会话环境。在引擎初始化阶段（通常通过 <code>UGameEngine::Init()</code> 方法触发），其实例会创建唯一的 <code>UGameInstance</code> 对象。该对象作为游戏会话的根容器，不仅承载玩家控制器、在线会话接口、关卡流送系统等全局组件，还通过 <code>FWorldContext</code> 机制管理游戏世界的上下文信息。例如，当游戏支持分屏合作或多窗口渲染时，每个视口会关联独立的 FWorldContext，但这些上下文最终仍由 UGameEngine 统一协调。</li><li>UEditorEngine：当引擎运行于编辑器模式时，<strong>UEditorEngine</strong> 将取代其基类成为主导实例。这一子类展现出高度复杂的双重特性：既要作为资源编辑的管理平台，又要承担游戏逻辑的实时预览功能。其内部通过 <code>FPlayInEditorSessionInfo</code> 等专用结构体实现角色切换，使得开发者能在同一进程中无缝切换编辑态与运行态。</li></ul><h4 id=ugameinstance class=heading-element><span>UGameInstance</span>
<a href=#ugameinstance class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p><code>UGameInstance</code> 在 Unreal Engine 中扮演着非常重要的角色，它是一个运行游戏的高级管理器，负责存储和管理整个游戏会话期间的状态和数据。</p><ul><li>生命周期管理：<code>UGameInstance</code> 的实例通常在游戏启动时创建，并在整个游戏会话期间持续存在，直到游戏结束。在编辑器模式下，它的生命周期从编辑器打开开始，到编辑器关闭结束。</li><li>存储游戏信息：<code>UGameInstance</code> 保存了一个指向 <code>FWorldContext</code> 的指针。<code>FWorldContext</code> 是一个包含当前世界（<code>UWorld</code>）上下文信息的结构体，它允许 <code>UGameInstance</code> 访问和管理当前游戏世界的状态。同时它还存储了游戏中所有的本地玩家（<code>Local Player</code>）、游戏会话（<code>Game Session</code>）等信息。这些信息对于游戏的运行至关重要，需要在整个游戏会话中持续跟踪和管理。</li><li>在游戏过程中，当玩家从一个 Level 切换到另一个 Level 时，当前 Level 的数据通常会被释放，包括管理该 Level 的 <code>UWorld</code> 对象。由于 <code>UGameInstance</code> 的生命周期不依赖于单个 Level，它非常适合用于存储那些需要跨 Level 持久存在或独立于 Level 的数据和功能。</li></ul><h4 id=fworldcontent class=heading-element><span>FWorldContent</span>
<a href=#fworldcontent class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p><code>FWorldContext</code> 是一个核心类，用于管理游戏世界（<code>UWorld</code>）的生命周期和上下文。</p><ul><li>在 UE4 中，特别是在开发过程中，可能会同时存在多个世界。<code>FWorldContext</code> 提供了一种机制来管理和跟踪这些世界的状态。与许多其他 UE4 类不同，<code>FWorldContext</code> 类型以 F 开头，表名它不是从 <code>UObject</code> 或 <code>AActor</code> 派生的。这意味着它不遵循UE4的垃圾回收机制，并且没有 <code>Serialize</code> 和 <code>Deserialize</code> 函数，因此它通常用于管理那些不通过 UE4 的序列化机制存储的数据。</li><li><code>FWorldContext</code> 是 UEngine 用来管理世界生成、销毁、切换的类。它包含对当前世界（<code>UWorld* ThisCurrentWorld</code>）的引用和一个指向拥有它的 <code>UGameInstance</code> 的指针（<code>UGameInstance* OwningGameInstance</code>）。</li><li>在独立运行的游戏中，通常只有一个 <code>Game WorldContext</code>。然而，在编辑器模式下，可能存在多个 <code>FWorldContext</code> 实例，例如：<ul><li><code>Editor Context</code>：用于编辑器视图的世界上下文。</li><li><code>PIE WorldContext</code>：用于实时预览（Play In Editor）的世界上下文。</li><li><code>Preview World</code>：用于编辑器视图中尚未运行的游戏场景的预览世界。</li></ul></li><li>当从一个世界切换到另一个世界时（例如，从编辑器视图的预览世界切换到实时预览世界），<code>FWorldContext</code> 负责保存当前世界的状态，并提供目标世界所需的上下文信息。这使得世界之间的切换更加流畅，同时保留了必要的状态信息。</li></ul><h4 id=uworld class=heading-element><span>UWorld</span>
<a href=#uworld class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p><strong>UWorld</strong> 表示整个游戏世界，是管理和组织游戏内所有关卡（ULevel）和游戏实体（Actors）的顶级容器。它继承自 <code>UObject</code> 类，通过一个名为 <code>Levels</code> 的数组 <code>TArray &lt; class ULevel *></code> 管理已加载的关卡，这些关卡包括持久性关卡（Persistent Level）和流式关卡（Stream Level）。</p><ul><li><strong>持久性关卡</strong>：UWorld 中的 <code>Persistent Level</code> 是在编辑器中始终打开的关卡，作为游戏世界的主要部分，通常包含游戏的主要场景和对象。UWorld 使用 <code>class ULevel *PersistentLevel</code> 来指向这个关卡。</li><li><strong>流式关卡</strong>：流式关卡是可以根据需要动态加载和卸载的关卡部分，这对于管理大型场景并提高性能非常有用。UWorld 通过这些流式关卡实现场景的按需加载。</li></ul><p>尽管 UWorld 可以访问所有关卡中的所有 Actors，但它并不直接保存这些 Actors。相反，它通过遍历每个 ULevel 及其 Actors 来管理它们。例如，UWorld 会检查每个已加载的 ULevel，然后访问该 ULevel 中的 Actors 数组。</p><h4 id=ulevel class=heading-element><span>ULevel</span>
<a href=#ulevel class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>ULevel 表示单个关卡或场景，是存放和管理 Actors 及其派生类的容器。它为开发者提供了一个框架来放置和管理场景中的所有对象，并通过 Actors 和蓝图实现关卡逻辑。同时，ULevel 与 UWorld 密切协作，支持复杂的场景管理和动态加载机制。</p><ul><li>ULevel 作为 Actors 的容器，允许开发者在关卡中放置和组织各种对象，如角色、道具、触发器等。它继承自 <code>UObject</code> 类，这意味着它拥有 <code>UObject</code> 提供的所有特性，包括引用计数、垃圾回收、序列化等。</li><li>每个 ULevel 对象都包含一个 <code>ALevelScriptActor</code> 对象，它允许开发者使用蓝图（一种可视化脚本工具）来编写和实现关卡特定的逻辑。同时，它还包含一个 <code>AWorldSettings</code> 对象，用于记录和存储关卡的自定义属性，如光照贴图、游戏模式等。</li></ul><p>其主要成员变量如下：</p><ul><li><code>TArray &lt;AActor *> Actors；</code>：存储关卡内所有 Actors。</li><li><code>AWorldSettings *WorldSettings；</code>：记录关卡的自定义属性。</li><li><code>ALevelScriptActor *LevelScriptActor；</code>：实现关卡蓝图功能。</li></ul><h3 id=逆向关键结构 class=heading-element><span>逆向关键结构</span>
<a href=#%e9%80%86%e5%90%91%e5%85%b3%e9%94%ae%e7%bb%93%e6%9e%84 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class="details admonition tip open disabled"><div class="details-summary admonition-title"><i class="icon fa-fw fa-regular fa-lightbulb" aria-hidden=true></i>补充</div><div class=details-content><div class=admonition-content><p>下面的结构只是前期根据一些资料得到的认知，不保证正确。更加详细的解释可以参考 <a href=https://bbs.kanxue.com/thread-282857.htm#msg_header_h2_0 target=_blank rel="external nofollow noopener noreferrer">UE4.27SDK-Dump</a> 和 <a href=https://bbs.kanxue.com/thread-278266.htm target=_blank rel="external nofollow noopener noreferrer">UnrealEngine 5 逆向之类名算法的分析</a> 这两篇文章。</p></div></div></div><p>在对 UE 进行逆向的过程中，最为重要就是 GWorld，GName 和 GUObjectArray 三个变量。</p><ul><li><strong>GWorld</strong>：<code>GWorld</code> 是 Unreal Engine 中的一个全局指针变量，是指向 <code>UWorld</code> 的指针，代表当前的世界实例。它存储了关于当前游戏世界状态的所有信息，包括游戏模式、玩家控制器、游戏状态、当前关卡等。<code>GWorld</code> 是游戏逻辑 的核心，是所有游戏对象和游 戏逻辑交互的中心点。</li><li><strong>GName</strong>：<code>GName</code> 是全局指针，指向 <code>FNamePool</code> 内存池。<code>FNamePool</code> 采用分块管理（如 64KB 的 <code>FNameBlock</code>），每个块内存储 <code>FNameEntry</code> 结构体，包含字符串的哈希、长度及 UTF-8 数据。</li><li><strong>GUObjectArray</strong>：<code>GUObjectArray</code> 是一个全局的 <code>FUObjectArray</code> 实例，是 <code>GUObject</code> 的全局变量声明，它的作用是作为所有 <code>UObject</code> 派生类的实例的容器。因此这个实例可以进行对象跟踪，对象生命周期管理，性能优化和调试开发等。</li></ul><p>这些结构对于 UE 的引擎逆向有很大的帮助，下面 Dump SDK 中的项目就需要通过这些结构的地址才能进行 SDK 的 Dump 操作。</p><p>对于 UE4 而言，符号如果暴露出来的可以直接通过导出表寻找 <code>GWorld</code>，<code>GUObjectArray</code>。UE4.23 版本以前的通过 <code>GName</code> 函数，UE4.23 版本及其以后的通过 <code>FNamePool::FNamePool</code> 构造函数寻找 <code>GName</code>。下面展示的就是对于Tecent 2024 游戏安全安卓题，在无符号的情况下，比对 UE4.27 引擎源码来查找三个结构体在 <code>libUE4.so</code> 文件中的偏移。UE5 的查找方式相同。</p><h2 id=dumpsdk class=heading-element><span>dumpSDK</span>
<a href=#dumpsdk class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 id=确定-ue-版本 class=heading-element><span>确定 UE 版本</span>
<a href=#%e7%a1%ae%e5%ae%9a-ue-%e7%89%88%e6%9c%ac class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>首先查看 UE 的版本，这里打开 <strong>AndroidManifest.xml</strong>，很容以发现是 UE4 的程序，其中存在很多字符提示，但是引擎版本被修改为了 <code>0.0.0</code>。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303190820.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303190820.png?size=small" data-sub-html="<h2>20250303190820</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303190820.png alt=查看apk信息 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303190820.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303190820.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303190820.png?size=large 2x" data-title=20250303190820 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>查看apk信息</figcaption></figure></p><p>之后用 IDA 打开 apk 中的 <strong>libUE4.so</strong>，搜索 <code>++UE4</code>，查看是否存在和 UE 相关的版本信息。这里我最开始没有搜索到，然后在 <code>Strings</code> 界面右键点击 <code>setup</code> ，把这个 <code>Delphi</code> 勾选上，然后就可以找到 UE4 版本的相关信息了。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303191023.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303191023.png?size=small" data-sub-html="<h2>20250303191023</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303191023.png alt=修改strings配置 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303191023.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303191023.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303191023.png?size=large 2x" data-title=20250303191023 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>修改strings配置</figcaption></figure></p><p>最后发现 <code>++UE4+Release-4.27</code>，由此确认为 4.27 版本，然后就是注册 epic 账号并关联 github 获取对应版本的源代码辅助后续分析。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303191123.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303191123.png?size=small" data-sub-html="<h2>20250303191123</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303191123.png alt=确定UE版本 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303191123.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303191123.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303191123.png?size=large 2x" data-title=20250303191123 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>确定UE版本</figcaption></figure></p><h3 id=查找关键结构 class=heading-element><span>查找关键结构</span>
<a href=#%e6%9f%a5%e6%89%be%e5%85%b3%e9%94%ae%e7%bb%93%e6%9e%84 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h4 id=gworld class=heading-element><span>GWorld</span>
<a href=#gworld class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>查看 UE 4.27 源码，<code>GWorld</code> 在 <strong>UE4.27.2\Engine\Source\Runtime\Engine\Private\World.cpp</strong> 中进行定义。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100042.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100042.png?size=small" data-sub-html="<h2>20250304100042</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100042.png alt=GWorld位置 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100042.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100042.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100042.png?size=large 2x" data-title=20250304100042 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>GWorld位置</figcaption></figure>然后还是在这个文件中，随便找到一个含有字符串和 GWorld 的函数，并通过字符串来查找这个结构的地址。这里寻找函数 <code>UWorld* FSeamlessTravelHandler::Tick()</code>，然后可以看到在字符串 <code>SeamlessTravel FlushLevelStreaming</code> 上面，<code>GWorld</code> 会被赋值。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100353.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100353.png?size=small" data-sub-html="<h2>20250304100353</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100353.png alt=查找GWorld srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100353.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100353.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100353.png?size=large 2x" data-title=20250304100353 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>查找GWorld</figcaption></figure>继续向上看，这里 GWorld 在被赋值之前会先被初始化为 <code>NULL</code>。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100440.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100440.png?size=small" data-sub-html="<h2>20250304100440</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100440.png alt=查找GWordl srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100440.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100440.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100440.png?size=large 2x" data-title=20250304100440 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>查找GWordl</figcaption></figure>因此在 IDA 中搜索字符串 <code>SeamlessTravel FlushLevelStreaming</code>，然后跳转到交叉引用处往上找即可看到GWorld。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101127.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101127.png?size=small" data-sub-html="<h2>20250304101127</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101127.png alt=逆向查找GWorld srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101127.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101127.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101127.png?size=large 2x" data-title=20250304101127 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>逆向查找GWorld</figcaption></figure>然后继续向上查看，可以发现 GWorld 被初始化为 <code>NULL</code>，因此在这里 GWorld 就是 <code>0xB32D8A8</code>。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101240.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101240.png?size=small" data-sub-html="<h2>20250304101240</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101240.png alt=逆向查找GWorld srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101240.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101240.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101240.png?size=large 2x" data-title=20250304101240 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>逆向查找GWorld</figcaption></figure></p><h4 id=gname class=heading-element><span>GName</span>
<a href=#gname class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>UE4 的 <code>GName</code> 在 <strong>UE4.27.2\Engine\Source\Runtime\Core\Private\UObject\UnrealNames.cpp</strong> 中，它是用内存池保存，内存池 <code>FNamePool</code> 的构造函数会初始化一些 Name，例如 <code>None</code>，<code>ByteProperty</code>，<code>IntProperty</code> 等。下面框出的代码作用就是将引擎预定义的硬编码名称（如 <code>EName</code> 枚举中的名称）静态注册到全局名称池中。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101601.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101601.png?size=small" data-sub-html="<h2>20250304101601</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101601.png alt=GName位置 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101601.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101601.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101601.png?size=large 2x" data-title=20250304101601 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>GName位置</figcaption></figure>因此在 IDA 中搜索字符串 <code>ByteProperty</code>，转到交叉引用处就是FNamePool构造函数。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304102913.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304102913.png?size=small" data-sub-html="<h2>20250304102913</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304102913.png alt=逆向查找GName srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304102913.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304102913.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304102913.png?size=large 2x" data-title=20250304102913 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>逆向查找GName</figcaption></figure>然后交叉引用到调用函数处，传入的参数（this 指针）就是 <code>GName</code>，所以这里的 GName 就是 <code>0xB171CC0</code> 。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103232.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103232.png?size=small" data-sub-html="<h2>20250304103232</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103232.png alt=逆向查找GName srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103232.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103232.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103232.png?size=large 2x" data-title=20250304103232 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>逆向查找GName</figcaption></figure></p><h4 id=guobjectarray class=heading-element><span>GUObjectArray</span>
<a href=#guobjectarray class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p><code>GUObjectArray</code> 在 <strong>UE4.27.2\Engine\Source\Runtime\CoreUObject\Private\UObject\UObjectHash.cpp</strong> 中定义。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103433.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103433.png?size=small" data-sub-html="<h2>20250304103433</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103433.png alt=查找GUObjectArray srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103433.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103433.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103433.png?size=large 2x" data-title=20250304103433 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>查找GUObjectArray</figcaption></figure>同样找到引用 GUObjectArray 的地方，采用全局搜索查看哪些地方对于 GUObjectArray 存在引用，同时查看是否存在显著的字符串。这里找的是位于 <strong>UE4.27.2\Engine\Source\Runtime\Launch\Private\LaunchEngineLoop.cpp</strong> 的 <code>int32 FEngineLoop::PreInitPostStartupScreen (const TCHAR* CmdLine)</code> 函数，字符串 <code>CloseDisregardForGC</code> 的下面就是 <code>GUObjectArray</code>。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103722.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103722.png?size=small" data-sub-html="<h2>20250304103722</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103722.png alt=查找GUObjectArray srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103722.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103722.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103722.png?size=large 2x" data-title=20250304103722 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>查找GUObjectArray</figcaption></figure>IDA 找到 <code>CloseDisregardForGC</code> 字符串引用处，这里下面函数传递的参数是 <code>this</code> 指针，由此即可确定 GUObjectArray 是 <code>0xB1B5F98</code>。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304104142.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304104142.png?size=small" data-sub-html="<h2>20250304104142</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304104142.png alt=逆向查找GUObjectArray srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304104142.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304104142.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304104142.png?size=large 2x" data-title=20250304104142 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>逆向查找GUObjectArray</figcaption></figure></p><h3 id=dumpsdk-1 class=heading-element><span>dumpSDK</span>
<a href=#dumpsdk-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>采用工具 <a href="https://github.com/revercc/UE4Dumper?tab=readme-ov-file" target=_blank rel="external nofollow noopener noreferrer">UE4Dumper</a> 和如下命令 dump sdk。注意需要使用 root 权限，不然会报错 <code>Can't find Library: libUE4.so</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>./ue4dumper64 --package com.tencent.ace.match2024 --ptrdec --sdku --gname 0x0B171CC0 --guobj 0x0B1B5F98 --output /data/local/tmp --newue+</span></span></code></pre></td></tr></table></div></div><p>之后就会得到一个 <strong>SDK.txt</strong> 的文件。或者可以使用 <a href=https://github.com/hackcatml/frida-ue4dump target=_blank rel="external nofollow noopener noreferrer">frida-ue4dump</a> 来进行 dump，不过这里不能确定 <code>GUObjectArray</code> 的地址，所以需要手动进行设置，然后才可以成功 dump SDK。然后就可以通过 SDK 来锁定实例对一些属性进行修改。因为 UE 存在反射机制，所以会暴露处相关类和方法的接口，而 SDK 就是这些接口的信息，所以根据这个文件可以对于原程序进行更改。而这里的实现就是通过 frida 来进行处理。</p><h2 id=寻找-actor class=heading-element><span>寻找 Actor</span>
<a href=#%e5%af%bb%e6%89%be-actor class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>后面对于不同 section 的破解都需要涉及游戏世界中的可交互对象，这些对象都是一个个 Actor。所以只有知道这些对象（包括玩家）都是哪些 Actor，才能继续下面的破解。因此这里对于 Actor 的寻找进行说明。通过下面的 frida 代码，我们就可以知道这个游戏中所有 Actor 的名称及其内存地址，而后面就是在解释怎么得到下面的代码。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>let</span> <span class=nx>GWorld_Offset</span> <span class=o>=</span> <span class=mh>0x0B32D8A8</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>GName_Offset</span> <span class=o>=</span> <span class=mh>0x0B171CC0</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>GWorld</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>GName</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>init</span><span class=p>(</span><span class=nx>soName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>module</span> <span class=o>=</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>findModuleByName</span><span class=p>(</span><span class=nx>soName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>module</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>addr</span> <span class=o>=</span> <span class=nx>module</span><span class=p>.</span><span class=nx>base</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>GWorld</span> <span class=o>=</span> <span class=nx>addr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>GWorld_Offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>GName</span> <span class=o>=</span> <span class=nx>addr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>GName_Offset</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`init success`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getNameFromId</span><span class=p>(</span><span class=nx>index</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// FNamePool相关偏移量和步长
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>FNameStride</span> <span class=o>=</span> <span class=mh>0x2</span><span class=p>;</span>                   <span class=c1>// FNameEntry 的步长，每个FNameEntry占用2字节
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>offset_GName_FNamePool</span> <span class=o>=</span> <span class=mh>0x30</span><span class=p>;</span>       <span class=c1>// GName 到 FNamePool 的偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>offset_FNamePool_Blocks</span> <span class=o>=</span> <span class=mh>0x10</span><span class=p>;</span>      <span class=c1>// FNamePool 到 Blocks 的偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// FNameEntry相关偏移量和位
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>offset_FNameEntry_Info</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>          <span class=c1>// FNameEntry 到 Info 的偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>FNameEntry_LenBit</span> <span class=o>=</span> <span class=mi>6</span><span class=p>;</span>               <span class=c1>// FNameEntry 长度位
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>offset_FNameEntry_String</span> <span class=o>=</span> <span class=mh>0x2</span><span class=p>;</span>      <span class=c1>// FNameEntry 到字符串部分的偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// 计算块和偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>Block</span> <span class=o>=</span> <span class=nx>index</span> <span class=o>&gt;&gt;</span> <span class=mi>16</span><span class=p>;</span>                 <span class=c1>// 块索引
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>Offset</span> <span class=o>=</span> <span class=nx>index</span> <span class=o>&amp;</span> <span class=mi>65535</span><span class=p>;</span>              <span class=c1>// 块内偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取FNamePool的起始地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>FNamePool</span> <span class=o>=</span> <span class=nx>GName</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>offset_GName_FNamePool</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取特定块的地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>NamePoolChunk</span> <span class=o>=</span> <span class=nx>FNamePool</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>offset_FNamePool_Blocks</span> <span class=o>+</span> <span class=nx>Block</span> <span class=o>*</span> <span class=mi>8</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 计算FNameEntry的地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>FNameEntry</span> <span class=o>=</span> <span class=nx>NamePoolChunk</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>FNameStride</span> <span class=o>*</span> <span class=nx>Offset</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 读取FNameEntry的Header
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=nx>offset_FNameEntry_Info</span> <span class=o>!==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kd>var</span> <span class=nx>FNameEntryHeader</span> <span class=o>=</span> <span class=nx>FNameEntry</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>offset_FNameEntry_Info</span><span class=p>).</span><span class=nx>readU16</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kd>var</span> <span class=nx>FNameEntryHeader</span> <span class=o>=</span> <span class=nx>FNameEntry</span><span class=p>.</span><span class=nx>readU16</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 捕捉读取异常并返回空字符串
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取字符串地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>str_addr</span> <span class=o>=</span> <span class=nx>FNameEntry</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>offset_FNameEntry_String</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 计算字符串长度和宽度
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>str_length</span> <span class=o>=</span> <span class=nx>FNameEntryHeader</span> <span class=o>&gt;&gt;</span> <span class=nx>FNameEntry_LenBit</span><span class=p>;</span> <span class=c1>// 计算字符串长度
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>wide</span> <span class=o>=</span> <span class=nx>FNameEntryHeader</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>;</span>                       <span class=c1>// 判断字符串是否为宽字符
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// 如果是宽字符，返回 &#34;widestr&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>wide</span><span class=p>)</span> <span class=k>return</span> <span class=s2>&#34;widestr&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 如果字符串长度合理，读取并返回UTF-8字符串
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>str_length</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=nx>str_length</span> <span class=o>&lt;</span> <span class=mi>250</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>str</span> <span class=o>=</span> <span class=nx>str_addr</span><span class=p>.</span><span class=nx>readUtf8String</span><span class=p>(</span><span class=nx>str_length</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>str</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;None&#34;</span><span class=p>;</span> <span class=c1>// 长度不合理，返回 &#34;None&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getActorsAddr</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 固定偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>ULevel_offset</span> <span class=o>=</span> <span class=mh>0x30</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>Actor_offset</span> <span class=o>=</span> <span class=mh>0x98</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>ULevel</span> <span class=o>=</span> <span class=nx>GWorld</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>ULevel_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>Actor</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>actorNum</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=mi>8</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[*] Actor: </span><span class=si>${</span><span class=nx>Actor</span><span class=si>}</span><span class=sb>, Actor_Num: </span><span class=si>${</span><span class=nx>actorNum</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>idx</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>idx</span> <span class=o>&lt;</span> <span class=nx>actorNum</span><span class=p>;</span> <span class=nx>idx</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>actorAddr</span> <span class=o>=</span> <span class=nx>Actor</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>idx</span> <span class=o>*</span> <span class=mh>0x8</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>actorID</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>actorName</span> <span class=o>=</span> <span class=nx>getNameFromId</span><span class=p>(</span><span class=nx>actorID</span><span class=p>);</span>     <span class=c1>//通过地址获取字符串名字
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`actorName: </span><span class=si>${</span><span class=nx>actorName</span><span class=si>}</span><span class=sb>, actorAddr: </span><span class=si>${</span><span class=nx>actorAddr</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>init</span><span class=p>(</span><span class=s2>&#34;libUE4.so&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>getActorsAddr</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>粗略查看上述代码，可以看到获取 Actor 的地址是从 <code>GWorld</code> 开始的；而获取 Actor 的名称，则是根据 Actor 的地址得到 actorID，然后再根据这个 actorID 从 <code>GName</code> 进行寻找，所以对于代码的讲解分为两部分，获取地址和获取名称。</p><h3 id=获取地址 class=heading-element><span>获取地址</span>
<a href=#%e8%8e%b7%e5%8f%96%e5%9c%b0%e5%9d%80 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>由上述代码，存储所有 Actors 的结构就在 ULevel 的结构中，所以我们的流程就是通过得到的 GWorld 找到 ULevel，然后再从 ULevel 中得到存储所有 Actors 的结构。</p><p>由上文的介绍，<code>GWorld</code> 是 Unreal Engine 中的一个全局指针变量，是指向 <code>UWorld</code> 的指针，代表当前的世界实例。所有可以把 GWorld 理解为 UWorld 类，之后就是对于这个类的讲解。</p><h4 id=ulevel_offset class=heading-element><span>ULevel_offset</span>
<a href=#ulevel_offset class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><h5 id=uworld-1 class=heading-element><span>UWorld</span>
<a href=#uworld-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>UWorld 这个类位于 <strong>4.27.2\Engine\Source\Runtime\Engine\Classes\Engine\World.h</strong>。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305111155.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305111155.png?size=small" data-sub-html="<h2>20250305111155</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305111155.png alt=UWorld srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305111155.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305111155.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305111155.png?size=large 2x" data-title=20250305111155 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>UWorld</figcaption></figure>在实际运行环境中 UWorld 的第一个成员就是 <code>ULevel* PersistentLevel</code>，可表示成下面的形式。这里 <code>ENGINE_API</code> 是一个模块导出宏，用于控制 Engine 模块的符号可见性。在 Windows 平台上被定义为 <code>__declspec(dllexport)</code>，表示将类或函数导出为 DLL 的公共符号；而在其他平台为空，这些平台不需要显式导出符号。而 <code>UPROPERTY(Transient)</code> 是 Unreal Engine 的属性修饰符，用于标记一个成员变量为临时变量，避免序列化和网络同步。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>ENGINE_API</span> <span class=n>UWorld</span> <span class=k>final</span> <span class=o>:</span> <span class=k>public</span> <span class=n>UObject</span><span class=p>,</span> <span class=k>public</span> <span class=n>FNetworkNotify</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/** Persistent level containing the world info, default brush and actors spawned during gameplay among other things			*/</span>
</span></span><span class=line><span class=cl>	<span class=n>UPROPERTY</span><span class=p>(</span><span class=n>Transient</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>class</span> <span class=nc>ULevel</span><span class=o>*</span>								<span class=n>PersistentLevel</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>这里 <code>PersistentLevel</code> 是一个指向 <code>ULevel</code> 的指针，表示持久化关卡。它是 UWorld 的核心成员之一，负责管理关卡中的 Actor、光照、BSP 等内容，同时也是是上文代码的 <code>GWorld.add(ULevel_offset).readPointer();</code>。它是 UWorld 类的第一个成员，指向了 ULevel 类的数据，但是代码中却是 <code>let ULevel_offset = 0x30;</code> 的偏移。这是因为 UWorld 存在继承，这里的偏移实际上就是继承类 <code>UObject</code> 和 <code>FNetworkNotify</code> 中成员变量的大小。</p><h5 id=fnetworknotify class=heading-element><span>FNetworkNotify</span>
<a href=#fnetworknotify class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>这里 FNetworkNotify 位于 <strong>4.27.2\Engine\Source\Runtime\Engine\Classes\Engine\NetworkDelegates.h</strong>。它是一个用于网络通知的基类，主要作用是提供网络同步和远程过程调用（RPC）的接口。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305121254.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305121254.png?size=small" data-sub-html="<h2>20250305121254</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305121254.png alt=FNetworkNotify srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305121254.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305121254.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305121254.png?size=large 2x" data-title=20250305121254 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>FNetworkNotify</figcaption></figure>由上图可以看出这个类没有成员变量，所以其可以简化为下面的形式。占据空间的只有虚表指针，也就是只有 8 个字节。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>FNetworkNotify</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint64_t</span> <span class=n>VTable</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div><h5 id=uobject-1 class=heading-element><span>UObject</span>
<a href=#uobject-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>找到位于 <strong>4.27.2\Engine\Source\Runtime\CoreUObject\Public\UObject\Object.h</strong> 的 UObject 类。这里 <code>COREUOBJECT_API</code> 是一个宏，用于控制 模块导出符号，其作用上文的 <code>ENGINE_API</code> 一样。同时它这里没有定义任何成员变量，所以还需要向上查看继承的 UObjectBaseUtility 类。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305121605.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305121605.png?size=small" data-sub-html="<h2>20250305121605</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305121605.png alt=UObject srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305121605.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305121605.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305121605.png?size=large 2x" data-title=20250305121605 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>UObject</figcaption></figure>UObjectBaseUtility 位于 <strong>4.27.2\Engine\Source\Runtime\CoreUObject\Public\UObject\UObjectBaseUtility.h</strong>，它和 UObject 一样没有定义任何成员变量，所以继续向上查看继承的 UObjectBase 类。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305122042.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305122042.png?size=small" data-sub-html="<h2>20250305122042</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305122042.png alt=UObjectBaseUtility srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305122042.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305122042.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305122042.png?size=large 2x" data-title=20250305122042 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>UObjectBaseUtility</figcaption></figure>UObjectBase 位于 <strong>4.27.2\Engine\Source\Runtime\CoreUObject\Public\UObject\UObjectBase.h</strong>。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305122209.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305122209.png?size=small" data-sub-html="<h2>20250305122209</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305122209.png alt=UObjectBase srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305122209.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305122209.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305122209.png?size=large 2x" data-title=20250305122209 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>UObjectBase</figcaption></figure>这个类就是顶级类了，其中也定义了相关的成员变量，可以简化为下面的形式。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>COREUOBJECT_API</span> <span class=n>UObjectBase</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint64_t</span> <span class=n>VTable</span><span class=p>;</span>                                        <span class=c1>//虚表指针，自己添加的
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Flags used to track and report various object states. This needs to be 8 byte aligned on 32-bit
</span></span></span><span class=line><span class=cl><span class=cm>	    platforms to reduce memory waste */</span>
</span></span><span class=line><span class=cl>	<span class=n>EObjectFlags</span>					<span class=n>ObjectFlags</span><span class=p>;</span>            <span class=c1>//对象属性
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Index into GObjectArray...very private. */</span>
</span></span><span class=line><span class=cl>	<span class=n>int32</span>							<span class=n>InternalIndex</span><span class=p>;</span>          <span class=c1>//对象 GUObjectArray 序号
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Class the object belongs to. */</span>
</span></span><span class=line><span class=cl>	<span class=n>UClass</span><span class=o>*</span>							<span class=n>ClassPrivate</span><span class=p>;</span>           <span class=c1>//对象的类
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Name of this object */</span>
</span></span><span class=line><span class=cl>	<span class=n>FName</span>							<span class=n>NamePrivate</span><span class=p>;</span>            <span class=c1>//对象的名字
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Object this object resides in. */</span>
</span></span><span class=line><span class=cl>	<span class=n>UObject</span><span class=o>*</span>						<span class=n>OuterPrivate</span><span class=p>;</span>           <span class=c1>//对象所在UPackage
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>从这个继承关系来看，虽然普遍认为 UObject 是 UE4 中所有对象的基类，但是真正的基类应该是 UObjectBase。不过认为 UObject 是基类也并无道理，因为继承自 UObjectBase 的 UObject 没有新增任何成员。它们的联系如下所示：</p><ul><li><code>UObjectBase</code> 提供了最基础的对象功能，如对象索引（InternalIndex）、类信息（ClassPrivate）、对象标志（ObjectFlags），不过不包含任何实用功能（如反射、序列化）；</li><li><code>UObjectBaseUtility</code> 继承扩展了外部对象引用（OuterPrivate）、对象名称（NamePrivate）、更多对象标志（Flags），它提供了基础的实用功能，但仍未实现完整的对象系统；</li><li><code>UObject</code> 实现了完整的对象系统，包括反射（Reflection）、垃圾回收（Garbage Collection）、序列化（Serialization）、属性系统（Property System），提供了开发者直接使用的接口。</li></ul><p>之后查看这个类的大小，可以看出有很多指针类型，那么就是 8 字节，余下不知道的就是 <code>EObjectFlags</code> 和 <code>FName</code> 类型了。EObjectFlags 位于 <strong>4.27.2\Engine\Source\Runtime\CoreUObject\Public\UObject\ObjectMacros.h</strong>，它是一个枚举类型（enum），在 C++ 底层类型是 uint32，也就是 4 个字节。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305124615.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305124615.png?size=small" data-sub-html="<h2>20250305124615</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305124615.png alt=EObjectFlags srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305124615.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305124615.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305124615.png?size=large 2x" data-title=20250305124615 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>EObjectFlags</figcaption></figure></p><p>然后看看 FName，它位于 <strong>4.27.2\Engine\Source\Runtime\Core\Public\UObject\NameTypes.h</strong>，是一个轻量级的字符串类型，用于表示对象的名称。在这里就可以看出，正是因为 UE 中所有对象都继承自 UObject 这个类，同时这个类又有成员变量 FName 提供名字，所以 UE 的反射系统才能方便知道一个对象的名字、字段、函数参数等信息。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305125139.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305125139.png?size=small" data-sub-html="<h2>20250305125139</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305125139.png alt=FName srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305125139.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305125139.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305125139.png?size=large 2x" data-title=20250305125139 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>FName</figcaption></figure>然后可以提取其中的成员变量转化为下面的形式，这里可以看到它包含三个成员变量，不过其中的 <code>DisplayIndex</code> 由编译条件宏包裹。这里是安卓平台下面的游戏，所以就没有这个成员变量，只有另外的两个存在。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>CORE_API</span> <span class=n>FName</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Index into the Names array (used to find String portion of the string/number pair used for comparison) */</span>
</span></span><span class=line><span class=cl>	<span class=n>FNameEntryId</span>	<span class=n>ComparisonIndex</span><span class=p>;</span>        <span class=c1>//指向 FNamePool中的名称条目
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#if WITH_CASE_PRESERVING_NAME
</span></span></span><span class=line><span class=cl><span class=cp></span>	<span class=cm>/** Index into the Names array (used to find String portion of the string/number pair used for display) */</span>
</span></span><span class=line><span class=cl>	<span class=n>FNameEntryId</span>	<span class=n>DisplayIndex</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#endif </span><span class=c1>// WITH_CASE_PRESERVING_NAME
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Number portion of the string/number pair (stored internally as 1 more than actual, so zero&#39;d memory will be the default, no-instance case) */</span>
</span></span><span class=line><span class=cl>	<span class=n>uint32</span>			<span class=n>Number</span><span class=p>;</span>                 <span class=c1>//用于区分同名对象的编号
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>因此这里的类型就只有 FNameEntryId 不知道了，它和 FName 在同一个文件中被定义。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305130947.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305130947.png?size=small" data-sub-html="<h2>20250305130947</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305130947.png alt=FNameEntryId srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305130947.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305130947.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305130947.png?size=large 2x" data-title=20250305130947 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>FNameEntryId</figcaption></figure>它只有一个成员变量 value，具体如下所示。因此 FNameEntryId 就是一个 4 字节的数据。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>FNameEntryId</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=n>uint32</span> <span class=n>Value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h5 id=获取偏移 class=heading-element><span>获取偏移</span>
<a href=#%e8%8e%b7%e5%8f%96%e5%81%8f%e7%a7%bb class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>由此，知道了所有和 ULevel_offset 获取相关的变量的类型，然后就可以知道这个偏移的计算结果了。首先是由于 ULevel 是第一个成员变量，所以计算的就是继承类 FNetworkNotify 和 UObject 的成员变量大小了。前者没有成员变量，所以只有一个虚表指针，8 个字节。后者则是和 UObjectBase 的成员变量一样，由此首先是虚表指针，8 个字节；之后是 EObjectFlags 和 int32，共 8 个字节；然后 UClass* 和 UObject* 两个类指针，共 16 个字节；最后就是 FName，由于安卓平台只有两个成员变量，所以它是 8 个字节。由此相加 <code>8 + 8 + 8 + 16 + 8 = 0x30</code>，由此得到了在 UWorld 中 ULevel 的偏移。</p><h4 id=actor_offset class=heading-element><span>Actor_offset</span>
<a href=#actor_offset class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><h5 id=ulevel-1 class=heading-element><span>ULevel</span>
<a href=#ulevel-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>找到位于 <strong>4.27.2\Engine\Source\Runtime\Engine\Classes\Engine\Level.h</strong> 的 ULevel 类，<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305152202.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305152202.png?size=small" data-sub-html="<h2>20250305152202</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305152202.png alt=ULevel srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305152202.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305152202.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305152202.png?size=large 2x" data-title=20250305152202 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>ULevel</figcaption></figure>这里关心的就是下面的结构，其中 <code>TArray&lt;AActor*> Actors;</code> 存储了所有的 Actors，它就是我们最后需要的结构。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>ULevel</span> <span class=o>:</span> <span class=k>public</span> <span class=n>UObject</span><span class=p>,</span> <span class=k>public</span> <span class=n>IInterface_AssetUserData</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** URL associated with this level. */</span>
</span></span><span class=line><span class=cl>	<span class=n>FURL</span>					<span class=n>URL</span><span class=p>;</span>                <span class=c1>//存储协议相关配置，以及地图等选项
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Array of all actors in this level, used by FActorIteratorBase and derived classes */</span>
</span></span><span class=line><span class=cl>	<span class=n>TArray</span><span class=o>&lt;</span><span class=n>AActor</span><span class=o>*&gt;</span> <span class=n>Actors</span><span class=p>;</span>                     <span class=c1>//存储所有Actors
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>父类位于 <strong>4.27.2\Engine\Source\Runtime\Engine\Classes\Interfaces\Interface_AssetUserData.h</strong>。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305160143.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305160143.png?size=small" data-sub-html="<h2>20250305160143</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305160143.png alt=IInterface_AssetUserData srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305160143.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305160143.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305160143.png?size=large 2x" data-title=20250305160143 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>IInterface_AssetUserData</figcaption></figure>它没有成员变量，所以结构和上文 FNetworkNotify 一样，都只有一个虚表指针。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>IInterface_AssetUserData</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint64_t</span> <span class=n>VTable</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>然后父类 UObject 和上文也一样，其占据空间为 0x28。</p><h5 id=furl class=heading-element><span>FURL</span>
<a href=#furl class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>位于 <strong>4.27.2\Engine\Source\Runtime\Engine\Classes\Engine\EngineBaseTypes.h</strong>。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305170253.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305170253.png?size=small" data-sub-html="<h2>20250305170253</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305170253.png alt=FURL srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305170253.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305170253.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305170253.png?size=large 2x" data-title=20250305170253 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>FURL</figcaption></figure>然后把成员变量提取出来可以得到下面的结构。这里 <code>UPROPERTY</code> 是一个非常重要的宏，用于标记类的成员变量为属性（Property）。它的作用是让引擎的反射系统（Reflection System）能够识别和管理这些变量，从而实现序列化、网络同步、编辑器支持等功能。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>ENGINE_API</span> <span class=n>FURL</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Protocol, i.e. &#34;unreal&#34; or &#34;http&#34;.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>UPROPERTY</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>FString</span> <span class=n>Protocol</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Optional hostname, i.e. &#34;204.157.115.40&#34; or &#34;unreal.epicgames.com&#34;, blank
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// if local.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>UPROPERTY</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>FString</span> <span class=n>Host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Optional host port.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>UPROPERTY</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>int32</span> <span class=n>Port</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>UPROPERTY</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>int32</span> <span class=n>Valid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Map name, i.e. &#34;SkyCity&#34;, default is &#34;Entry&#34;.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>UPROPERTY</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>FString</span> <span class=n>Map</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Optional place to download Map if client does not possess it
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>UPROPERTY</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>FString</span> <span class=n>RedirectURL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Options.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>UPROPERTY</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>TArray</span><span class=o>&lt;</span><span class=n>FString</span><span class=o>&gt;</span> <span class=n>Op</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Portal to enter through, default is &#34;&#34;.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>UPROPERTY</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>FString</span> <span class=n>Portal</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>可以看出上面的结构有两个类型是未知的，<code>FString</code> 和 <code>TArray</code>，因此下面就是对于这两个类型进行研究。</p><h5 id=fstring class=heading-element><span>FString</span>
<a href=#fstring class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>FString 位于 <strong>4.27.2\Engine\Source\Runtime\Core\Public\Containers\UnrealString.h</strong>，它是一个动态大小的字符串类，用于存储和操作字符串数据。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305182228.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305182228.png?size=small" data-sub-html="<h2>20250305182228</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305182228.png alt=FString srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305182228.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305182228.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305182228.png?size=large 2x" data-title=20250305182228 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>FString</figcaption></figure>由上图可以看出 FString 只有一个成员变量 <code>Data</code>，提取的结果如下所示。然后从下面的代码可以看到 FString 只有一个 <code>TArray&lt;TCHAR></code> 类型的成员变量，所以其大小和 TArray 类的大小是一样的。同时可以知道可见字符串相关数据存储在 TArray 容器中，容器类型是 TCHAR，而 TCHAR 类型就是 wchar_t 类型。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>CORE_API</span> <span class=n>FString</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=cm>/** Array holding the character data */</span>
</span></span><span class=line><span class=cl>	<span class=k>typedef</span> <span class=n>TArray</span><span class=o>&lt;</span><span class=n>TCHAR</span><span class=o>&gt;</span> <span class=n>DataType</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>DataType</span> <span class=n>Data</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h5 id=tarray class=heading-element><span>TArray</span>
<a href=#tarray class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>TArray 位于 <strong>4.27.2\Engine\Source\Runtime\Core\Public\Containers\Array.h</strong>。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305184237.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305184237.png?size=small" data-sub-html="<h2>20250305184237</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305184237.png alt=TArray srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305184237.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305184237.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305184237.png?size=large 2x" data-title=20250305184237 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>TArray</figcaption></figure>TArray 是一个动态数组模板类，提取出来的关键结构如下所示。这里 ElementAllocatorType 是 TArray 的内存分配器类型，其具体类型由模板参数 Allocator 决定。而 SizeType 是 TArray 的元素计数和索引类型，其类型由分配器的 SizeType 决定。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>SizeType</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TArray</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>typedef</span> <span class=k>typename</span> <span class=n>TChooseClass</span><span class=o>&lt;</span>
</span></span><span class=line><span class=cl>		<span class=n>Allocator</span><span class=o>::</span><span class=n>NeedsElementType</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=k>typename</span> <span class=n>Allocator</span><span class=o>::</span><span class=k>template</span> <span class=n>ForElementType</span><span class=o>&lt;</span><span class=n>ElementType</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=k>typename</span> <span class=n>Allocator</span><span class=o>::</span><span class=n>ForAnyElementType</span>
</span></span><span class=line><span class=cl>	<span class=o>&gt;::</span><span class=n>Result</span> <span class=n>ElementAllocatorType</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>protected</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=n>ElementAllocatorType</span> <span class=n>AllocatorInstance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>SizeType</span>             <span class=n>ArrayNum</span><span class=p>;</span>          <span class=c1>//记录当前数组内元素的实际个数
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>SizeType</span>             <span class=n>ArrayMax</span><span class=p>;</span>          <span class=c1>//记录当前数组最大可容纳元素的数量
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>这里可以从 <a href=https://santa.wang/ue-container-tarray-analysis/ target=_blank rel="external nofollow noopener noreferrer">UE TArray 源码剖析及分摊时间复杂度推导</a> 文章获取 ElementAllocatorType 和 SizeType 类型的大小，它们的大小分别为 8 字节和 4 字节。因此 TArray 的大小为 <code>8 + 4 + 4 = 16</code> 字节，FString 和 TArray 的大小一样，也是 16 字节。</p><p>需要注意，因为分析的类型为 <code>TArray&lt;TCHAR></code>，<code>TArray&lt;FString></code>， 所以认为 AllocatorInstance 为 8 字节。这是将其视为了默认分配器（FDefaultAllocator），它通常仅包含一个数据指针，与后面的元素类型无关，因此就是 8 字节。而如果使用其他特殊分配器，其内部可能会包含额外字段了，会导致 AllocatorInstance 的大小增加。</p><h5 id=获取偏移-1 class=heading-element><span>获取偏移</span>
<a href=#%e8%8e%b7%e5%8f%96%e5%81%8f%e7%a7%bb-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>知道了 FString 和 TArray 都是 16 字节大小后，可以计算 FURL 的大小为 <code>16 * 6 + 4 + 4 = 0x68</code>，然后加上父类的偏移 <code>0x98 + 0x28 + 8 = 0x98 </code>，因此得到了 ULevel 中 <code>TArray&lt;AActor*> Actors;</code> 的偏移为 0x98。</p><h4 id=获取内存地址 class=heading-element><span>获取内存地址</span>
<a href=#%e8%8e%b7%e5%8f%96%e5%86%85%e5%ad%98%e5%9c%b0%e5%9d%80 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>上文可以找到 Actors 数组的内存地址，也就是 <code>TArray&lt;AActor*> Actors;</code> 的地址。之后就是看 TArray 的结构了，它存储了 AllocatorInstance，ArrayNum，ArrayMax 三个成员变量，第一个就是分配器，它负责动态分配/释放存储数组元素的连续内存块。这里指默认分配器，它内部通常包含一个指向元素数组的指针（ <code>void* Data</code> 或类似成员），记录实际内存块的地址。</p><p>因此这里的 AllocatorInstance 就是一个指针，指向了存储 AActor 对象指针的连续内存块。所以在上面的代码中，使用了 <code>Actor = ULevel.add(Actor_offset).readPointer();</code> 来获取 Actors 数组中第一个元素的地址。然后这里存储的元素类型为 <code>AActor*</code> 类型，可以使用 <code>actorAddr = Actor.add(idx * 0x8).readPointer();</code> 获取后面的对象地址，因为 <code>AActor*</code> 是一个指针，占据 8 个字节。</p><p>上述过程可以使用 <code>console.log(hexdump(Actor, { offset: 0, length: 0x50, header: true, ansi: true }));</code> 来查看真实内存信息，可以发现其存储的就是连续的指针。<figure><a class=lightgallery href="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250306152608.png?size=large" data-thumbnail="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250306152608.png?size=small" data-sub-html="<h2>20250306152608</h2>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250306152608.png alt=hook结果 srcset="https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250306152608.png?size=small, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250306152608.png?size=medium 1.5x, https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250306152608.png?size=large 2x" data-title=20250306152608 style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>hook结果</figcaption></figure></p><p>之后也通过 <code>actorNum = ULevel.add(Actor_offset).add(8).readU32();</code> 获取了 Actor 数组中对象的个数，便于后续循环获取每一个对象的地址和名称。</p><h2 id=参考资料 class=heading-element><span>参考资料</span>
<a href=#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><div class="details admonition quote open disabled"><div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-quote-right" aria-hidden=true></i>参考</div><div class=details-content><div class=admonition-content><p><ul><li><a href=https://book.douban.com/subject/27033749/ target=_blank rel="external nofollow noopener noreferrer">大象无形 虚幻引擎程序设计浅析</a></li><li><a href=https://www.zhihu.com/column/c_1535217822816309248 target=_blank rel="external nofollow noopener noreferrer">《大象无形：虚幻引擎程序设计浅析》 笔记</a></li><li><a href="https://www.bilibili.com/video/BV14CA5eDEbw/?spm_id_from=333.1387.collection.video_card.click" target=_blank rel="external nofollow noopener noreferrer">UE 相关视频</a></li><li><a href="https://www.bilibili.com/video/BV1se4y1D7Hu/?spm_id_from=333.1387.collection.video_card.click" target=_blank rel="external nofollow noopener noreferrer">UE5初级源码解析</a></li><li><a href=https://blog.csdn.net/qq_23091255/article/details/144704710 target=_blank rel="external nofollow noopener noreferrer">虚幻引擎是什么？</a></li><li><a href=https://bbs.kanxue.com/thread-282857.htm target=_blank rel="external nofollow noopener noreferrer">UE4.27SDK-Dump</a></li></ul></div></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2025-03-05 19:41:35">更新于 2025.3.5&nbsp;
<a class=git-hash href=https://github.com/czTangt/blog.git/commit/a647e37b02781894214fa7f12784f91508633441 rel="external nofollow noopener noreferrer" target=_blank title="commit by czTangt(cz.tangt@gmail.com) a647e37b02781894214fa7f12784f91508633441: add find actor_offset to 2024TententGameSec"><i class="fa-solid fa-hashtag fa-fw" aria-hidden=true></i>a647e37</a></span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href="https://github.com/czTangt/blog.git/blob/main/content/posts%5candroid%5c2024_Tencent_GameSec_Prelim.md?plain=1" title=查看源码 target=_blank rel="external nofollow noopener noreferrer" class=link-to-source>查看源码</a></span><span><a href=https://github.com/czTangt/blog.git/edit/main/content/posts%5candroid%5c2024_Tencent_GameSec_Prelim.md title=编辑此页 target=_blank rel="external nofollow noopener noreferrer" class=link-to-edit>编辑此页</a></span><span><a href="https://github.com/czTangt/blog.git/issues/new?title=[BUG]%202024%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B&amp;body=%7cField%7cValue%7c%0A%7c-%7c-%7c%0A%7cTitle%7c2024%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B%7c%0A%7cURL%7chttps://czTangt.github.io/blog/posts/android/2024-tencent-gamesec-prelim/%7c%0A%7cFilename%7chttps://github.com/czTangt/blog.git/blob/main/content/posts%5candroid%5c2024_Tencent_GameSec_Prelim.md?plain=1%7c" title=报告问题 target=_blank rel="external nofollow noopener noreferrer" class=link-to-report>报告问题</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 X" data-sharer=twitter data-url=https://czTangt.github.io/blog/posts/android/2024-tencent-gamesec-prelim/ data-title=2024腾讯游戏安全竞赛初赛 data-hashtags=android,game><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://czTangt.github.io/blog/posts/android/2024-tencent-gamesec-prelim/ data-hashtag=android><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://czTangt.github.io/blog/posts/android/2024-tencent-gamesec-prelim/ data-title=2024腾讯游戏安全竞赛初赛><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/blog/tags/android/ class=post-tag title="标签 - Android">Android</a><a href=/blog/tags/game/ class=post-tag title="标签 - Game">Game</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/blog/>主页</a></span></section></div><div class=post-nav><a href=/blog/posts/android/shell/ class=post-nav-item rel=prev title=Shell><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Shell</a></div></div></article><aside class=toc id=toc-auto aria-label=目录><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered order-1">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.136.5"><img class=hugo-icon src=/blog/images/hugo.min.svg alt="Hugo logo"> Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.3.17-30a67c4b"><img class=fixit-icon src=/blog/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright order-2" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2024 - 2025</span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div></div><a href=https://github.com/czTangt/blog title="View source on GitHub" target=_blank rel="external nofollow" class="github-corner left d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true" width="56" height="56"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><noscript><div class=noscript-warning>该网站在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/blog/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=preload href=/blog/lib/katex/katex.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/blog/lib/katex/katex.min.css></noscript><link rel=stylesheet href=/blog/lib/cookieconsent/cookieconsent.min.css><script src=/blog/lib/autocomplete/autocomplete.min.js defer></script><script src=/blog/lib/fuse/fuse.min.js defer></script><script src=/blog/lib/lightgallery/lightgallery.min.js defer></script><script src=/blog/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/blog/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/blog/lib/sharer/sharer.min.js async defer></script><script src=/blog/lib/katex/katex.min.js defer></script><script src=/blog/lib/katex/auto-render.min.js defer></script><script src=/blog/lib/katex/mhchem.min.js defer></script><script src=/blog/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/blog/js/codeblock.js defer></script><script src=https://libs.baidu.com/jquery/2.1.4/jquery.min.js defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:10},comment:{enable:!1},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/blog/search.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!1},version:"v0.3.17-30a67c4b"}</script><script src=/blog/js/theme.min.js defer></script></body></html>