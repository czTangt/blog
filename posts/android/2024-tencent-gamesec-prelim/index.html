<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>2024腾讯游戏安全竞赛初赛 - czTang</title><meta name=author content="czTang"><meta name=description content="记录一下对于2024腾讯游戏安全竞赛安卓赛道的复现。
"><meta name=keywords content='android,game'><meta itemprop=name content="2024腾讯游戏安全竞赛初赛"><meta itemprop=description content="记录一下对于2024腾讯游戏安全竞赛安卓赛道的复现。"><meta itemprop=datePublished content="2025-03-03T18:55:55+08:00"><meta itemprop=dateModified content="2025-07-13T13:35:57+08:00"><meta itemprop=wordCount content="31596"><meta itemprop=keywords content="Android,Game"><meta property="og:url" content="https://czTangt.github.io/blog/posts/android/2024-tencent-gamesec-prelim/"><meta property="og:site_name" content="czTang"><meta property="og:title" content="2024腾讯游戏安全竞赛初赛"><meta property="og:description" content="记录一下对于2024腾讯游戏安全竞赛安卓赛道的复现。"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-03T18:55:55+08:00"><meta property="article:modified_time" content="2025-07-13T13:35:57+08:00"><meta property="article:tag" content="Android"><meta property="article:tag" content="Game"><meta name=twitter:card content="summary"><meta name=twitter:title content="2024腾讯游戏安全竞赛初赛"><meta name=twitter:description content="记录一下对于2024腾讯游戏安全竞赛安卓赛道的复现。"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/file/202410312135963.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical type=text/html href=https://czTangt.github.io/blog/posts/android/2024-tencent-gamesec-prelim/ title="2024腾讯游戏安全竞赛初赛 - czTang"><link rel=prev type=text/html href=https://czTangt.github.io/blog/posts/android/shell/ title=Shell><link rel=next type=text/html href=https://czTangt.github.io/blog/posts/android/2024-tencent-gamesec-final/ title=2024腾讯游戏安全竞赛决赛><link rel=stylesheet href=/blog/css/config.min.css><link rel=stylesheet href=/blog/css/style.min.css><link rel=preload href=/blog/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/blog/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/blog/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/blog/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"2024腾讯游戏安全竞赛初赛","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/czTangt.github.io\/blog\/posts\/android\/2024-tencent-gamesec-prelim\/"},"genre":"posts","keywords":"android, game","wordcount":31596,"url":"https:\/\/czTangt.github.io\/blog\/posts\/android\/2024-tencent-gamesec-prelim\/","datePublished":"2025-03-03T18:55:55+08:00","dateModified":"2025-07-13T13:35:57+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"czTang"},"description":""}</script><script src=/blog/js/head/color-scheme.min.js></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=left><div class=header-title><a href=/blog/ title=czTang><span class=header-title-pre><i class='fa fa-coffee'>&nbsp</i></span><span class=header-title-text>czTang</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/blog/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 归档</a></li><li class=menu-item><a class=menu-link href=/blog/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/blog/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/blog/about/><i class="fa-solid fa-user fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/blog/ title=czTang><span class=header-title-pre><i class='fa fa-coffee'>&nbsp</i></span><span class=header-title-text>czTang</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/blog/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 归档</a></li><li class=menu-item><a class=menu-link href=/blog/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/blog/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/blog/about/><i class="fa-solid fa-user fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=fi-container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=合集><div class="details collection-details open"><div class="details-summary collection-summary"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i>
<span class=collection-name title=合集>Game</span>
<span class=collection-count>3</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content collection-content"><nav><ul class=collection-list><li class=collection-item><span class=active title=2024腾讯游戏安全竞赛初赛>2024腾讯游戏安全竞赛初赛</span></li><li class=collection-item><a href=/blog/posts/android/2024-tencent-gamesec-final/ title=2024腾讯游戏安全竞赛决赛>2024腾讯游戏安全竞赛决赛</a></li><li class=collection-item><a href=/blog/posts/android/ue-structure/ title="UE 结构分析">UE 结构分析</a></li></ul><div class=collection-nav-simple><i class="fa-solid fa-angle-left fa-fw collection-nav-item text-secondary" aria-hidden=true></i><span class=text-secondary>1/3</span><a href=/blog/posts/android/2024-tencent-gamesec-final/ class=collection-nav-item rel=next title=2024腾讯游戏安全竞赛决赛><i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></nav></div></div></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>2024腾讯游戏安全竞赛初赛</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/czTangt title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img class=avatar src=/blog/images/avatar.jpg alt=czTang height=16 width=16>&nbsp;czTang</a></span><span class=post-included-in>&nbsp;收录于 <a href=/blog/categories/android/ class=post-category title="分类 - Android"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Android</a> 和 <a href=/blog/collections/game/ class=post-collection title="合集 - Game"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> Game</a></span></div><div class=post-meta-line><span title="发布于 2025-03-03 18:55:55"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2025.3.3>2025.3.3</time></span>&nbsp;<span title="更新于 2025-07-13 13:35:57"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden=true></i><time datetime=2025.7.13>2025.7.13</time></span>&nbsp;<span title="31596 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 31600 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 64 分钟</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#ue-基础知识>UE 基础知识</a><ul><li><a href=#相关概念>相关概念</a><ul><li><a href=#蓝图>蓝图</a></li><li><a href=#常见基类>常见基类</a><ul><li><a href=#uobject>Uobject</a></li><li><a href=#actor>Actor</a></li><li><a href=#pawn>Pawn</a></li><li><a href=#character>Character</a></li><li><a href=#controller>Controller</a></li><li><a href=#game-mode>Game Mode</a></li></ul></li></ul></li><li><a href=#相关结构>相关结构</a><ul><li><a href=#uengine>UEngine</a></li><li><a href=#ugameinstance>UGameInstance</a></li><li><a href=#fworldcontent>FWorldContent</a></li><li><a href=#uworld>UWorld</a></li><li><a href=#ulevel>ULevel</a></li></ul></li><li><a href=#逆向关键结构>逆向关键结构</a></li></ul></li><li><a href=#dumpsdk>dumpSDK</a><ul><li><a href=#确定-ue-版本>确定 UE 版本</a></li><li><a href=#查找关键结构>查找关键结构</a><ul><li><a href=#gworld>GWorld</a></li><li><a href=#gname>GName</a></li><li><a href=#guobjectarray>GUObjectArray</a></li></ul></li><li><a href=#dumpsdk-1>dumpSDK</a></li></ul></li><li><a href=#寻找-actor>寻找 Actor</a><ul><li><a href=#获取地址>获取地址</a><ul><li><a href=#ulevel_offset>ULevel_offset</a><ul><li><a href=#uworld-1>UWorld</a></li><li><a href=#fnetworknotify>FNetworkNotify</a></li><li><a href=#uobject-1>UObject</a></li><li><a href=#获取偏移>获取偏移</a></li></ul></li><li><a href=#actor_offset>Actor_offset</a><ul><li><a href=#ulevel-1>ULevel</a></li><li><a href=#furl>FURL</a></li><li><a href=#fstring>FString</a></li><li><a href=#tarray>TArray</a></li><li><a href=#获取偏移-1>获取偏移</a></li></ul></li><li><a href=#获取内存地址>获取内存地址</a></li></ul></li><li><a href=#获取名称>获取名称</a><ul><li><a href=#获取-actorid>获取 actorID</a></li><li><a href=#解析-tostring>解析 ToString</a><ul><li><a href=#getdisplaynameentry>GetDisplayNameEntry</a><ul><li><a href=#getnamepool>GetNamePool</a></li><li><a href=#getdisplayindex>GetDisplayIndex</a></li><li><a href=#resolve>Resolve</a></li></ul></li><li><a href=#getplainnamestring>GetPlainNameString</a><ul><li><a href=#fnameentry>FNameEntry</a></li><li><a href=#fnameentryheader>FNameEntryHeader</a></li></ul></li><li><a href=#总结>总结</a></li></ul></li><li><a href=#getnamefromid>getNameFromId</a><ul><li><a href=#得到-fnameentry>得到 FNameEntry</a></li><li><a href=#获得字符串名字>获得字符串名字</a></li></ul></li></ul></li><li><a href=#获取坐标>获取坐标</a><ul><li><a href=#解析函数>解析函数</a><ul><li><a href=#getactorlocation>GetActorLocation</a></li><li><a href=#getcomponenttransform>GetComponentTransform</a></li><li><a href=#getlocation>GetLocation</a></li></ul></li><li><a href=#变量获取坐标>变量获取坐标</a><ul><li><a href=#rootcomponent>RootComponent</a></li><li><a href=#componenttoworld>ComponentToWorld</a></li><li><a href=#translation>Translation</a></li><li><a href=#获取坐标-1>获取坐标</a></li></ul></li><li><a href=#函数获取坐标>函数获取坐标</a></li></ul></li></ul></li><li><a href=#section0>Section0</a><ul><li><a href=#修改血量>修改血量</a></li><li><a href=#实现瞬移>实现瞬移</a></li><li><a href=#实现穿墙>实现穿墙</a><ul><li><a href=#查看碰撞状态>查看碰撞状态</a></li><li><a href=#修改碰撞状态>修改碰撞状态</a></li></ul></li><li><a href=#摧毁墙体>摧毁墙体</a></li><li><a href=#消除碰撞>消除碰撞</a></li><li><a href=#消除扣血>消除扣血</a></li></ul></li><li><a href=#section1>Section1</a><ul><li><a href=#获取隐藏状态>获取隐藏状态</a></li><li><a href=#设置隐藏状态>设置隐藏状态</a></li></ul></li><li><a href=#section2>Section2</a><ul><li><a href=#初步尝试>初步尝试</a></li><li><a href=#获取碰撞状态>获取碰撞状态</a></li><li><a href=#修改碰撞状态-1>修改碰撞状态</a></li></ul></li><li><a href=#section3>Section3</a><ul><li><a href=#获取-actor>获取 Actor</a></li><li><a href=#获取类名>获取类名</a></li><li><a href=#破解-flag>破解 flag</a></li></ul></li><li><a href=#最终结果>最终结果</a></li><li><a href=#参考资料>参考资料</a></li></ul></nav></div></div><div class=content id=content><p>记录一下对于2024腾讯游戏安全竞赛安卓赛道的复现。</p><h2 class=heading-element id=ue-基础知识><span>UE 基础知识</span>
<a href=#ue-%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>在进行逆向前，首先需要知道一些 UE 的基本知识，不然后面会越来越混乱。这里可以从 <a href=https://blog.csdn.net/qq_23091255/article/details/144704710 target=_blank rel="external nofollow noopener noreferrer">虚幻引擎是什么</a> 这篇文章了解到什么是虚幻引擎。同时这篇文章也罗列了 UE 结构图，可以从这些继承关系图中查看 UE 相关的重要结构，下面就是对于其中的重要结构和一些概念进行讲解。</p><h3 class=heading-element id=相关概念><span>相关概念</span>
<a href=#%e7%9b%b8%e5%85%b3%e6%a6%82%e5%bf%b5 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h4 class=heading-element id=蓝图><span>蓝图</span>
<a href=#%e8%93%9d%e5%9b%be class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>虚幻引擎中的 <strong>蓝图可视化脚本</strong> 系统是一类完整的游戏性脚本系统，此系统的基础概念是使用基于节点的界面在虚幻编辑器中创建游戏性元素。它基于节点的可视化编程工具，通过逻辑节点图实现游戏逻辑，无需传统代码编写。</p><h4 class=heading-element id=常见基类><span>常见基类</span>
<a href=#%e5%b8%b8%e8%a7%81%e5%9f%ba%e7%b1%bb class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><h5 class=heading-element id=uobject><span>Uobject</span>
<a href=#uobject class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p><strong>UObject</strong> 是虚幻引擎中的核心基础类，大部分其他游戏对象和资源类都直接或间接地继承自它。它作为虚幻引擎的基石，提供了多项关键功能，包括内存管理、序列化、反射、垃圾回收以及元数据支持。在虚幻引擎中，UObject 类的实例通常被称为 <strong>对象</strong>，它们构成了游戏世界及其相关资源的基本单元。它的作用如下：</p><ul><li><strong>内存管理</strong>：UObject 提供了强大的内存管理机制，确保在创建和销毁对象时正确分配和释放内存。它引入了一套自动化的内存清理系统，使得对象可以在不再被引用时自动释放所占用的资源，自动进行垃圾回收，从而有效防止内存泄漏。这种机制不仅简化了开发者的任务，还提高了应用的稳定性和性能。</li><li><strong>序列化与反序列化</strong>：UObject 支持将对象的状态保存到磁盘文件（如关卡、材质、模型等资源），并在需要时从这些文件中恢复。这一特性使得虚幻引擎能够高效地加载和保存游戏内容，确保游戏状态可以持久化，并且可以在不同的会话之间保持一致。此外，序列化能力也使得跨平台的数据交换变得更加简单。</li><li><strong>反射</strong>：UObject 实现了反射机制，允许程序在运行时动态地检查和操作对象的结构和行为。尽管 C++ 本身并不具备内置的反射功能，但虚幻引擎通过 UObject 提供了这一强大特性。开发者可以通过反射访问对象的属性和方法，这对于编辑器功能（如属性面板、蓝图编辑）和运行时调试非常有用。反射机制还为自动化工具和脚本提供了便利，增强了开发效率。</li></ul><h5 class=heading-element id=actor><span>Actor</span>
<a href=#actor class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>Actor 指 <strong>AActor</strong> 基类，它是一个核心类，作为游戏世界内所有可交互对象的基础。任何可以在关卡中放置或动态生成的对象，几乎都是从 AActor 类派生而来。这包括但不限于角色、道具、特效、静态和动态物体等。它作为基类，为所有继承自它的类提供了一套通用的功能和接口。它不仅代表了游戏中可见的实体，还包含了控制这些实体行为的逻辑。每个 AActor 都可以拥有多个组件（如渲染组件、碰撞组件、音频组件等），这些组件赋予 AActor 特定的行为和特性。通过组合不同的组件，开发者可以构建出复杂且功能丰富的游戏元素。Actor 最主要的能力就是 <strong>能被挂载组件</strong>，只有需要挂载组件时，才应该继承自 Actor 类。</p><p>在虚幻引擎中，所有的 AActor 实例都由 <strong>ULevel</strong> 类管理，存储在一个名为 <strong>Actors</strong> 的成员变量中，该成员是一个 TArray 容器（<code>TArray&lt;AActor*> Actors;</code>），包含着当前关卡中所有的 AActor 对象。那么就可以通过遍历这个数组来访问和操作关卡内的所有 AActor。此外，虚幻引擎还提供了多种工具和函数，使得查找特定类型的 AActor 或根据条件筛选 AActor 变得更加容易。例如，可以使用 <code>GetAllActorsOfClass</code> 函数来获取指定类的所有实例，或者使用 <code>TActorIterator</code> 来遍历符合特定条件的 AActor。</p><h5 class=heading-element id=pawn><span>Pawn</span>
<a href=#pawn class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p><strong>APawn</strong> 派生自 AActor，它作为玩家或AI控制的代理实体（如角色、载具）。它代表国际象棋中的棋子，提供了被 <strong>操作</strong> 的特性。它能被后面要提到的 <strong>Controller</strong> 所操纵。</p><h5 class=heading-element id=character><span>Character</span>
<a href=#character class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p><strong>ACharacter</strong> 派生自 APawn，它提供了一个特殊组件：<strong>Character Movement</strong>。这个组件提供了一个基础的，基于胶囊体的角色移动功能。包括移动和跳跃，还能扩展出蹲伏和爬行等。所以如果游戏角色是人类的话，特别适合使用 Character 类。简单而言，对于需要移动的角色，都适用于 Character 类的逻辑。</p><h5 class=heading-element id=controller><span>Controller</span>
<a href=#controller class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p><strong>AController</strong> 是基类，Controller 是用来操控 Pawn/Character 的人。可以把它看作是下棋的棋手，或者提线木偶的操作者。它既可以是玩家，比如 <strong>Player Controller</strong>，通过键盘或者手柄输入来操作游戏角色，也可以是电脑 AI，比如 <strong>AI Controller</strong> 来操作游戏中的 NPC 和怪物等角色。它通过 Possess 来接管并控制一个角色，然后通过 UnPossess 来结束接管一个角色。</p><h5 class=heading-element id=game-mode><span>Game Mode</span>
<a href=#game-mode class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>这里指 <strong>AGameModeBase</strong> 基类，它是游戏规则与流程管理者，定义了游戏是如何被执行的，游戏规则，游戏流程以及其他方面的内容。它仅在服务端存在，客户端无法直接访问。核心职责就是定义玩家加入流程（如重生规则、队伍分配）；设置默认 Pawn 类、PlayerController 类、HUD 类；实现胜利/失败条件判定逻辑。</p><h3 class=heading-element id=相关结构><span>相关结构</span>
<a href=#%e7%9b%b8%e5%85%b3%e7%bb%93%e6%9e%84 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h4 class=heading-element id=uengine><span>UEngine</span>
<a href=#uengine class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p><strong>UEngine</strong> 作为虚幻引擎的基石，以抽象基类的形式通过 <code>UCLASS(abstract)</code> 宏定义，承载着引擎运行时全局状态管理的核心职责。其派生类体系严格遵循环境隔离原则，针对游戏运行时与编辑器环境分别派生出 <strong>UGameEngine</strong> 与 <strong>UEditorEngine</strong> 两个子类。这两个子类在内存管理、对象生命周期和系统交互层面存在显著差异，共同构建起引擎的多环境适应能力。</p><ul><li>UGameEngine：当引擎以独立游戏模式运行时，<strong>UGameEngine</strong> 将成为主导实例。此子类的核心使命是维护一个完整且封闭的游戏会话环境。在引擎初始化阶段（通常通过 <code>UGameEngine::Init()</code> 方法触发），其实例会创建唯一的 <code>UGameInstance</code> 对象。该对象作为游戏会话的根容器，不仅承载玩家控制器、在线会话接口、关卡流送系统等全局组件，还通过 <code>FWorldContext</code> 机制管理游戏世界的上下文信息。例如，当游戏支持分屏合作或多窗口渲染时，每个视口会关联独立的 FWorldContext，但这些上下文最终仍由 UGameEngine 统一协调。</li><li>UEditorEngine：当引擎运行于编辑器模式时，<strong>UEditorEngine</strong> 将取代其基类成为主导实例。这一子类展现出高度复杂的双重特性：既要作为资源编辑的管理平台，又要承担游戏逻辑的实时预览功能。其内部通过 <code>FPlayInEditorSessionInfo</code> 等专用结构体实现角色切换，使得开发者能在同一进程中无缝切换编辑态与运行态。</li></ul><h4 class=heading-element id=ugameinstance><span>UGameInstance</span>
<a href=#ugameinstance class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p><code>UGameInstance</code> 在 Unreal Engine 中扮演着非常重要的角色，它是一个运行游戏的高级管理器，负责存储和管理整个游戏会话期间的状态和数据。</p><ul><li>生命周期管理：<code>UGameInstance</code> 的实例通常在游戏启动时创建，并在整个游戏会话期间持续存在，直到游戏结束。在编辑器模式下，它的生命周期从编辑器打开开始，到编辑器关闭结束。</li><li>存储游戏信息：<code>UGameInstance</code> 保存了一个指向 <code>FWorldContext</code> 的指针。<code>FWorldContext</code> 是一个包含当前世界（<code>UWorld</code>）上下文信息的结构体，它允许 <code>UGameInstance</code> 访问和管理当前游戏世界的状态。同时它还存储了游戏中所有的本地玩家（<code>Local Player</code>）、游戏会话（<code>Game Session</code>）等信息。这些信息对于游戏的运行至关重要，需要在整个游戏会话中持续跟踪和管理。</li><li>在游戏过程中，当玩家从一个 Level 切换到另一个 Level 时，当前 Level 的数据通常会被释放，包括管理该 Level 的 <code>UWorld</code> 对象。由于 <code>UGameInstance</code> 的生命周期不依赖于单个 Level，它非常适合用于存储那些需要跨 Level 持久存在或独立于 Level 的数据和功能。</li></ul><h4 class=heading-element id=fworldcontent><span>FWorldContent</span>
<a href=#fworldcontent class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p><code>FWorldContext</code> 是一个核心类，用于管理游戏世界（<code>UWorld</code>）的生命周期和上下文。</p><ul><li>在 UE4 中，特别是在开发过程中，可能会同时存在多个世界。<code>FWorldContext</code> 提供了一种机制来管理和跟踪这些世界的状态。与许多其他 UE4 类不同，<code>FWorldContext</code> 类型以 F 开头，表名它不是从 <code>UObject</code> 或 <code>AActor</code> 派生的。这意味着它不遵循UE4的垃圾回收机制，并且没有 <code>Serialize</code> 和 <code>Deserialize</code> 函数，因此它通常用于管理那些不通过 UE4 的序列化机制存储的数据。</li><li><code>FWorldContext</code> 是 UEngine 用来管理世界生成、销毁、切换的类。它包含对当前世界（<code>UWorld* ThisCurrentWorld</code>）的引用和一个指向拥有它的 <code>UGameInstance</code> 的指针（<code>UGameInstance* OwningGameInstance</code>）。</li><li>在独立运行的游戏中，通常只有一个 <code>Game WorldContext</code>。然而，在编辑器模式下，可能存在多个 <code>FWorldContext</code> 实例，例如：<ul><li><code>Editor Context</code>：用于编辑器视图的世界上下文。</li><li><code>PIE WorldContext</code>：用于实时预览（Play In Editor）的世界上下文。</li><li><code>Preview World</code>：用于编辑器视图中尚未运行的游戏场景的预览世界。</li></ul></li><li>当从一个世界切换到另一个世界时（例如，从编辑器视图的预览世界切换到实时预览世界），<code>FWorldContext</code> 负责保存当前世界的状态，并提供目标世界所需的上下文信息。这使得世界之间的切换更加流畅，同时保留了必要的状态信息。</li></ul><h4 class=heading-element id=uworld><span>UWorld</span>
<a href=#uworld class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p><strong>UWorld</strong> 表示整个游戏世界，是管理和组织游戏内所有关卡（ULevel）和游戏实体（Actors）的顶级容器。它继承自 <code>UObject</code> 类，通过一个名为 <code>Levels</code> 的数组 <code>TArray &lt;class ULevel *></code> 管理已加载的关卡，这些关卡包括持久性关卡（Persistent Level）和流式关卡（Stream Level）。</p><ul><li><strong>持久性关卡</strong>：UWorld 中的 <code>Persistent Level</code> 是在编辑器中始终打开的关卡，作为游戏世界的主要部分，通常包含游戏的主要场景和对象。UWorld 使用 <code>class ULevel *PersistentLevel</code> 来指向这个关卡。</li><li><strong>流式关卡</strong>：流式关卡是可以根据需要动态加载和卸载的关卡部分，这对于管理大型场景并提高性能非常有用。UWorld 通过这些流式关卡实现场景的按需加载。</li></ul><p>尽管 UWorld 可以访问所有关卡中的所有 Actors，但它并不直接保存这些 Actors。相反，它通过遍历每个 ULevel 及其 Actors 来管理它们。例如，UWorld 会检查每个已加载的 ULevel，然后访问该 ULevel 中的 Actors 数组。</p><h4 class=heading-element id=ulevel><span>ULevel</span>
<a href=#ulevel class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>ULevel 表示单个关卡或场景，是存放和管理 Actors 及其派生类的容器。它为开发者提供了一个框架来放置和管理场景中的所有对象，并通过 Actors 和蓝图实现关卡逻辑。同时，ULevel 与 UWorld 密切协作，支持复杂的场景管理和动态加载机制。</p><ul><li>ULevel 作为 Actors 的容器，允许开发者在关卡中放置和组织各种对象，如角色、道具、触发器等。它继承自 <code>UObject</code> 类，这意味着它拥有 <code>UObject</code> 提供的所有特性，包括引用计数、垃圾回收、序列化等。</li><li>每个 ULevel 对象都包含一个 <code>ALevelScriptActor</code> 对象，它允许开发者使用蓝图（一种可视化脚本工具）来编写和实现关卡特定的逻辑。同时，它还包含一个 <code>AWorldSettings</code> 对象，用于记录和存储关卡的自定义属性，如光照贴图、游戏模式等。</li></ul><p>其主要成员变量如下：</p><ul><li><code>TArray &lt;AActor *> Actors；</code>：存储关卡内所有 Actors。</li><li><code>AWorldSettings *WorldSettings；</code>：记录关卡的自定义属性。</li><li><code>ALevelScriptActor *LevelScriptActor；</code>：实现关卡蓝图功能。</li></ul><h3 class=heading-element id=逆向关键结构><span>逆向关键结构</span>
<a href=#%e9%80%86%e5%90%91%e5%85%b3%e9%94%ae%e7%bb%93%e6%9e%84 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class="details admonition tip open disabled"><div class="details-summary admonition-title"><i class="icon fa-fw fa-regular fa-lightbulb" aria-hidden=true></i>补充</div><div class=details-content><div class=admonition-content><p>下面的结构只是前期根据一些资料得到的认知，不保证正确。更加详细的解释可以参考 <a href=https://bbs.kanxue.com/thread-282857.htm#msg_header_h2_0 target=_blank rel="external nofollow noopener noreferrer">UE4.27SDK-Dump</a> 和 <a href=https://bbs.kanxue.com/thread-278266.htm target=_blank rel="external nofollow noopener noreferrer">UnrealEngine 5 逆向之类名算法的分析</a> 这两篇文章。</p></div></div></div><p>在对 UE 进行逆向的过程中，最为重要就是 GWorld，GName 和 GUObjectArray 三个变量。</p><ul><li><strong>GWorld</strong>：<code>GWorld</code> 是 Unreal Engine 中的一个全局指针变量，是指向 <code>UWorld</code> 的指针，代表当前的世界实例。它存储了关于当前游戏世界状态的所有信息，包括游戏模式、玩家控制器、游戏状态、当前关卡等。<code>GWorld</code> 是游戏逻辑 的核心，是所有游戏对象和游 戏逻辑交互的中心点。</li><li><strong>GName</strong>：<code>GName</code> 是全局指针，指向 <code>FNamePool</code> 内存池。<code>FNamePool</code> 采用分块管理（如 64KB 的 <code>FNameBlock</code>），每个块内存储 <code>FNameEntry</code> 结构体，包含字符串的哈希、长度及 UTF-8 数据。</li><li><strong>GUObjectArray</strong>：<code>GUObjectArray</code> 是一个全局的 <code>FUObjectArray</code> 实例，是 <code>GUObject</code> 的全局变量声明，它的作用是作为所有 <code>UObject</code> 派生类的实例的容器。因此这个实例可以进行对象跟踪，对象生命周期管理，性能优化和调试开发等。</li></ul><p>这些结构对于 UE 的引擎逆向有很大的帮助，下面 Dump SDK 中的项目就需要通过这些结构的地址才能进行 SDK 的 Dump 操作。</p><p>对于 UE4 而言，符号如果暴露出来的可以直接通过导出表寻找 <code>GWorld</code>，<code>GUObjectArray</code>。UE4.23 版本以前的通过 <code>GName</code> 函数，UE4.23 版本及其以后的通过 <code>FNamePool::FNamePool</code> 构造函数寻找 <code>GName</code>。下面展示的就是对于Tecent 2024 游戏安全安卓题，在无符号的情况下，比对 UE4.27 引擎源码来查找三个结构体在 <code>libUE4.so</code> 文件中的偏移。UE5 的查找方式相同。</p><h2 class=heading-element id=dumpsdk><span>dumpSDK</span>
<a href=#dumpsdk class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 class=heading-element id=确定-ue-版本><span>确定 UE 版本</span>
<a href=#%e7%a1%ae%e5%ae%9a-ue-%e7%89%88%e6%9c%ac class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>首先查看 UE 的版本，这里打开 <strong>AndroidManifest.xml</strong>，很容以发现是 UE4 的程序，其中存在很多字符提示，但是引擎版本被修改为了 <code>0.0.0</code>。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303190820.png title=20250303190820 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303190820.png data-sub-html="<h2>查看apk信息</h2><p>20250303190820</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303190820.png alt=查看apk信息></a><figcaption class=image-caption>20250303190820</figcaption></figure></p><p>之后用 IDA 打开 apk 中的 <strong>libUE4.so</strong>，搜索 <code>++UE4</code>，查看是否存在和 UE 相关的版本信息。这里我最开始没有搜索到，然后在 <code>Strings</code> 界面右键点击 <code>setup</code> ，把这个 <code>Delphi</code> 勾选上，然后就可以找到 UE4 版本的相关信息了。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303191023.png title=20250303191023 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303191023.png data-sub-html="<h2>修改strings配置</h2><p>20250303191023</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303191023.png alt=修改strings配置></a><figcaption class=image-caption>20250303191023</figcaption></figure></p><p>最后发现 <code>++UE4+Release-4.27</code>，由此确认为 4.27 版本，然后就是注册 epic 账号并关联 github 获取对应版本的源代码辅助后续分析。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303191123.png title=20250303191123 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303191123.png data-sub-html="<h2>确定UE版本</h2><p>20250303191123</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250303191123.png alt=确定UE版本></a><figcaption class=image-caption>20250303191123</figcaption></figure></p><h3 class=heading-element id=查找关键结构><span>查找关键结构</span>
<a href=#%e6%9f%a5%e6%89%be%e5%85%b3%e9%94%ae%e7%bb%93%e6%9e%84 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h4 class=heading-element id=gworld><span>GWorld</span>
<a href=#gworld class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>查看 UE 4.27 源码，<code>GWorld</code> 在 <strong>UE4.27.2\Engine\Source\Runtime\Engine\Private\World.cpp</strong> 中进行定义。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100042.png title=20250304100042 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100042.png data-sub-html="<h2>GWorld位置</h2><p>20250304100042</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100042.png alt=GWorld位置></a><figcaption class=image-caption>20250304100042</figcaption></figure>然后还是在这个文件中，随便找到一个含有字符串和 GWorld 的函数，并通过字符串来查找这个结构的地址。这里寻找函数 <code>UWorld* FSeamlessTravelHandler::Tick()</code>，然后可以看到在字符串 <code>SeamlessTravel FlushLevelStreaming</code> 上面，<code>GWorld</code> 会被赋值。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100353.png title=20250304100353 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100353.png data-sub-html="<h2>查找GWorld</h2><p>20250304100353</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100353.png alt=查找GWorld></a><figcaption class=image-caption>20250304100353</figcaption></figure>继续向上看，这里 GWorld 在被赋值之前会先被初始化为 <code>NULL</code>。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100440.png title=20250304100440 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100440.png data-sub-html="<h2>查找GWordl</h2><p>20250304100440</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304100440.png alt=查找GWordl></a><figcaption class=image-caption>20250304100440</figcaption></figure>因此在 IDA 中搜索字符串 <code>SeamlessTravel FlushLevelStreaming</code>，然后跳转到交叉引用处往上找即可看到GWorld。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101127.png title=20250304101127 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101127.png data-sub-html="<h2>逆向查找GWorld</h2><p>20250304101127</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101127.png alt=逆向查找GWorld></a><figcaption class=image-caption>20250304101127</figcaption></figure>然后继续向上查看，可以发现 GWorld 被初始化为 <code>NULL</code>，因此在这里 GWorld 就是 <code>0xB32D8A8</code>。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101240.png title=20250304101240 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101240.png data-sub-html="<h2>逆向查找GWorld</h2><p>20250304101240</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101240.png alt=逆向查找GWorld></a><figcaption class=image-caption>20250304101240</figcaption></figure></p><h4 class=heading-element id=gname><span>GName</span>
<a href=#gname class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>UE4 的 <code>GName</code> 在 <strong>UE4.27.2\Engine\Source\Runtime\Core\Private\UObject\UnrealNames.cpp</strong> 中，它是用内存池保存，内存池 <code>FNamePool</code> 的构造函数会初始化一些 Name，例如 <code>None</code>，<code>ByteProperty</code>，<code>IntProperty</code> 等。下面框出的代码作用就是将引擎预定义的硬编码名称静态注册到全局名称池中。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101601.png title=20250304101601 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101601.png data-sub-html="<h2>GName位置</h2><p>20250304101601</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304101601.png alt=GName位置></a><figcaption class=image-caption>20250304101601</figcaption></figure>如下图所示，位于 <strong>4.27.2\Engine\Source\Runtime\Core\Public\UObject\UnrealNames.inl</strong> 的 UnrealNames.inl 文件就保存着需要注册的硬编码名称。在 IDA 中就是根据这些硬编码字符串的位置来寻找 GName 的位置。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313154822.png title=20250313154822 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313154822.png data-sub-html="<h2>UnrealNames.inl</h2><p>20250313154822</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313154822.png alt=UnrealNames.inl></a><figcaption class=image-caption>20250313154822</figcaption></figure>因此在 IDA 中搜索字符串 <code>ByteProperty</code>，转到交叉引用处就是 FNamePool 构造函数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304102913.png title=20250304102913 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304102913.png data-sub-html="<h2>逆向查找GName</h2><p>20250304102913</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304102913.png alt=逆向查找GName></a><figcaption class=image-caption>20250304102913</figcaption></figure>然后交叉引用到调用函数处，传入的参数（this 指针）就是 <code>GName</code>，所以这里的 GName 就是 <code>0xB171CC0</code> 。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103232.png title=20250304103232 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103232.png data-sub-html="<h2>逆向查找GName</h2><p>20250304103232</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103232.png alt=逆向查找GName></a><figcaption class=image-caption>20250304103232</figcaption></figure></p><h4 class=heading-element id=guobjectarray><span>GUObjectArray</span>
<a href=#guobjectarray class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p><code>GUObjectArray</code> 在 <strong>UE4.27.2\Engine\Source\Runtime\CoreUObject\Private\UObject\UObjectHash.cpp</strong> 中定义。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103433.png title=20250304103433 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103433.png data-sub-html="<h2>查找GUObjectArray</h2><p>20250304103433</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103433.png alt=查找GUObjectArray></a><figcaption class=image-caption>20250304103433</figcaption></figure>同样找到引用 GUObjectArray 的地方，采用全局搜索查看哪些地方对于 GUObjectArray 存在引用，同时查看是否存在显著的字符串。这里找的是位于 <strong>UE4.27.2\Engine\Source\Runtime\Launch\Private\LaunchEngineLoop.cpp</strong> 的 <code>int32 FEngineLoop::PreInitPostStartupScreen (const TCHAR* CmdLine)</code> 函数，字符串 <code>CloseDisregardForGC</code> 的下面就是 <code>GUObjectArray</code>。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103722.png title=20250304103722 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103722.png data-sub-html="<h2>查找GUObjectArray</h2><p>20250304103722</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304103722.png alt=查找GUObjectArray></a><figcaption class=image-caption>20250304103722</figcaption></figure>IDA 找到 <code>CloseDisregardForGC</code> 字符串引用处，这里下面函数传递的参数是 <code>this</code> 指针，由此即可确定 GUObjectArray 是 <code>0xB1B5F98</code>。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304104142.png title=20250304104142 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304104142.png data-sub-html="<h2>逆向查找GUObjectArray</h2><p>20250304104142</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250304104142.png alt=逆向查找GUObjectArray></a><figcaption class=image-caption>20250304104142</figcaption></figure></p><h3 class=heading-element id=dumpsdk-1><span>dumpSDK</span>
<a href=#dumpsdk-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>采用工具 <a href=https://github.com/revercc/UE4Dumper target=_blank rel="external nofollow noopener noreferrer">UE4Dumper</a> 和如下命令 dump sdk。注意需要使用 root 权限，不然会报错 <code>Can't find Library: libUE4.so</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>./ue4dumper64 --package com.tencent.ace.match2024 --ptrdec --sdku --gname 0x0B171CC0 --guobj 0x0B1B5F98 --output /data/local/tmp --newue+</span></span></code></pre></td></tr></table></div></div><p>之后就会得到一个 <strong>SDK.txt</strong> 的文件。或者可以使用 <a href=https://github.com/hackcatml/frida-ue4dump target=_blank rel="external nofollow noopener noreferrer">frida-ue4dump</a> 来进行 dump，不过这里不能确定 <code>GUObjectArray</code> 的地址，所以需要手动进行设置，然后才可以成功 dump SDK。然后就可以通过 SDK 来锁定实例对一些属性进行修改。因为 UE 存在反射机制，所以会暴露处相关类和方法的接口，而 SDK 就是这些接口的信息，所以根据这个文件可以对于原程序进行更改。而这里的实现就是通过 frida 来进行处理。</p><h2 class=heading-element id=寻找-actor><span>寻找 Actor</span>
<a href=#%e5%af%bb%e6%89%be-actor class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>后面对于不同 section 的破解都需要涉及游戏世界中的可交互对象，这些对象都是一个个 Actor。所以只有知道这些对象（包括玩家）都是哪些 Actor，才能继续下面的破解。因此这里对于 Actor 的寻找进行说明。通过下面的 frida 代码，我们就可以知道这个游戏中所有 Actor 的名称及其内存地址，而后面就是在解释怎么得到下面的代码。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span><span class=lnt>94
</span><span class=lnt>95
</span><span class=lnt>96
</span><span class=lnt>97
</span><span class=lnt>98
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>GWorld_Offset</span> <span class=o>=</span> <span class=mh>0x0B32D8A8</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>GName_Offset</span> <span class=o>=</span> <span class=mh>0x0B171CC0</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>GWorld</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>GName</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>moduleBase</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>init</span><span class=p>(</span><span class=nx>soName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>module</span> <span class=o>=</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>findModuleByName</span><span class=p>(</span><span class=nx>soName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>module</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>moduleBase</span> <span class=o>=</span> <span class=nx>module</span><span class=p>.</span><span class=nx>base</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>GWorld</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>GWorld_Offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>GName</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>GName_Offset</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`init success`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getNameFromId</span><span class=p>(</span><span class=nx>ComparisonIndex</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/*-----------------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=cm>        相关数据结构偏移与大小
</span></span></span><span class=line><span class=cl><span class=cm>    -----------------------------------------------------------------------------*/</span>
</span></span><span class=line><span class=cl>    <span class=c1>// FNameEntryAllocator 相关数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>offset_FRWLock</span> <span class=o>=</span> <span class=mh>0x38</span><span class=p>;</span>                                  <span class=c1>// FRWLock 偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>offset_Blocks</span> <span class=o>=</span> <span class=nx>offset_FRWLock</span> <span class=o>+</span> <span class=mh>0x8</span><span class=p>;</span>                   <span class=c1>// Blocks 偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>size_Stride</span> <span class=o>=</span> <span class=mh>0x2</span><span class=p>;</span>                                      <span class=c1>// FNameEntry 的大小
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>size_Block</span> <span class=o>=</span> <span class=mh>0x8</span><span class=p>;</span>                                       <span class=c1>// Blocks 中存储的 uint8* 指针的大小
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// FNameEntryHanlder 相关数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>FNameBlockOffsetBits</span> <span class=o>=</span> <span class=mi>16</span><span class=p>;</span>                              <span class=c1>// 块偏移量位数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>FNameBlockOffsets</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=nx>FNameBlockOffsetBits</span><span class=p>;</span>          <span class=c1>// 块偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>Block</span> <span class=o>=</span> <span class=nx>ComparisonIndex</span> <span class=o>&gt;&gt;</span> <span class=nx>FNameBlockOffsetBits</span><span class=p>;</span>        <span class=c1>// 块索引
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>Offset</span> <span class=o>=</span> <span class=nx>ComparisonIndex</span> <span class=o>&amp;</span> <span class=p>(</span><span class=nx>FNameBlockOffsets</span> <span class=o>-</span> <span class=mi>1</span><span class=p>);</span>     <span class=c1>// 块内偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// FNameEntryHeader 相关数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>bIsWideBit</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>                                         <span class=c1>// 判断是否为宽字符的位数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>offset_LenBit</span> <span class=o>=</span> <span class=mi>6</span><span class=p>;</span>                                      <span class=c1>// 字符串长度位数的偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// FNameEntry 相关数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>offset_Union</span> <span class=o>=</span> <span class=mh>0x2</span><span class=p>;</span>                                     <span class=c1>// FNameEntry 中字符串 Union 的偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/*-----------------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=cm>        相关数据结构计算
</span></span></span><span class=line><span class=cl><span class=cm>    -----------------------------------------------------------------------------*/</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 计算 FNameEntryAllocator 的地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>FNameEntryAllocator</span> <span class=o>=</span> <span class=nx>GName</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 计算 Blocks 数组的地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>Blocks</span> <span class=o>=</span> <span class=nx>FNameEntryAllocator</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>offset_Blocks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取 Blocks 数组中块实例的地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>BlockInstance</span> <span class=o>=</span> <span class=nx>Blocks</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Block</span> <span class=o>*</span> <span class=nx>size_Block</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 计算 Resolve 返回的 FNameEntry 类型地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>FNameEntry</span> <span class=o>=</span> <span class=nx>BlockInstance</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>size_Stride</span> <span class=o>*</span> <span class=nx>Offset</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取 FNameEntryHeader，它只有两个字节
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>FNameEntryHeader</span> <span class=o>=</span> <span class=nx>FNameEntry</span><span class=p>.</span><span class=nx>readU16</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取字符串地址，长度，是否为宽字符标识
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>str_addr</span> <span class=o>=</span> <span class=nx>FNameEntry</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>offset_Union</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>str_length</span> <span class=o>=</span> <span class=nx>FNameEntryHeader</span> <span class=o>&gt;&gt;</span> <span class=nx>offset_LenBit</span><span class=p>;</span>             <span class=c1>// 计算字符串长度
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>wide</span> <span class=o>=</span> <span class=nx>FNameEntryHeader</span> <span class=o>&amp;</span> <span class=nx>bIsWideBit</span><span class=p>;</span>                       <span class=c1>// 判断字符串是否为宽字符
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// 如果是宽字符，返回 &#34;widestr&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>wide</span><span class=p>)</span> <span class=k>return</span> <span class=s2>&#34;widestr&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 如果字符串长度合理，读取并返回UTF-8字符串
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>str_length</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=nx>str_length</span> <span class=o>&lt;</span> <span class=mi>250</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>str_addr</span><span class=p>.</span><span class=nx>readUtf8String</span><span class=p>(</span><span class=nx>str_length</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;None&#34;</span><span class=p>;</span> <span class=c1>// 长度不合理，返回 &#34;None&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getActorsMap</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 固定偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>ULevel_offset</span> <span class=o>=</span> <span class=mh>0x30</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Actor_offset</span> <span class=o>=</span> <span class=mh>0x98</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ULevel</span> <span class=o>=</span> <span class=nx>GWorld</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>ULevel_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Actor</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorNum</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=mi>8</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[*] Actor_Addr: </span><span class=si>${</span><span class=nx>Actor</span><span class=si>}</span><span class=sb>, Actor_Num: </span><span class=si>${</span><span class=nx>actorNum</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorsMap</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>idx</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>idx</span> <span class=o>&lt;</span> <span class=nx>actorNum</span><span class=p>;</span> <span class=nx>idx</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorAddr</span> <span class=o>=</span> <span class=nx>Actor</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>idx</span> <span class=o>*</span> <span class=mh>0x8</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorID</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorName</span> <span class=o>=</span> <span class=nx>getNameFromId</span><span class=p>(</span><span class=nx>actorID</span><span class=p>);</span>      <span class=c1>//通过地址获取字符串名字
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>actorsMap</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>actorName</span><span class=p>,</span> <span class=nx>actorAddr</span><span class=p>);</span>          <span class=c1>//以字符串名字对应地址值       
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// console.log(`actorName: ${actorName}, actorAddr: ${actorAddr}`);
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>actorsMap</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>init</span><span class=p>(</span><span class=s2>&#34;libUE4.so&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>getActorsMap</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>这个代码的运行结果如下所示，其中展示了各个 Actor 的名称及其地址。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250314214049.png title=20250314214049 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250314214049.png data-sub-html="<h2>寻找 Actor</h2><p>20250314214049</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250314214049.png alt="寻找 Actor"></a><figcaption class=image-caption>20250314214049</figcaption></figure>粗略查看上述代码，可以看到获取 Actor 的地址是从 <code>GWorld</code> 开始的；而获取 Actor 的名称，则是根据 Actor 的地址得到 actorID，然后再根据这个 actorID 从 <code>GName</code> 进行寻找，所以对于代码的讲解分为两部分，获取地址和获取名称。</p><h3 class=heading-element id=获取地址><span>获取地址</span>
<a href=#%e8%8e%b7%e5%8f%96%e5%9c%b0%e5%9d%80 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>由上述代码，存储所有 Actors 的结构就在 ULevel 的结构中，所以我们的流程就是通过得到的 GWorld 找到 ULevel，然后再从 ULevel 中得到存储所有 Actors 的结构。</p><p>由上文的介绍，<code>GWorld</code> 是 Unreal Engine 中的一个全局指针变量，是指向 <code>UWorld</code> 的指针，代表当前的世界实例。所有可以把 GWorld 理解为 UWorld 类，之后就是对于这个类的讲解。</p><h4 class=heading-element id=ulevel_offset><span>ULevel_offset</span>
<a href=#ulevel_offset class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><h5 class=heading-element id=uworld-1><span>UWorld</span>
<a href=#uworld-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>UWorld 这个类位于 <strong>4.27.2\Engine\Source\Runtime\Engine\Classes\Engine\World.h</strong>。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305111155.png title=20250305111155 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305111155.png data-sub-html="<h2>UWorld</h2><p>20250305111155</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305111155.png alt=UWorld></a><figcaption class=image-caption>20250305111155</figcaption></figure>在实际运行环境中 UWorld 的第一个成员就是 <code>ULevel* PersistentLevel</code>，可表示成下面的形式。这里 <code>ENGINE_API</code> 是一个模块导出宏，用于控制 Engine 模块的符号可见性。在 Windows 平台上被定义为 <code>__declspec(dllexport)</code>，表示将类或函数导出为 DLL 的公共符号；而在其他平台为空，这些平台不需要显式导出符号。而 <code>UPROPERTY(Transient)</code> 是 Unreal Engine 的属性修饰符，用于标记一个成员变量为临时变量，避免序列化和网络同步。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>ENGINE_API</span> <span class=n>UWorld</span> <span class=k>final</span> <span class=o>:</span> <span class=k>public</span> <span class=n>UObject</span><span class=p>,</span> <span class=k>public</span> <span class=n>FNetworkNotify</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/** Persistent level containing the world info, default brush and actors spawned during gameplay among other things			*/</span>
</span></span><span class=line><span class=cl>	<span class=n>UPROPERTY</span><span class=p>(</span><span class=n>Transient</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>class</span> <span class=nc>ULevel</span><span class=o>*</span>								<span class=n>PersistentLevel</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>这里 <code>PersistentLevel</code> 是一个指向 <code>ULevel</code> 的指针，表示持久化关卡。它是 UWorld 的核心成员之一，负责管理关卡中的 Actor、光照、BSP 等内容，同时也是是上文代码的 <code>GWorld.add(ULevel_offset).readPointer();</code>。它是 UWorld 类的第一个成员，指向了 ULevel 类的数据，但是代码中却是 <code>let ULevel_offset = 0x30;</code> 的偏移。这是因为 UWorld 存在继承，这里的偏移实际上就是继承类 <code>UObject</code> 和 <code>FNetworkNotify</code> 中成员变量的大小。</p><h5 class=heading-element id=fnetworknotify><span>FNetworkNotify</span>
<a href=#fnetworknotify class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>这里 FNetworkNotify 位于 <strong>4.27.2\Engine\Source\Runtime\Engine\Classes\Engine\NetworkDelegates.h</strong>。它是一个用于网络通知的基类，主要作用是提供网络同步和远程过程调用（RPC）的接口。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305121254.png title=20250305121254 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305121254.png data-sub-html="<h2>FNetworkNotify</h2><p>20250305121254</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305121254.png alt=FNetworkNotify></a><figcaption class=image-caption>20250305121254</figcaption></figure>由上图可以看出这个类没有成员变量，所以其可以简化为下面的形式。占据空间的只有虚表指针，也就是只有 8 个字节。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>FNetworkNotify</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint64_t</span> <span class=n>VTable</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div><h5 class=heading-element id=uobject-1><span>UObject</span>
<a href=#uobject-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>找到位于 <strong>4.27.2\Engine\Source\Runtime\CoreUObject\Public\UObject\Object.h</strong> 的 UObject 类。这里 <code>COREUOBJECT_API</code> 是一个宏，用于控制 模块导出符号，其作用上文的 <code>ENGINE_API</code> 一样。同时它这里没有定义任何成员变量，所以还需要向上查看继承的 UObjectBaseUtility 类。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305121605.png title=20250305121605 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305121605.png data-sub-html="<h2>UObject</h2><p>20250305121605</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305121605.png alt=UObject></a><figcaption class=image-caption>20250305121605</figcaption></figure>UObjectBaseUtility 位于 <strong>4.27.2\Engine\Source\Runtime\CoreUObject\Public\UObject\UObjectBaseUtility.h</strong>，它和 UObject 一样没有定义任何成员变量，所以继续向上查看继承的 UObjectBase 类。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305122042.png title=20250305122042 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305122042.png data-sub-html="<h2>UObjectBaseUtility</h2><p>20250305122042</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305122042.png alt=UObjectBaseUtility></a><figcaption class=image-caption>20250305122042</figcaption></figure>UObjectBase 位于 <strong>4.27.2\Engine\Source\Runtime\CoreUObject\Public\UObject\UObjectBase.h</strong>。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305122209.png title=20250305122209 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305122209.png data-sub-html="<h2>UObjectBase</h2><p>20250305122209</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305122209.png alt=UObjectBase></a><figcaption class=image-caption>20250305122209</figcaption></figure>这个类就是顶级类了，其中也定义了相关的成员变量，可以简化为下面的形式。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>COREUOBJECT_API</span> <span class=n>UObjectBase</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint64_t</span> <span class=n>VTable</span><span class=p>;</span>                                        <span class=c1>//虚表指针，自己添加的
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Flags used to track and report various object states. This needs to be 8 byte aligned on 32-bit
</span></span></span><span class=line><span class=cl><span class=cm>	    platforms to reduce memory waste */</span>
</span></span><span class=line><span class=cl>	<span class=n>EObjectFlags</span>					<span class=n>ObjectFlags</span><span class=p>;</span>            <span class=c1>//对象属性
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Index into GObjectArray...very private. */</span>
</span></span><span class=line><span class=cl>	<span class=n>int32</span>							<span class=n>InternalIndex</span><span class=p>;</span>          <span class=c1>//对象 GUObjectArray 序号
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Class the object belongs to. */</span>
</span></span><span class=line><span class=cl>	<span class=n>UClass</span><span class=o>*</span>							<span class=n>ClassPrivate</span><span class=p>;</span>           <span class=c1>//对象的类
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Name of this object */</span>
</span></span><span class=line><span class=cl>	<span class=n>FName</span>							<span class=n>NamePrivate</span><span class=p>;</span>            <span class=c1>//对象的名字
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Object this object resides in. */</span>
</span></span><span class=line><span class=cl>	<span class=n>UObject</span><span class=o>*</span>						<span class=n>OuterPrivate</span><span class=p>;</span>           <span class=c1>//对象所在UPackage
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>从这个继承关系来看，虽然普遍认为 UObject 是 UE4 中所有对象的基类，但是真正的基类应该是 UObjectBase。不过认为 UObject 是基类也并无道理，因为继承自 UObjectBase 的 UObject 没有新增任何成员。它们的联系如下所示：</p><ul><li><code>UObjectBase</code> 提供了最基础的对象功能，如对象索引（InternalIndex）、类信息（ClassPrivate）、对象标志（ObjectFlags），不过不包含任何实用功能（如反射、序列化）；</li><li><code>UObjectBaseUtility</code> 继承扩展了外部对象引用（OuterPrivate）、对象名称（NamePrivate）、更多对象标志（Flags），它提供了基础的实用功能，但仍未实现完整的对象系统；</li><li><code>UObject</code> 实现了完整的对象系统，包括反射（Reflection）、垃圾回收（Garbage Collection）、序列化（Serialization）、属性系统（Property System），提供了开发者直接使用的接口。</li></ul><p>之后查看这个类的大小，可以看出有很多指针类型，那么就是 8 字节，余下不知道的就是 <code>EObjectFlags</code> 和 <code>FName</code> 类型了。EObjectFlags 位于 <strong>4.27.2\Engine\Source\Runtime\CoreUObject\Public\UObject\ObjectMacros.h</strong>，它是一个枚举类型（enum），在 C++ 底层类型是 uint32，也就是 4 个字节。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305124615.png title=20250305124615 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305124615.png data-sub-html="<h2>EObjectFlags</h2><p>20250305124615</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305124615.png alt=EObjectFlags></a><figcaption class=image-caption>20250305124615</figcaption></figure></p><p>然后看看 FName，它位于 <strong>4.27.2\Engine\Source\Runtime\Core\Public\UObject\NameTypes.h</strong>，是一个轻量级的字符串类型，用于表示对象的名称。在这里就可以看出，正是因为 UE 中所有对象都继承自 UObject 这个类，同时这个类又有成员变量 FName 提供名字，所以 UE 的反射系统才能方便知道一个对象的名字、字段、函数参数等信息。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305125139.png title=20250305125139 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305125139.png data-sub-html="<h2>FName</h2><p>20250305125139</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305125139.png alt=FName></a><figcaption class=image-caption>20250305125139</figcaption></figure>然后可以提取其中的成员变量转化为下面的形式。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>CORE_API</span> <span class=n>FName</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Index into the Names array (used to find String portion of the string/number pair used for comparison) */</span>
</span></span><span class=line><span class=cl>	<span class=n>FNameEntryId</span>	<span class=n>ComparisonIndex</span><span class=p>;</span>        <span class=c1>//指向 FNamePool 中的名称条目
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#if WITH_CASE_PRESERVING_NAME
</span></span></span><span class=line><span class=cl><span class=cp></span>	<span class=cm>/** Index into the Names array (used to find String portion of the string/number pair used for display) */</span>
</span></span><span class=line><span class=cl>	<span class=n>FNameEntryId</span>	<span class=n>DisplayIndex</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#endif </span><span class=c1>// WITH_CASE_PRESERVING_NAME
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Number portion of the string/number pair (stored internally as 1 more than actual, so zero&#39;d memory will be the default, no-instance case) */</span>
</span></span><span class=line><span class=cl>	<span class=n>uint32</span>			<span class=n>Number</span><span class=p>;</span>                 <span class=c1>//用于区分同名对象的编号
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>从上面代码中可以看到它包含三个成员变量，不过其中的 <code>DisplayIndex</code> 由编译条件宏包裹。由下面图片中的注释可以看出，这个宏只用于编译器，而在实际运行中不会启动，因此对于安卓平台而言，这就没有 <code>DisplayIndex</code> 这个变量，只有另外两个成员变量存在。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250307102847.png title=20250307102847 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250307102847.png data-sub-html="<h2>编译条件宏</h2><p>20250307102847</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250307102847.png alt=编译条件宏></a><figcaption class=image-caption>20250307102847</figcaption></figure>因此这里的类型就只有 FNameEntryId 不知道了，它和 FName 在同一个文件中被定义。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305130947.png title=20250305130947 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305130947.png data-sub-html="<h2>FNameEntryId</h2><p>20250305130947</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305130947.png alt=FNameEntryId></a><figcaption class=image-caption>20250305130947</figcaption></figure>它只有一个成员变量 Value，具体如下所示。因此 FNameEntryId 就是一个 4 字节的数据。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>FNameEntryId</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=n>uint32</span> <span class=n>Value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h5 class=heading-element id=获取偏移><span>获取偏移</span>
<a href=#%e8%8e%b7%e5%8f%96%e5%81%8f%e7%a7%bb class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>由此，知道了所有和 ULevel_offset 获取相关的变量的类型，然后就可以知道这个偏移的计算结果了。首先是由于 ULevel 是第一个成员变量，所以计算的就是继承类 FNetworkNotify 和 UObject 的成员变量大小了。前者没有成员变量，所以只有一个虚表指针，8 个字节。后者则是和 UObjectBase 的成员变量一样，由此首先是虚表指针，8 个字节；之后是 EObjectFlags 和 int32，共 8 个字节；然后 UClass* 和 UObject* 两个类指针，共 16 个字节；最后就是 FName，由于安卓平台只有两个成员变量，所以它是 8 个字节。由此相加 <code>8 + 8 + 8 + 16 + 8 = 0x30</code>，由此得到了在 UWorld 中 ULevel 的偏移。</p><h4 class=heading-element id=actor_offset><span>Actor_offset</span>
<a href=#actor_offset class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><h5 class=heading-element id=ulevel-1><span>ULevel</span>
<a href=#ulevel-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>找到位于 <strong>4.27.2\Engine\Source\Runtime\Engine\Classes\Engine\Level.h</strong> 的 ULevel 类，<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305152202.png title=20250305152202 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305152202.png data-sub-html="<h2>ULevel</h2><p>20250305152202</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305152202.png alt=ULevel></a><figcaption class=image-caption>20250305152202</figcaption></figure>这里关心的就是下面的结构，其中 <code>TArray&lt;AActor*> Actors;</code> 存储了所有的 Actors，它就是我们最后需要的结构。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>ULevel</span> <span class=o>:</span> <span class=k>public</span> <span class=n>UObject</span><span class=p>,</span> <span class=k>public</span> <span class=n>IInterface_AssetUserData</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** URL associated with this level. */</span>
</span></span><span class=line><span class=cl>	<span class=n>FURL</span>					<span class=n>URL</span><span class=p>;</span>                <span class=c1>//存储协议相关配置，以及地图等选项
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Array of all actors in this level, used by FActorIteratorBase and derived classes */</span>
</span></span><span class=line><span class=cl>	<span class=n>TArray</span><span class=o>&lt;</span><span class=n>AActor</span><span class=o>*&gt;</span> <span class=n>Actors</span><span class=p>;</span>                     <span class=c1>//存储所有Actors
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>父类位于 <strong>4.27.2\Engine\Source\Runtime\Engine\Classes\Interfaces\Interface_AssetUserData.h</strong>。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305160143.png title=20250305160143 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305160143.png data-sub-html="<h2>IInterface_AssetUserData</h2><p>20250305160143</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305160143.png alt=IInterface_AssetUserData></a><figcaption class=image-caption>20250305160143</figcaption></figure>它没有成员变量，所以结构和上文 FNetworkNotify 一样，都只有一个虚表指针。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>IInterface_AssetUserData</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint64_t</span> <span class=n>VTable</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>然后父类 UObject 和上文也一样，其占据空间为 0x28。</p><h5 class=heading-element id=furl><span>FURL</span>
<a href=#furl class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>位于 <strong>4.27.2\Engine\Source\Runtime\Engine\Classes\Engine\EngineBaseTypes.h</strong>。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305170253.png title=20250305170253 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305170253.png data-sub-html="<h2>FURL</h2><p>20250305170253</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305170253.png alt=FURL></a><figcaption class=image-caption>20250305170253</figcaption></figure>然后把成员变量提取出来可以得到下面的结构。这里 <code>UPROPERTY</code> 是一个非常重要的宏，用于标记类的成员变量为属性（Property）。它的作用是让引擎的反射系统（Reflection System）能够识别和管理这些变量，从而实现序列化、网络同步、编辑器支持等功能。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>ENGINE_API</span> <span class=n>FURL</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Protocol, i.e. &#34;unreal&#34; or &#34;http&#34;.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>UPROPERTY</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>FString</span> <span class=n>Protocol</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Optional hostname, i.e. &#34;204.157.115.40&#34; or &#34;unreal.epicgames.com&#34;, blank
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// if local.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>UPROPERTY</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>FString</span> <span class=n>Host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Optional host port.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>UPROPERTY</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>int32</span> <span class=n>Port</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>UPROPERTY</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>int32</span> <span class=n>Valid</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Map name, i.e. &#34;SkyCity&#34;, default is &#34;Entry&#34;.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>UPROPERTY</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>FString</span> <span class=n>Map</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Optional place to download Map if client does not possess it
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>UPROPERTY</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>FString</span> <span class=n>RedirectURL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Options.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>UPROPERTY</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>TArray</span><span class=o>&lt;</span><span class=n>FString</span><span class=o>&gt;</span> <span class=n>Op</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Portal to enter through, default is &#34;&#34;.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>UPROPERTY</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=n>FString</span> <span class=n>Portal</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>可以看出上面的结构有两个类型是未知的，<code>FString</code> 和 <code>TArray</code>，因此下面就是对于这两个类型进行研究。</p><h5 class=heading-element id=fstring><span>FString</span>
<a href=#fstring class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>FString 位于 <strong>4.27.2\Engine\Source\Runtime\Core\Public\Containers\UnrealString.h</strong>，它是一个动态大小的字符串类，用于存储和操作字符串数据。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305182228.png title=20250305182228 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305182228.png data-sub-html="<h2>FString</h2><p>20250305182228</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305182228.png alt=FString></a><figcaption class=image-caption>20250305182228</figcaption></figure>由上图可以看出 FString 只有一个成员变量 <code>Data</code>，提取的结果如下所示。然后从下面的代码可以看到 FString 只有一个 <code>TArray&lt;TCHAR></code> 类型的成员变量，所以其大小和 TArray 类的大小是一样的。同时可以知道可见字符串相关数据存储在 TArray 容器中，容器类型是 TCHAR，而 TCHAR 类型就是 wchar_t 类型。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>CORE_API</span> <span class=n>FString</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=cm>/** Array holding the character data */</span>
</span></span><span class=line><span class=cl>	<span class=k>typedef</span> <span class=n>TArray</span><span class=o>&lt;</span><span class=n>TCHAR</span><span class=o>&gt;</span> <span class=n>DataType</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>DataType</span> <span class=n>Data</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h5 class=heading-element id=tarray><span>TArray</span>
<a href=#tarray class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>TArray 位于 <strong>4.27.2\Engine\Source\Runtime\Core\Public\Containers\Array.h</strong>。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305184237.png title=20250305184237 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305184237.png data-sub-html="<h2>TArray</h2><p>20250305184237</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250305184237.png alt=TArray></a><figcaption class=image-caption>20250305184237</figcaption></figure>TArray 是一个动态数组模板类，提取出来的关键结构如下所示。这里 ElementAllocatorType 是 TArray 的内存分配器类型，其具体类型由模板参数 Allocator 决定。而 SizeType 是 TArray 的元素计数和索引类型，其类型由分配器的 SizeType 决定。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>SizeType</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TArray</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>typedef</span> <span class=k>typename</span> <span class=n>TChooseClass</span><span class=o>&lt;</span>
</span></span><span class=line><span class=cl>		<span class=n>Allocator</span><span class=o>::</span><span class=n>NeedsElementType</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=k>typename</span> <span class=n>Allocator</span><span class=o>::</span><span class=k>template</span> <span class=n>ForElementType</span><span class=o>&lt;</span><span class=n>ElementType</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=k>typename</span> <span class=n>Allocator</span><span class=o>::</span><span class=n>ForAnyElementType</span>
</span></span><span class=line><span class=cl>	<span class=o>&gt;::</span><span class=n>Result</span> <span class=n>ElementAllocatorType</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>protected</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=n>ElementAllocatorType</span> <span class=n>AllocatorInstance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>SizeType</span>             <span class=n>ArrayNum</span><span class=p>;</span>          <span class=c1>//记录当前数组内元素的实际个数
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>SizeType</span>             <span class=n>ArrayMax</span><span class=p>;</span>          <span class=c1>//记录当前数组最大可容纳元素的数量
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>这里可以从 <a href=https://santa.wang/ue-container-tarray-analysis/ target=_blank rel="external nofollow noopener noreferrer">UE TArray 源码剖析及分摊时间复杂度推导</a> 文章获取 ElementAllocatorType 和 SizeType 类型的大小，它们的大小分别为 8 字节和 4 字节。因此 TArray 的大小为 <code>8 + 4 + 4 = 16</code> 字节，FString 和 TArray 的大小一样，也是 16 字节。</p><p>需要注意，因为分析的类型为 <code>TArray&lt;TCHAR></code>，<code>TArray&lt;FString></code>， 所以认为 AllocatorInstance 为 8 字节。这是将其视为了默认分配器（FDefaultAllocator），它通常仅包含一个数据指针，与后面的元素类型无关，因此就是 8 字节。而如果使用其他特殊分配器，其内部可能会包含额外字段了，会导致 AllocatorInstance 的大小增加。</p><h5 class=heading-element id=获取偏移-1><span>获取偏移</span>
<a href=#%e8%8e%b7%e5%8f%96%e5%81%8f%e7%a7%bb-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>知道了 FString 和 TArray 都是 16 字节大小后，可以计算 FURL 的大小为 <code>16 * 6 + 4 + 4 = 0x68</code>，然后加上父类的偏移 <code>0x98 + 0x28 + 8 = 0x98 </code>，因此得到了 ULevel 中 <code>TArray&lt;AActor*> Actors;</code> 的偏移为 0x98。</p><h4 class=heading-element id=获取内存地址><span>获取内存地址</span>
<a href=#%e8%8e%b7%e5%8f%96%e5%86%85%e5%ad%98%e5%9c%b0%e5%9d%80 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>上文可以找到 Actors 数组的内存地址，也就是 <code>TArray&lt;AActor*> Actors;</code> 的地址。之后就是看 TArray 的结构了，它存储了 AllocatorInstance，ArrayNum，ArrayMax 三个成员变量，第一个就是分配器，它负责动态分配/释放存储数组元素的连续内存块。这里指默认分配器，它内部通常包含一个指向元素数组的指针（ <code>void* Data</code> 或类似成员），记录实际内存块的地址。</p><p>因此这里的 AllocatorInstance 就是一个指针，指向了存储 AActor 对象指针的连续内存块。所以在上面的代码中，使用了 <code>Actor = ULevel.add(Actor_offset).readPointer();</code> 来获取 Actors 数组中第一个元素的地址。然后这里存储的元素类型为 <code>AActor*</code> 类型，可以使用 <code>actorAddr = Actor.add(idx * 0x8).readPointer();</code> 获取后面的对象地址，因为 <code>AActor*</code> 是一个指针，占据 8 个字节。</p><p>上述过程可以使用 <code>console.log(hexdump(Actor, { offset: 0, length: 0x50, header: true, ansi: true }));</code> 来查看真实内存信息，可以发现其存储的就是连续的指针。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250306152608.png title=20250306152608 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250306152608.png data-sub-html="<h2>hook结果</h2><p>20250306152608</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250306152608.png alt=hook结果></a><figcaption class=image-caption>20250306152608</figcaption></figure></p><p>之后也通过 <code>actorNum = ULevel.add(Actor_offset).add(8).readU32();</code> 获取了 Actor 数组中对象的个数，便于后续循环获取每一个对象的地址和名称。</p><h3 class=heading-element id=获取名称><span>获取名称</span>
<a href=#%e8%8e%b7%e5%8f%96%e5%90%8d%e7%a7%b0 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>根据上述代码，首先需要根据 actorAddr 来获取 actorID，然后再利用这个 actorID 来获取名称，因此下面可以分为获取 actorID 和 getNameFromId 两部分内瓤。</p><h4 class=heading-element id=获取-actorid><span>获取 actorID</span>
<a href=#%e8%8e%b7%e5%8f%96-actorid class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>AActor 位于 <code>4.27.2\Engine\Source\Runtime\Engine\Classes\GameFramework\Actor.h </code>。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250306205942.png title=20250306205942 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250306205942.png data-sub-html="<h2>AActor</h2><p>20250306205942</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250306205942.png alt=AActor></a><figcaption class=image-caption>20250306205942</figcaption></figure>由上图可以看出 AActor 继承 UObject 类，同时这里 actorID 是偏移 0x18，小于 UObjectBase 0x28 的大小，所以这里的偏移指的就是 UObjectBase 中的某个成员变量。因此根据下面 UObjectBase 中变量的大小进行计算，虚表指针 8 字节，EObjectFlags 和 int 32 共 8 字节，UClass* 指针 8 字节，加起来就是 0x18，所以这里的 <code>actorAddr.add(0x18)</code> 指向成员变量 NamePrivate，其类型为 FName。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>COREUOBJECT_API</span> <span class=n>UObjectBase</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint64_t</span> <span class=n>VTable</span><span class=p>;</span>                                        <span class=c1>//虚表指针，自己添加的
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Flags used to track and report various object states. This needs to be 8 byte aligned on 32-bit
</span></span></span><span class=line><span class=cl><span class=cm>	    platforms to reduce memory waste */</span>
</span></span><span class=line><span class=cl>	<span class=n>EObjectFlags</span>					<span class=n>ObjectFlags</span><span class=p>;</span>            <span class=c1>//对象属性
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Index into GObjectArray...very private. */</span>
</span></span><span class=line><span class=cl>	<span class=n>int32</span>							<span class=n>InternalIndex</span><span class=p>;</span>          <span class=c1>//对象 GUObjectArray 序号
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Class the object belongs to. */</span>
</span></span><span class=line><span class=cl>	<span class=n>UClass</span><span class=o>*</span>							<span class=n>ClassPrivate</span><span class=p>;</span>           <span class=c1>//对象的类
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Name of this object */</span>
</span></span><span class=line><span class=cl>	<span class=n>FName</span>							<span class=n>NamePrivate</span><span class=p>;</span>            <span class=c1>//对象的名字
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Object this object resides in. */</span>
</span></span><span class=line><span class=cl>	<span class=n>UObject</span><span class=o>*</span>						<span class=n>OuterPrivate</span><span class=p>;</span>           <span class=c1>//对象所在UPackage
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>上述 actorID 还存在 readU32 部分，所以需要分析 FName 结构，同时上面的内容中也有提到，正是这个成员变量提供名字，所以 UE 的反射系统才能方便知道一个对象的名字、字段、函数参数等信息。因此这里找到 FName 这个结构，它位于 <strong>4.27.2\Engine\Source\Runtime\Core\Public\UObject\NameTypes.h</strong>，下面就是提取的成员变量。然后由这里就可以看出，代码中的 <code>actorAddr.add(0x18).readU32()</code> 指的就是 FName 中的 ComparisonIndex，这里因为它是第一个成员变量，偏移为 0，所以直接读取指向的数据就可以得到该变量。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>CORE_API</span> <span class=n>FName</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Index into the Names array (used to find String portion of the string/number pair used for comparison) */</span>
</span></span><span class=line><span class=cl>	<span class=n>FNameEntryId</span>	<span class=n>ComparisonIndex</span><span class=p>;</span>        <span class=c1>//指向 FNamePool 中的名称条目
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#if WITH_CASE_PRESERVING_NAME
</span></span></span><span class=line><span class=cl><span class=cp></span>	<span class=cm>/** Index into the Names array (used to find String portion of the string/number pair used for display) */</span>
</span></span><span class=line><span class=cl>	<span class=n>FNameEntryId</span>	<span class=n>DisplayIndex</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#endif </span><span class=c1>// WITH_CASE_PRESERVING_NAME
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Number portion of the string/number pair (stored internally as 1 more than actual, so zero&#39;d memory will be the default, no-instance case) */</span>
</span></span><span class=line><span class=cl>	<span class=n>uint32</span>			<span class=n>Number</span><span class=p>;</span>                 <span class=c1>//用于区分同名对象的编号
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>同时这个类中存在一个成员函数 <code>ToString()</code>，下面就是它的声明。根据它的注释，可以看出这里调用 <code>FName::ToString</code> 就可以得到字符串名字，它返回一个 FString 类型。因此后面就是对于这个方法进行分析。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313131322.png title=20250313131322 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313131322.png data-sub-html="<h2>ToString()</h2><p>20250313131322</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313131322.png alt=ToString()></a><figcaption class=image-caption>20250313131322</figcaption></figure></p><h4 class=heading-element id=解析-tostring><span>解析 ToString</span>
<a href=#%e8%a7%a3%e6%9e%90-tostring class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>之后在 <strong>4.27.2\Engine\Source\Runtime\Core\Private\UObject\UnrealNames.cpp</strong> 中找到它的定义。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313131758.png title=20250313131758 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313131758.png data-sub-html="<h2>ToString()</h2><p>20250313131758</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313131758.png alt=ToString()></a><figcaption class=image-caption>20250313131758</figcaption></figure>可以看出这个函数先调用了 <code>GetDisplayNameEntry</code> 函数。</p><h5 class=heading-element id=getdisplaynameentry><span>GetDisplayNameEntry</span>
<a href=#getdisplaynameentry class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>然后在 <code>ToString()</code> 函数的上面就是这个函数的定义。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313132357.png title=20250313132357 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313132357.png data-sub-html="<h2>GetDisplayNameEntry()</h2><p>20250313132357</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313132357.png alt=GetDisplayNameEntry()></a><figcaption class=image-caption>20250313132357</figcaption></figure>由上图知道这个函数又调用了 <code>GetNamePool()</code>，<code>Resolve()</code>，<code>GetDisplayIndex()</code> 三个函数，因此依次查看这三个函数。</p><h6 class=heading-element id=getnamepool><span>GetNamePool</span>
<a href=#getnamepool class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h6><p>这里首先查看位于 <strong>4.27.2\Engine\Source\Runtime\Core\Private\UObject\UnrealNames.cpp</strong> 的 <code>GetNamePool()</code> 函数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313132859.png title=20250313132859 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313132859.png data-sub-html="<h2>GetNamePool()</h2><p>20250313132859</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313132859.png alt=GetNamePool()></a><figcaption class=image-caption>20250313132859</figcaption></figure>这里引用 <a href=https://bbs.kanxue.com/thread-282857.htm#msg_header_h3_10 target=_blank rel="external nofollow noopener noreferrer">UE4.27SDK-Dump</a> 中的介绍，这个函数是一个单例模式的函数，也就是在 so 中存在唯一的全局变量 NamePoolData，它的类型为 <code>FNamePool</code>（这里使用了 <code>alignas(FNamePool)</code> 确保数组内存对齐与 <code>FNamePool</code> 的严格对齐要求一致）。</p><ul><li><code>static bool bNamePoolInitialized;</code>：声明了一个静态布尔变量 <code>bNamePoolInitialized</code>，用于跟踪 <code>FNamePool</code> 实例是否已经被初始化。</li><li><code>alignas(FNamePool) static uint8 NamePoolData[sizeof(FNamePool)];</code>：声明了一个静态数组 <code>NamePoolData</code>，其大小等于 <code>FNamePool</code> 类的大小，并使用 alignas 关键字确保这个数组按照 FNamePool 的内存对齐要求进行对齐。这个数组将用作 FNamePool 实例的内存空间。</li><li><code>GetNamePool()</code>：这个函数用于返回 <code>FNamePool</code> 的实例，如果未被初始化则初始化。</li></ul><p>这个模式保证了即使在多线程环境下，<code>FNamePool</code> 也只会被初始化一次。它不使用 C++11 中的魔法静态（magic statics）或单例模式中的锁，以减少运行时的开销。通过这种方式，FNamePool 类的实例在第一次调用 GetNamePool 时被创建，并在随后的调用中直接返回，避免了重复初始化。</p><p>由此可以看出这个函数就是用来初始化 <code>FNamePool</code> 实例的，也就是 NamePoolData 这个数组，同时它只会初始化一次。同时上文提到的 GName 就是用内存池 FNamePool 来定义的。所以由此可以知道，FNamePoll 会定义一个全局静态变量 NamePoolData 数组，这个数组就是上文提到的 GName，它存储了全局的字符串，相当于一个字符串池，这里的 <code>ToString()</code> 函数就依赖这个数组获取字符串名字。</p><h6 class=heading-element id=getdisplayindex><span>GetDisplayIndex</span>
<a href=#getdisplayindex class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h6><p>之后看实现于 <strong>4.27.2\Engine\Source\Runtime\Core\Public\UObject\NameTypes.h</strong> 的 <code>GetDisplayIndex()</code> 函数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313160335.png title=20250313160335 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313160335.png data-sub-html="<h2>GetDisplayIndex()</h2><p>20250313160335</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313160335.png alt=GetDisplayIndex()></a><figcaption class=image-caption>20250313160335</figcaption></figure>这里就是调用了 <code>GetDisplayIndexFast()</code> 函数，然后返回了一个 FNameEntryId 类型的 Index。上文介绍过 FNameEntryId 这个类型，它内部只有一个成员变量 <code>uint32 Value;</code>，所以继续关注 <code>GetDisplayIndexFast()</code> 函数。它就在同样的文件中。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313161823.png title=20250313161823 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313161823.png data-sub-html="<h2>GetDisplayIndexFast()</h2><p>20250313161823</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313161823.png alt=GetDisplayIndexFast()></a><figcaption class=image-caption>20250313161823</figcaption></figure>这里同样的文件中有相关宏定义，然后由注释可以知道这个宏只用于编译器，而在实际运行中不会启用。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313161931.png title=20250313161931 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313161931.png data-sub-html="<h2>WITH_CASE_PRESERVING_NAME</h2><p>20250313161931</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313161931.png alt=WITH_CASE_PRESERVING_NAME></a><figcaption class=image-caption>20250313161931</figcaption></figure>因此这里的 <code>GetDisplayIndexFast()</code> 函数实际返回的就是 ComparisonIndex，而这个变量有两处被定义，其中一处就是作为上文提到的 FName 的成员变量。同时它的类型也是 FNameEntryId 类型，所以可以知道 ComparisonIndex 只是存储了一个 uint32 的值，它作为字符串在 GName 中的索引。</p><p>同时由此也可以知道每个继承 UObject 的类对象都可以通过 <code>NamePrivate -> ComparisonIndex</code> 来找到这个字符串的索引，然后通过 <code>ToString()</code> 来获取存储在 FNamePoolData 中的具体字符串名字。</p><h6 class=heading-element id=resolve><span>Resolve</span>
<a href=#resolve class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h6><p>这个函数的定义位于 <strong>4.27.2\Engine\Source\Runtime\Core\Private\UObject\UnrealNames.cpp</strong>，它是 FNamePool 类的一个函数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313163154.png title=20250313163154 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313163154.png data-sub-html="<h2>Resolve()</h2><p>20250313163154</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313163154.png alt=Resolve()></a><figcaption class=image-caption>20250313163154</figcaption></figure>这里可以看到这个函数的参数为 FNameEntryHandle 类型，但是在 <code>GetDisplayNameEntry()</code> 函数中可以看到其参数为 <code>GetDisplayIndex()</code> 函数，它的返回值类型为 FNameEntryId，所以这里 FNameEntryHandle 的构造函数存在相关的类型转换。</p><p>之后找到位于 <strong>4.27.2\Engine\Source\Runtime\Core\Private\UObject\UnrealNames.cpp</strong> 的类定义如下所示：<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313164532.png title=20250313164532 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313164532.png data-sub-html="<h2>FNameEntryHandle</h2><p>20250313164532</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313164532.png alt=FNameEntryHandle></a><figcaption class=image-caption>20250313164532</figcaption></figure>简化之后就是下面的呈现方式，同时获取了上方定义的相关未知值，例如 <code>FNameBlockOffsetBits</code>，它在上面被定义，是个常量。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cm>/** Remember to update natvis if you change these */</span>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=k>constexpr</span> <span class=n>uint32</span> <span class=n>FNameBlockOffsetBits</span> <span class=o>=</span> <span class=mi>16</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=k>constexpr</span> <span class=n>uint32</span> <span class=n>FNameBlockOffsets</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=n>FNameBlockOffsetBits</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/** An unpacked FNameEntryId */</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>FNameEntryHandle</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=n>uint32</span> <span class=n>Block</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>uint32</span> <span class=n>Offset</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>FNameEntryHandle</span><span class=p>(</span><span class=n>uint32</span> <span class=n>InBlock</span><span class=p>,</span> <span class=n>uint32</span> <span class=n>InOffset</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=o>:</span> <span class=n>Block</span><span class=p>(</span><span class=n>InBlock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>,</span> <span class=n>Offset</span><span class=p>(</span><span class=n>InOffset</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>FNameEntryHandle</span><span class=p>(</span><span class=n>FNameEntryId</span> <span class=n>Id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=o>:</span> <span class=n>Block</span><span class=p>(</span><span class=n>Id</span><span class=p>.</span><span class=n>ToUnstableInt</span><span class=p>()</span> <span class=o>&gt;&gt;</span> <span class=n>FNameBlockOffsetBits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>,</span> <span class=n>Offset</span><span class=p>(</span><span class=n>Id</span><span class=p>.</span><span class=n>ToUnstableInt</span><span class=p>()</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>FNameBlockOffsets</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>然后回到 <code>Resolve()</code> 函数，可以看到它是调用了 <code>Entries.Resolve()</code> 函数，但是这里不知道这个 Entries 是什么。不过 <code>Resolve()</code> 函数是 FNamePool 类的一个函数，所以这个 Entries 应该是在 FNamePool 中，所以后面对于这个类进行分析。</p><p>这里关注位于 <strong>4.27.2\Engine\Source\Runtime\Core\Private\UObject\UnrealNames.cpp</strong> 的 FNamePool 类。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313173020.png title=20250313173020 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313173020.png data-sub-html="<h2>FNamePool</h2><p>20250313173020</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313173020.png alt=FNamePool></a><figcaption class=image-caption>20250313173020</figcaption></figure>然后可以发现第一个成员变量就是之前不知道的 Entries，然后这个变量的类型为 FNameEntryAllocator。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>FNamePool</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=n>FNameEntryAllocator</span> <span class=n>Entries</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>......</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>得到了 Entries，那么就可以看同文件下的 <code>Entries.Resolve()</code> 函数了，这个函数就是 FNameEntryAllocator 类的一个成员函数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313165045.png title=20250313165045 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313165045.png data-sub-html="<h2>Resolve()</h2><p>20250313165045</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313165045.png alt=Resolve()></a><figcaption class=image-caption>20250313165045</figcaption></figure>可以看到这里存在未知的 Blocks 和 Stride 两个数据。不过因为这个函数是 FNameEntryAllocator 的一个成员函数，所以这两个未知变量极有可能是 FNameEntryAllocator 的成员变量，所以继续查看同文件下的 FNameEntryAllocator 这个类。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313183511.png title=20250313183511 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313183511.png data-sub-html="<h2>FNameEntryAllocator</h2><p>20250313183511</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313183511.png alt=FNameEntryAllocator></a><figcaption class=image-caption>20250313183511</figcaption></figure>提取相关成员变量如下所示：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>FNameEntryAllocator</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=k>enum</span> <span class=p>{</span> <span class=n>Stride</span> <span class=o>=</span> <span class=k>alignof</span><span class=p>(</span><span class=n>FNameEntry</span><span class=p>)</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>	<span class=k>enum</span> <span class=p>{</span> <span class=n>BlockSizeBytes</span> <span class=o>=</span> <span class=n>Stride</span> <span class=o>*</span> <span class=n>FNameBlockOffsets</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>mutable</span> <span class=n>FRWLock</span> <span class=n>Lock</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>uint32</span> <span class=n>CurrentBlock</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>uint32</span> <span class=n>CurrentByteCursor</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>uint8</span><span class=o>*</span> <span class=n>Blocks</span><span class=p>[</span><span class=n>FNameMaxBlocks</span><span class=p>]</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>然后可以发现 Blocks 和 Stride 正好是 FNameEntryAllocator 的成员变量。所以这里就是通过调用 GetNamePool 得到了 GName，调用 GetDisplayIndex 得到索引，调用 Resolve 在 GName 上根据索引找到一个 FNameEntry 类型变量，最后返回此变量。</p><h5 class=heading-element id=getplainnamestring><span>GetPlainNameString</span>
<a href=#getplainnamestring class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>然后分析 <code>GetDisplayNameEntry()->GetPlainNameString()</code> 中后面的 <code>GetPlainNameString()</code> 函数。</p><h6 class=heading-element id=fnameentry><span>FNameEntry</span>
<a href=#fnameentry class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h6><p>首先查看位于 <strong>4.27.2\Engine\Source\Runtime\Core\Public\UObject\NameTypes.h</strong> 的 FNameEntry，这个是函数 <code>GetDisplayNameEntry()</code> 的返回类型。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313192458.png title=20250313192458 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313192458.png data-sub-html="<h2>FNameEntry</h2><p>20250313192458</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313192458.png alt=FNameEntry></a><figcaption class=image-caption>20250313192458</figcaption></figure>这里同样存在一个只有在编译运行时才有效的宏，因此它的成员变量如下所示，只有一个 <code>FNameEntryHeader Header;</code> 和一个联合体，它们都会参与后续的字符串转换。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>FNameEntry</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl><span class=cp>#if WITH_CASE_PRESERVING_NAME
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=n>FNameEntryId</span> <span class=n>ComparisonId</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=n>FNameEntryHeader</span> <span class=n>Header</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>union</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ANSICHAR</span> <span class=n>AnsiName</span><span class=p>[</span><span class=n>NAME_SIZE</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>WIDECHAR</span> <span class=n>WideName</span><span class=p>[</span><span class=n>NAME_SIZE</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h6 class=heading-element id=fnameentryheader><span>FNameEntryHeader</span>
<a href=#fnameentryheader class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h6><p>然后看同文件下面的 FNameEntryHeader 结构。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313192828.png title=20250313192828 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313192828.png data-sub-html="<h2>FNameEntryHeader</h2><p>20250313192828</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313192828.png alt=FNameEntryHeader></a><figcaption class=image-caption>20250313192828</figcaption></figure></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>FNameEntryHeader</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>uint16</span> <span class=nl>bIsWide</span> <span class=p>:</span> <span class=mi>1</span><span class=p>;</span>                         <span class=c1>// 标记是否为宽字符（Unicode）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#if WITH_CASE_PRESERVING_NAME
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=n>uint16</span> <span class=nl>Len</span> <span class=p>:</span> <span class=mi>15</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#else
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=k>static</span> <span class=k>constexpr</span> <span class=n>uint32</span> <span class=n>ProbeHashBits</span> <span class=o>=</span> <span class=mi>5</span><span class=p>;</span>  <span class=c1>// 哈希值位数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>uint16</span> <span class=nl>LowercaseProbeHash</span> <span class=p>:</span> <span class=n>ProbeHashBits</span><span class=p>;</span>  <span class=c1>// 小写哈希值（5 位）
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>uint16</span> <span class=nl>Len</span> <span class=p>:</span> <span class=mi>10</span><span class=p>;</span>                            <span class=c1>// 字符串长度（最大 1023）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#endif
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=p>};</span></span></span></code></pre></td></tr></table></div></div><p>这里忽略编译运行时才有效的宏，那么这里的结构就是如下所示。由此该类指示了是否为宽字符，同时保存了字符串哈希，字符串长度，总共使用 2 字节空间。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>| bIsWide (1 bit) | LowercaseProbeHash (5 bits) | Len (10 bits) |
</span></span><span class=line><span class=cl>| --------------- | --------------------------- | ------------- |</span></span></code></pre></td></tr></table></div></div><p>然后看位于 <strong>4.27.2\Engine\Source\Runtime\Core\Private\UObject\UnrealNames.cpp</strong> 的 GetPlainNameString 函数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313195030.png title=20250313195030 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313195030.png data-sub-html="<h2>GetPlainNameString</h2><p>20250313195030</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313195030.png alt=GetPlainNameString></a><figcaption class=image-caption>20250313195030</figcaption></figure>这里的 Header 就是上文 FNameEntry 中的 <code>FNameEntryHeader Header;</code>，它利用变量 bIsWide 来判断是否为宽字符，然后根据这个判断返回对应类型的字符串。之后可以看同文件下的 <code>GetUnterminatedName()</code> 函数，它的作用只是返回 FNameEntry 中存储的对应类型字符串。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313195352.png title=20250313195352 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313195352.png data-sub-html="<h2>GetUnterminatedName()</h2><p>20250313195352</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313195352.png alt=GetUnterminatedName()></a><figcaption class=image-caption>20250313195352</figcaption></figure></p><h5 class=heading-element id=总结><span>总结</span>
<a href=#%e6%80%bb%e7%bb%93 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>这里的 ToString() 函数会调用两个关键函数 <code>GetDisplayNameEntry()->GetPlainNameString()</code>，而 <code>GetDisplayNameEntry()</code> 又依次调用 <code>GetNamePool()</code>，<code>GetDisplayIndex()</code>，<code>Resolve()</code> 三个函数。</p><ul><li><code>GetNamePool()</code> 函数主要用于初始化并返回 <code>FNamePool NamePoolData</code>，这个 NamePoolData 就是之前找的 GName。</li><li><code>GetDisplayIndex()</code> 主要用于返回对象名称的索引，它返回类型为 FNameEntryId，其成员变量只有一个 <code>uint32 Value;</code>。同时此函数内部调用 <code>GetDisplayIndexFast()</code> 获取 ComparisonIndex，该索引值直接存储在 FName 对象中，可通过 UObjectBase 的 NamePrivate 成员直接提取。</li><li><code>Resolve()</code> 根据索引从名称池中解析出对应的目录项，返回 FNameEntry 对象。此对象通过位域（bIsWide 标志位）判断字符串编码类型（ASCII 或宽字符），并通过联合体（Union）兼容不同编码的字符串存储。</li></ul><p>最后 <code>Resolve()</code> 返回的 FNameEntry 对象将调用 <code>GetPlainNameString()</code> 方法，将内部存储的原始字符串转换为 FString 类型输出。此过程根据 bIsWide 标志自动选择字符编码处理逻辑，确保字符串内容的准确性。</p><h4 class=heading-element id=getnamefromid><span>getNameFromId</span>
<a href=#getnamefromid class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>知道了 <code>ToString()</code> 是怎么解析的，那么就可以来看看 getNameFromId 是怎么获取到字符串名字的。这里的流程就是从 GName 中获取 FNameEntryAllocator 结构的 Blocks 结构，然后调用 <code>Resolve()</code> 函数进行解析，得到了 FNameEntry 结构。这个结构就存储着字符串的名称，然后通过相关比特位判断是否为宽字符，同时得到字符长度，然后就直接根据该结构获取字符串即可。</p><h5 class=heading-element id=得到-fnameentry><span>得到 FNameEntry</span>
<a href=#%e5%be%97%e5%88%b0-fnameentry class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>因此这里首先分析如何得到 FNameEntry。从上文可以知道 GName 就是 FNamePoolData 结构，它的类型为 FNamePool。而 FNamePool 的第一个成员变量就是 <code>FNameEntryAllocator Entries;</code>，因此就直接知道，GName 的地址也是 FNameEntryAllocator 结构的地址。然后再从 FNameEntryAllocator 中获取到 Blocks 的偏移。这里 FNameEntryAllocator 的结构如下所示：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>FNameEntryAllocator</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=k>enum</span> <span class=p>{</span> <span class=n>Stride</span> <span class=o>=</span> <span class=k>alignof</span><span class=p>(</span><span class=n>FNameEntry</span><span class=p>)</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>	<span class=k>enum</span> <span class=p>{</span> <span class=n>BlockSizeBytes</span> <span class=o>=</span> <span class=n>Stride</span> <span class=o>*</span> <span class=n>FNameBlockOffsets</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>mutable</span> <span class=n>FRWLock</span> <span class=n>Lock</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>uint32</span> <span class=n>CurrentBlock</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>uint32</span> <span class=n>CurrentByteCursor</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>uint8</span><span class=o>*</span> <span class=n>Blocks</span><span class=p>[</span><span class=n>FNameMaxBlocks</span><span class=p>]</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>它存在一个 FRWLock 的结构，但是不知道它的具体大小。而因为是 Android 的游戏分析，所以可以找到其相关的定义。首先可以从 <strong>4.27.2\Engine\Source\Runtime\Core\Public\Android\AndroidCriticalSection.h</strong> 找到 FRWLock 的类型。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313223325.png title=20250313223325 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313223325.png data-sub-html="<h2>FRWLock</h2><p>20250313223325</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313223325.png alt=FRWLock></a><figcaption class=image-caption>20250313223325</figcaption></figure>之后可以从 <strong>4.27.2\Engine\Source\Runtime\Core\Public\HAL\PThreadRWLock.h</strong> 中找到 FPThreadsRWLock。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313223419.png title=20250313223419 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313223419.png data-sub-html="<h2>FPThreadsRWLock</h2><p>20250313223419</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250313223419.png alt=FPThreadsRWLock></a><figcaption class=image-caption>20250313223419</figcaption></figure>这个 FPThreadsRWLock 只有一个成员变量，如下所示：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>FPThreadsRWLock</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=n>pthread_rwlock_t</span> <span class=n>Mutex</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>因此可以知道，这个 FRWLock 的大小，就是 pthread_rwlock_t 的大小，而这个数据类型定义在 &lt;pthread.h> 这个 Linux 库文件中，所以可以直接得到它的大小。在 在 32 位安卓平台上此成员大小为0x28，在 64 位安卓平台上是0x38。由此再加上两个 uint32 类型数据，也就是 <code>0x38 + 0x4 + 0x4 = 0x40</code> 得到了 Blocks 的偏移。</p><p>之后就是实现 <code>Entries.Resolve()</code> 函数，也就是获取 <code>Blocks[Handle.Block] + Stride * Handle.Offset</code>。而 Block 和 Offset 是 FNameEntryHandle 构造函数中计算的变量，其通过传入的 ComparisonIndex 计算出相关结果。然后结合上述相关的 frida 代码来看：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl>    <span class=c1>// 获取 Blocks 数组中块实例的地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>BlockInstance</span> <span class=o>=</span> <span class=nx>Blocks</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Block</span> <span class=o>*</span> <span class=nx>size_Block</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 计算 Resolve 返回的 FNameEntry 类型地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>FNameEntry</span> <span class=o>=</span> <span class=nx>BlockInstance</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>size_Stride</span> <span class=o>*</span> <span class=nx>Offset</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div><p>这里的 size_Block 就是 <code>uint8*</code> 这个指针的大小，因为 Blocks 的数据类型是个指针，所以这个数组中的每个元素就是 8 字节大小。同时这里的 size_Stride 为 2 字节大小，它这里使用 alignof(FNameEntry)，含义就是 Stride 和 FNameEntry 的对齐要求一样。又 FNameEntry 中存在 FNameEntryHeader 这个数据，它大小为 2 字节，所以 FNameEntry 会按照 2 字节对齐（Union 中的 ANSICHAR 和 WIDECHAR 就是 char 和 wchar_t，一个 8 bit，一个 16 bit，也满足）。因此这里的 Stride 就是 2 字节。然后就可以得到 FNameEntry 这个结构了。</p><h5 class=heading-element id=获得字符串名字><span>获得字符串名字</span>
<a href=#%e8%8e%b7%e5%be%97%e5%ad%97%e7%ac%a6%e4%b8%b2%e5%90%8d%e5%ad%97 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>之后因为 FNameEntryHeader 就是 FNameEntry 的第一个成员变量，且为 2 字节大小，因此直接使用 readU16 就到了。后面再由 FNameEntryHeader 中宽字符判断标志和字符长度的 bit 位获取相应的结果。然后在 FNameEntry 的字符串 union 中得到字符串地址，根据字符长度读取相应的字符串名字。具体的流程如下所示：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl>    <span class=c1>// 获取字符串地址，长度，是否为宽字符标识
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>str_addr</span> <span class=o>=</span> <span class=nx>FNameEntry</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>offset_Union</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>str_length</span> <span class=o>=</span> <span class=nx>FNameEntryHeader</span> <span class=o>&gt;&gt;</span> <span class=nx>offset_LenBit</span><span class=p>;</span>             <span class=c1>// 计算字符串长度
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>wide</span> <span class=o>=</span> <span class=nx>FNameEntryHeader</span> <span class=o>&amp;</span> <span class=nx>bIsWideBit</span><span class=p>;</span>                       <span class=c1>// 判断字符串是否为宽字符
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// 如果是宽字符，返回 &#34;widestr&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>wide</span><span class=p>)</span> <span class=k>return</span> <span class=s2>&#34;widestr&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 如果字符串长度合理，读取并返回UTF-8字符串
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>str_length</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=nx>str_length</span> <span class=o>&lt;</span> <span class=mi>250</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>str_addr</span><span class=p>.</span><span class=nx>readUtf8String</span><span class=p>(</span><span class=nx>str_length</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;None&#34;</span><span class=p>;</span> <span class=c1>// 长度不合理，返回 &#34;None&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=获取坐标><span>获取坐标</span>
<a href=#%e8%8e%b7%e5%8f%96%e5%9d%90%e6%a0%87 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>位于 <strong>4.27.2\Engine\Source\Runtime\Engine\Classes\GameFramework\Actor.h</strong> 的 <code>K2_GetActorLocation()</code> 函数实现了对于坐标的获取，因此这里的任务就是解析这个函数，查看它是如何获取 Actor 地址的。不过这个函数出现在 dump 的 SDK 中，因此也可以通过偏移直接获取该函数，之后调用这个函数就可以得到地址。</p><h4 class=heading-element id=解析函数><span>解析函数</span>
<a href=#%e8%a7%a3%e6%9e%90%e5%87%bd%e6%95%b0 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><h5 class=heading-element id=getactorlocation><span>GetActorLocation</span>
<a href=#getactorlocation class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>查看这个函数的实现，可以发现它实际上只是调用了 <code>GetActorLocation()</code> 这个函数，而这个函数才是实际上获取 Actor 坐标的函数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320111314.png title=20250320111314 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320111314.png data-sub-html="<h2>K2_GetActorLocation()</h2><p>20250320111314</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320111314.png alt=K2_GetActorLocation()></a><figcaption class=image-caption>20250320111314</figcaption></figure>之后查看实现于同目录的 <code>GetActorLocation()</code> 函数，发现只是调用的 <code>TemplateGetActorLocation()</code> 函数，同时传入了 <code>RootComponent</code> 这个变量。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320111348.png title=20250320111348 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320111348.png data-sub-html="<h2>GetActorLocation()</h2><p>20250320111348</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320111348.png alt=GetActorLocation()></a><figcaption class=image-caption>20250320111348</figcaption></figure><code>RootComponent</code> 变量也是位于同目录，它是 AActor 类的一个成员变量，是一个指向 USceneComponent 类的指针。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320111736.png title=20250320111736 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320111736.png data-sub-html="<h2>RootComponent</h2><p>20250320111736</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320111736.png alt=RootComponent></a><figcaption class=image-caption>20250320111736</figcaption></figure>继续分析 <code>TemplateGetActorLocation()</code> 函数，可以看到这里就是判断 <code>RootComponent</code> 是否为空，不为空就通过调用 <code>RootComponent->GetComponentLocation()</code>，也就是调用 USceneComponent 类的相关函数来获取地址，否则就是赋值为零。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320111928.png title=20250320111928 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320111928.png data-sub-html="<h2>TemplateGetActorLocation()</h2><p>20250320111928</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320111928.png alt=TemplateGetActorLocation()></a><figcaption class=image-caption>20250320111928</figcaption></figure>然后继续追进，查看位于 <strong>4.27.2\Engine\Source\Runtime\Engine\Classes\Components\SceneComponent.h</strong> 的 <code>GetComponentLocation()</code> 函数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320112312.png title=20250320112312 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320112312.png data-sub-html="<h2>GetComponentLocation()</h2><p>20250320112312</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320112312.png alt=GetComponentLocation()></a><figcaption class=image-caption>20250320112312</figcaption></figure>由上面的内容，知道这个函数就是 USceneComponent 类的一个成员函数，可以看到调用了 <code>GetComponentTransform()</code> 和 <code>GetLocation()</code> 两个函数，之后就是对于这两个函数进行分析。</p><h5 class=heading-element id=getcomponenttransform><span>GetComponentTransform</span>
<a href=#getcomponenttransform class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>这里查看处于同目录的 <code>GetComponentTransform()</code> 函数，可以发现返回一个 FTransform 类型对象的引用。然后返回了 <code>ComponentToWorld</code> 这个变量。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320112925.png title=20250320112925 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320112925.png data-sub-html="<h2>GetComponentTransform()</h2><p>20250320112925</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320112925.png alt=GetComponentTransform()></a><figcaption class=image-caption>20250320112925</figcaption></figure>之后继续寻找，在同目录中发现了这个变量，它是 USceneComponent 类中 FTransform 类型的私有成员变量。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320112957.png title=20250320112957 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320112957.png data-sub-html="<h2>ComponentToWorld</h2><p>20250320112957</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320112957.png alt=ComponentToWorld></a><figcaption class=image-caption>20250320112957</figcaption></figure></p><h5 class=heading-element id=getlocation><span>GetLocation</span>
<a href=#getlocation class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>之后分析 <strong>4.27.2\Engine\Source\Runtime\Core\Public\Math\TransformVectorized.h</strong> 的 <code>GetLocation()</code> 函数。发现实际还是调用同目录下的 <code>GetTranslation()</code> 函数，并且返回的类型为 FVector 类型。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320113327.png title=20250320113327 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320113327.png data-sub-html="<h2>GetLocation()</h2><p>20250320113327</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320113327.png alt=GetLocation()></a><figcaption class=image-caption>20250320113327</figcaption></figure>然后查看位于 <strong>4.27.2\Engine\Source\Runtime\Core\Public\Math\Vector.h</strong> 的 FVector 结构体。由下可以看出这个结构就是存储坐标的结构，其中的成员变量 <code>X,Y,Z</code> 就是代表了坐标。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320123546.png title=20250320123546 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320123546.png data-sub-html="<h2>FVector</h2><p>20250320123546</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320123546.png alt=FVector></a><figcaption class=image-caption>20250320123546</figcaption></figure>之后查看 <code>GetTranslation()</code> 函数，其中 <code>DiagnosticCheckNaN_Translate()</code> 是调试用的函数，用于检查 Translation 中是否存在非法值，因此这里可以忽略。同时这里定义了一个 FVector 类型的变量 OutTranslation，之后通过 <code>VectorStoreFloat3()</code> 函数对于这个变量进行赋值并返回。由上述对于 FVector 结构的分析，这个就是最后会得到的坐标了。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320113353.png title=20250320113353 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320113353.png data-sub-html="<h2>GetTranslation()</h2><p>20250320113353</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320113353.png alt=GetTranslation()></a><figcaption class=image-caption>20250320113353</figcaption></figure>查看 <strong>4.27.2\Engine\Source\Runtime\Core\Public\Math\UnrealMathSSE.h</strong> 中 <code>VectorStoreFloat3()</code> 函数的作用。有下面的函数内容可以知道，它就是把第一个参数的 Vec 中存储的坐标信息赋值给了第二个参数 Ptr。对应于 <code>GetTranslation()</code> 函数就是把 Translation 中的坐标信息赋值给了 OutTranslation。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320124233.png title=20250320124233 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320124233.png data-sub-html="<h2>VectorStoreFloat3()</h2><p>20250320124233</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320124233.png alt=VectorStoreFloat3()></a><figcaption class=image-caption>20250320124233</figcaption></figure>查看 <strong>4.27.2\Engine\Source\Runtime\Core\Public\Math\TransformVectorized.h</strong> 中 FTransform 的成员变量 Translation。同时由上面的代码 <code>union { VectorRegister v; float f[4]; } Tmp;</code> 可以知道这里的 VectorRegister 就是 4 个 float 的变量，其中前面三个表示坐标的 <code>X,Y,Z</code>。所以这里可以知道，得到了这个 Translation 数据，那么就得到了这个 Actor 的坐标。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320124447.png title=20250320124447 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320124447.png data-sub-html="<h2>Translation</h2><p>20250320124447</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320124447.png alt=Translation></a><figcaption class=image-caption>20250320124447</figcaption></figure></p><h4 class=heading-element id=变量获取坐标><span>变量获取坐标</span>
<a href=#%e5%8f%98%e9%87%8f%e8%8e%b7%e5%8f%96%e5%9d%90%e6%a0%87 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>由上述分析，获取存储坐标变量 Translation 的过程很明确了。首先在 AActor 类中获取 RootComponent 变量，它是 USceneComponent 类的对象指针。然后在 USceneComponent 类中获取 FTransform 类型的 ComponentToWorld 变量。根据 FTransform 的类型，ComponentToWorld 的 Translation 就是 Actor 的坐标。</p><h5 class=heading-element id=rootcomponent><span>RootComponent</span>
<a href=#rootcomponent class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>这里首先获取 RootComponent 的偏移，根据 dump SDK 的信息，在 <code>Class: Actor.Object</code> 中可以找到这个变量。这里的 SceneComponent 就是指 USceneComponent 类，它在不同 sdk 中的前缀不一样。然后看这里的信息，可以发现其偏移大小为 0x130。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320125553.png title=20250320125553 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320125553.png data-sub-html="<h2>RootComponent</h2><p>20250320125553</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320125553.png alt=RootComponent></a><figcaption class=image-caption>20250320125553</figcaption></figure></p><h5 class=heading-element id=componenttoworld><span>ComponentToWorld</span>
<a href=#componenttoworld class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>之后寻找 ComponentToWorld，它处于 sdk 的 SceneComponent 类型中。不过 sdk 中只显示出 public 的成员变量，但是 ComponentToWorld 是 private 的成员变量，所以这里就没有显示，最大的偏移大小为 0x151，那么 ComponentToWorld 肯定比这个偏移大。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320125800.png title=20250320125800 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320125800.png data-sub-html="<h2>ComponentToWorld</h2><p>20250320125800</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320125800.png alt=ComponentToWorld></a><figcaption class=image-caption>20250320125800</figcaption></figure>对于上面的情况，就需要根据源码来计算具体偏移了，找到 USceneComponent 的类源码，然后发现变量 PhysicsVolumeChangedDelegate 在 sdk 中偏移大小为 0x151，类型大小为一个字节。由此根据类型的大小计算 ComponentToWorld 的偏移地址。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320130120.png title=20250320130120 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320130120.png data-sub-html="<h2>USceneComponent</h2><p>20250320130120</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320130120.png alt=USceneComponent></a><figcaption class=image-caption>20250320130120</figcaption></figure>这里通过计算可以确定 ComponentToWorld 的偏移地址为 0x1c0。</p><h5 class=heading-element id=translation><span>Translation</span>
<a href=#translation class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>FTransform 结构中的 Translation 变量是 protected 成员变量，所以也不会在 sdk 中出现，因此这里也是需要通过计算类型大小来得到偏移。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320124447.png title=20250320124447 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320124447.png data-sub-html="<h2>Translation</h2><p>20250320124447</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320124447.png alt=Translation></a><figcaption class=image-caption>20250320124447</figcaption></figure>这里通过计算得到 Translation 的偏移地址为 0x10。</p><h5 class=heading-element id=获取坐标-1><span>获取坐标</span>
<a href=#%e8%8e%b7%e5%8f%96%e5%9d%90%e6%a0%87-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>根据上面的过程，就可以写出下面 frida 的代码来获取 Actor 的坐标了。这里代码获取的就是 <code>FirstPersonCharacter_C</code> 这个 Actor 的坐标位置。需要注意不是所有 Actor 都有 USceneComponent 类型的 RootComponent，因此需要先进行判断。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>dumpVector</span><span class=p>(</span><span class=nx>addr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>vec</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Vector</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>Memory</span><span class=p>.</span><span class=nx>readFloat</span><span class=p>(</span><span class=nx>addr</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>Memory</span><span class=p>.</span><span class=nx>readFloat</span><span class=p>(</span><span class=nx>addr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mi>4</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=nx>Memory</span><span class=p>.</span><span class=nx>readFloat</span><span class=p>(</span><span class=nx>addr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>  <span class=c1>// 读取内存中的浮点数，3个浮点数分别对应x, y, z，每个浮点数占4个字节
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;[+] 坐标：&#39;</span><span class=p>,</span> <span class=nx>vec</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getActorLocation1</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>RootComponent</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x130</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>RootComponent</span> <span class=o>==</span> <span class=mh>0x0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] RootComponent is null`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ComponentToWorld</span> <span class=o>=</span> <span class=nx>RootComponent</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x1c0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Translation</span> <span class=o>=</span> <span class=nx>ComponentToWorld</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>dumpVector</span><span class=p>(</span><span class=nx>Translation</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>init</span><span class=p>(</span><span class=s2>&#34;libUE4.so&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>playerActorAddr</span> <span class=o>=</span> <span class=nx>getPlayActorAddr</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>getActorLocation1</span><span class=p>(</span><span class=nx>playerActorAddr</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p><figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320131115.png title=20250320131115 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320131115.png data-sub-html="<h2>运行结果</h2><p>20250320131115</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320131115.png alt=运行结果></a><figcaption class=image-caption>20250320131115</figcaption></figure></p><h4 class=heading-element id=函数获取坐标><span>函数获取坐标</span>
<a href=#%e5%87%bd%e6%95%b0%e8%8e%b7%e5%8f%96%e5%9d%90%e6%a0%87 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>若是 Actor 不存在 RootComponent，还可以通过 <code>K2_GetActorLocation()</code> 这个函数来获取 Actor 的坐标位置。下面就是这个函数在 so 中的偏移位置。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320131315.png title=20250320131315 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320131315.png data-sub-html="<h2>K2_GetActorLocation()</h2><p>20250320131315</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320131315.png alt=K2_GetActorLocation()></a><figcaption class=image-caption>20250320131315</figcaption></figure>然后找到 so 中的这个函数，通过相关偏移 0x130，0x1D0 确定了第一个参数是 actor 的地址，然后修改相关变量名称为 RootComponent，Translation 和 FVector。这样就知道这个函数的参数信息和具体操作了，可以得到第三个参数就是获取到的 FVector 类型的坐标。</p><p>这里需要补充一下，该函数实际是 <code>GetActorLocation()</code> 函数的内容，但是我们寻找的偏移是 <code>K2_GetActorLocation</code> 函数的偏移，而这里之所以这样是因为上述函数存在一个宏 FORCEINLINE，表示该函数是内联函数。因此这些函数在编译时直接展开到调用处，这里看到的偏移也就是实际函数的位置了。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320132356.png title=20250320132356 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320132356.png data-sub-html="<h2>so 函数</h2><p>20250320132356</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250320132356.png alt="so 函数"></a><figcaption class=image-caption>20250320132356</figcaption></figure>之后就可以写出下面 frida 的代码来获取 Actor 的坐标了。这里函数的第二个参数不确定，传入 actorAddr 会造成 crash，而传入 buf 就可以正常得到输出。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getActorLocation2</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>buf</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mh>0x100</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x965ddf8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>GetActorLocation</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NativeFunction</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=s1>&#39;void&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;pointer&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nx>GetActorLocation</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>buf</span><span class=p>,</span> <span class=nx>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>dumpVector</span><span class=p>(</span><span class=nx>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>init</span><span class=p>(</span><span class=s2>&#34;libUE4.so&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>playerActor</span> <span class=o>=</span> <span class=nx>getPlayActor</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>getActorLocation2</span><span class=p>(</span><span class=nx>playerActor</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>然后得到的结果和上面代码的结果一样，同时不断测试发现这里向后 x 轴数据变大，向左 y 轴数据变大。</p><h2 class=heading-element id=section0><span>Section0</span>
<a href=#section0 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><div class="details admonition tip open disabled"><div class="details-summary admonition-title"><i class="icon fa-fw fa-regular fa-lightbulb" aria-hidden=true></i>背景</div><div class=details-content><div class=admonition-content><p>玩家被关在房间中，碰到墙体和门都会血条清零重新开始，只有左边摇杆可以控制前后左右，右侧摇杆没有作用。目的就是打开门并逃出房间。</p></div></div></div><p>由上述背景，首先就需要找到这个玩家是哪个 Actor，然后根据相应的 Actor 类进行操作。而这里根据对于 FPS 游戏的理解，玩家就是第一人人称视角，所以可以从获取的所有 Actor 名称中找到最适宜的玩家名称 <code>FirstPersonCharacter_C</code>。然后可以从 dump 的 sdk 中找到其继承关系 <code>Class: FirstPersonCharacter_C.Character.Pawn.Actor.Object</code>，可以看出其具备完整角色控制功能（Character）、玩家输入响应（Pawn）以及基础场景交互（Actor）等核心特性，那么之后就是对于这个 Actor 进行分析了。</p><h3 class=heading-element id=修改血量><span>修改血量</span>
<a href=#%e4%bf%ae%e6%94%b9%e8%a1%80%e9%87%8f class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>这里查看 dump 的 SDK，可以发现 <a href=https://github.com/revercc/UE4Dumper target=_blank rel="external nofollow noopener noreferrer">UE4Dumper</a> 和 <a href=https://github.com/hackcatml/frida-ue4dump target=_blank rel="external nofollow noopener noreferrer">frida-ue4dump</a> 的 sdk 结果不同。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250318124547.png title=20250318124547 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250318124547.png data-sub-html="<h2>UE4Dumper 结果</h2><p>20250318124547</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250318124547.png alt="UE4Dumper 结果"></a><figcaption class=image-caption>20250318124547</figcaption></figure><figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250318124417.png title=20250318124417 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250318124417.png data-sub-html="<h2>frida-ue4dump 结果</h2><p>20250318124417</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250318124417.png alt="frida-ue4dump 结果"></a><figcaption class=image-caption>20250318124417</figcaption></figure>上述的 sdk 中，UE4Dumper 中直接显示了 <strong>生命值</strong> 的偏移，所以考虑修改血量，使其碰触墙壁不死亡。然后首先查看血量，发现是 100，之后就是不断调整这个血量值，查看什么时候可以穿过门。这里首先尝试 10000，发现可以通过，然后不断降低寻找扣除血量的具体值，之后就降低到了 2000。不过后面的查找太过于繁琐，所以就维持 2000 了，同时在尝试中发现门和墙扣除的血量不同，2000 碰触墙壁也是直接死亡。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>cachedPlayerAddr</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span> <span class=c1>// 缓存玩家角色地址
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>getPlayActorAddr</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>cachedPlayerAddr</span><span class=p>)</span> <span class=k>return</span> <span class=nx>cachedPlayerAddr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>playerName</span> <span class=o>=</span> <span class=s2>&#34;FirstPersonCharacter_C&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorsAddr</span> <span class=o>=</span> <span class=nx>getActorsMap</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>actorsAddr</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>playerName</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>cachedPlayerAddr</span> <span class=o>=</span> <span class=nx>actorsAddr</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>playerName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[*] playerName: </span><span class=si>${</span><span class=nx>playerName</span><span class=si>}</span><span class=sb>, playerAddr: </span><span class=si>${</span><span class=nx>cachedPlayerAddr</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>cachedPlayerAddr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>section0_1</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>getPlayActor</span><span class=p>().</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x510</span><span class=p>).</span><span class=nx>writeFloat</span><span class=p>(</span><span class=mi>2000</span><span class=p>);</span> <span class=c1>// 这里穿过门和碰触墙扣的血量不同，2000 即可穿过门而不死亡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// console.log(`blood: ${getPlayActor().add(0x510).readFloat()}`);
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>init</span><span class=p>(</span><span class=s2>&#34;libUE4.so&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>section0_1</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>因此添加上面的代码，修改生命值偏移的 float 值，进行加血的操作。然后可以发现可以通过 sectin0 的那道门了，同时左上角血量 UI 清零，但是根据代码可以知道，其数值不会为零，也就不会重置世界。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250318131240.png title=20250318131240 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250318131240.png data-sub-html="<h2>通过 section0</h2><p>20250318131240</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250318131240.png alt="通过 section0"></a><figcaption class=image-caption>20250318131240</figcaption></figure></p><h3 class=heading-element id=实现瞬移><span>实现瞬移</span>
<a href=#%e5%ae%9e%e7%8e%b0%e7%9e%ac%e7%a7%bb class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>这里除了修改血量之外，要逃出房间，还可以采用瞬移的方式。上文提到了 Actor 类中的 <code>K2_GetActorLocation()</code> 函数可以显示 Actor 的坐标，同时 Actor 类中还存在 <code>K2_SetActorLocation()</code> 函数，它可以实现对于 Actor 坐标的修改，从而实现瞬移。由此之后就是分析位于 <strong>4.27.2\Engine\Source\Runtime\Engine\Classes\GameFramework\Actor.h</strong> 的这个函数。上面存在对于这个函数参数的解释：</p><ul><li><code>NewLocation</code> 指向了 <code>Actor</code> 的目标位置。直接指定移动的目的地。</li><li><code>bSweep</code> 则是是否检测碰撞。若为 <code>true</code>：移动时会检测路径上的碰撞（仅对根组件有效），遇到障碍物则停止移动，并触发碰撞事件；若为 <code>false</code>：直接设置位置，无视碰撞。</li><li><code>SweepHitResult</code> 表示碰撞结果。返回移动过程中遇到的碰撞信息（如碰撞点、法线、碰撞对象等），用于后续逻辑处理（如播放音效、触发伤害）。</li><li><code>bTeleport</code> 表示是否传送物理状态。若为 <code>true</code>：物理状态（如速度）保持不变，适用于瞬移（如传送门效果）；若为 <code>false</code>：物理速度会根据移动距离更新，适用于推动物体或物理模拟；</li></ul><p><figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321171306.png title=20250321171306 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321171306.png data-sub-html="<h2>K2_SetActorLocation()</h2><p>20250321171306</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321171306.png alt=K2_SetActorLocation()></a><figcaption class=image-caption>20250321171306</figcaption></figure>其实现位于 <strong>4.27.2\Engine\Source\Runtime\Engine\Private\Actor.cpp</strong>，同时也是调用函数 <code>SetActorLocation()</code> 函数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321171434.png title=20250321171434 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321171434.png data-sub-html="<h2>K2_SetActorLocation()</h2><p>20250321171434</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321171434.png alt=K2_SetActorLocation()></a><figcaption class=image-caption>20250321171434</figcaption></figure>找到同目录下的 <code>SetActorLocation()</code> 函数，可以看出其具体逻辑。这个函数就是将新的坐标和当前坐标相减，获得坐标的差值 <code>delta</code>，之后使用 <code>RootComponent->MoveComponent()</code> 函数来移动当前坐标到新坐标，它有六个参数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321171634.png title=20250321171634 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321171634.png data-sub-html="<h2>SetActorLocation()</h2><p>20250321171634</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321171634.png alt=SetActorLocation()></a><figcaption class=image-caption>20250321171634</figcaption></figure>从这里可以看出 SetActorLocation 的过程很复杂，涉及到很多结构，所以这里不像上述获取坐标过程一样通过解析函数获取，而是直接通过调用这里的 <code>K2_SetActorLocation()</code> 来修改 Actor 的坐标。由此看到下面 SDK 中该函数的偏移位置。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321181905.png title=20250321181905 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321181905.png data-sub-html="<h2>SDK 信息</h2><p>20250321181905</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321181905.png alt="SDK 信息"></a><figcaption class=image-caption>20250321181905</figcaption></figure>之后在 so 文件中查找该函数的偏移 0x965dc3c，之后可以看到下面的结果。该函数只有三个参数，同时最后也是 return 一个函数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321182011.png title=20250321182011 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321182011.png data-sub-html="<h2>so 中函数</h2><p>20250321182011</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321182011.png alt="so 中函数"></a><figcaption class=image-caption>20250321182011</figcaption></figure><figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321182036.png title=20250321182036 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321182036.png data-sub-html="<h2>so 中函数</h2><p>20250321182036</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321182036.png alt="so 中函数"></a><figcaption class=image-caption>20250321182036</figcaption></figure>由此继续查看这个返回的函数 <code>sub_8C3181C</code>，就看到了下面的内容，同时根据相关偏移对变量进行了重命名操作，因此可以看得更为明显一些。这里 <code>RootComponent + 0x4B8</code> 部分的函数应该就是源码的 <code>RootComponent->MoveComponent()</code> 函数，同时根据上文调用该函数时第二个参数的对比 <code>v8 != 0</code>，可以猜测这里实现的就是 <code>SetActorLocation()</code> 函数的逻辑。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321182134.png title=20250321182134 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321182134.png data-sub-html="<h2>so 中函数</h2><p>20250321182134</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321182134.png alt="so 中函数"></a><figcaption class=image-caption>20250321182134</figcaption></figure>再对这个函数进行分析，下面的结果中存在 <code>RootComponent + 0x1D0</code> 和 <code>RootComponent + 0x1D8</code>，它们分别获取原本 Actor 做坐标的 X、Z 的数据。同时这里也使用了 <code>vsub_f32</code> 来进行向量的逐元素减法，下面也是使用参数 <code>a7</code> 减去获取到的原 Z 轴坐标。因此这里函数的后面三个参数 <code>a5</code>，<code>a6</code>，<code>a7</code> 对应的应该就是 <code>X，Y，Z</code> 三个坐标值。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321183807.png title=20250321183807 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321183807.png data-sub-html="<h2>sub_8C3181C</h2><p>20250321183807</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321183807.png alt=sub_8C3181C></a><figcaption class=image-caption>20250321183807</figcaption></figure>同时通过下面对于 <code>RootComponent->MoveComponent()</code> 的调用可以看出 <code>a2</code> 和 <code>a4</code> 两个参数都只是获取最低位，由此怀疑其为 bool 类型数据。再结合 <code>K2_SetActorLocation()</code> 的函数源码，可以猜测 <code>a2</code> 为 <code>bSweep</code>，<code>a4</code> 为 <code>bTeleport</code>，它们都是 bool 变量，而 <code>a3</code> 为 <code>SweepHitResult</code>，它是一个指向FHitResult 结构的指针。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321184529.png title=20250321184529 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321184529.png data-sub-html="<h2>sub_8C3181C</h2><p>20250321184529</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321184529.png alt=sub_8C3181C></a><figcaption class=image-caption>20250321184529</figcaption></figure>由此可以写出下面的代码修改 Actor 的坐标。这里不使用 <code>sub_965dc3c</code> 函数是因为不能通过参数传递坐标，这个函数使用的坐标是通过内部别的函数获取的，因此使用这个函数会比较麻烦。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>setActorLocation</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>,</span> <span class=nx>z</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x8C3181C</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>SetLocationFunc</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NativeFunction</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>,</span> <span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>,</span> <span class=s1>&#39;float&#39;</span><span class=p>,</span> <span class=s1>&#39;float&#39;</span><span class=p>,</span> <span class=s1>&#39;float&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nx>SetLocationFunc</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>ptr</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>,</span> <span class=nx>z</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>section0_2</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>playerActor</span> <span class=o>=</span> <span class=nx>getPlayActorAddr</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 下面的坐标就是通过加血逃出房间后的坐标，也可以不断进行尝试来修改坐标以逃出房间
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>setActorLocation</span><span class=p>(</span><span class=nx>playerActor</span><span class=p>,</span> <span class=o>-</span><span class=mi>1000</span><span class=p>,</span> <span class=mi>100</span><span class=p>,</span> <span class=mi>270</span><span class=p>);</span> <span class=c1>// 向后 x 轴变大，向左 y 轴变大
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>getActorLocation1</span><span class=p>(</span><span class=nx>playerActor</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>init</span><span class=p>(</span><span class=s2>&#34;libUE4.so&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>section0_2</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>最后执行成功就是更改 Actor 的坐标。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321185929.png title=20250321185929 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321185929.png data-sub-html="<h2>frida 结果</h2><p>20250321185929</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321185929.png alt="frida 结果"></a><figcaption class=image-caption>20250321185929</figcaption></figure>同时可以瞬移出去，通过 section0。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321190005.png title=20250321190005 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321190005.png data-sub-html="<h2>通过 section0</h2><p>20250321190005</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321190005.png alt="通过 section0"></a><figcaption class=image-caption>20250321190005</figcaption></figure></p><h3 class=heading-element id=实现穿墙><span>实现穿墙</span>
<a href=#%e5%ae%9e%e7%8e%b0%e7%a9%bf%e5%a2%99 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>在 <strong>4.27.2\Engine\Source\Runtime\Engine\Classes\GameFramework\Actor.h</strong> 的 <code>GetActorEnableCollision()</code> 和 <code>SetActorEnableCollision()</code> 函数可以查看和修改当前 Actor 是否能够触碰的状态。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321224304.png title=20250321224304 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321224304.png data-sub-html="<h2>触碰函数</h2><p>20250321224304</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321224304.png alt=触碰函数></a><figcaption class=image-caption>20250321224304</figcaption></figure>然后可以找到这两个函数的实现如下。可以发现获取 Actor 的碰撞状态就是查看 <code>bActorEnableCollision</code> 这个变量的信息，同时修改碰撞状态也是首先判断参数是否和原先碰撞状态相同，不同就更改这个变量，再通知其他组件执行具体的逻辑来实现碰撞状态的转换。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321224502.png title=20250321224502 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321224502.png data-sub-html="<h2>GetActorEnableCollision()</h2><p>20250321224502</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321224502.png alt=GetActorEnableCollision()></a><figcaption class=image-caption>20250321224502</figcaption></figure><figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321224531.png title=20250321224531 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321224531.png data-sub-html="<h2>SetActorEnableCollision()</h2><p>20250321224531</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321224531.png alt=SetActorEnableCollision()></a><figcaption class=image-caption>20250321224531</figcaption></figure></p><h4 class=heading-element id=查看碰撞状态><span>查看碰撞状态</span>
<a href=#%e6%9f%a5%e7%9c%8b%e7%a2%b0%e6%92%9e%e7%8a%b6%e6%80%81 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>由此可以知道 Actor 中的 <code>bActorEnableCollision</code> 就是控制 Actor 是否能够触碰的变量。由此获取这个变量的值就可以判断一个 Actor 是否可以被触碰，<code>true</code> 表示可以触碰，<code>false</code> 表示不可以触碰。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321230810.png title=20250321230810 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321230810.png data-sub-html="<h2>bActorEnableCollision</h2><p>20250321230810</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321230810.png alt=bActorEnableCollision></a><figcaption class=image-caption>20250321230810</figcaption></figure>同时 SDK 中也显示了该变量在 Actor 类中的偏移，由此可以直接获取这个值的数据。这里需要注意 <code>ByteMask</code> 为 8，它表示 00001000 中 1 的位置，也就是 bit 为 3 的位置。因为这里的类型为 <code>uint8 bActorEnableCollision:1;</code>， 它表示占据 uint8 这一个字节大小中的一个比特位，因此需要通过 <code>ByteMask</code> 这个数据查找占据哪一个 bit 位。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321231013.png title=20250321231013 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321231013.png data-sub-html="<h2>bActorEnableCollision</h2><p>20250321231013</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321231013.png alt=bActorEnableCollision></a><figcaption class=image-caption>20250321231013</figcaption></figure>然后就可以编写代码查看某个 Actor 的碰撞状态。这里返回 true 表示可以触碰，false 表示可以穿透，不会触碰。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getActorEnableCollision1</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>offset</span> <span class=o>=</span> <span class=mh>0x5C</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>bit</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>byteValue</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>readU8</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>offset</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>isEnabled</span> <span class=o>=</span> <span class=p>(</span><span class=nx>byteValue</span> <span class=o>&gt;&gt;&gt;</span> <span class=nx>bit</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0x1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>isEnabled</span> <span class=o>!==</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>之后尝试直接调用函数来查看碰撞状态，因此直接查看 SDK 中 <code>GetActorEnableCollision()</code> 函数，得到其偏移。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322105850.png title=20250322105850 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322105850.png data-sub-html="<h2>SDK 内容</h2><p>20250322105850</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322105850.png alt="SDK 内容"></a><figcaption class=image-caption>20250322105850</figcaption></figure>之后在 IDA 查看此函数，发现它存在三个参数，根据上面的知识，第一个参数应该就是 actorAddr，不过后面两个参数不能确定表示什么意思。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322105953.png title=20250322105953 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322105953.png data-sub-html="<h2>GetActorEnableCollision()</h2><p>20250322105953</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322105953.png alt=GetActorEnableCollision()></a><figcaption class=image-caption>20250322105953</figcaption></figure>在这种情况下，可以通过 frida 的报错来得到相关参数信息。首先根据后面两个参数的类型设置函数的参数为 pointer 和 bool 类型。这里采用 <code>Memory.alloc(0x28)</code> 是因为汇编中存在语句 <code>LDR X8, [X1,#0x20]</code>，它是以第二个参数 X1 为基址，然后在偏移 0x20 的位置上获取 0x8 字节赋值给 X8。因此第二个参数作为指针，要给其分配至少 0x28 字节大小以便获取，这样可以尽量避免出错。不过实际这里改为 0x19 也不会报错，而改的更小就会出现问题，目前也不知道为什么。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getActorEnableCollision2</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x965b940</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>getActorEnableCollisionFunc</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NativeFunction</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=s1>&#39;void&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>arg1</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mh>0x28</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>getActorEnableCollisionFunc</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>arg1</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>不过上述代码会报错 <code>access violation accessing 0x1</code>，这表明代码尝试访问非法内存地址 0x1，由此可以看出第三个参数不应该是 bool 类型，而应该也是一个 pointer 类型数据。因此根据这个报错更改为下面的类型：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getActorEnableCollision2</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x965b940</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>getActorEnableCollisionFunc</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NativeFunction</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=s1>&#39;void&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;pointer&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>arg1</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mh>0x19</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>arg2</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>getActorEnableCollisionFunc</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>arg1</span><span class=p>,</span> <span class=nx>arg2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>arg2</span><span class=p>.</span><span class=nx>readU8</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>修正之后就可以正常运行了，这里第三个参数虽然是 pointer 类型，但是根据 IDA 里的信息应该为 bool，所以只分配一个字节。不过不知道这里获取的 <code>bActorEnableCollision</code> 通过什么返回，由此首先尝试直接获取构造函数的返回值，但是结果是 undefined。然后读取第三个参数的结果，发现它的数值匹配，同时结合上面的 <code>getActorCollisionEnabled1()</code> 和下面的 <code>setActorCollisionEnabled()</code> 发现确实就是这个参数存储了 <code>bActorEnableCollision</code>。</p><h4 class=heading-element id=修改碰撞状态><span>修改碰撞状态</span>
<a href=#%e4%bf%ae%e6%94%b9%e7%a2%b0%e6%92%9e%e7%8a%b6%e6%80%81 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>而对于 <code>SetActorEnableCollision()</code> 函数，其实现方法复杂，因此直接采用构造函数的方法来对碰撞状态进行修改。首先找到 SDK 中函数的偏移。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321223042.png title=20250321223042 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321223042.png data-sub-html="<h2>SetActorEnableCollision()</h2><p>20250321223042</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321223042.png alt=SetActorEnableCollision()></a><figcaption class=image-caption>20250321223042</figcaption></figure>然后发现和上文的 <code>K2_SetActorLocation()</code> 函数形式差不多，所以直接查看 return 的函数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321234647.png title=20250321234647 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321234647.png data-sub-html="<h2>so 中函数</h2><p>20250321234647</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321234647.png alt="so 中函数"></a><figcaption class=image-caption>20250321234647</figcaption></figure>这里的函数就和源码的参数相似了，虽然源码只有一个 bool 类型的参数，但是根据上面解析 <code>K2_SetActorLocation()</code> 函数的经验，第一个函数应该就是 ActorAddr 这个指针，后面的参数才是源码中展示的参数。因此这里第二个参数 <code>a2</code> 应该就是源码中的 bool 类型参数 <code>bNewActorEnableCollision</code> 了。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321234750.png title=20250321234750 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321234750.png data-sub-html="<h2>so 中函数</h2><p>20250321234750</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321234750.png alt="so 中函数"></a><figcaption class=image-caption>20250321234750</figcaption></figure>由此可以直接写出修改碰撞状态的代码。这里根据上述得到的 ActorName，知道了和墙体有关的 Actor 含有 <code>Wall</code> 这个字符串，由此枚举出含有这个字符串的 Actor，都设置墙体不可碰撞，这样就实现了穿墙的操作。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>setActorEnableCollision</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>bNewActorEnableCollision</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x8C21320</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>setActorEnableCollisionFunc</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NativeFunction</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=s1>&#39;void&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nx>setActorEnableCollisionFunc</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>bNewActorEnableCollision</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>section0_3</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>wallActor</span> <span class=o>=</span> <span class=s2>&#34;Wall&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorsMap</span> <span class=o>=</span> <span class=nx>getActorsMap</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>actorName</span><span class=p>,</span> <span class=nx>actorAddr</span><span class=p>]</span> <span class=k>of</span> <span class=nx>actorsMap</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>actorName</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>wallActor</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// console.log(`[+] Found Wall actor: ${actorName}, address: ${actorAddr}`);
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>setActorEnableCollision</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=c1>// console.log(`After setActorEnableCollision`, getActorEnableCollision1(actorAddr));
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] Set Wall Actor collision disabled`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>init</span><span class=p>(</span><span class=s2>&#34;libUE4.so&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>section0_3</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>运行之后可以发现穿墙不会死亡，顺利通过 section0.<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321235318.png title=20250321235318 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321235318.png data-sub-html="<h2>通过 section0</h2><p>20250321235318</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250321235318.png alt="通过 section0"></a><figcaption class=image-caption>20250321235318</figcaption></figure></p><h3 class=heading-element id=摧毁墙体><span>摧毁墙体</span>
<a href=#%e6%91%a7%e6%af%81%e5%a2%99%e4%bd%93 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>搜索资料，发现 Actor 类中的 <code>Destory()</code> 函数是成员函数，它会立即标记 Actor 为销毁状态，并且会从场景中移除该 Actor。因此找到位于 <strong>4.27.2\Engine\Source\Runtime\Engine\Classes\GameFramework\Actor.h</strong> 的这个函数的定义。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322112954.png title=20250322112954 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322112954.png data-sub-html="<h2>Destroy()</h2><p>20250322112954</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322112954.png alt=Destroy()></a><figcaption class=image-caption>20250322112954</figcaption></figure>之后在 <strong>4.27.2\Engine\Source\Runtime\Engine\Private\Actor.cpp</strong> 找到这个函数的实现。因此可以通过这个函数来销毁墙体，这样也可以实现逃出房间。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322113333.png title=20250322113333 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322113333.png data-sub-html="<h2>Destroy()</h2><p>20250322113333</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322113333.png alt=Destroy()></a><figcaption class=image-caption>20250322113333</figcaption></figure>但是在 SDK 中没有 <code>Destory()</code> 这个函数，而是存在 <code>K2_DestroyActor()</code> 函数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322113514.png title=20250322113514 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322113514.png data-sub-html="<h2>SDK 信息</h2><p>20250322113514</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322113514.png alt="SDK 信息"></a><figcaption class=image-caption>20250322113514</figcaption></figure>不过这里根据之前的知识，这个 <code>K2_DestroyActor()</code> 就是 <code>Destory()</code> 的中转函数，前面函数只是会调用后面的函数。之后在同目录下查看源码，发现确实就是这样。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322113647.png title=20250322113647 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322113647.png data-sub-html="<h2>K2_DestroyActor()</h2><p>20250322113647</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322113647.png alt=K2_DestroyActor()></a><figcaption class=image-caption>20250322113647</figcaption></figure>由此直接查看 IDA 中这个函数的信息。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322113909.png title=20250322113909 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322113909.png data-sub-html="<h2>so 中的函数</h2><p>20250322113909</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322113909.png alt="so 中的函数"></a><figcaption class=image-caption>20250322113909</figcaption></figure>发现两个参数都是 pointer 类型，由此根据上述经验写出摧毁 Actor 的代码。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>destroyActor</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x965B924</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>arg1</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mh>0x28</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>destroyActorFunc</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NativeFunction</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=s1>&#39;void&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;pointer&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>destroyActorFunc</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>arg1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// console.log(`[+] Destroy Actor: ${actorAddr}`);
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>section0_4</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>wallActor</span> <span class=o>=</span> <span class=s2>&#34;Wall&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorsMap</span> <span class=o>=</span> <span class=nx>getActorsMap</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>actorName</span><span class=p>,</span> <span class=nx>actorAddr</span><span class=p>]</span> <span class=k>of</span> <span class=nx>actorsMap</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>actorName</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>wallActor</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>destroyActor</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] Destroy Wall Actor Done`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>init</span><span class=p>(</span><span class=s2>&#34;libUE4.so&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>section0_4</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>运行之后，所有的墙体就被摧毁了，由此可以自由进出这个房间。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322114343.png title=20250322114343 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322114343.png data-sub-html="<h2>通过section0</h2><p>20250322114343</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322114343.png alt=通过section0></a><figcaption class=image-caption>20250322114343</figcaption></figure></p><h3 class=heading-element id=消除碰撞><span>消除碰撞</span>
<a href=#%e6%b6%88%e9%99%a4%e7%a2%b0%e6%92%9e class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>由 <a href="https://dev.epicgames.com/documentation/en-us/unreal-engine/collision-overview?application_version=4.27" target=_blank rel="external nofollow noopener noreferrer">文档</a> 可以知道，<code>ReceiveHit()</code> 是用于处理物理碰撞阻塞事件（Blocking Collision）的回调函数，当两个具有阻塞（Block）关系的物体发生碰撞时触发，可以通过下面的定义来了解函数。同时 hook 这个函数，发现人物只要和墙体发生碰撞，就会调用这个函数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250331223744.png title=20250331223744 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250331223744.png data-sub-html="<h2>ReceiveHit()</h2><p>20250331223744</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250331223744.png alt=ReceiveHit()></a><figcaption class=image-caption>20250331223744</figcaption></figure>因此可以写出下面的代码，直接将函数的开始位置 patch 为 ret，就可以使人物碰撞而不会收到伤害。不过注意这里的 <code>ReceiveHit()</code> 函数在 SDK 中存在两个，只有在 <code>Class: FirstPersonCharacter_C.Character.Pawn.Actor.Object</code> 类下的函数才是真实调用的函数，而在 Actor 下的不是，虽然 hook 发现会被调用，但是 patch 之后还是会收到伤害。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>patchReceiveHit</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x5E93094</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>Memory</span><span class=p>.</span><span class=nx>protect</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=mh>0x1000</span><span class=p>,</span> <span class=s1>&#39;rwx&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>f_addr</span><span class=p>.</span><span class=nx>writeByteArray</span><span class=p>([</span><span class=mh>0xC0</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0x5F</span><span class=p>,</span> <span class=mh>0xD6</span><span class=p>]);</span>    <span class=c1>// ret
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// frida -U -F com.tencent.ace.match2024 -l .\section.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>init</span><span class=p>(</span><span class=s2>&#34;libUE4.so&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>patchReceiveHit</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>之后执行上面的代码就会发现人物碰触墙体不会受到伤害，可以逃离房间了。</p><h3 class=heading-element id=消除扣血><span>消除扣血</span>
<a href=#%e6%b6%88%e9%99%a4%e6%89%a3%e8%a1%80 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>查看上面的 <code>ReceiveHit()</code> 函数，它其实是中转函数，通过下面的代码调用真实函数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250331230133.png title=20250331230133 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250331230133.png data-sub-html="<h2>ReceiveHit()</h2><p>20250331230133</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250331230133.png alt=ReceiveHit()></a><figcaption class=image-caption>20250331230133</figcaption></figure>所以通过下面代码可以找到调用的真实函数偏移为 <code>0x5e843d4</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>findReceiveHit</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>playerActor</span> <span class=o>=</span> <span class=nx>getPlayActorAddr</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>playerActor</span><span class=p>.</span><span class=nx>readPointer</span><span class=p>().</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x8B0</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[*] no_exec_ReceiveHit: 0x</span><span class=si>${</span><span class=p>(</span><span class=nx>f_addr</span> <span class=o>-</span> <span class=nx>moduleBase</span><span class=p>).</span><span class=nx>toString</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>之后在 IDA 中跳转到这个函数，发现其最后 return 了 <code>sub_5E840C8()</code> 函数，再继续追进。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250331230713.png title=20250331230713 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250331230713.png data-sub-html="<h2>sub_5E840C8()</h2><p>20250331230713</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250331230713.png alt=sub_5E840C8()></a><figcaption class=image-caption>20250331230713</figcaption></figure>分析上面的函数的内容可以猜测，这里传入的参数 <code>a1</code> 应该一脉相承，就是传入 <code>ReceiveHit()</code> 的 <code>a1</code> 参数，也就是 <code>playerActor</code> 的地址。之后发现还存在获取 <code>playerActor + 0x510</code> 地址处的数据的操作，这个是 SDK 中标注的生命值，那么就可以知道这里先获取生命值，然后减去 100 再写入原地址中。同时后面存在 <code>RestartLevel</code> 字符串也可以证实这里进行的就是碰墙的扣血函数。</p><p>因此这里直接把扣血逻辑进行 nop，或者对下面进行 if 判断的语句改为直接跳转，跳过重生都可以通过 section0。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>nopBloodScattered</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>nopBloodScattered_addr</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x5E840F8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>Memory</span><span class=p>.</span><span class=nx>protect</span><span class=p>(</span><span class=nx>nopBloodScattered_addr</span><span class=p>,</span> <span class=mh>0x1000</span><span class=p>,</span> <span class=s1>&#39;rwx&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>nopBloodScattered_addr</span><span class=p>.</span><span class=nx>writeByteArray</span><span class=p>([</span><span class=mh>0x1F</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0xD5</span><span class=p>])</span> <span class=c1>// nop
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>skipRebirth</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>skipRebirth</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x5E84158</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>Memory</span><span class=p>.</span><span class=nx>protect</span><span class=p>(</span><span class=nx>skipRebirth</span><span class=p>,</span> <span class=mh>0x1000</span><span class=p>,</span> <span class=s1>&#39;rwx&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>skipRebirth</span><span class=p>.</span><span class=nx>writeByteArray</span><span class=p>([</span><span class=mh>0x18</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x14</span><span class=p>])</span>    <span class=c1>// B  loc_5E841B8
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>运行之后就会发现可以逃离房间了，但是两个方法都还是会使生命值 UI 清零。</p><h2 class=heading-element id=section1><span>Section1</span>
<a href=#section1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><div class="details admonition tip open disabled"><div class="details-summary admonition-title"><i class="icon fa-fw fa-regular fa-lightbulb" aria-hidden=true></i>背景</div><div class=details-content><div class=admonition-content><p>通过 section0 后，墙壁上存在指示 <strong>请根据提示，依次完成游戏找到 flag</strong>，然后箭头指向左侧，那么左侧的封闭房间中应该存在相关提示，同时摧毁墙体之后也可以看到有相关的内容展示。由此进入左侧房间，发现下面的提示。</p></div></div></div><p><figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322123211.png title=20250322123211 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322123211.png data-sub-html="<h2>section1 提示</h2><p>20250322123211</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322123211.png alt="section1 提示"></a><figcaption class=image-caption>20250322123211</figcaption></figure>然后抬头寻找，发现空中存在这样的 flag 标识，其中的内容没有显示。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322123339.png title=20250322123339 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322123339.png data-sub-html="<h2>隐藏flag</h2><p>20250322123339</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322123339.png alt=隐藏flag></a><figcaption class=image-caption>20250322123339</figcaption></figure>因此后面就需要找到相关的参数来使 flag 中隐藏的内容展现出来。这里找到了三个和隐藏相关的函数，<code>SetActorHiddenInGame()</code>，<code>SetHiddenInGame()</code>，<code>SetVisibility()</code>。这里第一个函数属于 Actor 类，后面两个函数属于 USceneComponent 类。</p><p>按理来说这里应该是调用 <code>SetActorHiddenInGame()</code> 来使隐藏的 Actor 显示出来，但是根据其在 SDK 中的偏移为 0x965ba10，找到的 so 中函数如下。由上述经验，这里的参数只需要关心 <code>a2</code>，但是它是 pointer 类型，同时下面代码对于这个指针指向的数据也存在检测和修改，因此尝试多次也不能成功调用这个代码。</p><p>这里补充一下，SDK 暴露出的 Actor 类中其他的函数大多都是中转函数，最后都是通过 return 返回另外一个函数，另一个函数只是使用参数，没有检测和修改，同时也没有下面这么复杂，因此可以进行构造使用。下面这个就不行了，除非可以知道其运行时的数据，但是感觉原程序没有调用这个函数，找不到运行状态，所以无法构造。</p><div class="details admonition note open disabled"><div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden=true></i>补充</div><div class=details-content><div class=admonition-content><p>这里对于中转函数的概念是复现时候猜测的，后来查看别人的 <a href=https://www.cnblogs.com/lordtianqiyi/p/18789809 target=_blank rel="external nofollow noopener noreferrer">wp</a> 和 <a href=https://www.cnblogs.com/wodehao0808/p/6163673.html target=_blank rel="external nofollow noopener noreferrer">讲解</a>，发现可以根据有符号的 libUE4.so 来得知这个中转函数是什么。由这里 wp 中 <strong>exec包裹的关键函数</strong> 一节可以看出来，存在 exec 头的函数就是上文说的中转函数，没有 exec 头的才是真实执行的函数。</p></div></div></div><p><figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322170805.png title=20250322170805 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322170805.png data-sub-html="<h2>so 中函数</h2><p>20250322170805</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322170805.png alt="so 中函数"></a><figcaption class=image-caption>20250322170805</figcaption></figure>后来根据下文获取 <code>SetCollisionEnable()</code> 函数的方法，也可以获取到 <code>SetActorHiddenInGame()</code> 函数。上面 so 中函数返回 <code>a1 + 0x310</code> 位置的函数，这个按照经验就是需要的 <code>SetCollisionEnable()</code>（原函数是中转函数）。然后这里 a1 就是 ActorAddr，由此这里只需要获取到虚函数表偏移为 0x310 的函数即可。因为 C++ 对象的首地址（对象头部）存储着指向虚函数表的指针（vptr），所以具体做法就是读取指针获取虚函数表再添加偏移读取指针，这样就得到了函数地址。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>setActorHiddenInGame</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>bHidden</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// actorAddr.readPointer() 获取虚函数表
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>readPointer</span><span class=p>().</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x310</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 上述操作后，通过 f_addr - moduleBase 可以获取相对偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x8C2EC34</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>setActorHiddenInGameFunc</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NativeFunction</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=s1>&#39;void&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nx>setActorHiddenInGameFunc</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>bHidden</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>上文获取到相对偏移之后，可以在 IDA 中查看函数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323094705.png title=20250323094705 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323094705.png data-sub-html="<h2>so 中函数</h2><p>20250323094705</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323094705.png alt="so 中函数"></a><figcaption class=image-caption>20250323094705</figcaption></figure>但是修改之后发现没有隐藏的 flag 出现，由此关心另外两个函数 <code>SetHiddenInGame()</code> 和 <code>SetVisibility()</code>。前者表示对于对象的渲染，通过 <code>bVisible</code> 属性获取；后者则是对于对象在游戏运行时的隐藏，通过 <code>bHiddenInGame</code> 获取。同时 <code>bVisible</code> 的优先级更高，若是这个属性为 false，表示对象完全不会渲染。由此即使 <code>bHiddenInGame</code> 为 false 表示对象没有隐藏，也不会出现了，因为对象都不会渲染，就不存在显示隐藏的问题了。然后就可以根据这些知识，分别构造函数查看状态。</p><h3 class=heading-element id=获取隐藏状态><span>获取隐藏状态</span>
<a href=#%e8%8e%b7%e5%8f%96%e9%9a%90%e8%97%8f%e7%8a%b6%e6%80%81 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>不过查看 <code>SetActorHiddenInGame()</code> 函数的源码，发现首先通过比较 <code>IsHidden()</code> 的结果，然后再使用 <code>SetHidden</code> 修改状态。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322172938.png title=20250322172938 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322172938.png data-sub-html="<h2>SetActorHiddenInGame()</h2><p>20250322172938</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322172938.png alt=SetActorHiddenInGame()></a><figcaption class=image-caption>20250322172938</figcaption></figure>这里 <code>IsHidden()</code> 的实现如下，他就是获取 Actor 类中的成员变量 <code>bHidden</code>。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322173411.png title=20250322173411 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322173411.png data-sub-html="<h2>IsHidden()</h2><p>20250322173411</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322173411.png alt=IsHidden()></a><figcaption class=image-caption>20250322173411</figcaption></figure>因此可以在 SDK 中找到这个成员的偏移。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322184238.png title=20250322184238 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322184238.png data-sub-html="<h2>bHidden</h2><p>20250322184238</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322184238.png alt=bHidden></a><figcaption class=image-caption>20250322184238</figcaption></figure>之后就可以写代码获取隐藏状态信息了。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getbHidden</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>offset</span> <span class=o>=</span> <span class=mh>0x58</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>bit</span> <span class=o>=</span> <span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>byteValue</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>readU8</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>offset</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>isEnabled</span> <span class=o>=</span> <span class=p>(</span><span class=nx>byteValue</span> <span class=o>&gt;&gt;&gt;</span> <span class=nx>bit</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0x1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>isEnabled</span> <span class=o>!==</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>同时 <code>bHiddenInGame</code> 与 <code>bVisible</code> 也是同样的判断流程，它们都是 USceneComponent 类的成员变量，可以在 SDK 中找到相关偏移。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322191139.png title=20250322191139 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322191139.png data-sub-html="<h2>SDK 中偏移</h2><p>20250322191139</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322191139.png alt="SDK 中偏移"></a><figcaption class=image-caption>20250322191139</figcaption></figure>然后这里提取二者的源码信息：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>ENGINE_API</span> <span class=nl>USceneComponent</span> <span class=p>:</span> <span class=k>public</span> <span class=n>UActorComponent</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Whether to completely draw the primitive; if false, the primitive is not drawn, does not cast a shadow. */</span>
</span></span><span class=line><span class=cl>	<span class=n>UPROPERTY</span><span class=p>(</span><span class=n>EditAnywhere</span><span class=p>,</span> <span class=n>BlueprintReadOnly</span><span class=p>,</span> <span class=n>ReplicatedUsing</span><span class=o>=</span><span class=n>OnRep_Visibility</span><span class=p>,</span>  <span class=n>Category</span> <span class=o>=</span> <span class=n>Rendering</span><span class=p>,</span> <span class=n>meta</span><span class=o>=</span><span class=p>(</span><span class=n>AllowPrivateAccess</span><span class=o>=</span><span class=s>&#34;true&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>uint8</span> <span class=nl>bVisible</span><span class=p>:</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=cm>/** Whether to hide the primitive in game, if the primitive is Visible. */</span>
</span></span><span class=line><span class=cl>	<span class=n>UPROPERTY</span><span class=p>(</span><span class=n>Interp</span><span class=p>,</span> <span class=n>EditAnywhere</span><span class=p>,</span> <span class=n>BlueprintReadOnly</span><span class=p>,</span> <span class=n>Category</span><span class=o>=</span><span class=n>Rendering</span><span class=p>,</span> <span class=n>meta</span><span class=o>=</span><span class=p>(</span><span class=n>SequencerTrackClass</span> <span class=o>=</span> <span class=s>&#34;MovieSceneVisibilityTrack&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=n>uint8</span> <span class=nl>bHiddenInGame</span><span class=p>:</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>之后就构造下面的代码获取相关信息。注意这里不是所有 Actor 都有 USceneComponent 类型的 <code>RootComponent</code>，因此首先需要经过判断才能获取相关隐藏状态。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getbHiddenInGame</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>RootComponent</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x130</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>offset</span> <span class=o>=</span> <span class=mh>0x14d</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>bit</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>RootComponent</span> <span class=o>!=</span> <span class=mh>0x0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>bHiddenInGame</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>readU8</span><span class=p>(</span><span class=nx>RootComponent</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>offset</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>isHidden</span> <span class=o>=</span>  <span class=p>(</span><span class=nx>bHiddenInGame</span> <span class=o>&gt;&gt;&gt;</span> <span class=nx>bit</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0x1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>isHidden</span> <span class=o>!==</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getbVisible</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>RootComponent</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x130</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>offset</span> <span class=o>=</span> <span class=mh>0x14c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>bit</span> <span class=o>=</span> <span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>RootComponent</span> <span class=o>!=</span> <span class=mh>0x0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>bVisible</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>readU8</span><span class=p>(</span><span class=nx>RootComponent</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>offset</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>isbVisible</span> <span class=o>=</span> <span class=p>(</span><span class=nx>bVisible</span> <span class=o>&gt;&gt;&gt;</span> <span class=nx>bit</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0x1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>isbVisible</span> <span class=o>!==</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getActorHiddenStatus</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorsMap</span> <span class=o>=</span> <span class=nx>getActorsMap</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>actorName</span><span class=p>,</span> <span class=nx>actorAddr</span><span class=p>]</span> <span class=k>of</span> <span class=nx>actorsMap</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] Actor: </span><span class=si>${</span><span class=nx>actorName</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`\tbHidden: </span><span class=si>${</span><span class=nx>getbHidden</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`\tbHiddenInGame: </span><span class=si>${</span><span class=nx>getbHiddenInGame</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`\tbVisible: </span><span class=si>${</span><span class=nx>getbVisible</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>这里需要区别一下 <code>bHidden</code>，<code>bHiddenInGame</code> 和 <code>bVisible</code> 三个变量：</p><ul><li><code>bHidden</code> 设计目的是用于编辑器与运行时分离：仅在编辑器中可见，游戏中强制隐藏。</li><li><code>bHiddenInGame</code> 的设计目的是运行时隐藏：仅在游戏运行阶段隐藏对象（编辑器可见）。</li><li><code>bVisible</code> 则是全局渲染总开关：完全禁用对象渲染流程。</li></ul><table><thead><tr><th>属性</th><th>编辑器中的表现</th><th>游戏运行时的表现</th></tr></thead><tbody><tr><td><code>bVisible = false</code></td><td>完全不可见（不渲染，无碰撞）</td><td>完全不可见（不渲染，无碰撞）</td></tr><tr><td><code>bHiddenInGame = true</code></td><td>可见（编辑器默认）</td><td>隐藏（但保留碰撞和逻辑）</td></tr><tr><td><code>bHidden = true</code></td><td>可见（要看具体描述）</td><td>完全不可见（强制隐藏，无视其他设置）</td></tr></tbody></table><p>同时三者也存在优先级：$bVisible (\text{最高优先级}) → bHidden (\text{次优先级}) → bHiddenInGame (\text{最低优先级})$</p><ul><li>若 <code>bVisible = false</code>：直接跳过渲染，bHidden 和 bHiddenInGame 无效。</li><li>若 <code>bVisible = true</code>：<ul><li>若 <code>bHidden = true</code>：游戏中强制隐藏（无视 bHiddenInGame）。</li><li>若 <code>bHidden = false</code>：由 bHiddenInGame 控制运行时可见性。</li></ul></li></ul><p>之后就从最高优先级查看，从上到下找隐藏的部分。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getActorHiddenStatus</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorsMap</span> <span class=o>=</span> <span class=nx>getActorsMap</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>actorName</span><span class=p>,</span> <span class=nx>actorAddr</span><span class=p>]</span> <span class=k>of</span> <span class=nx>actorsMap</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>getbVisible</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=o>==</span> <span class=kc>false</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] Actor: </span><span class=si>${</span><span class=nx>actorName</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`\tbHidden: </span><span class=si>${</span><span class=nx>getbHidden</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`\tbHiddenInGame: </span><span class=si>${</span><span class=nx>getbHiddenInGame</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`\tbVisible: </span><span class=si>${</span><span class=nx>getbVisible</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>init</span><span class=p>(</span><span class=s2>&#34;libUE4.so&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>getActorHiddenStatus</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>通过上面的代码，可以得到下面的结果。由此就知道为什么上文 <code>SetActorHiddenInGame()</code> 的修改不起作用了，这里存在优先级更高的设置。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322201133.png title=20250322201133 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322201133.png data-sub-html="<h2>隐藏的 Actor</h2><p>20250322201133</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322201133.png alt="隐藏的 Actor"></a><figcaption class=image-caption>20250322201133</figcaption></figure>这里最高优先级的 bVisible 设置成了 false，那么余下怎么修改都不会被渲染。同时只有一个 Actor，且这个 Actor 的名称和隐藏 flag 有关，那么可以确定就是这个 Actor 没被渲染从而隐藏了。那么后面就是通过 <code>SetVisibility()</code> 函数来重新渲染这个 Actor。</p><h3 class=heading-element id=设置隐藏状态><span>设置隐藏状态</span>
<a href=#%e8%ae%be%e7%bd%ae%e9%9a%90%e8%97%8f%e7%8a%b6%e6%80%81 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>首先在 SDK 中找到这个函数的偏移。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322201424.png title=20250322201424 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322201424.png data-sub-html="<h2>SDK 中偏移</h2><p>20250322201424</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322201424.png alt="SDK 中偏移"></a><figcaption class=image-caption>20250322201424</figcaption></figure>然后在 so 文件中查看。这里因为是一个中转函数，所以直接查看 return 的函数，找到了这个 <code>sub_8E619BC</code> 函数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322201519.png title=20250322201519 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322201519.png data-sub-html="<h2>so 中函数</h2><p>20250322201519</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322201519.png alt="so 中函数"></a><figcaption class=image-caption>20250322201519</figcaption></figure>之后查看源码，可以看到需要的就是两个 bool 类型的变量。其中 <code>NewHidden</code> 表示设置的新状态，为 true 就是进行渲染，不隐藏；而 <code>bPropagateToChildren</code> 表示是否将隐藏状态传递给所有子组件，默认 false 表示仅影响当前 Actor。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322202625.png title=20250322202625 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322202625.png data-sub-html="<h2>SetVisibility()</h2><p>20250322202625</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322202625.png alt=SetVisibility()></a><figcaption class=image-caption>20250322202625</figcaption></figure>由此写出下面的代码。不过测试发现只能显示出隐藏 flag 的一部分，其余的显示不出来。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>setVisibility</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>bVisible</span><span class=p>,</span> <span class=nx>bForce</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>RootComponent</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x130</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>RootComponent</span> <span class=o>!=</span> <span class=mh>0x0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x8E619BC</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>setVisibilityFunc</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NativeFunction</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=s1>&#39;void&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=nx>setVisibilityFunc</span><span class=p>(</span><span class=nx>RootComponent</span><span class=p>,</span> <span class=nx>bVisible</span><span class=p>,</span> <span class=nx>bForce</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>section1</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorsMap</span> <span class=o>=</span> <span class=nx>getActorsMap</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>actorName</span><span class=p>,</span> <span class=nx>actorAddr</span><span class=p>]</span> <span class=k>of</span> <span class=nx>actorsMap</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>getbVisible</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=o>==</span> <span class=kc>false</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>setVisibility</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] Set </span><span class=si>${</span><span class=nx>actorName</span><span class=si>}</span><span class=sb> Visible Success`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>init</span><span class=p>(</span><span class=s2>&#34;libUE4.so&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>section0_2</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>section1</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>后来发现问题出现在 <code>getActorsMap()</code> 函数上面，这里返回的是 <code>{actorName, actorAddr}</code> 的字典，但是在之前遍历的时候，同名的 actorName 的地址会被后面遍历的覆盖掉，而这里 <code>Shape_Pipe_Flag</code> 名称的 Actor 有很多个，因此使用这个函数就只会出现一部分了。由此重新实现这个遍历即可。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>section1</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 固定偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>ULevel_offset</span> <span class=o>=</span> <span class=mh>0x30</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Actor_offset</span> <span class=o>=</span> <span class=mh>0x98</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ULevel</span> <span class=o>=</span> <span class=nx>GWorld</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>ULevel_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Actor</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorNum</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=mi>8</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[*] Actor_Addr: </span><span class=si>${</span><span class=nx>Actor</span><span class=si>}</span><span class=sb>, Actor_Num: </span><span class=si>${</span><span class=nx>actorNum</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>idx</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>idx</span> <span class=o>&lt;</span> <span class=nx>actorNum</span><span class=p>;</span> <span class=nx>idx</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorAddr</span> <span class=o>=</span> <span class=nx>Actor</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>idx</span> <span class=o>*</span> <span class=mh>0x8</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorID</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorName</span> <span class=o>=</span> <span class=nx>getNameFromId</span><span class=p>(</span><span class=nx>actorID</span><span class=p>);</span>      <span class=c1>//通过地址获取字符串名字
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=nx>getbVisible</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=o>==</span> <span class=kc>false</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>setVisibility</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] Set </span><span class=si>${</span><span class=nx>actorName</span><span class=p>,</span> <span class=nx>actorAddr</span><span class=si>}</span><span class=sb> Visible Success`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>运行之后得到结果，然后也可以看到 section1 的 flag 部分为 8939。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322211724.png title=20250322211724 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322211724.png data-sub-html="<h2>运行结果</h2><p>20250322211724</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322211724.png alt=运行结果></a><figcaption class=image-caption>20250322211724</figcaption></figure><figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322211900.png title=20250322211900 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322211900.png data-sub-html="<h2>通过section1</h2><p>20250322211900</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322211900.png alt=通过section1></a><figcaption class=image-caption>20250322211900</figcaption></figure></p><h2 class=heading-element id=section2><span>Section2</span>
<a href=#section2 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><div class="details admonition tip open disabled"><div class="details-summary admonition-title"><i class="icon fa-fw fa-regular fa-lightbulb" aria-hidden=true></i>背景</div><div class=details-content><div class=admonition-content><p>继续查看墙体后面的提示，这次就是使得前方的立方体变得不可穿透，也就是具有碰撞属性。</p></div></div></div><p><figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322232337.png title=20250322232337 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322232337.png data-sub-html="<h2>section2提示</h2><p>20250322232337</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250322232337.png alt=section2提示></a><figcaption class=image-caption>20250322232337</figcaption></figure></p><h3 class=heading-element id=初步尝试><span>初步尝试</span>
<a href=#%e5%88%9d%e6%ad%a5%e5%b0%9d%e8%af%95 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>由此使用上文 <strong>实现穿墙</strong> 中的 <code>setActorEnableCollision()</code> 函数来设置所有的 Actor 可触碰，然后再来尝试触碰这个立方体。但是发现不起作用，这说明不是这个函数起作用。由此找到了 <code>SetCollisionEnabled()</code> 函数，它可以控制组件的碰撞状态。</p><p>这里需要梳理一下 Actor 和这个函数的关系。要处理的这个立方体很像 UE 中直接生成的静态网格体，由此可以对于 AStaticMeshActor 这个表示静态网格体的类进行分析。查看源码，发现这个类继承 Actor，同时其第一个成员变量是 <code>class UStaticMeshComponent* StaticMeshComponent;</code>。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323105718.png title=20250323105718 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323105718.png data-sub-html="<h2>AStaticMeshActor</h2><p>20250323105718</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323105718.png alt=AStaticMeshActor></a><figcaption class=image-caption>20250323105718</figcaption></figure>然后在 SDK 中可以知道这个 StaticMeshComponent 成员变量的偏移。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323105759.png title=20250323105759 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323105759.png data-sub-html="<h2>SDK 信息</h2><p>20250323105759</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323105759.png alt="SDK 信息"></a><figcaption class=image-caption>20250323105759</figcaption></figure>然后对于这个 UStaticMeshComponent 类进行分析，可以在 SDK 中找到其继承关系。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323110026.png title=20250323110026 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323110026.png data-sub-html="<h2>SDK 信息</h2><p>20250323110026</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323110026.png alt="SDK 信息"></a><figcaption class=image-caption>20250323110026</figcaption></figure>而它的基类 PrimitiveComponent.SceneComponent.ActorComponent.Object 就存在着 <code>SetCollisionEnabled()</code> 函数。</p><h3 class=heading-element id=获取碰撞状态><span>获取碰撞状态</span>
<a href=#%e8%8e%b7%e5%8f%96%e7%a2%b0%e6%92%9e%e7%8a%b6%e6%80%81 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>与此同时还在这个类中发现了 <code>byte GetCollisionEnabled();// 0x98ec5c4</code> 函数。因此由上面的信息，尝试首先调用 <code>GetCollisionEnabled()</code> 查看是否存在不可触碰的静态网格体，之后再对这个静态网格体进行设置。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323110408.png title=20250323110408 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323110408.png data-sub-html="<h2>SDK 信息</h2><p>20250323110408</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323110408.png alt="SDK 信息"></a><figcaption class=image-caption>20250323110408</figcaption></figure>于是查看 <code>GetCollisionEnabled()</code> 源码，发现其会首先判断 <code>GetActorEnableCollision()</code> 的结果，若是这个的碰撞被禁用，那么就直接返回。因此可以知道 Actor 的全局碰撞状态优先于组件的独立设置。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323112842.png title=20250323112842 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323112842.png data-sub-html="<h2>GetCollisionEnabled()</h2><p>20250323112842</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323112842.png alt=GetCollisionEnabled()></a><figcaption class=image-caption>20250323112842</figcaption></figure>然后根据上面的偏移找到 so 中的函数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323113144.png title=20250323113144 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323113144.png data-sub-html="<h2>so 中函数</h2><p>20250323113144</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323113144.png alt="so 中函数"></a><figcaption class=image-caption>20250323113144</figcaption></figure>发现这个函数也需要计算偏移，由此写代码获取碰撞信息。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getCollisionEnabled</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>StaticMeshComponent</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x220</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>vptr</span> <span class=o>=</span> <span class=nx>StaticMeshComponent</span><span class=p>.</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>vptr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x510</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>GetCollisionEnabled</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NativeFunction</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>GetCollisionEnabled</span><span class=p>(</span><span class=nx>StaticMeshComponent</span><span class=p>,</span> <span class=nx>ptr</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getCollisionStatus</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ULevel_offset</span> <span class=o>=</span> <span class=mh>0x30</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Actor_offset</span> <span class=o>=</span> <span class=mh>0x98</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ULevel</span> <span class=o>=</span> <span class=nx>GWorld</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>ULevel_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Actor</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorNum</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=mi>8</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[*] Actor_Addr: </span><span class=si>${</span><span class=nx>Actor</span><span class=si>}</span><span class=sb>, Actor_Num: </span><span class=si>${</span><span class=nx>actorNum</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>idx</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>idx</span> <span class=o>&lt;</span> <span class=nx>actorNum</span><span class=p>;</span> <span class=nx>idx</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorAddr</span> <span class=o>=</span> <span class=nx>Actor</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>idx</span> <span class=o>*</span> <span class=mh>0x8</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorID</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorName</span> <span class=o>=</span> <span class=nx>getNameFromId</span><span class=p>(</span><span class=nx>actorID</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span> <span class=c1>// 采用 try-catch 防止对于不是 AStaticMeshActor 的 Actor 调用出错
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] </span><span class=si>${</span><span class=nx>actorName</span><span class=si>}</span><span class=sb>, </span><span class=si>${</span><span class=nx>getCollisionEnabled</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>然后就得到了下面的结果。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323121250.png title=20250323121250 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323121250.png data-sub-html="<h2>获得结果</h2><p>20250323121250</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323121250.png alt=获得结果></a><figcaption class=image-caption>20250323121250</figcaption></figure>这里可以看到很多 0 和 3，这是因为 <code>GetCollisionEnabled()</code> 的返回类型是 <code>ECollisionEnabled::Type</code>，它是一个枚举类型，定义如下：<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323121455.png title=20250323121455 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323121455.png data-sub-html="<h2>ECollisionEnabled</h2><p>20250323121455</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323121455.png alt=ECollisionEnabled></a><figcaption class=image-caption>20250323121455</figcaption></figure></p><h3 class=heading-element id=修改碰撞状态-1><span>修改碰撞状态</span>
<a href=#%e4%bf%ae%e6%94%b9%e7%a2%b0%e6%92%9e%e7%8a%b6%e6%80%81-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>由此可知这里 0 表示无碰撞，3 表示完全启用碰撞。再根据这里存在 <code>Cube</code> 这样无碰撞的 Actor，于是猜测这个就是上文中提到的立方体。于是下面就使用 <code>SetCollisionEnabled()</code> 函数来进行碰撞状态的修改。首先查看源码发现是先通过 <code>GetCollisionEnabled()</code> 获取碰撞状态再进行操作的。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323121830.png title=20250323121830 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323121830.png data-sub-html="<h2>SetCollisionEnabled()</h2><p>20250323121830</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323121830.png alt=SetCollisionEnabled()></a><figcaption class=image-caption>20250323121830</figcaption></figure>在 IDA 中根据偏移查看函数，发现也是通过偏移调用虚函数表中的函数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323121929.png title=20250323121929 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323121929.png data-sub-html="<h2>so 中函数</h2><p>20250323121929</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323121929.png alt="so 中函数"></a><figcaption class=image-caption>20250323121929</figcaption></figure>于是就可以写下面的代码进行碰撞状态的修改。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>setCollisionEnabled</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>bNewActorEnableCollision</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>StaticMeshComponent</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x220</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>vptr</span> <span class=o>=</span> <span class=nx>StaticMeshComponent</span><span class=p>.</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>vptr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x660</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>SetCollisionEnabled</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NativeFunction</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=s1>&#39;void&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nx>SetCollisionEnabled</span><span class=p>(</span><span class=nx>StaticMeshComponent</span><span class=p>,</span> <span class=nx>bNewActorEnableCollision</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>section2</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ULevel_offset</span> <span class=o>=</span> <span class=mh>0x30</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Actor_offset</span> <span class=o>=</span> <span class=mh>0x98</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ULevel</span> <span class=o>=</span> <span class=nx>GWorld</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>ULevel_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Actor</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorNum</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=mi>8</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[*] Actor_Addr: </span><span class=si>${</span><span class=nx>Actor</span><span class=si>}</span><span class=sb>, Actor_Num: </span><span class=si>${</span><span class=nx>actorNum</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>idx</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>idx</span> <span class=o>&lt;</span> <span class=nx>actorNum</span><span class=p>;</span> <span class=nx>idx</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorAddr</span> <span class=o>=</span> <span class=nx>Actor</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>idx</span> <span class=o>*</span> <span class=mh>0x8</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorID</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorName</span> <span class=o>=</span> <span class=nx>getNameFromId</span><span class=p>(</span><span class=nx>actorID</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>actorName</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s2>&#34;Cube&#34;</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nx>getCollisionEnabled</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// console.log(`[+] ${actorName}, ${actorAddr} -&gt; Collision Enabled: ${getCollisionEnabled(actorAddr)}`);
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>setCollisionEnabled</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] </span><span class=si>${</span><span class=nx>actorName</span><span class=si>}</span><span class=sb>, </span><span class=si>${</span><span class=nx>actorAddr</span><span class=si>}</span><span class=sb> -&gt; Collision Enabled: </span><span class=si>${</span><span class=nx>getCollisionEnabled</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>init</span><span class=p>(</span><span class=s2>&#34;libUE4.so&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>section0_1</span><span class=p>();</span> <span class=c1>// 需要注意碰撞立方体也会扣血，所以最好设置加血而不是瞬移等
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>section2</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>这里根据上面 <code>getCollisionEnabled()</code> 的返回信息，把 bool 类型参数改为 3，表示完全碰撞。然后碰撞第一个立方体之后就会出现下一个，最后需要碰撞三个立方体，这和上面获取碰撞状态中的 Cube，Cube2，Cube3 相对应。最后都碰撞之后，发现通向 section3 的门留出了一个空间过去看提示，同时也可以看到上面 flag 又显示了一部分，因此 section2 的 flag 部分为 008。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323122455.png title=20250323122455 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323122455.png data-sub-html="<h2>通过section2</h2><p>20250323122455</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323122455.png alt=通过section2></a><figcaption class=image-caption>20250323122455</figcaption></figure></p><h2 class=heading-element id=section3><span>Section3</span>
<a href=#section3 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><div class="details admonition tip open disabled"><div class="details-summary admonition-title"><i class="icon fa-fw fa-regular fa-lightbulb" aria-hidden=true></i>背景</div><div class=details-content><div class=admonition-content><p>查看墙面上的提示，这次则是藏在了黄色小球对应的 class 类中，需要找到这个类。</p></div></div></div><p><figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323125343.png title=20250323125343 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323125343.png data-sub-html="<h2>section3提示</h2><p>20250323125343</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323125343.png alt=section3提示></a><figcaption class=image-caption>20250323125343</figcaption></figure></p><h3 class=heading-element id=获取-actor><span>获取 Actor</span>
<a href=#%e8%8e%b7%e5%8f%96-actor class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>首先就需要知道这个黄色小球是哪一个 Actor，这里采用坐标限制的方法，在小球四个方向获取玩家的坐标，然后确定 X 轴和 Y 轴的范围，这样就可以通过坐标筛选出黄色小球。获取四个方面的坐标如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[+] 坐标： (-875.7613525390625, 1391.974365234375, 268.49981689453125)   正对 section3 文字
</span></span><span class=line><span class=cl>[+] 坐标： (-1104.78515625, 1551.6224365234375, 268.49981689453125)      正对 section3 提示
</span></span><span class=line><span class=cl>[+] 坐标： (-874.4379272460938, 1826.078369140625, 268.49981689453125)   背对 section3 文字
</span></span><span class=line><span class=cl>[+] 坐标： (-647.5235595703125, 1571.5631103515625, 268.49981689453125)  背对 section3 提示</span></span></code></pre></td></tr></table></div></div><p>这样通过获取 X 轴和 Y 轴的最大最小值，可以确定黄色小球的坐标范围。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getYellowBall</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ULevel_offset</span> <span class=o>=</span> <span class=mh>0x30</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Actor_offset</span> <span class=o>=</span> <span class=mh>0x98</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ULevel</span> <span class=o>=</span> <span class=nx>GWorld</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>ULevel_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Actor</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorNum</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=mi>8</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[*] Actor_Addr: </span><span class=si>${</span><span class=nx>Actor</span><span class=si>}</span><span class=sb>, Actor_Num: </span><span class=si>${</span><span class=nx>actorNum</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>idx</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>idx</span> <span class=o>&lt;</span> <span class=nx>actorNum</span><span class=p>;</span> <span class=nx>idx</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorAddr</span> <span class=o>=</span> <span class=nx>Actor</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>idx</span> <span class=o>*</span> <span class=mh>0x8</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorID</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorName</span> <span class=o>=</span> <span class=nx>getNameFromId</span><span class=p>(</span><span class=nx>actorID</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>Translation</span> <span class=o>=</span> <span class=nx>getActorLocation2</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>x</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>readFloat</span><span class=p>(</span><span class=nx>Translation</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>y</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>readFloat</span><span class=p>(</span><span class=nx>Translation</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mi>4</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>x</span> <span class=o>&gt;</span> <span class=o>-</span><span class=mi>1104</span> <span class=o>&amp;&amp;</span> <span class=nx>x</span> <span class=o>&lt;</span> <span class=o>-</span><span class=mi>647</span> <span class=o>&amp;&amp;</span> <span class=nx>y</span> <span class=o>&gt;</span> <span class=mi>1391</span> <span class=o>&amp;&amp;</span> <span class=nx>y</span> <span class=o>&lt;</span> <span class=mi>1826</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] </span><span class=si>${</span><span class=nx>actorName</span><span class=si>}</span><span class=sb>, </span><span class=si>${</span><span class=nx>actorAddr</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>运行之后获得下面的结果。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323171056.png title=20250323171056 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323171056.png data-sub-html="<h2>运行结果</h2><p>20250323171056</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323171056.png alt=运行结果></a><figcaption class=image-caption>20250323171056</figcaption></figure>发现找到了唯一一个 Actor，那么这个就是黄色小球的 Actor，余下就是需要找到它对应的 Class 类，这里就解析其类名看看它属于哪个类。</p><h3 class=heading-element id=获取类名><span>获取类名</span>
<a href=#%e8%8e%b7%e5%8f%96%e7%b1%bb%e5%90%8d class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>Actor 继承了 UObject，而 UObject 顶级类 UObjectBase 的成员变量如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>COREUOBJECT_API</span> <span class=n>UObjectBase</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint64_t</span> <span class=n>VTable</span><span class=p>;</span>                                        <span class=c1>//虚表指针，自己添加的
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Flags used to track and report various object states. This needs to be 8 byte aligned on 32-bit
</span></span></span><span class=line><span class=cl><span class=cm>	    platforms to reduce memory waste */</span>
</span></span><span class=line><span class=cl>	<span class=n>EObjectFlags</span>					<span class=n>ObjectFlags</span><span class=p>;</span>            <span class=c1>//对象属性
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Index into GObjectArray...very private. */</span>
</span></span><span class=line><span class=cl>	<span class=n>int32</span>							<span class=n>InternalIndex</span><span class=p>;</span>          <span class=c1>//对象 GUObjectArray 序号
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Class the object belongs to. */</span>
</span></span><span class=line><span class=cl>	<span class=n>UClass</span><span class=o>*</span>							<span class=n>ClassPrivate</span><span class=p>;</span>           <span class=c1>//对象的类
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Name of this object */</span>
</span></span><span class=line><span class=cl>	<span class=n>FName</span>							<span class=n>NamePrivate</span><span class=p>;</span>            <span class=c1>//对象的名字
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=cm>/** Object this object resides in. */</span>
</span></span><span class=line><span class=cl>	<span class=n>UObject</span><span class=o>*</span>						<span class=n>OuterPrivate</span><span class=p>;</span>           <span class=c1>//对象所在UPackage
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>这里的 <code>UClass* ClassPrivate;</code> 就表明了该 Actor 所属的类。因此这里通过 0x10 的偏移获取到 UClass 的指针之后就得到了 <code>ClassPrivate</code> 这个成员变量。然后这个成员变量是 UClass 类型，所以就寻找这个类的定义。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323172058.png title=20250323172058 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323172058.png data-sub-html="<h2>UClass</h2><p>20250323172058</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323172058.png alt=UClass></a><figcaption class=image-caption>20250323172058</figcaption></figure>发现这个类继承了 UStruct，那么继续寻找这个 UStruct 类。他就在同目录下，并继承了 UField 类，所以继续查找。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323172205.png title=20250323172205 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323172205.png data-sub-html="<h2>UStruct</h2><p>20250323172205</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323172205.png alt=UStruct></a><figcaption class=image-caption>20250323172205</figcaption></figure>同目录找到 UField 类，发现其继承了 UObject。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323172256.png title=20250323172256 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323172256.png data-sub-html="<h2>UField</h2><p>20250323172256</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323172256.png alt=UField></a><figcaption class=image-caption>20250323172256</figcaption></figure>由此目前的继承关系就是 <code>UClass -> UStruct -> UField -> UObject</code>，那么这里 <code>ClassPrivate</code> 也存在上面顶级类 <code>UObjectBase</code> 类的成员变量。由此可以直接通过 0x18 的偏移获取到 <code>FName NamePrivate;</code>，然后就可以和 Actor 名称解析一样获取到类的名称了。由此写出下面的代码。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getYellowBall</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ULevel_offset</span> <span class=o>=</span> <span class=mh>0x30</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Actor_offset</span> <span class=o>=</span> <span class=mh>0x98</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ULevel</span> <span class=o>=</span> <span class=nx>GWorld</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>ULevel_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Actor</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorNum</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=mi>8</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[*] Actor_Addr: </span><span class=si>${</span><span class=nx>Actor</span><span class=si>}</span><span class=sb>, Actor_Num: </span><span class=si>${</span><span class=nx>actorNum</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>idx</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>idx</span> <span class=o>&lt;</span> <span class=nx>actorNum</span><span class=p>;</span> <span class=nx>idx</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorAddr</span> <span class=o>=</span> <span class=nx>Actor</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>idx</span> <span class=o>*</span> <span class=mh>0x8</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorID</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorName</span> <span class=o>=</span> <span class=nx>getNameFromId</span><span class=p>(</span><span class=nx>actorID</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>ClassPrivate</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x10</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>classNameId</span> <span class=o>=</span> <span class=nx>ClassPrivate</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>className</span> <span class=o>=</span> <span class=nx>getNameFromId</span><span class=p>(</span><span class=nx>classNameId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>Translation</span> <span class=o>=</span> <span class=nx>getActorLocation2</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>x</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>readFloat</span><span class=p>(</span><span class=nx>Translation</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>y</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>readFloat</span><span class=p>(</span><span class=nx>Translation</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mi>4</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>x</span> <span class=o>&gt;</span> <span class=o>-</span><span class=mi>1104</span> <span class=o>&amp;&amp;</span> <span class=nx>x</span> <span class=o>&lt;</span> <span class=o>-</span><span class=mi>647</span> <span class=o>&amp;&amp;</span> <span class=nx>y</span> <span class=o>&gt;</span> <span class=mi>1391</span> <span class=o>&amp;&amp;</span> <span class=nx>y</span> <span class=o>&lt;</span> <span class=mi>1826</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] YellowBall -&gt; </span><span class=si>${</span><span class=nx>actorName</span><span class=si>}</span><span class=sb>, </span><span class=si>${</span><span class=nx>className</span><span class=si>}</span><span class=sb>, </span><span class=si>${</span><span class=nx>actorAddr</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>init</span><span class=p>(</span><span class=s2>&#34;libUE4.so&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>getYellowBall</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>运行之后就是下面的结果，可以看到其类名为 <code>MyActor</code>。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323172757.png title=20250323172757 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323172757.png data-sub-html="<h2>运行结果</h2><p>20250323172757</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323172757.png alt=运行结果></a><figcaption class=image-caption>20250323172757</figcaption></figure>然后就在 SDK 中根据类名进行查找，发现这个类存在一个函数 <code>getlastflag()</code>，那么最后的 flag 就和这个函数有关了。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323172856.png title=20250323172856 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323172856.png data-sub-html="<h2>SDK 信息</h2><p>20250323172856</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323172856.png alt="SDK 信息"></a><figcaption class=image-caption>20250323172856</figcaption></figure></p><h3 class=heading-element id=破解-flag><span>破解 flag</span>
<a href=#%e7%a0%b4%e8%a7%a3-flag class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>在 IDA 中根据偏移找到函数，但是没有什么信息，所以就按照以往的经验，查看 return 的函数，这里就是 <code>loc_6A91A54</code>。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323173025.png title=20250323173025 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323173025.png data-sub-html="<h2>so 中函数</h2><p>20250323173025</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323173025.png alt="so 中函数"></a><figcaption class=image-caption>20250323173025</figcaption></figure>然后就发现了关键的地方。下面的代码首先通过 dlopen 打开了 libplay.so，然后通过 dlsym 进行符号查找，找到 <code>get_last_flag()</code> 函数，之后进行调用。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323173118.png title=20250323173118 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323173118.png data-sub-html="<h2>so 中函数</h2><p>20250323173118</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323173118.png alt="so 中函数"></a><figcaption class=image-caption>20250323173118</figcaption></figure>所以这里就追踪 libplay.so 中的 <code>get_last_flag()</code> 函数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323173320.png title=20250323173320 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323173320.png data-sub-html="<h2>so 中函数</h2><p>20250323173320</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323173320.png alt="so 中函数"></a><figcaption class=image-caption>20250323173320</figcaption></figure>这里一开始看不出什么，只不过在 <code>get_last_flag()</code> 和 <code>sub_19BC() -> ... -> sub_EEC()</code> 两个函数中发现了对于数据的异或，因此提取异或数据写出下面的代码。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>data_3E50</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xD8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x98</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x54</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xC1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x64</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x93</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x56</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x84</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x38</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x4F</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x60</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xBB</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xA9</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xA4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xCC</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x88</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x8D</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x9F</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x9D</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x43</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xB0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xD7</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xD4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x53</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x1C</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x7D</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xB4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xB6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xF6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x37</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x23</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x66</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xDB</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x92</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x19</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xDF</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xCF</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xF9</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x9A</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x92</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xF2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x3C</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x31</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xBB</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x87</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x09</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xF8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xE4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xE7</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x90</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xF4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x99</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xCC</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x69</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x5F</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x04</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x46</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x89</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x75</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x5C</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xF0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xCC</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xBD</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x2E</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xA3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x68</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x0F</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xD6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xDC</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x4E</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x7A</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x4D</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x63</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xD0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x60</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x24</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x2D</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x75</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x3C</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x16</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xFC</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x41</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x1D</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x6E</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xDF</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xA4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x0D</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xD3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xA6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x9D</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xB9</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x58</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x88</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xB2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xBB</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x8D</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x9F</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x25</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x1B</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x11</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xB0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x41</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x2F</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xCD</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xB6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x84</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 对data_3E50进行异或处理</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xD2</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x94</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x5A</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xC1</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x35</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x85</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x71</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xBC</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>8</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x71</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>9</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x55</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>10</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x5B</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>11</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xE7</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>12</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x84</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>13</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xEA</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>14</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xA3</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>15</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x72</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>16</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x71</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>17</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x61</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 对data_3E30进行异或处理</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xC8</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x17</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x81</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xB1</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xB7</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x63</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x7B</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x34</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>8</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xED</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>9</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xF2</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>10</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xB7</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>11</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x45</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>12</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x47</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>13</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x1C</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>14</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xE3</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>15</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xA2</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>16</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x43</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>17</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xEF</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>18</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x97</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>19</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x9C</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>20</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xF7</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>21</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xA6</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>22</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xC4</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>23</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x76</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 对data_3DE0进行异或处理</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x70</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xF8</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xC2</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x39</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xBA</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xA0</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xA1</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xD7</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>8</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xBC</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>9</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xD0</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>10</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x86</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>11</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x22</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>12</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x13</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>13</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x49</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>14</span><span class=p>]</span> <span class=o>^=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>15</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xC6</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>16</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x25</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>17</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xD</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>18</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xA2</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>19</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x9F</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>20</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xE9</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>22</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xF5</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>21</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x7B</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>25</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x8F</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>23</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x3F</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>24</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x57</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>27</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x2F</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>26</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x86</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>28</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x18</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>30</span><span class=p>]</span> <span class=o>^=</span> <span class=mi>7</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>29</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x2E</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>31</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xB5</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>32</span><span class=p>]</span> <span class=o>^=</span> <span class=mi>6</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>33</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x43</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>34</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x45</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>35</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x1C</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>36</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x56</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>37</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x7D</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>38</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x90</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>39</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x2C</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>40</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x73</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>42</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xAF</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>43</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xD5</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>41</span><span class=p>]</span> <span class=o>^=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>44</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x7F</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>45</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xA0</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>46</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xD2</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>47</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xE8</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>49</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x2F</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>50</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xF0</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>48</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xCF</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>52</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xC1</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>51</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xCB</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>53</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xBC</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>54</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xAD</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>55</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x16</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>56</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x2F</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>57</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x24</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>58</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x86</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>59</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x76</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>60</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x17</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>61</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xF4</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>62</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x3B</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>63</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x99</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>64</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x84</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 输出处理后的结果</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;处理后的data_3E50:&#34;</span><span class=p>,</span> <span class=n>data_3E50</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;处理后的data_3E30:&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>chr</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>data_3E30</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;处理后的data_3DE0:&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>chr</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>data_3DE0</span><span class=p>]))</span></span></span></code></pre></td></tr></table></div></div><p>然后得到了下面的结果。由此可以知道这里 <code>sub_EEC()</code> 中的 <code>data_3DE0</code> 就是 base64 的魔改表，那么 <code>data_3E30</code> 就是加密的数据了，但是 <code>data_3E50</code> 不知道是什么。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323213756.png title=20250323213756 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323213756.png data-sub-html="<h2>运行结果</h2><p>20250323213756</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323213756.png alt=运行结果></a><figcaption class=image-caption>20250323213756</figcaption></figure>之后查看 <code>sub_192C() -> ... -> sub_E4C()</code> 函数，查看其汇编如下。在这里，它会根据 x22 寄存器的值来进行跳转。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323210346.png title=20250323210346 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323210346.png data-sub-html="<h2>sub_E4C()</h2><p>20250323210346</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323210346.png alt=sub_E4C()></a><figcaption class=image-caption>20250323210346</figcaption></figure>off_3D50 的信息如下，由此可以知道，当 <code>W10 = 1</code> 时跳转到 <code>sub_EA8()</code> 函数，否则跳转到 <code>sub_ED8()</code> 函数。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323210438.png title=20250323210438 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323210438.png data-sub-html="<h2>off_3D50</h2><p>20250323210438</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323210438.png alt=off_3D50></a><figcaption class=image-caption>20250323210438</figcaption></figure>这里 <code>sub_ED8()</code> 函数就是一个返回。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323210556.png title=20250323210556 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323210556.png data-sub-html="<h2>sub_ED8()</h2><p>20250323210556</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323210556.png alt=sub_ED8()></a><figcaption class=image-caption>20250323210556</figcaption></figure>而从下面的 <code>sub_EA8()</code> 函数可以看出，它这里通过 <code>UDIV</code> 和 <code>MSUB</code> 指令实现取模运算（<code>X8 % X19</code>），结果存入 X10，因此 X8 和 X10 都是索引，用于提取 X21 和 X20 中的数据为 W11 和 W10 进行异或。之后 X8 递增，若是 <code>X8 &lt; X22</code>，那么 <code>W10 = 1</code>，最后进行跳转。因为这里的 X9 还是 <code>sub_E4C()</code> 时的数据，所以当 <code>W10 = 1</code> 时，还是会跳转回 <code>sub_EA8()</code> 这个函数，也就形成了循环异或。<figure><a class=lightgallery href=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323210721.png title=20250323210721 data-thumbnail=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323210721.png data-sub-html="<h2>sub_EA8()</h2><p>20250323210721</p>"><img loading=lazy src=https://nuthecz.oss-cn-hangzhou.aliyuncs.com/img/20250323210721.png alt=sub_EA8()></a><figcaption class=image-caption>20250323210721</figcaption></figure>由此根据上面得到的结果和汇编信息，可以推断出解密就是把上述加密的数据经过变表 base64 解密之后再进行异或。于是写代码进行解密。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>base64</span> <span class=kn>import</span> <span class=n>b64decode</span>
</span></span><span class=line><span class=cl><span class=n>enc</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>chr</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>data_3E30</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>new_table</span> <span class=o>=</span> <span class=s2>&#34;ACE0BDFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz123456789+/&#34;</span>
</span></span><span class=line><span class=cl><span class=n>old_table</span> <span class=o>=</span> <span class=s2>&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>tmp</span> <span class=o>=</span> <span class=n>b64decode</span><span class=p>(</span><span class=n>enc</span><span class=o>.</span><span class=n>translate</span><span class=p>(</span><span class=nb>str</span><span class=o>.</span><span class=n>maketrans</span><span class=p>(</span><span class=n>new_table</span><span class=p>,</span> <span class=n>old_table</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>tmp</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>tmp</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=n>data_3E50</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span> <span class=c1># flag : _Anti_Cheat_Expert</span></span></span></code></pre></td></tr></table></div></div><p>最后得到了 section3 的 flag 部分为 _Anti_Cheat_Expert。</p><h2 class=heading-element id=最终结果><span>最终结果</span>
<a href=#%e6%9c%80%e7%bb%88%e7%bb%93%e6%9e%9c class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>最终得到 flag 为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>flag{8939008_Anti_Cheat_Expert}</span></span></code></pre></td></tr></table></div></div><p>全部 frida 代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span><span class=lnt>341
</span><span class=lnt>342
</span><span class=lnt>343
</span><span class=lnt>344
</span><span class=lnt>345
</span><span class=lnt>346
</span><span class=lnt>347
</span><span class=lnt>348
</span><span class=lnt>349
</span><span class=lnt>350
</span><span class=lnt>351
</span><span class=lnt>352
</span><span class=lnt>353
</span><span class=lnt>354
</span><span class=lnt>355
</span><span class=lnt>356
</span><span class=lnt>357
</span><span class=lnt>358
</span><span class=lnt>359
</span><span class=lnt>360
</span><span class=lnt>361
</span><span class=lnt>362
</span><span class=lnt>363
</span><span class=lnt>364
</span><span class=lnt>365
</span><span class=lnt>366
</span><span class=lnt>367
</span><span class=lnt>368
</span><span class=lnt>369
</span><span class=lnt>370
</span><span class=lnt>371
</span><span class=lnt>372
</span><span class=lnt>373
</span><span class=lnt>374
</span><span class=lnt>375
</span><span class=lnt>376
</span><span class=lnt>377
</span><span class=lnt>378
</span><span class=lnt>379
</span><span class=lnt>380
</span><span class=lnt>381
</span><span class=lnt>382
</span><span class=lnt>383
</span><span class=lnt>384
</span><span class=lnt>385
</span><span class=lnt>386
</span><span class=lnt>387
</span><span class=lnt>388
</span><span class=lnt>389
</span><span class=lnt>390
</span><span class=lnt>391
</span><span class=lnt>392
</span><span class=lnt>393
</span><span class=lnt>394
</span><span class=lnt>395
</span><span class=lnt>396
</span><span class=lnt>397
</span><span class=lnt>398
</span><span class=lnt>399
</span><span class=lnt>400
</span><span class=lnt>401
</span><span class=lnt>402
</span><span class=lnt>403
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>GWorld_Offset</span> <span class=o>=</span> <span class=mh>0x0B32D8A8</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>GName_Offset</span> <span class=o>=</span> <span class=mh>0x0B171CC0</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>GWorld</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>GName</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>moduleBase</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>cachedPlayerAddr</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span> <span class=c1>// 缓存玩家角色地址
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>init</span><span class=p>(</span><span class=nx>soName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>module</span> <span class=o>=</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>findModuleByName</span><span class=p>(</span><span class=nx>soName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>module</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>moduleBase</span> <span class=o>=</span> <span class=nx>module</span><span class=p>.</span><span class=nx>base</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>GWorld</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>GWorld_Offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>GName</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>GName_Offset</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`init success`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getNameFromId</span><span class=p>(</span><span class=nx>ComparisonIndex</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/*-----------------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=cm>        相关数据结构偏移与大小
</span></span></span><span class=line><span class=cl><span class=cm>    -----------------------------------------------------------------------------*/</span>
</span></span><span class=line><span class=cl>    <span class=c1>// FNameEntryAllocator 相关数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>offset_FRWLock</span> <span class=o>=</span> <span class=mh>0x38</span><span class=p>;</span>                                  <span class=c1>// FRWLock 偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>offset_Blocks</span> <span class=o>=</span> <span class=nx>offset_FRWLock</span> <span class=o>+</span> <span class=mh>0x8</span><span class=p>;</span>                   <span class=c1>// Blocks 偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>size_Stride</span> <span class=o>=</span> <span class=mh>0x2</span><span class=p>;</span>                                      <span class=c1>// FNameEntry 的大小
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>size_Block</span> <span class=o>=</span> <span class=mh>0x8</span><span class=p>;</span>                                       <span class=c1>// Blocks 中存储的 uint8* 指针的大小
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// FNameEntryHanlder 相关数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>FNameBlockOffsetBits</span> <span class=o>=</span> <span class=mi>16</span><span class=p>;</span>                              <span class=c1>// 块偏移量位数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>FNameBlockOffsets</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=nx>FNameBlockOffsetBits</span><span class=p>;</span>          <span class=c1>// 块偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>Block</span> <span class=o>=</span> <span class=nx>ComparisonIndex</span> <span class=o>&gt;&gt;</span> <span class=nx>FNameBlockOffsetBits</span><span class=p>;</span>        <span class=c1>// 块索引
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>Offset</span> <span class=o>=</span> <span class=nx>ComparisonIndex</span> <span class=o>&amp;</span> <span class=p>(</span><span class=nx>FNameBlockOffsets</span> <span class=o>-</span> <span class=mi>1</span><span class=p>);</span>     <span class=c1>// 块内偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// FNameEntryHeader 相关数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>bIsWideBit</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>                                         <span class=c1>// 判断是否为宽字符的位数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>offset_LenBit</span> <span class=o>=</span> <span class=mi>6</span><span class=p>;</span>                                      <span class=c1>// 字符串长度位数的偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// FNameEntry 相关数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>offset_Union</span> <span class=o>=</span> <span class=mh>0x2</span><span class=p>;</span>                                     <span class=c1>// FNameEntry 中字符串 Union 的偏移量
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/*-----------------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=cm>        相关数据结构计算
</span></span></span><span class=line><span class=cl><span class=cm>    -----------------------------------------------------------------------------*/</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 计算 FNameEntryAllocator 的地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>FNameEntryAllocator</span> <span class=o>=</span> <span class=nx>GName</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 计算 Blocks 数组的地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>Blocks</span> <span class=o>=</span> <span class=nx>FNameEntryAllocator</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>offset_Blocks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取 Blocks 数组中块实例的地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>BlockInstance</span> <span class=o>=</span> <span class=nx>Blocks</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Block</span> <span class=o>*</span> <span class=nx>size_Block</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 计算 Resolve 返回的 FNameEntry 类型地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>FNameEntry</span> <span class=o>=</span> <span class=nx>BlockInstance</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>size_Stride</span> <span class=o>*</span> <span class=nx>Offset</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取 FNameEntryHeader，它只有两个字节
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>FNameEntryHeader</span> <span class=o>=</span> <span class=nx>FNameEntry</span><span class=p>.</span><span class=nx>readU16</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取字符串地址，长度，是否为宽字符标识
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>str_addr</span> <span class=o>=</span> <span class=nx>FNameEntry</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>offset_Union</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>str_length</span> <span class=o>=</span> <span class=nx>FNameEntryHeader</span> <span class=o>&gt;&gt;</span> <span class=nx>offset_LenBit</span><span class=p>;</span>             <span class=c1>// 计算字符串长度
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>wide</span> <span class=o>=</span> <span class=nx>FNameEntryHeader</span> <span class=o>&amp;</span> <span class=nx>bIsWideBit</span><span class=p>;</span>                       <span class=c1>// 判断字符串是否为宽字符
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// 如果是宽字符，返回 &#34;widestr&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>wide</span><span class=p>)</span> <span class=k>return</span> <span class=s2>&#34;widestr&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 如果字符串长度合理，读取并返回UTF-8字符串
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>str_length</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=nx>str_length</span> <span class=o>&lt;</span> <span class=mi>250</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>str_addr</span><span class=p>.</span><span class=nx>readUtf8String</span><span class=p>(</span><span class=nx>str_length</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;None&#34;</span><span class=p>;</span> <span class=c1>// 长度不合理，返回 &#34;None&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getActorsMap</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 固定偏移
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>ULevel_offset</span> <span class=o>=</span> <span class=mh>0x30</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Actor_offset</span> <span class=o>=</span> <span class=mh>0x98</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ULevel</span> <span class=o>=</span> <span class=nx>GWorld</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>ULevel_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Actor</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorNum</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=mi>8</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[*] Actor_Addr: </span><span class=si>${</span><span class=nx>Actor</span><span class=si>}</span><span class=sb>, Actor_Num: </span><span class=si>${</span><span class=nx>actorNum</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorsMap</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Map</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>idx</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>idx</span> <span class=o>&lt;</span> <span class=nx>actorNum</span><span class=p>;</span> <span class=nx>idx</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorAddr</span> <span class=o>=</span> <span class=nx>Actor</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>idx</span> <span class=o>*</span> <span class=mh>0x8</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorID</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorName</span> <span class=o>=</span> <span class=nx>getNameFromId</span><span class=p>(</span><span class=nx>actorID</span><span class=p>);</span>      <span class=c1>//通过地址获取字符串名字
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>actorsMap</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>actorName</span><span class=p>,</span> <span class=nx>actorAddr</span><span class=p>);</span>          <span class=c1>//以字符串名字对应地址值       
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// console.log(`actorName: ${actorName}, actorAddr: ${actorAddr}`);
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>actorsMap</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getPlayActorAddr</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>cachedPlayerAddr</span><span class=p>)</span> <span class=k>return</span> <span class=nx>cachedPlayerAddr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>playerName</span> <span class=o>=</span> <span class=s2>&#34;FirstPersonCharacter_C&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorsAddr</span> <span class=o>=</span> <span class=nx>getActorsMap</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>actorsAddr</span><span class=p>.</span><span class=nx>has</span><span class=p>(</span><span class=nx>playerName</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>cachedPlayerAddr</span> <span class=o>=</span> <span class=nx>actorsAddr</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>playerName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[*] playerName: </span><span class=si>${</span><span class=nx>playerName</span><span class=si>}</span><span class=sb>, playerAddr: </span><span class=si>${</span><span class=nx>cachedPlayerAddr</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>cachedPlayerAddr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>section0_1</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>getPlayActorAddr</span><span class=p>().</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x510</span><span class=p>).</span><span class=nx>writeFloat</span><span class=p>(</span><span class=mi>10000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`blood: </span><span class=si>${</span><span class=nx>getPlayActor</span><span class=p>().</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x510</span><span class=p>).</span><span class=nx>readFloat</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Vector</span> <span class=p>{</span><span class=c1>// 设置向量对象
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>,</span> <span class=nx>z</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>x</span> <span class=o>=</span> <span class=nx>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>y</span> <span class=o>=</span> <span class=nx>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>z</span> <span class=o>=</span> <span class=nx>z</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 将向量转换为字符串
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>toString</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sb>`(</span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>x</span><span class=si>}</span><span class=sb>, </span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>y</span><span class=si>}</span><span class=sb>, </span><span class=si>${</span><span class=k>this</span><span class=p>.</span><span class=nx>z</span><span class=si>}</span><span class=sb>)`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>dumpVector</span><span class=p>(</span><span class=nx>addr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>vec</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Vector</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>Memory</span><span class=p>.</span><span class=nx>readFloat</span><span class=p>(</span><span class=nx>addr</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>Memory</span><span class=p>.</span><span class=nx>readFloat</span><span class=p>(</span><span class=nx>addr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mi>4</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=nx>Memory</span><span class=p>.</span><span class=nx>readFloat</span><span class=p>(</span><span class=nx>addr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>  <span class=c1>// 读取内存中的浮点数，3个浮点数分别对应x, y, z，每个浮点数占4个字节
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;[+] 坐标：&#39;</span><span class=p>,</span> <span class=nx>vec</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getActorLocation1</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>RootComponent</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x130</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>RootComponent</span> <span class=o>==</span> <span class=mh>0x0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] RootComponent is null`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ComponentToWorld</span> <span class=o>=</span> <span class=nx>RootComponent</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x1c0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Translation</span> <span class=o>=</span> <span class=nx>ComponentToWorld</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>dumpVector</span><span class=p>(</span><span class=nx>Translation</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getActorLocation2</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>buf</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mh>0x100</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x965ddf8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>GetActorLocation</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NativeFunction</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=s1>&#39;void&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;pointer&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nx>GetActorLocation</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>buf</span><span class=p>,</span> <span class=nx>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// dumpVector(buf);
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=nx>buf</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>setActorLocation</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>,</span> <span class=nx>z</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x8C3181C</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>SetLocationFunc</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NativeFunction</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>,</span> <span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>,</span> <span class=s1>&#39;float&#39;</span><span class=p>,</span> <span class=s1>&#39;float&#39;</span><span class=p>,</span> <span class=s1>&#39;float&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nx>SetLocationFunc</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>ptr</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>,</span> <span class=nx>z</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>section0_2</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>playerActor</span> <span class=o>=</span> <span class=nx>getPlayActorAddr</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>setActorLocation</span><span class=p>(</span><span class=nx>playerActor</span><span class=p>,</span> <span class=o>-</span><span class=mi>1000</span><span class=p>,</span> <span class=mi>100</span><span class=p>,</span> <span class=mi>270</span><span class=p>);</span> <span class=c1>// 向后 x 轴变大，向左 y 轴变大
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>getActorLocation1</span><span class=p>(</span><span class=nx>playerActor</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getActorEnableCollision1</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>offset</span> <span class=o>=</span> <span class=mh>0x5C</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>bit</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>byteValue</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>readU8</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>offset</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>isEnabled</span> <span class=o>=</span> <span class=p>(</span><span class=nx>byteValue</span> <span class=o>&gt;&gt;&gt;</span> <span class=nx>bit</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0x1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>isEnabled</span> <span class=o>!==</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getActorEnableCollision2</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x965b940</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>getActorEnableCollisionFunc</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NativeFunction</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=s1>&#39;void&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;pointer&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>arg1</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mh>0x19</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>arg2</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>getActorEnableCollisionFunc</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>arg1</span><span class=p>,</span> <span class=nx>arg2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>arg2</span><span class=p>.</span><span class=nx>readU8</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>setActorEnableCollision</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>bNewActorEnableCollision</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x8C21320</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>setActorEnableCollisionFunc</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NativeFunction</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=s1>&#39;void&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nx>setActorEnableCollisionFunc</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>bNewActorEnableCollision</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>section0_3</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>wallActor</span> <span class=o>=</span> <span class=s2>&#34;Wall&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorsMap</span> <span class=o>=</span> <span class=nx>getActorsMap</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>actorName</span><span class=p>,</span> <span class=nx>actorAddr</span><span class=p>]</span> <span class=k>of</span> <span class=nx>actorsMap</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>actorName</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>wallActor</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// console.log(`[+] Found Wall actor: ${actorName}, address: ${actorAddr}`);
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>setActorEnableCollision</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=c1>// console.log(`After setActorEnableCollision`, getActorEnableCollision1(actorAddr));
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] Set Wall Actor collision disabled`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>destroyActor</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x965B924</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>arg1</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mh>0x28</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>destroyActorFunc</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NativeFunction</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=s1>&#39;void&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;pointer&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>destroyActorFunc</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>arg1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// console.log(`[+] Destroy Actor: ${actorAddr}`);
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>section0_4</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>wallActor</span> <span class=o>=</span> <span class=s2>&#34;Wall&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorsMap</span> <span class=o>=</span> <span class=nx>getActorsMap</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>actorName</span><span class=p>,</span> <span class=nx>actorAddr</span><span class=p>]</span> <span class=k>of</span> <span class=nx>actorsMap</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>actorName</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>wallActor</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// console.log(`[+] Found Wall actor: ${actorName}, address: ${actorAddr}`);
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>// setActorCollisionEnabled(actorAddr, 0);
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>destroyActor</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] Destroy Wall Actor Done`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>patchReceiveHit</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x5E93094</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>Memory</span><span class=p>.</span><span class=nx>protect</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=mh>0x1000</span><span class=p>,</span> <span class=s1>&#39;rwx&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>f_addr</span><span class=p>.</span><span class=nx>writeByteArray</span><span class=p>([</span><span class=mh>0xC0</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0x5F</span><span class=p>,</span> <span class=mh>0xD6</span><span class=p>]);</span>    <span class=c1>// ret
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>section0_5</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>patchReceiveHit</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>findReceiveHit</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>playerActor</span> <span class=o>=</span> <span class=nx>getPlayActorAddr</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>playerActor</span><span class=p>.</span><span class=nx>readPointer</span><span class=p>().</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x8B0</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[*] no_exec_ReceiveHit: 0x</span><span class=si>${</span><span class=p>(</span><span class=nx>f_addr</span> <span class=o>-</span> <span class=nx>moduleBase</span><span class=p>).</span><span class=nx>toString</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>nopBloodScattered</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>nopBloodScattered_addr</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x5E840F8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>Memory</span><span class=p>.</span><span class=nx>protect</span><span class=p>(</span><span class=nx>nopBloodScattered_addr</span><span class=p>,</span> <span class=mh>0x1000</span><span class=p>,</span> <span class=s1>&#39;rwx&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>nopBloodScattered_addr</span><span class=p>.</span><span class=nx>writeByteArray</span><span class=p>([</span><span class=mh>0x1F</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0xD5</span><span class=p>])</span> <span class=c1>// nop
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>skipRebirth</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>skipRebirth</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x5E84158</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>Memory</span><span class=p>.</span><span class=nx>protect</span><span class=p>(</span><span class=nx>skipRebirth</span><span class=p>,</span> <span class=mh>0x1000</span><span class=p>,</span> <span class=s1>&#39;rwx&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>skipRebirth</span><span class=p>.</span><span class=nx>writeByteArray</span><span class=p>([</span><span class=mh>0x18</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x14</span><span class=p>])</span>    <span class=c1>// B  loc_5E841B8
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>section0_6</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>findReceiveHit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>nopBloodScattered</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>skipRebirth</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getbHidden</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>offset</span> <span class=o>=</span> <span class=mh>0x58</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>bit</span> <span class=o>=</span> <span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>byteValue</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>readU8</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>offset</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>isEnabled</span> <span class=o>=</span> <span class=p>(</span><span class=nx>byteValue</span> <span class=o>&gt;&gt;&gt;</span> <span class=nx>bit</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0x1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>isEnabled</span> <span class=o>!==</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>setActorHiddenInGame</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>bNewActorEnableCollision</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>readPointer</span><span class=p>().</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x310</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// const f_addr = moduleBase.add(0x8C2EC34);
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>setActorHiddenInGameFunc</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NativeFunction</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=s1>&#39;void&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nx>setActorHiddenInGameFunc</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>bNewActorEnableCollision</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getbHiddenInGame</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取 RootComponent
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>RootComponent</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x130</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>offset</span> <span class=o>=</span> <span class=mh>0x14d</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>bit</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>RootComponent</span> <span class=o>!=</span> <span class=mh>0x0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>bHiddenInGame</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>readU8</span><span class=p>(</span><span class=nx>RootComponent</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>offset</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>isHidden</span> <span class=o>=</span>  <span class=p>(</span><span class=nx>bHiddenInGame</span> <span class=o>&gt;&gt;&gt;</span> <span class=nx>bit</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0x1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>isHidden</span> <span class=o>!==</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getbVisible</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取 RootComponent
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>RootComponent</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x130</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>offset</span> <span class=o>=</span> <span class=mh>0x14c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>bit</span> <span class=o>=</span> <span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>RootComponent</span> <span class=o>!=</span> <span class=mh>0x0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>bVisible</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>readU8</span><span class=p>(</span><span class=nx>RootComponent</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>offset</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>isbVisible</span> <span class=o>=</span> <span class=p>(</span><span class=nx>bVisible</span> <span class=o>&gt;&gt;&gt;</span> <span class=nx>bit</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0x1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>isbVisible</span> <span class=o>!==</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>setVisibility</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>bVisible</span><span class=p>,</span> <span class=nx>bForce</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>RootComponent</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x130</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>RootComponent</span> <span class=o>!=</span> <span class=mh>0x0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>moduleBase</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x8E619BC</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>setVisibilityFunc</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NativeFunction</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=s1>&#39;void&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=nx>setVisibilityFunc</span><span class=p>(</span><span class=nx>RootComponent</span><span class=p>,</span> <span class=nx>bVisible</span><span class=p>,</span> <span class=nx>bForce</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>section1</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ULevel_offset</span> <span class=o>=</span> <span class=mh>0x30</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Actor_offset</span> <span class=o>=</span> <span class=mh>0x98</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ULevel</span> <span class=o>=</span> <span class=nx>GWorld</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>ULevel_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Actor</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorNum</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=mi>8</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[*] Actor_Addr: </span><span class=si>${</span><span class=nx>Actor</span><span class=si>}</span><span class=sb>, Actor_Num: </span><span class=si>${</span><span class=nx>actorNum</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>idx</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>idx</span> <span class=o>&lt;</span> <span class=nx>actorNum</span><span class=p>;</span> <span class=nx>idx</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorAddr</span> <span class=o>=</span> <span class=nx>Actor</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>idx</span> <span class=o>*</span> <span class=mh>0x8</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorID</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorName</span> <span class=o>=</span> <span class=nx>getNameFromId</span><span class=p>(</span><span class=nx>actorID</span><span class=p>);</span>      <span class=c1>//通过地址获取字符串名字
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=nx>getbVisible</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=o>==</span> <span class=kc>false</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>setVisibility</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] Set </span><span class=si>${</span><span class=nx>actorName</span><span class=si>}</span><span class=sb>, </span><span class=si>${</span><span class=nx>actorAddr</span><span class=si>}</span><span class=sb> Visible Success`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getCollisionEnabled</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>StaticMeshComponent</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x220</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>vptr</span> <span class=o>=</span> <span class=nx>StaticMeshComponent</span><span class=p>.</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>vptr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x510</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>GetCollisionEnabled</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NativeFunction</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>GetCollisionEnabled</span><span class=p>(</span><span class=nx>StaticMeshComponent</span><span class=p>,</span> <span class=nx>ptr</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>setCollisionEnabled</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=nx>bNewActorEnableCollision</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>StaticMeshComponent</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x220</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>vptr</span> <span class=o>=</span> <span class=nx>StaticMeshComponent</span><span class=p>.</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>f_addr</span> <span class=o>=</span> <span class=nx>vptr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x660</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>SetCollisionEnabled</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>NativeFunction</span><span class=p>(</span><span class=nx>f_addr</span><span class=p>,</span> <span class=s1>&#39;void&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;pointer&#39;</span><span class=p>,</span> <span class=s1>&#39;bool&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nx>SetCollisionEnabled</span><span class=p>(</span><span class=nx>StaticMeshComponent</span><span class=p>,</span> <span class=nx>bNewActorEnableCollision</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>section2</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ULevel_offset</span> <span class=o>=</span> <span class=mh>0x30</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Actor_offset</span> <span class=o>=</span> <span class=mh>0x98</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ULevel</span> <span class=o>=</span> <span class=nx>GWorld</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>ULevel_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Actor</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorNum</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=mi>8</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[*] Actor_Addr: </span><span class=si>${</span><span class=nx>Actor</span><span class=si>}</span><span class=sb>, Actor_Num: </span><span class=si>${</span><span class=nx>actorNum</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>idx</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>idx</span> <span class=o>&lt;</span> <span class=nx>actorNum</span><span class=p>;</span> <span class=nx>idx</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorAddr</span> <span class=o>=</span> <span class=nx>Actor</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>idx</span> <span class=o>*</span> <span class=mh>0x8</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorID</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorName</span> <span class=o>=</span> <span class=nx>getNameFromId</span><span class=p>(</span><span class=nx>actorID</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>actorName</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s2>&#34;Cube&#34;</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nx>getCollisionEnabled</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// console.log(`[+] ${actorName}, ${actorAddr} -&gt; Collision Enabled: ${getCollisionEnabled(actorAddr)}`);
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>setCollisionEnabled</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] </span><span class=si>${</span><span class=nx>actorName</span><span class=si>}</span><span class=sb>, </span><span class=si>${</span><span class=nx>actorAddr</span><span class=si>}</span><span class=sb> -&gt; Collision Enabled: </span><span class=si>${</span><span class=nx>getCollisionEnabled</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getYellowBall</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ULevel_offset</span> <span class=o>=</span> <span class=mh>0x30</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Actor_offset</span> <span class=o>=</span> <span class=mh>0x98</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ULevel</span> <span class=o>=</span> <span class=nx>GWorld</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>ULevel_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Actor</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>actorNum</span> <span class=o>=</span> <span class=nx>ULevel</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Actor_offset</span><span class=p>).</span><span class=nx>add</span><span class=p>(</span><span class=mi>8</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[*] Actor_Addr: </span><span class=si>${</span><span class=nx>Actor</span><span class=si>}</span><span class=sb>, Actor_Num: </span><span class=si>${</span><span class=nx>actorNum</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>idx</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>idx</span> <span class=o>&lt;</span> <span class=nx>actorNum</span><span class=p>;</span> <span class=nx>idx</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorAddr</span> <span class=o>=</span> <span class=nx>Actor</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>idx</span> <span class=o>*</span> <span class=mh>0x8</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorID</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>actorName</span> <span class=o>=</span> <span class=nx>getNameFromId</span><span class=p>(</span><span class=nx>actorID</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>ClassPrivate</span> <span class=o>=</span> <span class=nx>actorAddr</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x10</span><span class=p>).</span><span class=nx>readPointer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>classNameId</span> <span class=o>=</span> <span class=nx>ClassPrivate</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>).</span><span class=nx>readU32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>className</span> <span class=o>=</span> <span class=nx>getNameFromId</span><span class=p>(</span><span class=nx>classNameId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>Translation</span> <span class=o>=</span> <span class=nx>getActorLocation2</span><span class=p>(</span><span class=nx>actorAddr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>x</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>readFloat</span><span class=p>(</span><span class=nx>Translation</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>y</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>readFloat</span><span class=p>(</span><span class=nx>Translation</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=mi>4</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>x</span> <span class=o>&gt;</span> <span class=o>-</span><span class=mi>1104</span> <span class=o>&amp;&amp;</span> <span class=nx>x</span> <span class=o>&lt;</span> <span class=o>-</span><span class=mi>647</span> <span class=o>&amp;&amp;</span> <span class=nx>y</span> <span class=o>&gt;</span> <span class=mi>1391</span> <span class=o>&amp;&amp;</span> <span class=nx>y</span> <span class=o>&lt;</span> <span class=mi>1826</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[+] YellowBall -&gt; </span><span class=si>${</span><span class=nx>actorName</span><span class=si>}</span><span class=sb>, </span><span class=si>${</span><span class=nx>className</span><span class=si>}</span><span class=sb>, </span><span class=si>${</span><span class=nx>actorAddr</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// frida -U -F com.tencent.ace.match2024 -l .\section.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>init</span><span class=p>(</span><span class=s2>&#34;libUE4.so&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>python 解密代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>data_3E50</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xD8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x98</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x54</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xC1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x64</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x93</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x56</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x84</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x38</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x4F</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x60</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xBB</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xA9</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xA4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xCC</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x88</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x8D</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x9F</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x9D</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x43</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xB0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xD7</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xD4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x53</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x1C</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x7D</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xB4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xB6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xF6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x37</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x23</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x66</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xDB</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x92</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x19</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xDF</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xCF</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xF9</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x9A</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x92</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xF2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x3C</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x31</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xBB</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x87</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x09</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xF8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xE4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xE7</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x90</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xF4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x99</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xCC</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x69</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x5F</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x04</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x46</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x89</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x75</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x5C</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xF0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xCC</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xBD</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x2E</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xA3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x68</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x0F</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xD6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xDC</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x4E</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x7A</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x4D</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x63</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xD0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x60</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x24</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x2D</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x75</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x3C</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x16</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xFC</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x41</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x1D</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x6E</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xDF</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xA4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x0D</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xD3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xA6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x9D</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xB9</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x58</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x88</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xB2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xBB</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x8D</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x9F</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x25</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x1B</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x11</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xB0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x41</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x2F</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xCD</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xB6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x84</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 对data_3E50进行异或处理</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xD2</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x94</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x5A</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xC1</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x35</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x85</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x71</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xBC</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>8</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x71</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>9</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x55</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>10</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x5B</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>11</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xE7</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>12</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x84</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>13</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xEA</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>14</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xA3</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>15</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x72</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>16</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x71</span>
</span></span><span class=line><span class=cl><span class=n>data_3E50</span><span class=p>[</span><span class=mi>17</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x61</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 对data_3E30进行异或处理</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xC8</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x17</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x81</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xB1</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xB7</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x63</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x7B</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x34</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>8</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xED</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>9</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xF2</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>10</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xB7</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>11</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x45</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>12</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x47</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>13</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x1C</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>14</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xE3</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>15</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xA2</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>16</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x43</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>17</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xEF</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>18</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x97</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>19</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x9C</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>20</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xF7</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>21</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xA6</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>22</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xC4</span>
</span></span><span class=line><span class=cl><span class=n>data_3E30</span><span class=p>[</span><span class=mi>23</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x76</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 对data_3DE0进行异或处理</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x70</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xF8</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xC2</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x39</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xBA</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xA0</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xA1</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xD7</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>8</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xBC</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>9</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xD0</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>10</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x86</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>11</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x22</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>12</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x13</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>13</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x49</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>14</span><span class=p>]</span> <span class=o>^=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>15</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xC6</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>16</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x25</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>17</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xD</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>18</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xA2</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>19</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x9F</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>20</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xE9</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>22</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xF5</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>21</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x7B</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>25</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x8F</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>23</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x3F</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>24</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x57</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>27</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x2F</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>26</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x86</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>28</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x18</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>30</span><span class=p>]</span> <span class=o>^=</span> <span class=mi>7</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>29</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x2E</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>31</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xB5</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>32</span><span class=p>]</span> <span class=o>^=</span> <span class=mi>6</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>33</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x43</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>34</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x45</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>35</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x1C</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>36</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x56</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>37</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x7D</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>38</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x90</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>39</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x2C</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>40</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x73</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>42</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xAF</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>43</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xD5</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>41</span><span class=p>]</span> <span class=o>^=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>44</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x7F</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>45</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xA0</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>46</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xD2</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>47</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xE8</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>49</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x2F</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>50</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xF0</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>48</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xCF</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>52</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xC1</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>51</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xCB</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>53</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xBC</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>54</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xAD</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>55</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x16</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>56</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x2F</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>57</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x24</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>58</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x86</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>59</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x76</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>60</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x17</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>61</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0xF4</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>62</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x3B</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>63</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x99</span>
</span></span><span class=line><span class=cl><span class=n>data_3DE0</span><span class=p>[</span><span class=mi>64</span><span class=p>]</span> <span class=o>^=</span> <span class=mh>0x84</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 输出处理后的结果</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;处理后的data_3E50:&#34;</span><span class=p>,</span> <span class=n>data_3E50</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;处理后的data_3E30:&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>chr</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>data_3E30</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;处理后的data_3DE0:&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>chr</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>data_3DE0</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>base64</span> <span class=kn>import</span> <span class=n>b64decode</span>
</span></span><span class=line><span class=cl><span class=n>enc</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>chr</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>data_3E30</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>new_table</span> <span class=o>=</span> <span class=s2>&#34;ACE0BDFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz123456789+/&#34;</span>
</span></span><span class=line><span class=cl><span class=n>old_table</span> <span class=o>=</span> <span class=s2>&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>tmp</span> <span class=o>=</span> <span class=n>b64decode</span><span class=p>(</span><span class=n>enc</span><span class=o>.</span><span class=n>translate</span><span class=p>(</span><span class=nb>str</span><span class=o>.</span><span class=n>maketrans</span><span class=p>(</span><span class=n>new_table</span><span class=p>,</span> <span class=n>old_table</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>tmp</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>tmp</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=n>data_3E50</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=参考资料><span>参考资料</span>
<a href=#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><div class="details admonition quote open disabled"><div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-quote-right" aria-hidden=true></i>参考</div><div class=details-content><div class=admonition-content><ul><li><a href=https://www.zhihu.com/column/c_1535217822816309248 target=_blank rel="external nofollow noopener noreferrer">《大象无形：虚幻引擎程序设计浅析》 笔记</a></li><li><a href=https://blog.csdn.net/qq_23091255/article/details/144704710 target=_blank rel="external nofollow noopener noreferrer">虚幻引擎是什么？</a></li><li><a href=https://bbs.kanxue.com/thread-282857.htm target=_blank rel="external nofollow noopener noreferrer">UE4.27SDK-Dump</a></li><li><a href=https://bbs.kanxue.com/thread-278264.htm#msg_header_h1_3 target=_blank rel="external nofollow noopener noreferrer">UnrealEngine4恢复符号过程分析</a></li><li><a href=https://bbs.kanxue.com/thread-281998.htm target=_blank rel="external nofollow noopener noreferrer">腾讯游戏安全2024安卓初赛复现</a></li><li><a href=http://www.yxfzedu.com/article/10613 target=_blank rel="external nofollow noopener noreferrer">CTF对抗-腾讯游戏安全技术竞赛2024初赛 安卓方向复盘</a></li><li><a href=https://zhuanlan.zhihu.com/p/554869462 target=_blank rel="external nofollow noopener noreferrer">UE4 SetHiddenInGame VS SetVisibility</a></li><li><a href=https://izayoishiki.github.io/2025/02/01/2024%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%E5%AE%89%E5%8D%93%E5%88%9D%E8%B5%9B%E5%A4%8D%E7%8E%B0/ target=_blank rel="external nofollow noopener noreferrer">2024腾讯游戏安全安卓初赛复现</a></li><li><a href=https://www.cnblogs.com/lordtianqiyi/p/18789809 target=_blank rel="external nofollow noopener noreferrer">2024 腾讯游戏安全大赛 mobile 初赛 wp</a></li></ul></div></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2025-07-13 13:35:57">更新于 2025.7.13&nbsp;<a class=git-hash href=https://github.com/czTangt/blog.git/commit/4c4e700b056b545f7251ca8fc05d415e65f964eb rel="external nofollow noopener noreferrer" target=_blank title="add content of string dump&#10&#10Commit: 4c4e700b056b545f7251ca8fc05d415e65f964eb [4c4e700]&#10Author: czTangt&#10Date: 2025-07-13 13:35:57"><i class="fa-solid fa-hashtag fa-fw" aria-hidden=true></i>4c4e700</a></span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href="https://github.com/czTangt/blog.git/blob/main/content/posts/android/2024_Tencent_GameSec_Prelim.md?plain=1" title=查看源码 target=_blank rel="external nofollow noopener noreferrer" class=link-to-source>查看源码</a></span><span><a href=https://github.com/czTangt/blog.git/edit/main/content/posts/android/2024_Tencent_GameSec_Prelim.md title=编辑此页 target=_blank rel="external nofollow noopener noreferrer" class=link-to-edit>编辑此页</a></span><span><a href="https://github.com/czTangt/blog.git/issues/new?title=[BUG]%202024%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B&amp;body=%7cField%7cValue%7c%0A%7c-%7c-%7c%0A%7cTitle%7c2024%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B%7c%0A%7cURL%7chttps://czTangt.github.io/blog/posts/android/2024-tencent-gamesec-prelim/%7c%0A%7cFilename%7chttps://github.com/czTangt/blog.git/blob/main/content/posts/android/2024_Tencent_GameSec_Prelim.md?plain=1%7c" title=报告问题 target=_blank rel="external nofollow noopener noreferrer" class=link-to-report>报告问题</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 X" data-sharer=twitter data-url=https://czTangt.github.io/blog/posts/android/2024-tencent-gamesec-prelim/ data-title=2024腾讯游戏安全竞赛初赛 data-hashtags=android,game><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://czTangt.github.io/blog/posts/android/2024-tencent-gamesec-prelim/ data-hashtag=android><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://czTangt.github.io/blog/posts/android/2024-tencent-gamesec-prelim/ data-title=2024腾讯游戏安全竞赛初赛><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/blog/tags/android/ class=post-tag title="标签 - Android">Android</a><a href=/blog/tags/game/ class=post-tag title="标签 - Game">Game</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/blog/>主页</a></span></section></div><div class=post-nav><a href=/blog/posts/android/shell/ class=post-nav-item rel=prev title=Shell><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Shell</a><a href=/blog/posts/android/2024-tencent-gamesec-final/ class=post-nav-item rel=next title=2024腾讯游戏安全竞赛决赛>2024腾讯游戏安全竞赛决赛<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article><aside class=toc id=toc-auto aria-label=目录><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered order-1">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.150.0"><img class=hugo-icon src=/blog/images/hugo.min.svg alt="Hugo logo"> Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.4.0-alpha.1"><img class=fixit-icon src=/blog/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright order-2" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2024 - 2025</span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div></div><a href=https://github.com/czTangt/blog title="View source on GitHub" target=_blank rel="external nofollow" class="github-corner left d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true" width="56" height="56"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><div id=mask></div><noscript><div class=noscript-warning>该网站在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/blog/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/blog/lib/cookieconsent/cookieconsent.min.css><script src=/blog/lib/autocomplete/autocomplete.min.js defer></script><script src=/blog/lib/fuse/fuse.min.js defer></script><script src=/blog/lib/lightgallery/lightgallery.min.js defer></script><script src=/blog/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/blog/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/blog/lib/sharer/sharer.min.js async defer></script><script src=/blog/js/lib/mathjax.min.js async defer></script><script src=/blog/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/blog/js/codeblock.js defer></script><script src=https://libs.baidu.com/jquery/2.1.4/jquery.min.js defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:10},comment:{enable:!1},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightgallery:!0,search:{distance:100,findAllMatches:!1,fuseIndexURL:"/blog/search.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!1},version:"v0.4.0-alpha.1"}</script><script src=/blog/js/theme.min.js defer></script></body></html>